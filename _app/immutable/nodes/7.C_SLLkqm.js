import{t as ce,a as re}from"../chunks/Dl42bQaK.js";import"../chunks/Cns6LDpP.js";import{a5 as qe,ab as ae,ac as He,a6 as $e,a7 as p,a2 as g,ad as k,e as t,$ as Ge,a8 as u,aa as st,s as m,i as it,a9 as ot}from"../chunks/C_nTGglK.js";import{e as oe,s as K}from"../chunks/D15B_ygG.js";import{i as Fe}from"../chunks/BiG_kpbh.js";import{s as Q,r as Le}from"../chunks/CThLS2ih.js";import{l as We,s as nt,c as rt}from"../chunks/CSJ2tm9-.js";import{b as je}from"../chunks/RyJ3Hllu.js";import{b as _e}from"../chunks/BOcuyyEv.js";import{i as Be}from"../chunks/-d2lr63c.js";import{o as Xe}from"../chunks/BfnemT7e.js";import{r as ne,s as ct,v as dt,z as De,l as ft,m as vt,a as pt,d as ut,b as ht,e as gt}from"../chunks/Di72JI2_.js";import{_ as xt}from"../chunks/C1FmrZbK.js";import{p as Ne}from"../chunks/BSqzZcxX.js";var yt=ce('<main class="svelte-13sjxqj"><div class="viewer-container svelte-13sjxqj"><div id="viewer" class="svelte-13sjxqj"></div></div></main>');function mt(de,V){qe(V,!1);let P=`
ATOM      1  CH3 ACE     1       2.000   2.090   0.000
ATOM      2  C   ACE     1       3.427   2.641  -0.000
ATOM      3  O   ACE     1       4.391   1.877  -0.000
ATOM      4  N   ALA     2       3.555   3.970  -0.000
ATOM      5  CA  ALA     2       4.853   4.614  -0.000
ATOM     6  HA  ALA     2       5.408   4.316   0.890
ATOM     7  CB  ALA     2       5.661   4.221  -1.232
ATOM     8  C   ALA     2       4.713   6.129   0.000
ATOM     9  O   ALA     2       3.601   6.653   0.000
ATOM     10  N   NME     3       5.846   6.835   0.000
ATOM     11  H   NME     3       6.737   6.359  -0.000
ATOM     12  CH3 NME     3       5.846   8.284   0.000
TER   
END`,z=[6,7,8,9,10,11,12],w=4,R=5,O=Ne(V,"angle",8,50),G=Ne(V,"phiAngle",8,0);function H(i){let f;Math.abs(i.z)>.9?f={x:0,y:i.z,z:-i.y}:f={x:-i.y,y:i.x,z:0};let h=Math.sqrt(f.x**2+f.y**2+f.z**2);return f.x/=h,f.y/=h,f.z/=h,f}function j(i,f,h,v,N){let L=N*Math.PI/180,B=Math.cos(L),_=Math.sin(L),A=1-B,T=[[B+v.x**2*A,v.x*v.y*A-v.z*_,v.x*v.z*A+v.y*_],[v.y*v.x*A+v.z*_,B+v.y**2*A,v.y*v.z*A-v.x*_],[v.z*v.x*A-v.y*_,v.z*v.y*A+v.x*_,B+v.z**2*A]];return f.forEach(M=>{let E=i[M-1],W=E.x-h.x,J=E.y-h.y,x=E.z-h.z,X=T[0][0]*W+T[0][1]*J+T[0][2]*x,Y=T[1][0]*W+T[1][1]*J+T[1][2]*x,ee=T[2][0]*W+T[2][1]*J+T[2][2]*x;E.x=X+h.x,E.y=Y+h.y,E.z=ee+h.z}),i}function F(i,f,h,v,N,L){let _=i.split(`
`).filter(x=>x.startsWith("ATOM")).map(x=>{let X=parseFloat(x.substring(30,38).trim()),Y=parseFloat(x.substring(38,46).trim()),ee=parseFloat(x.substring(46,54).trim());return{x:X,y:Y,z:ee,line:x}}),A=_[h-1],T=_[v-1],M={x:T.x-A.x,y:T.y-A.y,z:T.z-A.z},E=Math.sqrt(M.x**2+M.y**2+M.z**2);M.x/=E,M.y/=E,M.z/=E;let W=H(M);return _=j(_,f,A,M,N),_=j(_,f,A,W,L),_.forEach(x=>{x.line=x.line.substring(0,30)+x.x.toFixed(3).padStart(8)+x.y.toFixed(3).padStart(8)+x.z.toFixed(3).padStart(8)+x.line.substring(54)}),_.map(x=>x.line).join(`
`)+`
TER
END`}let D=k(),d=k(),y=k();Xe(async()=>{if(typeof window<"u")try{const{createViewer:i}=await xt(async()=>{const{createViewer:f}=await import("../chunks/kNyKxqkf.js").then(h=>h._);return{createViewer:f}},[],import.meta.url);console.log("3Dmol.js loaded successfully"),g(d,i(t(y),{backgroundColor:"white"})),o(!0),window.addEventListener("resize",()=>{t(d)&&(t(d).resize(),t(d).render())})}catch(i){console.error("Failed to load 3Dmol.js:",i)}});function o(i=!0){t(d)&&(console.log("Updating viewer with angles:",O(),G()),t(d).clear(),t(d).addModel(t(D),"pdb"),t(d).setStyle({},{stick:{radius:.2},sphere:{scale:.3}}),i&&t(d).zoomTo(),t(d).render())}ae(()=>(Ge(O()),Ge(G())),()=>{g(D,F(P,z,w,R,O(),G()))}),ae(()=>(t(d),t(D)),()=>{t(d)&&t(D)&&o(!1)}),He(),Be();var Z=yt(),$=p(Z),U=p($);_e(U,i=>g(y,i),()=>t(y)),u($),u(Z),re(de,Z),$e()}var bt=ce(`<div class="game-ended-popup svelte-1feoufx"><div class="popup-content svelte-1feoufx"><h2 class="svelte-1feoufx">Game Ended</h2> <p class="svelte-1feoufx">You've used all your lives!</p> <button class="svelte-1feoufx">Play Again</button></div></div>`),_t=ce('<button class="svelte-1feoufx">Clear Samples</button>'),At=ce('<main class="svelte-1feoufx"><h1 class="svelte-1feoufx">Protein Backbone Conformation Explorer</h1> <div class="live-bar-container svelte-1feoufx"><div class="lives-label svelte-1feoufx"> </div> <div class="live-bar svelte-1feoufx"><div class="lives-remaining svelte-1feoufx"></div> <span class="heart svelte-1feoufx">❤️</span></div></div> <!> <div class="container svelte-1feoufx"><div class="panel svelte-1feoufx"><h2 class="svelte-1feoufx">Backbone Angles</h2> <canvas class="svelte-1feoufx"></canvas> <div class="Other"><div class="control-panel svelte-1feoufx"><div class="slider-container svelte-1feoufx"><label for="angle" class="svelte-1feoufx">Psi Angle (degrees):</label> <input type="range" id="angle" min="0" max="360" step="1" class="svelte-1feoufx"> <span class="svelte-1feoufx"> </span></div> <div class="slider-container svelte-1feoufx"><label for="phiAngle" class="svelte-1feoufx">Phi Angle (degrees):</label> <input type="range" id="phiAngle" min="0" max="360" step="1" class="svelte-1feoufx"> <span class="svelte-1feoufx"> </span></div></div> <!></div></div> <div class="panel svelte-1feoufx"><h2 class="svelte-1feoufx">Energy Landscape</h2> <div class="contour-container svelte-1feoufx"><canvas></canvas></div> <div class="info svelte-1feoufx"><p class="svelte-1feoufx"> </p> <p class="svelte-1feoufx"> </p> <div class="instruction svelte-1feoufx"><p class="highlight svelte-1feoufx">Click on the plot above to add sample points and update the GP model</p></div> <div class="button-group svelte-1feoufx"><!> <button class="info-button svelte-1feoufx"> </button></div> <div class="energy-function svelte-1feoufx"><h3 class="svelte-1feoufx">About the Visualization:</h3> <p class="svelte-1feoufx"> </p> <p class="svelte-1feoufx">The energy function represents different stable conformations of the protein backbone. Lighter regions indicate lower energy (more stable conformations).</p> <p class="svelte-1feoufx">Click directly on the plot to add sample points and build a GP model that learns this energy landscape.</p></div></div></div></div></main>');function Lt(de,V){qe(V,!1);const P=k(),z=k();let w=k([]),R=[],O=k(),G=k(),H=k(!1),j=k(!1),F=k(20),D=k(!1);const d=400,y=400,o=40,Z=d-2*o,$=We([0,360],[o,d-o]),U=We([0,360],[y-o,o]),i={primary:"#3c6382",secondary:"#82ccdd",accent:"#60a3bc",highlight:"#6a89cc",text:"#2c3e50",bond1:"#38ada9",bond2:"#6a89cc",atom1:"#3c6382",atom2:"#60a3bc",atom3:"#82ccdd",atom4:"#38ada9"};let f=1/0,h=-1/0;function v(){const n=ne(0,360,7.2).toArray(),s=ne(0,360,360/50).toArray();for(const a of n)for(const r of s){const c=L(a,r);f=Math.min(f,c),h=Math.max(h,c)}f=Math.floor(f*10)/10,h=Math.ceil(h*10)/10,console.log(`Energy range: ${f} to ${h}`)}function N(e){return e*(Math.PI/180)}function L(e,n){const s=N(e)-Math.PI,a=N(n)-Math.PI,r=Math.exp(-((s+Math.PI/2)**2)-(a-Math.PI/2)**2/.5),c=Math.exp(-((s+Math.PI/2)**2)-(a+.5)**2/.3),b=Math.exp(-((s-Math.PI/2)**2)-(a+Math.PI/2)**2/.5),C=Math.exp(-((s-Math.PI/2)**2)-(a-.5)**2/.3),I=Math.exp(-((s-0)**2)/.3-(a-Math.PI/4)**2/.2),l=r+c+b+C+I;return-Math.log(l+1e-6)}function B(){g(w,[]),R=[],M()}function _(e){if(t(H)||t(F)<=0)return;const n=t(G).getBoundingClientRect(),s=e.clientX-n.left,a=e.clientY-n.top,r=Math.round($.invert(s)),c=Math.round(U.invert(a));if(s>=o&&s<=d-o&&a>=o&&a<=y-o){g(P,r),g(z,c);const b=L(t(P),t(z));g(w,[...t(w),{phi:t(P),psi:t(z),energy:b}]),g(F,t(F)-1),t(F)===0&&g(D,!0),T(),W()}}function A(){g(F,20),g(w,[]),R=[],g(D,!1),M()}function T(){if(g(H,!0),t(w).length===0){g(H,!1),M();return}setTimeout(()=>{const e=t(w).map(l=>[l.phi,l.psi]),n=t(w).map(l=>l.energy),s=(l,S,se=1*(180/Math.PI))=>{const ie=pt(ut(ht(l,S),2));return gt(-.5*ie/(se*se))},a=e.length,r=De(a,a);for(let l=0;l<a;l++)for(let S=0;S<a;S++)r.set([l,S],s(e[l],e[S]));const c=.01;for(let l=0;l<a;l++)r.set([l,l],r.get([l,l])+c);const b=40,C=ne(0,360,360/b).toArray(),I=ne(0,360,360/b).toArray();R=[];for(const l of C)for(const S of I){const se=[l,S],ie=De(1,a);for(let q=0;q<a;q++)ie.set([0,q],s(se,e[q]));try{const q=ft(r,n),lt=vt(ie,q).get([0,0]);R.push({phi:l,psi:S,predicted:lt})}catch(q){console.error("Error in GP calculation:",q)}}M(),g(H,!1)},50)}function M(){if(!t(G))return;const e=t(G).getContext("2d");e.clearRect(0,0,d+60,y);const n=ct().domain([h,f]).interpolator(dt);if(t(j)||R.length===0){const a=Z/80;for(let r=0;r<80;r++)for(let c=0;c<80;c++){const b=0+360*r/80,C=0+360*c/80,I=L(b,C),l=$(b),S=U(C);e.fillStyle=n(I),e.fillRect(l-a/2,S-a/2,a,a)}}else{const s=Z/Math.sqrt(R.length);R.forEach(a=>{const r=$(a.phi),c=U(a.psi);e.fillStyle=n(a.predicted),e.fillRect(r-s/2,c-s/2,s,s)})}E(e,n),e.strokeStyle=i.primary,e.lineWidth=2,e.beginPath(),e.moveTo(o,y-o),e.lineTo(d-o,y-o),e.moveTo(o,o),e.lineTo(o,y-o),e.stroke(),e.fillStyle=i.text,e.font="bold 14px Arial, sans-serif",e.textAlign="center",e.fillText("0",o,y-o+15),e.fillText("180",d/2,y-o+15),e.fillText("360",d-o,y-o+15),e.fillText("φ",d-o+10,y-o+25),e.textAlign="right",e.fillText("0",o-5,y-o),e.fillText("180",o-5,y/2),e.fillText("360",o-5,o),e.fillText("ψ",o-20,o-20),t(w).forEach(s=>{const a=$(s.phi),r=U(s.psi),c=8,b=e.createRadialGradient(a,r,2,a,r,c);b.addColorStop(0,i.highlight),b.addColorStop(1,"rgba(106, 137, 204, 0)"),e.fillStyle=b,e.beginPath(),e.arc(a,r,c,0,2*Math.PI),e.fill(),e.fillStyle=i.accent,e.beginPath(),e.arc(a,r,4,0,2*Math.PI),e.fill(),e.strokeStyle=i.primary,e.lineWidth=1,e.stroke()})}function E(e,n){const a=y-2*o,r=d-o+20,c=o,b=100,C=a/b;for(let l=0;l<b;l++){const S=f+(h-f)*(b-l-1)/b;e.fillStyle=n(S),e.fillRect(r,c+l*C,20,C+1)}e.strokeStyle=i.text,e.lineWidth=1,e.strokeRect(r,c,20,a),e.fillStyle=i.text,e.font="12px Arial, sans-serif",e.textAlign="left",e.fillText(f.toFixed(1),r+20+5,c+a),e.fillText(h.toFixed(1),r+20+5,c);const I=(f+h)/2;e.fillText(I.toFixed(1),r+20+5,c+a/2),e.save(),e.translate(r+20+25,c+a/2),e.rotate(-Math.PI/2),e.textAlign="center",e.fillText("Energy",0,10),e.restore()}function W(){if(!t(O))return;const e=t(O).getContext("2d");e.clearRect(0,0,d,y);const n=d/2,s=y/2,a=120,r=e.createRadialGradient(n,s,0,n,s,a*1.5);r.addColorStop(0,"rgba(60, 99, 130, 0.1)"),r.addColorStop(1,"rgba(245, 246, 250, 0.05)"),e.fillStyle=r,e.fillRect(0,0,d,y);const c=e.createLinearGradient(n-a,s,n+a,s);c.addColorStop(0,i.secondary),c.addColorStop(.5,i.primary),c.addColorStop(1,i.secondary),e.strokeStyle=c,e.lineWidth=3,e.beginPath(),e.moveTo(n-a,s),e.lineTo(n+a,s),e.stroke();const b=[{x:n-a,y:s,color:i.atom1,label:"N",size:24},{x:n-a/2,y:s,color:i.atom2,label:"Cα",size:26},{x:n,y:s,color:i.atom3,label:"C",size:24},{x:n+a/2,y:s,color:i.atom4,label:"O",size:24},{x:n+a,y:s,color:i.atom1,label:"N",size:24}];e.save(),e.translate(n-a/2,s),e.rotate(N(t(P)));const C=e.createLinearGradient(0,0,0,-60);C.addColorStop(0,i.bond1),C.addColorStop(1,i.secondary),e.strokeStyle=C,e.lineWidth=3,e.beginPath(),e.moveTo(0,0),e.lineTo(0,-60),e.stroke(),e.fillStyle=i.text,e.font="bold 14px Arial, sans-serif",e.fillText("φ = "+t(P).toFixed(0),5,-30),e.restore(),e.save(),e.translate(n,s),e.rotate(N(t(z)));const I=e.createLinearGradient(0,0,0,-60);I.addColorStop(0,i.bond2),I.addColorStop(1,i.highlight),e.strokeStyle=I,e.lineWidth=3,e.beginPath(),e.moveTo(0,0),e.lineTo(0,-60),e.stroke(),e.fillStyle=i.text,e.font="bold 14px Arial, sans-serif",e.fillText("ψ = "+t(z).toFixed(0),5,-30),e.restore(),b.forEach(l=>{const S=e.createRadialGradient(l.x,l.y,0,l.x,l.y,l.size*1.2);S.addColorStop(0,l.color),S.addColorStop(1,"rgba(255, 255, 255, 0)"),e.fillStyle=S,e.beginPath(),e.arc(l.x,l.y,l.size*1.2,0,2*Math.PI),e.fill(),e.fillStyle=l.color,e.beginPath(),e.arc(l.x,l.y,l.size,0,2*Math.PI),e.fill(),e.fillStyle="#fff",e.font="bold 14px Arial, sans-serif",e.textAlign="center",e.textBaseline="middle",e.fillText(l.label,l.x,l.y)})}function J(){g(j,!t(j)),M()}Xe(()=>{v(),W(),M()}),ae(()=>{},()=>{g(P,0)}),ae(()=>{},()=>{g(z,0)}),ae(()=>(t(O),t(P),t(z)),()=>{t(O)&&(t(P)||t(z))&&W()}),He(),Be();var x=At(),X=m(p(x),2),Y=p(X),ee=p(Y);u(Y);var Ae=m(Y,2),Me=p(Ae),Ye=m(Me,2);u(Ae),u(X);var Se=m(X,2);{var Ke=e=>{var n=bt(),s=p(n),a=m(p(s),4);u(s),u(n),oe("click",a,A),re(e,n)};Fe(Se,e=>{t(D)&&e(Ke)})}var Pe=m(Se,2),fe=p(Pe),le=m(p(fe),2);Q(le,"width",d),Q(le,"height",y),_e(le,e=>g(O,e),()=>t(O));var ze=m(le,2),ve=p(ze),pe=p(ve),ue=m(p(pe),2);Le(ue);var Te=m(ue,2),Ze=p(Te);u(Te),u(pe);var Ce=m(pe,2),he=m(p(Ce),2);Le(he);var we=m(he,2),Ue=p(we);u(we),u(Ce),u(ve);var Je=m(ve,2);mt(Je,{get angle(){return t(P)},set angle(e){g(P,e)},get phiAngle(){return t(z)},set phiAngle(e){g(z,e)},$$legacy:!0}),u(ze),u(fe);var Ee=m(fe,2),ge=m(p(Ee),2),te=p(ge);Q(te,"width",d+60),Q(te,"height",y),_e(te,e=>g(G,e),()=>t(G)),u(ge);var ke=m(ge,2),xe=p(ke),Qe=p(xe);u(xe);var ye=m(xe,2),Ve=p(ye);u(ye);var me=m(ye,4),Ie=p(me);{var et=e=>{var n=_t();oe("click",n,B),re(e,n)};Fe(Ie,e=>{t(w).length>0&&e(et)})}var be=m(Ie,2),tt=p(be,!0);u(be),u(me);var Oe=m(me,2),Re=m(p(Oe),2),at=p(Re,!0);u(Re),ot(4),u(Oe),u(ke),u(Ee),u(Pe),u(x),st((e,n)=>{K(ee,`Lives ${t(F)??""}/20`),Q(Me,"style",`width: ${e??""}%`),Q(Ye,"style",`left: ${e??""}%`),K(Ze,`${t(z)??""}°`),K(Ue,`${t(P)??""}°`),nt(te,1,rt(t(H)?"loading":""),"svelte-1feoufx"),K(Qe,`Samples: ${t(w).length??""}`),K(Ve,`Current energy: ${n??""}`),K(tt,t(j)?"Show GP Prediction":"Show Energy Function"),K(at,t(j)?"Showing actual energy function":"Showing Gaussian Process prediction")},[()=>Math.max(0,t(F)/20*100),()=>L(t(P),t(z)).toFixed(2)],it),je(ue,()=>t(z),e=>g(z,e)),je(he,()=>t(P),e=>g(P,e)),oe("click",te,_),oe("click",be,J),re(de,x),$e()}export{Lt as component};
