import{t as ie,a as se}from"../chunks/cGtBC6Qd.js";import"../chunks/7LKkzqbz.js";import{a4 as tt,a1 as d,ac as F,e as t,aa as le,Z as Be,ab as at,a6 as i,a7 as n,a5 as st,a9 as fe,s as r,i as Ze,aw as ht,f as Ke,a8 as ft}from"../chunks/BJ4irGt7.js";import{e as K,s as U}from"../chunks/CvaqDwXv.js";import{i as be}from"../chunks/lIaEYNz1.js";import{s as J,r as Ae}from"../chunks/B9r3SdpA.js";import{l as Ue,s as Re,c as Je}from"../chunks/dhIx7U5O.js";import{b as mt,a as xe}from"../chunks/CI8f-3O8.js";import{b as Le}from"../chunks/CUY-1DrG.js";import{i as lt}from"../chunks/CkfO92w8.js";import{o as Fe}from"../chunks/Cpzjerpz.js";import{r as Me,s as _t,v as yt,z as Qe,l as bt,m as At,a as xt,d as Mt,b as wt,e as zt}from"../chunks/PBAI84v4.js";import{_ as St}from"../chunks/C1FmrZbK.js";import{p as Ve}from"../chunks/6XXKwe28.js";var Pt=ie('<main class="svelte-13sjxqj"><div class="viewer-container svelte-13sjxqj"><div id="viewer" class="svelte-13sjxqj"></div></div></main>');function et(we,ve){tt(ve,!1);let P=`
ATOM      1  CH3 ACE     1       2.000   2.090   0.000
ATOM      2  C   ACE     1       3.427   2.641  -0.000
ATOM      3  O   ACE     1       4.391   1.877  -0.000
ATOM      4  N   ALA     2       3.555   3.970  -0.000
ATOM      5  CA  ALA     2       4.853   4.614  -0.000
ATOM     6  HA  ALA     2       5.408   4.316   0.890
ATOM     7  CB  ALA     2       5.661   4.221  -1.232
ATOM     8  C   ALA     2       4.713   6.129   0.000
ATOM     9  O   ALA     2       3.601   6.653   0.000
ATOM     10  N   NME     3       5.846   6.835   0.000
ATOM     11  H   NME     3       6.737   6.359  -0.000
ATOM     12  CH3 NME     3       5.846   8.284   0.000
TER   
END`,T=[6,7,8,9,10,11,12],N=4,j=5,de=Ve(ve,"angle",8,50),L=Ve(ve,"phiAngle",8,0);function Z(f){let m;Math.abs(f.z)>.9?m={x:0,y:f.z,z:-f.y}:m={x:-f.y,y:f.x,z:0};let _=Math.sqrt(m.x**2+m.y**2+m.z**2);return m.x/=_,m.y/=_,m.z/=_,m}function H(f,m,_,g,te){let I=te*Math.PI/180,O=Math.cos(I),w=Math.sin(I),z=1-O,S=[[O+g.x**2*z,g.x*g.y*z-g.z*w,g.x*g.z*z+g.y*w],[g.y*g.x*z+g.z*w,O+g.y**2*z,g.y*g.z*z-g.x*w],[g.z*g.x*z-g.y*w,g.z*g.y*z+g.x*w,O+g.z**2*z]];return m.forEach($=>{let D=f[$-1],ae=D.x-_.x,ne=D.y-_.y,b=D.z-_.z,G=S[0][0]*ae+S[0][1]*ne+S[0][2]*b,ue=S[1][0]*ae+S[1][1]*ne+S[1][2]*b,re=S[2][0]*ae+S[2][1]*ne+S[2][2]*b;D.x=G+_.x,D.y=ue+_.y,D.z=re+_.z}),f}function Q(f,m,_,g,te,I){let w=f.split(`
`).filter(b=>b.startsWith("ATOM")).map(b=>{let G=parseFloat(b.substring(30,38).trim()),ue=parseFloat(b.substring(38,46).trim()),re=parseFloat(b.substring(46,54).trim());return{x:G,y:ue,z:re,line:b}}),z=w[_-1],S=w[g-1],$={x:S.x-z.x,y:S.y-z.y,z:S.z-z.z},D=Math.sqrt($.x**2+$.y**2+$.z**2);$.x/=D,$.y/=D,$.z/=D;let ae=Z($);return w=H(w,m,z,$,te),w=H(w,m,z,ae,I),w.forEach(b=>{b.line=b.line.substring(0,30)+b.x.toFixed(3).padStart(8)+b.y.toFixed(3).padStart(8)+b.z.toFixed(3).padStart(8)+b.line.substring(54)}),w.map(b=>b.line).join(`
`)+`
TER
END`}let Y=F(),y=F(),ee=F();Fe(async()=>{if(typeof window<"u")try{const{createViewer:f}=await St(async()=>{const{createViewer:m}=await import("../chunks/kNyKxqkf.js").then(_=>_._);return{createViewer:m}},[],import.meta.url);console.log("3Dmol.js loaded successfully"),d(y,f(t(ee),{backgroundColor:"white"})),C(!0),window.addEventListener("resize",()=>{t(y)&&(t(y).resize(),t(y).render())})}catch(f){console.error("Failed to load 3Dmol.js:",f)}});function C(f=!0){t(y)&&(console.log("Updating viewer with angles:",de(),L()),t(y).clear(),t(y).addModel(t(Y),"pdb"),t(y).setStyle({},{stick:{radius:.2},sphere:{scale:.3}}),f&&t(y).zoomTo(),t(y).render())}le(()=>(Be(de()),Be(L())),()=>{d(Y,Q(P,T,N,j,de(),L()))}),le(()=>(t(y),t(Y)),()=>{t(y)&&t(Y)&&C(!1)}),at(),lt();var x=Pt(),c=i(x),pe=i(c);Le(pe,f=>d(ee,f),()=>t(ee)),n(c),n(x),se(we,x),st()}var Tt=ie(`<div class="game-ended-popup svelte-17ca876"><div class="popup-content svelte-17ca876"><h2 class="svelte-17ca876">Game Ended</h2> <p class="svelte-17ca876">You've used all your lives!</p> <p class="svelte-17ca876"> </p> <button class="svelte-17ca876">Play Again</button></div></div>`),Et=ie('<button class="svelte-17ca876">Clear Samples</button>'),kt=ie('<div class="panel svelte-17ca876"><h2 class="svelte-17ca876">Backbone Angles</h2> <div class="molecule-visualization svelte-17ca876"><!></div> <div class="control-panel svelte-17ca876"><div class="slider-container svelte-17ca876"><label for="angle" class="svelte-17ca876">Œ® Angle (degrees):</label> <input type="range" id="angle" min="0" max="360" step="1" class="svelte-17ca876"> <span class="svelte-17ca876"> </span></div> <div class="slider-container svelte-17ca876"><label for="phiAngle" class="svelte-17ca876">Œ¶ Angle (degrees):</label> <input type="range" id="phiAngle" min="0" max="360" step="1" class="svelte-17ca876"> <span class="svelte-17ca876"> </span></div></div></div> <div class="panel svelte-17ca876"><h2 class="svelte-17ca876">Energy Landscape</h2> <div class="contour-container svelte-17ca876"><canvas></canvas></div> <div class="button-group svelte-17ca876"><!> <button class="info-button svelte-17ca876"> </button></div> <div class="instruction svelte-17ca876"><p class="svelte-17ca876">Click directly on the plot above to sample points. This will run the simulation and update the emulator model based on the simulator output.</p></div></div>',1),Ct=ie('<button class="svelte-17ca876">Clear Samples</button>'),It=ie('<div class="grid-item energy-plot svelte-17ca876"><h2 class="svelte-17ca876">Energy Landscape</h2> <div class="contour-container svelte-17ca876"><canvas></canvas></div></div> <div class="grid-item buttons svelte-17ca876"><div class="instruction svelte-17ca876"><p class="svelte-17ca876">Click directly on the plot to sample points. This will run the simulation and update the emulator model based on the simulator output.</p></div> <div class="vertical-button-group svelte-17ca876"><!> <button class="info-button svelte-17ca876"> </button></div></div> <div class="grid-item molecule-panel svelte-17ca876"><h2 class="svelte-17ca876">Backbone Angles</h2> <div class="molecule-visualization svelte-17ca876"><!></div></div> <div class="grid-item angle-sliders svelte-17ca876"><div class="vertical-control-panel svelte-17ca876"><div class="compact-slider-container svelte-17ca876"><label for="angle-vertical" class="svelte-17ca876">Œ® Angle:</label> <input type="range" id="angle-vertical" min="0" max="360" step="1" class="svelte-17ca876"> <span class="svelte-17ca876"> </span></div> <div class="compact-slider-container svelte-17ca876"><label for="phiAngle-vertical" class="svelte-17ca876">Œ¶ Angle:</label> <input type="range" id="phiAngle-vertical" min="0" max="360" step="1" class="svelte-17ca876"> <span class="svelte-17ca876"> </span></div></div></div>',1),Ot=ie(`<main class="svelte-17ca876"><h1 class="svelte-17ca876">Protein Explorer</h1> <div class="instruction svelte-17ca876"><p class="svelte-17ca876">Rotating backbone angles changes the protein's shape, affecting its stability. Lower energy regions correspond to more stable conformations.</p></div> <div class="instruction svelte-17ca876"><p class="highlight svelte-17ca876">Your goal is to train an emulator that accurately predicts the energy function using as few protein simulator runs as possible.</p></div> <div class="bars-container svelte-17ca876"><div class="live-bar-container svelte-17ca876"><div class="lives-label"> </div> <div class="live-bar svelte-17ca876"><div class="lives-remaining svelte-17ca876"></div> <span class="heart svelte-17ca876">üí∑</span></div></div> <div></div> <div class="score-bar-container svelte-17ca876"><div class="score-label">Score: <span id="score-percentage"> </span></div> <div class="score-bar svelte-17ca876"><div class="score-value svelte-17ca876" id="score-bar"></div> <span class="star svelte-17ca876" id="score-star">‚≠ê</span></div></div></div> <!> <div class="level-container svelte-17ca876"><label for="level" class="level-label svelte-17ca876">Difficulty:</label> <select id="level" class="svelte-17ca876"><option>Level 1</option><option>Level 2</option><option>Level 3</option></select></div> <div><!></div> <div class="button-group svelte-17ca876" style="margin-top: 20px; text-align: center;"><button class="info-button svelte-17ca876"><span>Go back</span></button></div></main>`);function Zt(we,ve){tt(ve,!1);const P=F(),T=F(),N=F(),j=F();function de(){window.location.href="https://alan-turing-institute.github.io/gp-demo/"}let L=F([]),Z=[],H=F(),Q=F(!1),Y=F(!1),y=F(20),ee=F(!1);const C=400,x=400,c=40,pe=C-2*c,f=Ue([0,360],[c,C-c]),m=Ue([0,360],[x-c,c]),_={primary:"#3c6382",accent:"#60a3bc",highlight:"#6a89cc",text:"#2c3e50"};let g=F(!1);function te(){d(g,window.innerHeight>window.innerWidth)}Fe(()=>(w(),G(),te(),window.addEventListener("resize",te),()=>{window.removeEventListener("resize",te)}));let I=1/0,O=-1/0;function w(){const p=Me(0,360,7.2).toArray(),o=Me(0,360,360/50).toArray();for(const a of p)for(const l of o){const s=S(a,l);I=Math.min(I,s),O=Math.max(O,s)}I=Math.floor(I*10)/10,O=Math.ceil(O*10)/10,console.log(`Energy range: ${I} to ${O}`)}function z(e){return e*(Math.PI/180)}function S(e,p){const o=z(e)-Math.PI,a=z(p)-Math.PI,l=Math.exp(-((o+Math.PI/2)**2)-(a-Math.PI/2)**2/.5),s=Math.exp(-((o+Math.PI/2)**2)-(a+.5)**2/.3),v=Math.exp(-((o-Math.PI/2)**2)-(a+Math.PI/2)**2/.5),h=Math.exp(-((o-Math.PI/2)**2)-(a-.5)**2/.3),M=Math.exp(-((o-0)**2)/.3-(a-Math.PI/4)**2/.2);let A=0;return t(j)=="1"?A=l:t(j)=="2"?A=l+s:t(j)=="3"?A=l+s+v+h+M:console.error("Invalid difficulty level: ",t(j)),-Math.log(A+1e-6)}function $(){d(L,[]),Z=[],G(),d(y,20),d(N,0)}function D(e){if(t(Q)||t(y)<=0)return;const p=t(H).getBoundingClientRect(),o=t(H).width/p.width,a=t(H).height/p.height,l=(e.clientX-p.left)*o,s=(e.clientY-p.top)*a,v=Math.round(f.invert(l)),h=Math.round(m.invert(s));if(l>=c&&l<=C-c&&s>=c&&s<=x-c){d(P,v),d(T,h);const M=S(t(P),t(T));d(L,[...t(L),{phi:t(P),psi:t(T),energy:M}]),d(y,t(y)-1),t(y)===0&&d(ee,!0),b()}}function ae(){d(y,20),d(N,0),d(L,[]),Z=[],d(ee,!1),G()}function ne(e,p){if(e.length!==p.length||e.length===0)throw new Error("Arrays must be of the same length and non-empty");const o=e.reduce((v,h)=>v+h,0)/e.length,a=e.reduce((v,h)=>v+Math.pow(h-o,2),0),s=1-e.reduce((v,h,M)=>v+Math.pow(h-p[M],2),0)/a;return Math.max(0,s)}function b(){d(Q,!0);let e=[],p=[];if(t(L).length===0){d(Q,!1),G();return}setTimeout(()=>{console.log("Updating GP model...");const o=t(L).map(u=>[u.phi,u.psi]),a=t(L).map(u=>u.energy),l=(u,E,V=1*(180/Math.PI))=>{const B=xt(Mt(wt(u,E),2));return zt(-.5*B/(V*V))},s=o.length,v=Qe(s,s);for(let u=0;u<s;u++)for(let E=0;E<s;E++)v.set([u,E],l(o[u],o[E]));const h=.01;for(let u=0;u<s;u++)v.set([u,u],v.get([u,u])+h);const M=40,A=Me(0,360,360/M).toArray(),X=Me(0,360,360/M).toArray();Z=[];for(const u of A)for(const E of X){const V=[u,E],B=Qe(1,s);for(let R=0;R<s;R++)B.set([0,R],l(V,o[R]));try{const R=bt(v,a),q=At(B,R).get([0,0]);Z.push({phi:u,psi:E,predicted:q}),p.push(q),e.push(S(u,E))}catch(R){console.error("Error in GP calculation:",R)}}G(),d(N,ne(e,p)),console.log("R2 Score: ",t(N)),d(Q,!1)},50)}function G(){if(!t(H))return;const e=t(H).getContext("2d");e.clearRect(0,0,C+60,x);const p=_t().domain([O,I]).interpolator(yt);if(t(Y)){const a=pe/80;for(let l=0;l<80;l++)for(let s=0;s<80;s++){const v=0+360*l/80,h=0+360*s/80,M=S(v,h),A=f(v),X=m(h);e.fillStyle=p(M),e.fillRect(A-a/2,X-a/2,a,a)}}else if(Z.length===0){const a=pe/80;for(let l=0;l<80;l++)for(let s=0;s<80;s++){const v=0+360*l/80,h=0+360*s/80,M=f(v),A=m(h);e.fillStyle=p(0),e.fillRect(M-a/2,A-a/2,a,a)}}else{const o=pe/Math.sqrt(Z.length);Z.forEach(a=>{const l=f(a.phi),s=m(a.psi);e.fillStyle=p(a.predicted),e.fillRect(l-o/2,s-o/2,o,o)})}ue(e,p),e.strokeStyle=_.primary,e.lineWidth=2,e.beginPath(),e.moveTo(c,x-c),e.lineTo(C-c,x-c),e.moveTo(c,c),e.lineTo(c,x-c),e.stroke(),e.fillStyle=_.text,e.font="bold 14px Arial, sans-serif",e.textAlign="center",e.fillText("0",c,x-c+15),e.fillText("180",C/2,x-c+15),e.fillText("360",C-c,x-c+15),e.fillText("œÜ",C-c+10,x-c+25),e.textAlign="right",e.fillText("0",c-5,x-c),e.fillText("180",c-5,x/2),e.fillText("360",c-5,c),e.fillText("œà",c-20,c-20),t(L).forEach(o=>{const a=f(o.phi),l=m(o.psi),s=8,v=e.createRadialGradient(a,l,2,a,l,s);v.addColorStop(0,_.highlight),v.addColorStop(1,"rgba(106, 137, 204, 0)"),e.fillStyle=v,e.beginPath(),e.arc(a,l,s,0,2*Math.PI),e.fill(),e.fillStyle=_.accent,e.beginPath(),e.arc(a,l,4,0,2*Math.PI),e.fill(),e.strokeStyle=_.primary,e.lineWidth=1,e.stroke()})}function ue(e,p){const a=x-2*c,l=C-c+20,s=c,v=100,h=a/v;for(let A=0;A<v;A++){const X=I+(O-I)*(v-A-1)/v;e.fillStyle=p(X),e.fillRect(l,s+A*h,20,h+1)}e.strokeStyle=_.text,e.lineWidth=1,e.strokeRect(l,s,20,a),e.fillStyle=_.text,e.font="12px Arial, sans-serif",e.textAlign="left",e.fillText(I.toFixed(1),l+20+5,s+a),e.fillText(O.toFixed(1),l+20+5,s);const M=(I+O)/2;e.fillText(M.toFixed(1),l+20+5,s+a/2),e.save(),e.translate(l+20+25,s+a/2),e.rotate(-Math.PI/2),e.textAlign="center",e.fillText("Energy",0,10),e.restore()}function re(){d(Y,!t(Y)),G()}Fe(()=>{w(),setTimeout(()=>{G()},100)});function it(e){d(j,e.target.value),t(Y)&&G(),console.log("Difficulty level set to: ",t(j))}le(()=>{},()=>{d(P,0)}),le(()=>{},()=>{d(T,0)}),le(()=>{},()=>{d(N,0)}),le(()=>(t(P),t(T)),()=>{}),le(()=>{},()=>{d(j,"3")}),at(),lt();var ze=Ot(),Se=r(i(ze),6),Pe=i(Se),Te=i(Pe),nt=i(Te);n(Te);var $e=r(Te,2),De=i($e),rt=r(De,2);n($e),n(Pe);var We=r(Pe,4),Ee=i(We),je=r(i(Ee)),ot=i(je);n(je),n(Ee);var He=r(Ee,2),Ge=i(He),ct=r(Ge,2);n(He),n(We),n(Se);var qe=r(Se,2);{var vt=e=>{var p=Tt(),o=i(p),a=r(i(o),4),l=i(a);n(a);var s=r(a,2);n(o),n(p),fe(v=>U(l,`Final score: ${v??""}%`),[()=>(t(N)*100).toFixed(0)],Ze),K("click",s,ae),se(e,p)};be(qe,e=>{t(ee)&&e(vt)})}var ke=r(qe,2),me=r(i(ke),2);fe(()=>{t(j),ht(()=>{})});var Ce=i(me);Ce.value=(Ce.__value="1")==null?"":"1";var Ie=r(Ce);Ie.value=(Ie.__value="2")==null?"":"2";var Ne=r(Ie);Ne.value=(Ne.__value="3")==null?"":"3",n(me),n(ke);var _e=r(ke,2),dt=i(_e);{var pt=e=>{var p=kt(),o=Ke(p),a=r(i(o),2);J(a,"style",`width: ${C}px; height: ${x}px;`);var l=i(a);et(l,{get angle(){return t(P)},set angle(k){d(P,k)},get phiAngle(){return t(T)},set phiAngle(k){d(T,k)},$$legacy:!0}),n(a);var s=r(a,2),v=i(s),h=r(i(v),2);Ae(h);var M=r(h,2),A=i(M);n(M),n(v);var X=r(v,2),u=r(i(X),2);Ae(u);var E=r(u,2),V=i(E);n(E),n(X),n(s),n(o);var B=r(o,2),R=r(i(B),2),q=i(R);J(q,"width",C+60),J(q,"height",x),Le(q,k=>d(H,k),()=>t(H)),n(R);var oe=r(R,2),ge=i(oe);{var Oe=k=>{var ye=Et();K("click",ye,$),se(k,ye)};be(ge,k=>{t(L).length>0&&k(Oe)})}var ce=r(ge,2),he=i(ce,!0);n(ce),n(oe),ft(2),n(B),fe(()=>{U(A,`${t(T)??""}¬∞`),U(V,`${t(P)??""}¬∞`),Re(q,1,Je(t(Q)?"loading":""),"svelte-17ca876"),U(he,t(Y)?"Show Emulator Prediction":"Show Simulator Function")}),xe(h,()=>t(T),k=>d(T,k)),xe(u,()=>t(P),k=>d(P,k)),K("click",q,D),K("click",ce,re),se(e,p)},ut=e=>{var p=It(),o=Ke(p),a=r(i(o),2),l=i(a);J(l,"width",C+60),J(l,"height",x),Le(l,W=>d(H,W),()=>t(H)),n(a),n(o);var s=r(o,2),v=r(i(s),2),h=i(v);{var M=W=>{var Xe=Ct();K("click",Xe,$),se(W,Xe)};be(h,W=>{t(L).length>0&&W(M)})}var A=r(h,2),X=i(A,!0);n(A),n(v),n(s);var u=r(s,2),E=r(i(u),2),V=i(E);et(V,{get angle(){return t(P)},set angle(W){d(P,W)},get phiAngle(){return t(T)},set phiAngle(W){d(T,W)},$$legacy:!0}),n(E),n(u);var B=r(u,2),R=i(B),q=i(R),oe=r(i(q),2);Ae(oe);var ge=r(oe,2),Oe=i(ge);n(ge),n(q);var ce=r(q,2),he=r(i(ce),2);Ae(he);var k=r(he,2),ye=i(k);n(k),n(ce),n(R),n(B),fe(()=>{Re(l,1,Je(t(Q)?"loading":""),"svelte-17ca876"),U(X,t(Y)?"Show Emulator Prediction":"Show Simulator Function"),U(Oe,`${t(T)??""}¬∞`),U(ye,`${t(P)??""}¬∞`)}),K("click",l,D),K("click",A,re),xe(oe,()=>t(T),W=>d(T,W)),xe(he,()=>t(P),W=>d(P,W)),se(e,p)};be(dt,e=>{t(g)?e(ut,!1):e(pt)})}n(_e);var Ye=r(_e,2),gt=i(Ye);n(Ye),n(ze),fe((e,p)=>{U(nt,`Guesses left ${t(y)??""}/20`),J(De,"style",`width: ${e??""}%`),J(rt,"style",`left: ${e??""}%`),U(ot,`${p??""}%`),J(Ge,"style",`width: ${t(N)*100}%`),J(ct,"style",`left: ${t(N)*100}%`),Re(_e,1,`responsive-grid ${(t(g)?"vertical":"horizontal")??""}`,"svelte-17ca876")},[()=>Math.max(0,t(y)/20*100),()=>(t(N)*100).toFixed(0)],Ze),mt(me,()=>t(j),e=>d(j,e)),K("change",me,it),K("click",gt,de),se(we,ze),st()}export{Zt as component};
