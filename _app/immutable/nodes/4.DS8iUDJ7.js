import{t as ft,a as dt}from"../chunks/cGtBC6Qd.js";import"../chunks/7LKkzqbz.js";import{a4 as le,aa as Rt,ab as ae,a9 as Wt,a5 as ne,s as g,a6 as v,i as Ct,e as i,ac as P,a1 as h,a7 as f}from"../chunks/BJ4irGt7.js";import{e as B,s as J}from"../chunks/CvaqDwXv.js";import{i as Vt}from"../chunks/lIaEYNz1.js";import{s as I}from"../chunks/B9r3SdpA.js";import{l as vt,s as re,c as ce}from"../chunks/dhIx7U5O.js";import{b as It}from"../chunks/CUY-1DrG.js";import{i as de}from"../chunks/CkfO92w8.js";import{o as ve}from"../chunks/Cpzjerpz.js";import{r as Q,s as fe,v as Ft,z as Gt,l as pe,m as he}from"../chunks/PBAI84v4.js";var ge=ft(`<div class="game-ended-popup svelte-9fpox1"><div class="popup-content svelte-9fpox1"><h2 class="svelte-9fpox1">Game Ended</h2> <p class="svelte-9fpox1">You've used all your lives!</p> <p class="svelte-9fpox1"> </p> <button class="svelte-9fpox1">Play Again</button></div></div>`),ue=ft('<button class="svelte-9fpox1">Clear Samples</button>'),me=ft('<main class="svelte-9fpox1"><h1 class="svelte-9fpox1">Asteroid Explorer</h1> <div class="live-bar-container svelte-9fpox1"><div class="lives-label svelte-9fpox1"> </div> <div class="live-bar svelte-9fpox1"><div class="lives-remaining svelte-9fpox1"></div> <span class="heart svelte-9fpox1">❤️</span></div></div> <div class="score-bar-container svelte-9fpox1"><div class="score-label svelte-9fpox1">Score: <span id="score-percentage"> </span></div> <div class="score-bar svelte-9fpox1"><div class="score-value svelte-9fpox1" id="score-bar"></div> <span class="star svelte-9fpox1" id="score-star">⭐</span></div></div> <!> <div class="container svelte-9fpox1"><div class="panel svelte-9fpox1"><h2 class="svelte-9fpox1">Asteroid Visualization</h2> <canvas class="svelte-9fpox1"></canvas> <div class="info svelte-9fpox1"><div class="instruction svelte-9fpox1"><p class="svelte-9fpox1">Flyby distance is the closest approach distance given an object’s hyperbolic speed and impact parameter. A value of 0 indicates a collision with Earth.</p> <div class="button-group svelte-9fpox1"><button class="info-button svelte-9fpox1"><span>Go back</span></button></div></div></div></div> <div class="panel svelte-9fpox1"><h2 class="svelte-9fpox1">Flyby distance past Earth</h2> <div class="contour-container svelte-9fpox1"><canvas></canvas></div> <div class="info svelte-9fpox1"><div class="instruction svelte-9fpox1"><p class="highlight svelte-9fpox1">Your goal is to train an emulator that accurately predicts flyby distance using as few asteroid simulator runs as possible.</p> <p class="svelte-9fpox1">Click directly on the plot above to sample points. This will run the simulation and update the emulator model based on the simulator output.</p></div> <div class="button-group svelte-9fpox1"><!> <button class="info-button svelte-9fpox1"> </button></div></div></div></div></main>');function ze($t,Yt){le(Yt,!1);const E=P();function Ht(){window.location.href="https://alan-turing-institute.github.io/gp-demo/"}const d={primary:"#3c6382",accent:"#60a3bc",highlight:"#6a89cc",text:"#2c3e50",surface:"#dcdde1",error:"#e55039"};let F=P(5e3),G=P(3),A=P([]),$=[],Y=P(),R=P(),L=P(!1),D=P(!1),W=P(20),U=P(!1);const M=6371;function Lt(t,a,r=398600.4418,e=6371){const o=Math.sqrt(1+Math.pow(a,2)*Math.pow(t,4)/Math.pow(r,2)),s=r*(o-1)/Math.pow(t,2);return s>=e?s:0}function K(t,a){return Lt(a,t)}const b=400,y=400,l=40,tt=b-2*l,X=vt().domain([5e3,5*M]).range([l,b-l]),O=vt().domain([3,20]).range([y-l,l]);let w=1/0,C=-1/0;function Xt(){const a=Q(5e3,5*M,(5*M-5e3)/50).toArray(),r=Q(3,20,17/50).toArray();for(const e of a)for(const o of r){const s=K(e,o);w=Math.min(w,s),C=Math.max(C,s)}w=Math.floor(w*10)/10,C=Math.ceil(C*10)/10,console.log(`Energy range: ${w} to ${C}`)}function Ot(){h(A,[]),$=[],j(),h(W,20),h(E,0)}function jt(t){if(i(L)||i(W)<=0)return;const a=i(R).getBoundingClientRect(),r=t.clientX-a.left,e=t.clientY-a.top;if(r>=l&&r<=b-l&&e>=l&&e<=y-l){const o=X.invert(r),s=O.invert(e);h(F,o),h(G,s);const n=K(i(F),i(G));h(A,[...i(A),{angle:i(F),velocity:i(G),energy:n}]),h(W,i(W)-1),i(W)===0&&h(U,!0),Dt(),et()}}function qt(){h(W,20),h(E,0),h(A,[]),$=[],h(U,!1),j()}function Bt(t,a){if(t.length!==a.length||t.length===0)throw new Error("Arrays must be of the same length and non-empty");const r=t.reduce((n,m)=>n+m,0)/t.length,e=t.reduce((n,m)=>n+Math.pow(m-r,2),0),s=1-t.reduce((n,m,_)=>n+Math.pow(m-a[_],2),0)/e;return Math.max(0,s)}function Dt(){h(L,!0);let t=[],a=[];if(i(A).length===0){h(L,!1);return}setTimeout(()=>{const r=i(A).map(c=>[c.angle,c.velocity]),e=i(A).map(c=>c.energy),o=(c,u)=>{const S=(c[0]-u[0])/1e4,k=(c[1]-u[1])/5;return Math.exp(-.5*(S*S+k*k))},s=r.length,n=Gt(s,s);for(let c=0;c<s;c++)for(let u=0;u<s;u++)n.set([c,u],o(r[c],r[u]));const m=.01;for(let c=0;c<s;c++)n.set([c,c],n.get([c,c])+m);const _=40,x=Q(5e3,5*M,(5*M-5e3)/_).toArray(),T=Q(3,20,17/_).toArray();$=[];for(const c of x)for(const u of T){const S=[c,u],k=Gt(1,s);for(let p=0;p<s;p++)k.set([0,p],o(S,r[p]));try{const p=pe(n,e),H=he(k,p).get([0,0]);$.push({angle:c,velocity:u,predicted:H}),a.push(H),t.push(K(c,u))}catch(p){console.error("Error in GP calculation:",p)}}j(),h(E,Bt(t,a)),h(L,!1)},50)}function j(){if(!i(R))return;const t=i(R).getContext("2d");t.clearRect(0,0,i(R).width,i(R).height);const a=fe(Ft).domain([C,w]).interpolator(Ft);if(i(D)){const e=tt/80;for(let o=0;o<80;o++)for(let s=0;s<80;s++){const n=5e3+(5*M-5e3)*o/80,m=3+17*s/80,_=K(n,m),x=X(n),T=O(m);t.fillStyle=a(_),t.fillRect(x-e/2,T-e/2,e,e)}}else if($.length===0){const e=tt/80;for(let o=0;o<80;o++)for(let s=0;s<80;s++){const n=5e3+(5*M-5e3)*o/80,m=3+17*s/80,_=X(n),x=O(m);t.fillStyle=a(0),t.fillRect(_-e/2,x-e/2,e,e)}}else{const r=tt/Math.sqrt($.length);$.forEach(e=>{const o=X(e.angle),s=O(e.velocity);t.fillStyle=a(e.predicted),t.fillRect(o-r/2,s-r/2,r,r)})}Kt(t,a),t.strokeStyle=d.primary,t.lineWidth=2,t.beginPath(),t.moveTo(l,y-l),t.lineTo(b-l,y-l),t.moveTo(l,l),t.lineTo(l,y-l),t.stroke(),t.fillStyle=d.text,t.font="12px Arial, sans-serif",t.textAlign="center",t.fillText("5000",l,y-l+15),t.fillText(String(5*M),b-l,y-l+15),t.fillText("Impact parameter (km)",b/2,y-l+20),t.textAlign="right",t.fillText("3",l-10,y-l),t.fillText("20",l-10,l),t.save(),t.translate(l-15,y/2-25),t.rotate(-Math.PI/2),t.fillText("Velocity (km/s)",0,0),t.restore(),i(A).forEach(r=>{const e=X(r.angle),o=O(r.velocity),s=10,n=t.createRadialGradient(e,o,2,e,o,s);n.addColorStop(0,d.highlight),n.addColorStop(1,"rgba(106, 137, 204, 0)"),t.fillStyle=n,t.beginPath(),t.arc(e,o,s,0,2*Math.PI),t.fill(),t.fillStyle=d.accent,t.beginPath(),t.arc(e,o,6,0,2*Math.PI),t.fill(),t.strokeStyle=d.primary,t.lineWidth=1,t.stroke()})}function Kt(t,a){const e=y-2*l,o=b-l+20,s=l,n=100,m=e/n;for(let u=0;u<n;u++){const S=w+(C-w)*(n-u-1)/n;t.fillStyle=a(S),t.fillRect(o,s+u*m,20,m+1)}t.strokeStyle=d.text,t.lineWidth=1,t.strokeRect(o,s,20,e),t.fillStyle=d.text,t.font="14px Arial, sans-serif",t.textAlign="left";const _=5,x=s+e;t.beginPath(),t.moveTo(o,x),t.lineTo(o+20,x),t.stroke(),t.fillText(w.toFixed(1),o+20+_,x+5);const T=s;t.beginPath(),t.moveTo(o,T),t.lineTo(o+20,T),t.stroke(),t.fillText(C.toFixed(1),o+20+_,T+5);const c=s+e/2;t.beginPath(),t.moveTo(o,c),t.stroke(),t.save(),t.translate(o-25,s+e/2),t.rotate(Math.PI/2),t.textAlign="center",t.fillText("Flyby Distance (km)",0,-60),t.restore()}function et(){if(!i(Y))return;const t=i(Y).getContext("2d");t.clearRect(0,0,b,y);const e=vt().domain([5e3,5*M]).range([y-l-30,l])(i(F)),o=l*2;t.save(),t.setLineDash([5,5]),t.beginPath(),t.moveTo(0,e),t.lineTo(b,e),t.strokeStyle=d.error,t.lineWidth=1,t.stroke(),t.restore();const s=20,n=12,m=2*Math.PI/n;t.beginPath();for(let Z=0;Z<n;Z++){const Mt=Z*m,se=.8+Math.random()*.4,wt=s*se,zt=o+wt*Math.cos(Mt),Et=e+wt*Math.sin(Mt);Z===0?t.moveTo(zt,Et):t.lineTo(zt,Et)}t.closePath(),t.fillStyle=d.surface,t.fill(),t.strokeStyle=d.primary,t.lineWidth=2,t.stroke(),t.fillStyle=d.text,t.font="12px Arial",t.textAlign="center",t.fillText("Asteroid",o,e+s+15);const x=i(G)*10;t.beginPath(),t.moveTo(o,e),t.lineTo(o+x,e),t.strokeStyle=d.error,t.lineWidth=3,t.stroke();const T=8;t.beginPath(),t.moveTo(o+x,e),t.lineTo(o+x-T,e-T/2),t.lineTo(o+x-T,e+T/2),t.closePath(),t.fillStyle=d.error,t.fill();const c=o+x/2,u=e;t.fillStyle=d.text,t.font="12px Arial",t.textAlign="center",t.fillText("velocity",c+25,u-10);const S=20,k=b-l-S,p=y-l-S,H=t.createRadialGradient(k,p,S*.3,k,p,S);H.addColorStop(0,"#66ccff"),H.addColorStop(1,"#003366"),t.beginPath(),t.arc(k,p,S,0,2*Math.PI),t.fillStyle=H,t.fill(),t.strokeStyle="#002244",t.lineWidth=2,t.stroke(),t.beginPath(),t.moveTo(0,p),t.lineTo(b,p),t.strokeStyle=d.primary,t.lineWidth=2,t.stroke();const z=(o+k)/2;t.beginPath(),t.moveTo(z,e),t.lineTo(z,p),t.strokeStyle=d.text,t.lineWidth=1,t.stroke();const V=5;t.beginPath(),t.moveTo(z,e),t.lineTo(z-V,e+V),t.lineTo(z+V,e+V),t.closePath(),t.fillStyle=d.text,t.fill(),t.beginPath(),t.moveTo(z,p),t.lineTo(z-V,p-V),t.lineTo(z+V,p-V),t.closePath(),t.fillStyle=d.text,t.fill(),t.save(),t.fillStyle=d.text,t.font="12px Arial",t.textAlign="left",t.fillText("impact parameter",z+5,(e+p)/2),t.restore(),t.fillStyle=d.text,t.font="12px Arial",t.textAlign="center",t.fillText("Earth",k,p+S+15),t.fillStyle=d.text,t.font="14px Arial",t.textAlign="left",t.fillText(`Impact Parameter: ${i(F).toFixed(0)} km`,20,30),t.fillText(`Velocity: ${i(G).toFixed(2)} km/s`,20,50)}function Nt(){h(D,!i(D)),j()}ve(()=>{console.log("Astroid canvas:",i(Y)),console.log("Contour canvas:",i(R)),Xt(),et(),j()}),Rt(()=>{},()=>{h(E,0)}),Rt(()=>(i(Y),i(F),i(G)),()=>{i(Y)&&(i(F)!==void 0||i(G)!==void 0)&&et()}),ae(),de();var ot=me(),it=g(v(ot),2),st=v(it),Zt=v(st);f(st);var pt=g(st,2),ht=v(pt),Jt=g(ht,2);f(pt),f(it);var lt=g(it,2),at=v(lt),gt=g(v(at)),Qt=v(gt);f(gt),f(at);var ut=g(at,2),mt=v(ut),Ut=g(mt,2);f(ut),f(lt);var yt=g(lt,2);{var te=t=>{var a=ge(),r=v(a),e=g(v(r),4),o=v(e);f(e);var s=g(e,2);f(r),f(a),Wt(n=>J(o,`Final score: ${n??""}%`),[()=>(i(E)*100).toFixed(0)],Ct),B("click",s,qt),dt(t,a)};Vt(yt,t=>{i(U)&&t(te)})}var xt=g(yt,2),nt=v(xt),N=g(v(nt),2);I(N,"width",b),I(N,"height",y),It(N,t=>h(Y,t),()=>i(Y));var bt=g(N,2),St=v(bt),_t=g(v(St),2),ee=v(_t);f(_t),f(St),f(bt),f(nt);var Tt=g(nt,2),rt=g(v(Tt),2),q=v(rt);I(q,"width",b+60),I(q,"height",y),It(q,t=>h(R,t),()=>i(R)),f(rt);var kt=g(rt,2),Pt=g(v(kt),2),At=v(Pt);{var oe=t=>{var a=ue();B("click",a,Ot),dt(t,a)};Vt(At,t=>{i(A).length>0&&t(oe)})}var ct=g(At,2),ie=v(ct,!0);f(ct),f(Pt),f(kt),f(Tt),f(xt),f(ot),Wt((t,a)=>{J(Zt,`Lives ${i(W)??""}/20`),I(ht,"style",`width: ${t??""}%`),I(Jt,"style",`left: ${t??""}%`),J(Qt,`${a??""}%`),I(mt,"style",`width: ${i(E)*100}%`),I(Ut,"style",`left: ${i(E)*100}%`),re(q,1,ce(i(L)?"loading":""),"svelte-9fpox1"),J(ie,i(D)?"Show Emulator Prediction":"Show Simulator Function")},[()=>Math.max(0,i(W)/20*100),()=>(i(E)*100).toFixed(0)],Ct),B("click",ee,Ht),B("click",q,jt),B("click",ct,Nt),dt($t,ot),ne()}export{ze as component};
