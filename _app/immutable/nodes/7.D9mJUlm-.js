import{t as be,a as ge}from"../chunks/XXpPz1rO.js";import"../chunks/CG3dSJ55.js";import{am as Se,as as ue,at as we,ar as Te,e as t,an as Ie,s as z,ao as g,au as O,Q as _,ap as u,i as Ge,aq as Re}from"../chunks/C9kX8gL9.js";import{s as ee,e as ve}from"../chunks/CWldEeeP.js";import{i as Le}from"../chunks/DDIuJh5f.js";import{r as Pe,s as de}from"../chunks/BK-Xurv5.js";import{l as ze,s as We,c as De}from"../chunks/C0MQ2VaA.js";import{b as me}from"../chunks/CUbg1kqr.js";import{i as Ce}from"../chunks/CmZZvN_p.js";import{o as Ee}from"../chunks/DWMzei4F.js";import{r as ye,s as Ne,v as He,z as Ae,l as qe,m as $e,a as je,d as Be,b as Xe,e as Ye}from"../chunks/BoOaU208.js";import{_ as Ke}from"../chunks/C1FmrZbK.js";import{b as _e}from"../chunks/6XTkFf--.js";var Ze=be('<main class="svelte-1tzehgw"><div class="control-panel svelte-1tzehgw"><div class="slider-container svelte-1tzehgw"><label for="angle" class="svelte-1tzehgw">Psi Angle (degrees):</label> <input type="range" id="angle" min="0" max="360" step="1" class="svelte-1tzehgw"> <span class="svelte-1tzehgw"> </span></div> <div class="slider-container svelte-1tzehgw"><label for="phiAngle" class="svelte-1tzehgw">Phi Angle (degrees):</label> <input type="range" id="phiAngle" min="0" max="360" step="1" class="svelte-1tzehgw"> <span class="svelte-1tzehgw"> </span></div></div> <div class="viewer-container svelte-1tzehgw"><div id="viewer" class="svelte-1tzehgw"></div></div></main>');function Qe(he,pe){Se(pe,!1);let G=`
ATOM      1  CH3 ACE     1       2.000   2.090   0.000
ATOM      2  C   ACE     1       3.427   2.641  -0.000
ATOM      3  O   ACE     1       4.391   1.877  -0.000
ATOM      4  N   ALA     2       3.555   3.970  -0.000
ATOM      5  CA  ALA     2       4.853   4.614  -0.000
ATOM     6  HA  ALA     2       5.408   4.316   0.890
ATOM     7  CB  ALA     2       5.661   4.221  -1.232
ATOM     8  C   ALA     2       4.713   6.129   0.000
ATOM     9  O   ALA     2       3.601   6.653   0.000
ATOM     10  N   NME     3       5.846   6.835   0.000
ATOM     11  H   NME     3       6.737   6.359  -0.000
ATOM     12  CH3 NME     3       5.846   8.284   0.000
TER   
END`,R=[6,7,8,9,10,11,12],F=4,W=5,T=O(50),k=O(0);function j(y){let f;Math.abs(y.z)>.9?f={x:0,y:y.z,z:-y.y}:f={x:-y.y,y:y.x,z:0};let M=Math.sqrt(f.x**2+f.y**2+f.z**2);return f.x/=M,f.y/=M,f.z/=M,f}function D(y,f,M,c,H){let Y=H*Math.PI/180,K=Math.cos(Y),x=Math.sin(Y),m=1-K,b=[[K+c.x**2*m,c.x*c.y*m-c.z*x,c.x*c.z*m+c.y*x],[c.y*c.x*m+c.z*x,K+c.y**2*m,c.y*c.z*m-c.x*x],[c.z*c.x*m-c.y*x,c.z*c.y*m+c.x*x,K+c.z**2*m]];return f.forEach(C=>{let w=y[C-1],Z=w.x-M.x,q=w.y-M.y,p=w.z-M.z,Q=b[0][0]*Z+b[0][1]*q+b[0][2]*p,V=b[1][0]*Z+b[1][1]*q+b[1][2]*p,le=b[2][0]*Z+b[2][1]*q+b[2][2]*p;w.x=Q+M.x,w.y=V+M.y,w.z=le+M.z}),y}function A(y,f,M,c,H,Y){let x=y.split(`
`).filter(p=>p.startsWith("ATOM")).map(p=>{let Q=parseFloat(p.substring(30,38).trim()),V=parseFloat(p.substring(38,46).trim()),le=parseFloat(p.substring(46,54).trim());return{x:Q,y:V,z:le,line:p}}),m=x[M-1],b=x[c-1],C={x:b.x-m.x,y:b.y-m.y,z:b.z-m.z},w=Math.sqrt(C.x**2+C.y**2+C.z**2);C.x/=w,C.y/=w,C.z/=w;let Z=j(C);return x=D(x,f,m,C,H),x=D(x,f,m,Z,Y),x.forEach(p=>{p.line=p.line.substring(0,30)+p.x.toFixed(3).padStart(8)+p.y.toFixed(3).padStart(8)+p.z.toFixed(3).padStart(8)+p.line.substring(54)}),x.map(p=>p.line).join(`
`)+`
TER
END`}let h=O(),a=O(),U=O();Ee(async()=>{if(typeof window<"u")try{const{createViewer:y}=await Ke(async()=>{const{createViewer:f}=await import("../chunks/kNyKxqkf.js").then(M=>M._);return{createViewer:f}},[],import.meta.url);console.log("3Dmol.js loaded successfully"),_(a,y(t(U),{backgroundColor:"white"})),B(!0),window.addEventListener("resize",()=>{t(a)&&(t(a).resize(),t(a).render())})}catch(y){console.error("Failed to load 3Dmol.js:",y)}});function B(y=!0){t(a)&&(console.log("Updating viewer with angles:",t(T),t(k)),t(a).clear(),t(a).addModel(t(h),"pdb"),t(a).setStyle({},{stick:{radius:.2},sphere:{scale:.3}}),y&&t(a).zoomTo(),t(a).render())}ue(()=>(t(T),t(k)),()=>{_(h,A(G,R,F,W,t(T),t(k)))}),ue(()=>(t(a),t(h)),()=>{t(a)&&t(h)&&B(!1)}),we(),Ce();var N=Ze(),d=g(N),S=g(d),I=z(g(S),2);Pe(I);var oe=z(I,2),J=g(oe);u(oe),u(S);var ie=z(S,2),te=z(g(ie),2);Pe(te);var ne=z(te,2),X=g(ne);u(ne),u(ie),u(d);var se=z(d,2),ae=g(se);me(ae,y=>_(U,y),()=>t(U)),u(se),u(N),Te(()=>{ee(J,`${t(T)??""}°`),ee(X,`${t(k)??""}°`)}),_e(I,()=>t(T),y=>_(T,y)),_e(te,()=>t(k),y=>_(k,y)),ge(he,N),Ie()}var Ue=be('<button class="svelte-1yey7yo">Clear Samples</button>'),Je=be('<main class="svelte-1yey7yo"><h1 class="svelte-1yey7yo">Protein Backbone Conformation Explorer</h1> <div class="container svelte-1yey7yo"><div class="panel svelte-1yey7yo"><h2 class="svelte-1yey7yo">Backbone Angles</h2> <canvas class="svelte-1yey7yo"></canvas> <div class="Other"><!></div></div> <div class="panel svelte-1yey7yo"><h2 class="svelte-1yey7yo">Energy Landscape</h2> <div class="contour-container svelte-1yey7yo"><canvas></canvas></div> <div class="info svelte-1yey7yo"><p class="svelte-1yey7yo"> </p> <p class="svelte-1yey7yo"> </p> <div class="instruction svelte-1yey7yo"><p class="highlight svelte-1yey7yo">Click on the plot above to add sample points and update the GP model</p></div> <div class="button-group svelte-1yey7yo"><!> <button class="info-button svelte-1yey7yo"> </button></div> <div class="energy-function svelte-1yey7yo"><h3 class="svelte-1yey7yo">About the Visualization:</h3> <p class="svelte-1yey7yo"> </p> <p class="svelte-1yey7yo">The energy function represents different stable conformations of the protein backbone. Darker regions indicate lower energy (more stable conformations).</p> <p class="svelte-1yey7yo">Click directly on the plot to add sample points and build a GP model that learns this energy landscape.</p></div></div></div></div></main>');function ht(he,pe){Se(pe,!1);let G=O(0),R=O(0),F=O([]),W=[],T=O(),k=O(),j=O(!1),D=O(!1);const A=400,h=400,a=40,U=A-2*a,B=ze([-Math.PI,Math.PI],[a,A-a]),N=ze([-Math.PI,Math.PI],[h-a,a]),d={primary:"#3c6382",secondary:"#82ccdd",accent:"#60a3bc",highlight:"#6a89cc",text:"#2c3e50",bond1:"#38ada9",bond2:"#6a89cc",atom1:"#3c6382",atom2:"#60a3bc",atom3:"#82ccdd",atom4:"#38ada9"};let S=1/0,I=-1/0;function oe(){const i=ye(-Math.PI,Math.PI,2*Math.PI/50).toArray(),n=ye(-Math.PI,Math.PI,2*Math.PI/50).toArray();for(const l of i)for(const s of n){const r=J(l,s);S=Math.min(S,r),I=Math.max(I,r)}S=Math.floor(S*10)/10,I=Math.ceil(I*10)/10,console.log(`Energy range: ${S} to ${I}`)}function J(e,i){const n=Math.exp(-((e+Math.PI/2)**2)-(i-Math.PI/2)**2/.5),l=Math.exp(-((e+Math.PI/2)**2)-(i+.5)**2/.3),s=Math.exp(-((e-Math.PI/2)**2)-(i+Math.PI/2)**2/.5),r=Math.exp(-((e-Math.PI/2)**2)-(i-.5)**2/.3),v=Math.exp(-((e-0)**2)/.3-(i-Math.PI/4)**2/.2),E=n+l+s+r+v;return-Math.log(E+1e-6)}function ie(){_(F,[]),W=[],X()}function te(e){if(t(j))return;const i=t(k).getBoundingClientRect(),n=e.clientX-i.left,l=e.clientY-i.top,s=B.invert(n),r=N.invert(l);if(n>=a&&n<=A-a&&l>=a&&l<=h-a){_(G,s),_(R,r);const v=J(t(G),t(R));_(F,[...t(F),{phi:t(G),psi:t(R),energy:v}]),ne(),ae()}}function ne(){if(_(j,!0),t(F).length===0){_(j,!1),X();return}setTimeout(()=>{const e=t(F).map(o=>[o.phi,o.psi]),i=t(F).map(o=>o.energy),n=(o,P,re=1)=>{const ce=je(Be(Xe(o,P),2));return Ye(-.5*ce/(re*re))},l=e.length,s=Ae(l,l);for(let o=0;o<l;o++)for(let P=0;P<l;P++)s.set([o,P],n(e[o],e[P]));const r=.01;for(let o=0;o<l;o++)s.set([o,o],s.get([o,o])+r);const v=40,E=ye(-Math.PI,Math.PI,2*Math.PI/v).toArray(),L=ye(-Math.PI,Math.PI,2*Math.PI/v).toArray();W=[];for(const o of E)for(const P of L){const re=[o,P],ce=Ae(1,l);for(let $=0;$<l;$++)ce.set([0,$],n(re,e[$]));try{const $=qe(s,i),Fe=$e(ce,$).get([0,0]);W.push({phi:o,psi:P,predicted:Fe})}catch($){console.error("Error in GP calculation:",$)}}X(),_(j,!1)},50)}function X(){if(!t(k))return;const e=t(k).getContext("2d");e.clearRect(0,0,A+60,h);const i=Ne().domain([I,S]).interpolator(He);if(t(D)||W.length===0){const l=U/80;for(let s=0;s<80;s++)for(let r=0;r<80;r++){const v=-Math.PI+2*Math.PI*s/80,E=-Math.PI+2*Math.PI*r/80,L=J(v,E),o=B(v),P=N(E);e.fillStyle=i(L),e.fillRect(o-l/2,P-l/2,l,l)}}else{const n=U/Math.sqrt(W.length);W.forEach(l=>{const s=B(l.phi),r=N(l.psi);e.fillStyle=i(l.predicted),e.fillRect(s-n/2,r-n/2,n,n)})}se(e,i),e.strokeStyle=d.primary,e.lineWidth=2,e.beginPath(),e.moveTo(a,h-a),e.lineTo(A-a,h-a),e.moveTo(a,a),e.lineTo(a,h-a),e.stroke(),e.fillStyle=d.text,e.font="bold 14px Arial, sans-serif",e.textAlign="center",e.fillText("-π",a,h-a+15),e.fillText("0",A/2,h-a+15),e.fillText("π",A-a,h-a+15),e.fillText("φ",A-a+15,h-a+5),e.textAlign="right",e.fillText("-π",a-5,h-a),e.fillText("0",a-5,h/2),e.fillText("π",a-5,a),e.fillText("ψ",a-15,a-10),t(F).forEach(n=>{const l=B(n.phi),s=N(n.psi),r=8,v=e.createRadialGradient(l,s,2,l,s,r);v.addColorStop(0,d.highlight),v.addColorStop(1,"rgba(106, 137, 204, 0)"),e.fillStyle=v,e.beginPath(),e.arc(l,s,r,0,2*Math.PI),e.fill(),e.fillStyle=d.accent,e.beginPath(),e.arc(l,s,4,0,2*Math.PI),e.fill(),e.strokeStyle=d.primary,e.lineWidth=1,e.stroke()})}function se(e,i){const l=h-2*a,s=A-a+20,r=a,v=100,E=l/v;for(let o=0;o<v;o++){const P=S+(I-S)*(v-o-1)/v;e.fillStyle=i(P),e.fillRect(s,r+o*E,20,E+1)}e.strokeStyle=d.text,e.lineWidth=1,e.strokeRect(s,r,20,l),e.fillStyle=d.text,e.font="12px Arial, sans-serif",e.textAlign="left",e.fillText(S.toFixed(1),s+20+5,r+l),e.fillText(I.toFixed(1),s+20+5,r);const L=(S+I)/2;e.fillText(L.toFixed(1),s+20+5,r+l/2),e.save(),e.translate(s+20+25,r+l/2),e.rotate(-Math.PI/2),e.textAlign="center",e.fillText("Energy",0,0),e.restore()}function ae(){if(!t(T))return;const e=t(T).getContext("2d");e.clearRect(0,0,A,h);const i=A/2,n=h/2,l=120,s=e.createRadialGradient(i,n,0,i,n,l*1.5);s.addColorStop(0,"rgba(60, 99, 130, 0.1)"),s.addColorStop(1,"rgba(245, 246, 250, 0.05)"),e.fillStyle=s,e.fillRect(0,0,A,h);const r=e.createLinearGradient(i-l,n,i+l,n);r.addColorStop(0,d.secondary),r.addColorStop(.5,d.primary),r.addColorStop(1,d.secondary),e.strokeStyle=r,e.lineWidth=3,e.beginPath(),e.moveTo(i-l,n),e.lineTo(i+l,n),e.stroke();const v=[{x:i-l,y:n,color:d.atom1,label:"N",size:24},{x:i-l/2,y:n,color:d.atom2,label:"Cα",size:26},{x:i,y:n,color:d.atom3,label:"C",size:24},{x:i+l/2,y:n,color:d.atom4,label:"O",size:24},{x:i+l,y:n,color:d.atom1,label:"N",size:24}];e.save(),e.translate(i-l/2,n),e.rotate(t(G));const E=e.createLinearGradient(0,0,0,-60);E.addColorStop(0,d.bond1),E.addColorStop(1,d.secondary),e.strokeStyle=E,e.lineWidth=3,e.beginPath(),e.moveTo(0,0),e.lineTo(0,-60),e.stroke(),e.fillStyle=d.text,e.font="bold 14px Arial, sans-serif",e.fillText("φ = "+t(G).toFixed(2),5,-30),e.restore(),e.save(),e.translate(i,n),e.rotate(t(R));const L=e.createLinearGradient(0,0,0,-60);L.addColorStop(0,d.bond2),L.addColorStop(1,d.highlight),e.strokeStyle=L,e.lineWidth=3,e.beginPath(),e.moveTo(0,0),e.lineTo(0,-60),e.stroke(),e.fillStyle=d.text,e.font="bold 14px Arial, sans-serif",e.fillText("ψ = "+t(R).toFixed(2),5,-30),e.restore(),v.forEach(o=>{const P=e.createRadialGradient(o.x,o.y,0,o.x,o.y,o.size*1.2);P.addColorStop(0,o.color),P.addColorStop(1,"rgba(255, 255, 255, 0)"),e.fillStyle=P,e.beginPath(),e.arc(o.x,o.y,o.size*1.2,0,2*Math.PI),e.fill(),e.fillStyle=o.color,e.beginPath(),e.arc(o.x,o.y,o.size,0,2*Math.PI),e.fill(),e.fillStyle="#fff",e.font="bold 14px Arial, sans-serif",e.textAlign="center",e.textBaseline="middle",e.fillText(o.label,o.x,o.y)})}function y(){_(D,!t(D)),X()}Ee(()=>{oe(),ae(),X()}),ue(()=>(t(T),t(G),t(R)),()=>{t(T)&&(t(G)||t(R))&&ae()}),we(),Ce();var f=Je(),M=z(g(f),2),c=g(M),H=z(g(c),2);de(H,"width",A),de(H,"height",h),me(H,e=>_(T,e),()=>t(T));var Y=z(H,2),K=g(Y);Qe(K,{}),u(Y),u(c);var x=z(c,2),m=z(g(x),2),b=g(m);de(b,"width",A+60),de(b,"height",h),me(b,e=>_(k,e),()=>t(k)),u(m);var C=z(m,2),w=g(C),Z=g(w);u(w);var q=z(w,2),p=g(q);u(q);var Q=z(q,4),V=g(Q);{var le=e=>{var i=Ue();ve("click",i,ie),ge(e,i)};Le(V,e=>{t(F).length>0&&e(le)})}var fe=z(V,2),ke=g(fe,!0);u(fe),u(Q);var xe=z(Q,2),Me=z(g(xe),2),Oe=g(Me,!0);u(Me),Re(4),u(xe),u(C),u(x),u(M),u(f),Te(e=>{We(b,1,De(t(j)?"loading":""),"svelte-1yey7yo"),ee(Z,`Samples: ${t(F).length??""}`),ee(p,`Current energy: ${e??""}`),ee(ke,t(D)?"Show GP Prediction":"Show Energy Function"),ee(Oe,t(D)?"Showing actual energy function":"Showing Gaussian Process prediction")},[()=>J(t(G),t(R)).toFixed(2)],Ge),ve("click",b,te),ve("click",fe,y),ge(he,f),Ie()}export{ht as component};
