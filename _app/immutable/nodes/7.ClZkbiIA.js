import{t as ze,a as ue}from"../chunks/XXpPz1rO.js";import"../chunks/CG3dSJ55.js";import{am as Se,as as ye,at as we,ar as Te,e as t,an as Ie,s as P,ao as u,au as O,Q as _,ap as y,i as Ge,aq as Re}from"../chunks/C9kX8gL9.js";import{s as ee,e as ge}from"../chunks/CWldEeeP.js";import{i as Le}from"../chunks/DDIuJh5f.js";import{r as Me,s as de}from"../chunks/BK-Xurv5.js";import{l as Pe,s as We,c as De}from"../chunks/C0MQ2VaA.js";import{b as me}from"../chunks/CUbg1kqr.js";import{i as Ce}from"../chunks/CmZZvN_p.js";import{o as Ee}from"../chunks/DWMzei4F.js";import{r as he,s as Ne,v as He,z as Ae,l as qe,m as $e,a as je,d as Be,b as Xe,e as Ye}from"../chunks/BoOaU208.js";import{_ as Ke}from"../chunks/C1FmrZbK.js";import{b as _e}from"../chunks/6XTkFf--.js";var Ze=ze('<main class="svelte-1tzehgw"><div class="control-panel svelte-1tzehgw"><div class="slider-container svelte-1tzehgw"><label for="angle" class="svelte-1tzehgw">Psi Angle (degrees):</label> <input type="range" id="angle" min="0" max="360" step="1" class="svelte-1tzehgw"> <span class="svelte-1tzehgw"> </span></div> <div class="slider-container svelte-1tzehgw"><label for="phiAngle" class="svelte-1tzehgw">Phi Angle (degrees):</label> <input type="range" id="phiAngle" min="0" max="360" step="1" class="svelte-1tzehgw"> <span class="svelte-1tzehgw"> </span></div></div> <div class="viewer-container svelte-1tzehgw"><div id="viewer" class="svelte-1tzehgw"></div></div></main>');function Qe(pe,fe){Se(fe,!1);let G=`
ATOM      1  CH3 ACE     1       2.000   2.090   0.000
ATOM      2  C   ACE     1       3.427   2.641  -0.000
ATOM      3  O   ACE     1       4.391   1.877  -0.000
ATOM      4  N   ALA     2       3.555   3.970  -0.000
ATOM      5  CA  ALA     2       4.853   4.614  -0.000
ATOM     6  HA  ALA     2       5.408   4.316   0.890
ATOM     7  CB  ALA     2       5.661   4.221  -1.232
ATOM     8  C   ALA     2       4.713   6.129   0.000
ATOM     9  O   ALA     2       3.601   6.653   0.000
ATOM     10  N   NME     3       5.846   6.835   0.000
ATOM     11  H   NME     3       6.737   6.359  -0.000
ATOM     12  CH3 NME     3       5.846   8.284   0.000
TER   
END`,R=[6,7,8,9,10,11,12],F=4,W=5,T=O(50),k=O(0);function j(h){let v;Math.abs(h.z)>.9?v={x:0,y:h.z,z:-h.y}:v={x:-h.y,y:h.x,z:0};let x=Math.sqrt(v.x**2+v.y**2+v.z**2);return v.x/=x,v.y/=x,v.z/=x,v}function D(h,v,x,c,H){let Y=H*Math.PI/180,K=Math.cos(Y),b=Math.sin(Y),m=1-K,z=[[K+c.x**2*m,c.x*c.y*m-c.z*b,c.x*c.z*m+c.y*b],[c.y*c.x*m+c.z*b,K+c.y**2*m,c.y*c.z*m-c.x*b],[c.z*c.x*m-c.y*b,c.z*c.y*m+c.x*b,K+c.z**2*m]];return v.forEach(C=>{let w=h[C-1],Z=w.x-x.x,q=w.y-x.y,f=w.z-x.z,Q=z[0][0]*Z+z[0][1]*q+z[0][2]*f,V=z[1][0]*Z+z[1][1]*q+z[1][2]*f,ae=z[2][0]*Z+z[2][1]*q+z[2][2]*f;w.x=Q+x.x,w.y=V+x.y,w.z=ae+x.z}),h}function A(h,v,x,c,H,Y){let b=h.split(`
`).filter(f=>f.startsWith("ATOM")).map(f=>{let Q=parseFloat(f.substring(30,38).trim()),V=parseFloat(f.substring(38,46).trim()),ae=parseFloat(f.substring(46,54).trim());return{x:Q,y:V,z:ae,line:f}}),m=b[x-1],z=b[c-1],C={x:z.x-m.x,y:z.y-m.y,z:z.z-m.z},w=Math.sqrt(C.x**2+C.y**2+C.z**2);C.x/=w,C.y/=w,C.z/=w;let Z=j(C);return b=D(b,v,m,C,H),b=D(b,v,m,Z,Y),b.forEach(f=>{f.line=f.line.substring(0,30)+f.x.toFixed(3).padStart(8)+f.y.toFixed(3).padStart(8)+f.z.toFixed(3).padStart(8)+f.line.substring(54)}),b.map(f=>f.line).join(`
`)+`
TER
END`}let p=O(),l=O(),U=O();Ee(async()=>{if(typeof window<"u")try{const{createViewer:h}=await Ke(async()=>{const{createViewer:v}=await import("../chunks/kNyKxqkf.js").then(x=>x._);return{createViewer:v}},[],import.meta.url);console.log("3Dmol.js loaded successfully"),_(l,h(t(U),{backgroundColor:"white"})),B(!0),window.addEventListener("resize",()=>{t(l)&&(t(l).resize(),t(l).render())})}catch(h){console.error("Failed to load 3Dmol.js:",h)}});function B(h=!0){t(l)&&(console.log("Updating viewer with angles:",t(T),t(k)),t(l).clear(),t(l).addModel(t(p),"pdb"),t(l).setStyle({},{stick:{radius:.2},sphere:{scale:.3}}),h&&t(l).zoomTo(),t(l).render())}ye(()=>(t(T),t(k)),()=>{_(p,A(G,R,F,W,t(T),t(k)))}),ye(()=>(t(l),t(p)),()=>{t(l)&&t(p)&&B(!1)}),we(),Ce();var N=Ze(),d=u(N),S=u(d),I=P(u(S),2);Me(I);var ie=P(I,2),J=u(ie);y(ie),y(S);var ne=P(S,2),te=P(u(ne),2);Me(te);var se=P(te,2),X=u(se);y(se),y(ne),y(d);var oe=P(d,2),le=u(oe);me(le,h=>_(U,h),()=>t(U)),y(oe),y(N),Te(()=>{ee(J,`${t(T)??""}°`),ee(X,`${t(k)??""}°`)}),_e(I,()=>t(T),h=>_(T,h)),_e(te,()=>t(k),h=>_(k,h)),ue(pe,N),Ie()}var Ue=ze('<button class="svelte-lzu280">Clear Samples</button>'),Je=ze('<main class="svelte-lzu280"><h1 class="svelte-lzu280">Protein Backbone Conformation Explorer</h1> <div class="container svelte-lzu280"><div class="panel svelte-lzu280"><h2 class="svelte-lzu280">Backbone Angles</h2> <canvas class="svelte-lzu280"></canvas> <div class="Other"><!></div></div> <div class="panel svelte-lzu280"><h2 class="svelte-lzu280">Energy Landscape</h2> <div class="contour-container svelte-lzu280"><canvas></canvas></div> <div class="info svelte-lzu280"><p class="svelte-lzu280"> </p> <p class="svelte-lzu280"> </p> <div class="instruction svelte-lzu280"><p class="highlight svelte-lzu280">Click on the plot above to add sample points and update the GP model</p></div> <div class="button-group svelte-lzu280"><!> <button class="info-button svelte-lzu280"> </button></div> <div class="energy-function svelte-lzu280"><h3 class="svelte-lzu280">About the Visualization:</h3> <p class="svelte-lzu280"> </p> <p class="svelte-lzu280">The energy function represents different stable conformations of the protein backbone. Darker regions indicate lower energy (more stable conformations).</p> <p class="svelte-lzu280">Click directly on the plot to add sample points and build a GP model that learns this energy landscape.</p></div></div></div></div></main>');function pt(pe,fe){Se(fe,!1);let G=O(0),R=O(0),F=O([]),W=[],T=O(),k=O(),j=O(!1),D=O(!1);const A=400,p=400,l=40,U=A-2*l,B=Pe([-Math.PI,Math.PI],[l,A-l]),N=Pe([-Math.PI,Math.PI],[p-l,l]),d={primary:"#3c6382",secondary:"#82ccdd",accent:"#60a3bc",highlight:"#6a89cc",text:"#2c3e50",bond1:"#38ada9",bond2:"#6a89cc",atom1:"#3c6382",atom2:"#60a3bc",atom3:"#82ccdd",atom4:"#38ada9"};let S=1/0,I=-1/0;function ie(){const n=he(-Math.PI,Math.PI,2*Math.PI/50).toArray(),s=he(-Math.PI,Math.PI,2*Math.PI/50).toArray();for(const a of n)for(const o of s){const r=J(a,o);S=Math.min(S,r),I=Math.max(I,r)}S=Math.floor(S*10)/10,I=Math.ceil(I*10)/10,console.log(`Energy range: ${S} to ${I}`)}function J(e,n){const s=Math.exp(-((e+Math.PI/2)**2)-(n-Math.PI/2)**2/.5),a=Math.exp(-((e+Math.PI/2)**2)-(n+.5)**2/.3),o=Math.exp(-((e-Math.PI/2)**2)-(n+Math.PI/2)**2/.5),r=Math.exp(-((e-Math.PI/2)**2)-(n-.5)**2/.3),g=Math.exp(-((e-0)**2)/.3-(n-Math.PI/4)**2/.2),E=s+a+o+r+g;return-Math.log(E+1e-6)}function ne(){_(F,[]),W=[],X()}function te(e){if(t(j))return;const n=t(k).getBoundingClientRect(),s=e.clientX-n.left,a=e.clientY-n.top,o=B.invert(s),r=N.invert(a);if(s>=l&&s<=A-l&&a>=l&&a<=p-l){_(G,o),_(R,r);const g=J(t(G),t(R));_(F,[...t(F),{phi:t(G),psi:t(R),energy:g}]),se(),le()}}function se(){if(_(j,!0),t(F).length===0){_(j,!1),X();return}setTimeout(()=>{const e=t(F).map(i=>[i.phi,i.psi]),n=t(F).map(i=>i.energy),s=(i,M,re=1)=>{const ce=je(Be(Xe(i,M),2));return Ye(-.5*ce/(re*re))},a=e.length,o=Ae(a,a);for(let i=0;i<a;i++)for(let M=0;M<a;M++)o.set([i,M],s(e[i],e[M]));const r=.01;for(let i=0;i<a;i++)o.set([i,i],o.get([i,i])+r);const g=40,E=he(-Math.PI,Math.PI,2*Math.PI/g).toArray(),L=he(-Math.PI,Math.PI,2*Math.PI/g).toArray();W=[];for(const i of E)for(const M of L){const re=[i,M],ce=Ae(1,a);for(let $=0;$<a;$++)ce.set([0,$],s(re,e[$]));try{const $=qe(o,n),Fe=$e(ce,$).get([0,0]);W.push({phi:i,psi:M,predicted:Fe})}catch($){console.error("Error in GP calculation:",$)}}X(),_(j,!1)},50)}function X(){if(!t(k))return;const e=t(k).getContext("2d");e.clearRect(0,0,A+60,p);const n=Ne().domain([I,S]).interpolator(He);if(t(D)||W.length===0){const a=U/80;for(let o=0;o<80;o++)for(let r=0;r<80;r++){const g=-Math.PI+2*Math.PI*o/80,E=-Math.PI+2*Math.PI*r/80,L=J(g,E),i=B(g),M=N(E);e.fillStyle=n(L),e.fillRect(i-a/2,M-a/2,a,a)}}else{const s=U/Math.sqrt(W.length);W.forEach(a=>{const o=B(a.phi),r=N(a.psi);e.fillStyle=n(a.predicted),e.fillRect(o-s/2,r-s/2,s,s)})}oe(e,n),e.strokeStyle=d.primary,e.lineWidth=2,e.beginPath(),e.moveTo(l,p-l),e.lineTo(A-l,p-l),e.moveTo(l,l),e.lineTo(l,p-l),e.stroke(),e.fillStyle=d.text,e.font="bold 14px Arial, sans-serif",e.textAlign="center",e.fillText("-π",l,p-l+15),e.fillText("0",A/2,p-l+15),e.fillText("π",A-l,p-l+15),e.fillText("φ",A-l+15,p-l+5),e.textAlign="right",e.fillText("-π",l-5,p-l),e.fillText("0",l-5,p/2),e.fillText("π",l-5,l),e.fillText("ψ",l-15,l-10),t(F).forEach(s=>{const a=B(s.phi),o=N(s.psi),r=8,g=e.createRadialGradient(a,o,2,a,o,r);g.addColorStop(0,d.highlight),g.addColorStop(1,"rgba(106, 137, 204, 0)"),e.fillStyle=g,e.beginPath(),e.arc(a,o,r,0,2*Math.PI),e.fill(),e.fillStyle=d.accent,e.beginPath(),e.arc(a,o,4,0,2*Math.PI),e.fill(),e.strokeStyle=d.primary,e.lineWidth=1,e.stroke()})}function oe(e,n){const a=p-2*l,o=A-l+20,r=l,g=100,E=a/g;for(let i=0;i<g;i++){const M=S+(I-S)*(g-i-1)/g;e.fillStyle=n(M),e.fillRect(o,r+i*E,20,E+1)}e.strokeStyle=d.text,e.lineWidth=1,e.strokeRect(o,r,20,a),e.fillStyle=d.text,e.font="12px Arial, sans-serif",e.textAlign="left",e.fillText(S.toFixed(1),o+20+5,r+a),e.fillText(I.toFixed(1),o+20+5,r);const L=(S+I)/2;e.fillText(L.toFixed(1),o+20+5,r+a/2),e.save(),e.translate(o+20+25,r+a/2),e.rotate(-Math.PI/2),e.textAlign="center",e.fillText("Energy",0,0),e.restore()}function le(){if(!t(T))return;const e=t(T).getContext("2d");e.clearRect(0,0,A,p);const n=A/2,s=p/2,a=120,o=e.createRadialGradient(n,s,0,n,s,a*1.5);o.addColorStop(0,"rgba(60, 99, 130, 0.1)"),o.addColorStop(1,"rgba(245, 246, 250, 0.05)"),e.fillStyle=o,e.fillRect(0,0,A,p);const r=e.createLinearGradient(n-a,s,n+a,s);r.addColorStop(0,d.secondary),r.addColorStop(.5,d.primary),r.addColorStop(1,d.secondary),e.strokeStyle=r,e.lineWidth=3,e.beginPath(),e.moveTo(n-a,s),e.lineTo(n+a,s),e.stroke();const g=[{x:n-a,y:s,color:d.atom1,label:"N",size:24},{x:n-a/2,y:s,color:d.atom2,label:"Cα",size:26},{x:n,y:s,color:d.atom3,label:"C",size:24},{x:n+a/2,y:s,color:d.atom4,label:"O",size:24},{x:n+a,y:s,color:d.atom1,label:"N",size:24}];e.save(),e.translate(n-a/2,s),e.rotate(t(G));const E=e.createLinearGradient(0,0,0,-60);E.addColorStop(0,d.bond1),E.addColorStop(1,d.secondary),e.strokeStyle=E,e.lineWidth=3,e.beginPath(),e.moveTo(0,0),e.lineTo(0,-60),e.stroke(),e.fillStyle=d.text,e.font="bold 14px Arial, sans-serif",e.fillText("φ = "+t(G).toFixed(2),5,-30),e.restore(),e.save(),e.translate(n,s),e.rotate(t(R));const L=e.createLinearGradient(0,0,0,-60);L.addColorStop(0,d.bond2),L.addColorStop(1,d.highlight),e.strokeStyle=L,e.lineWidth=3,e.beginPath(),e.moveTo(0,0),e.lineTo(0,-60),e.stroke(),e.fillStyle=d.text,e.font="bold 14px Arial, sans-serif",e.fillText("ψ = "+t(R).toFixed(2),5,-30),e.restore(),g.forEach(i=>{const M=e.createRadialGradient(i.x,i.y,0,i.x,i.y,i.size*1.2);M.addColorStop(0,i.color),M.addColorStop(1,"rgba(255, 255, 255, 0)"),e.fillStyle=M,e.beginPath(),e.arc(i.x,i.y,i.size*1.2,0,2*Math.PI),e.fill(),e.fillStyle=i.color,e.beginPath(),e.arc(i.x,i.y,i.size,0,2*Math.PI),e.fill(),e.fillStyle="#fff",e.font="bold 14px Arial, sans-serif",e.textAlign="center",e.textBaseline="middle",e.fillText(i.label,i.x,i.y)})}function h(){_(D,!t(D)),X()}Ee(()=>{ie(),le(),X()}),ye(()=>(t(T),t(G),t(R)),()=>{t(T)&&(t(G)||t(R))&&le()}),we(),Ce();var v=Je(),x=P(u(v),2),c=u(x),H=P(u(c),2);de(H,"width",A),de(H,"height",p),me(H,e=>_(T,e),()=>t(T));var Y=P(H,2),K=u(Y);Qe(K,{}),y(Y),y(c);var b=P(c,2),m=P(u(b),2),z=u(m);de(z,"width",A+60),de(z,"height",p),me(z,e=>_(k,e),()=>t(k)),y(m);var C=P(m,2),w=u(C),Z=u(w);y(w);var q=P(w,2),f=u(q);y(q);var Q=P(q,4),V=u(Q);{var ae=e=>{var n=Ue();ge("click",n,ne),ue(e,n)};Le(V,e=>{t(F).length>0&&e(ae)})}var ve=P(V,2),ke=u(ve,!0);y(ve),y(Q);var be=P(Q,2),xe=P(u(be),2),Oe=u(xe,!0);y(xe),Re(4),y(be),y(C),y(b),y(x),y(v),Te(e=>{We(z,1,De(t(j)?"loading":""),"svelte-lzu280"),ee(Z,`Samples: ${t(F).length??""}`),ee(f,`Current energy: ${e??""}`),ee(ke,t(D)?"Show GP Prediction":"Show Energy Function"),ee(Oe,t(D)?"Showing actual energy function":"Showing Gaussian Process prediction")},[()=>J(t(G),t(R)).toFixed(2)],Ge),ge("click",z,te),ge("click",ve,h),ue(pe,v),Ie()}export{pt as component};
