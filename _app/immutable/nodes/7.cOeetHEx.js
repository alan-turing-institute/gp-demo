import{t as ce,a as re}from"../chunks/Dl42bQaK.js";import"../chunks/Cns6LDpP.js";import{a5 as Ne,ab as ae,ac as qe,a6 as He,a7 as p,a2 as g,ad as E,e as t,$ as Ge,a8 as h,aa as lt,s as m,i as st,a9 as ot}from"../chunks/C_nTGglK.js";import{e as ie,s as Y}from"../chunks/D15B_ygG.js";import{i as Fe}from"../chunks/BiG_kpbh.js";import{s as Q,r as Le}from"../chunks/CThLS2ih.js";import{l as Re,s as it,c as nt}from"../chunks/CSJ2tm9-.js";import{b as We}from"../chunks/RyJ3Hllu.js";import{b as Me}from"../chunks/BOcuyyEv.js";import{i as $e}from"../chunks/-d2lr63c.js";import{o as Be}from"../chunks/BfnemT7e.js";import{r as ne,s as rt,v as ct,z as je,l as dt,m as ft,a as vt,d as pt,b as ht,e as ut}from"../chunks/Di72JI2_.js";import{_ as gt}from"../chunks/C1FmrZbK.js";import{p as De}from"../chunks/BSqzZcxX.js";var xt=ce('<main class="svelte-13sjxqj"><div class="viewer-container svelte-13sjxqj"><div id="viewer" class="svelte-13sjxqj"></div></div></main>');function yt(de,V){Ne(V,!1);let S=`
ATOM      1  CH3 ACE     1       2.000   2.090   0.000
ATOM      2  C   ACE     1       3.427   2.641  -0.000
ATOM      3  O   ACE     1       4.391   1.877  -0.000
ATOM      4  N   ALA     2       3.555   3.970  -0.000
ATOM      5  CA  ALA     2       4.853   4.614  -0.000
ATOM     6  HA  ALA     2       5.408   4.316   0.890
ATOM     7  CB  ALA     2       5.661   4.221  -1.232
ATOM     8  C   ALA     2       4.713   6.129   0.000
ATOM     9  O   ALA     2       3.601   6.653   0.000
ATOM     10  N   NME     3       5.846   6.835   0.000
ATOM     11  H   NME     3       6.737   6.359  -0.000
ATOM     12  CH3 NME     3       5.846   8.284   0.000
TER   
END`,z=[6,7,8,9,10,11,12],C=4,O=5,k=De(V,"angle",8,50),G=De(V,"phiAngle",8,0);function q(o){let f;Math.abs(o.z)>.9?f={x:0,y:o.z,z:-o.y}:f={x:-o.y,y:o.x,z:0};let u=Math.sqrt(f.x**2+f.y**2+f.z**2);return f.x/=u,f.y/=u,f.z/=u,f}function R(o,f,u,v,j){let U=j*Math.PI/180,$=Math.cos(U),_=Math.sin(U),P=1-$,b=[[$+v.x**2*P,v.x*v.y*P-v.z*_,v.x*v.z*P+v.y*_],[v.y*v.x*P+v.z*_,$+v.y**2*P,v.y*v.z*P-v.x*_],[v.z*v.x*P-v.y*_,v.z*v.y*P+v.x*_,$+v.z**2*P]];return f.forEach(w=>{let T=o[w-1],B=T.x-u.x,D=T.y-u.y,x=T.z-u.z,X=b[0][0]*B+b[0][1]*D+b[0][2]*x,ee=b[1][0]*B+b[1][1]*D+b[1][2]*x,J=b[2][0]*B+b[2][1]*D+b[2][2]*x;T.x=X+u.x,T.y=ee+u.y,T.z=J+u.z}),o}function F(o,f,u,v,j,U){let _=o.split(`
`).filter(x=>x.startsWith("ATOM")).map(x=>{let X=parseFloat(x.substring(30,38).trim()),ee=parseFloat(x.substring(38,46).trim()),J=parseFloat(x.substring(46,54).trim());return{x:X,y:ee,z:J,line:x}}),P=_[u-1],b=_[v-1],w={x:b.x-P.x,y:b.y-P.y,z:b.z-P.z},T=Math.sqrt(w.x**2+w.y**2+w.z**2);w.x/=T,w.y/=T,w.z/=T;let B=q(w);return _=R(_,f,P,w,j),_=R(_,f,P,B,U),_.forEach(x=>{x.line=x.line.substring(0,30)+x.x.toFixed(3).padStart(8)+x.y.toFixed(3).padStart(8)+x.z.toFixed(3).padStart(8)+x.line.substring(54)}),_.map(x=>x.line).join(`
`)+`
TER
END`}let W=E(),d=E(),y=E();Be(async()=>{if(typeof window<"u")try{const{createViewer:o}=await gt(async()=>{const{createViewer:f}=await import("../chunks/kNyKxqkf.js").then(u=>u._);return{createViewer:f}},[],import.meta.url);console.log("3Dmol.js loaded successfully"),g(d,o(t(y),{backgroundColor:"white"})),i(!0),window.addEventListener("resize",()=>{t(d)&&(t(d).resize(),t(d).render())})}catch(o){console.error("Failed to load 3Dmol.js:",o)}});function i(o=!0){t(d)&&(console.log("Updating viewer with angles:",k(),G()),t(d).clear(),t(d).addModel(t(W),"pdb"),t(d).setStyle({},{stick:{radius:.2},sphere:{scale:.3}}),o&&t(d).zoomTo(),t(d).render())}ae(()=>(Ge(k()),Ge(G())),()=>{g(W,F(S,z,C,O,k(),G()))}),ae(()=>(t(d),t(W)),()=>{t(d)&&t(W)&&i(!1)}),qe(),$e();var K=xt(),H=p(K),Z=p(H);Me(Z,o=>g(y,o),()=>t(y)),h(H),h(K),re(de,K),He()}var mt=ce(`<div class="game-ended-popup svelte-1feoufx"><div class="popup-content svelte-1feoufx"><h2 class="svelte-1feoufx">Game Ended</h2> <p class="svelte-1feoufx">You've used all your lives!</p> <button class="svelte-1feoufx">Play Again</button></div></div>`),bt=ce('<button class="svelte-1feoufx">Clear Samples</button>'),Mt=ce('<main class="svelte-1feoufx"><h1 class="svelte-1feoufx">Protein Backbone Conformation Explorer</h1> <div class="live-bar-container svelte-1feoufx"><div class="lives-label svelte-1feoufx"> </div> <div class="live-bar svelte-1feoufx"><div class="lives-remaining svelte-1feoufx"></div> <span class="heart svelte-1feoufx">❤️</span></div></div> <!> <div class="container svelte-1feoufx"><div class="panel svelte-1feoufx"><h2 class="svelte-1feoufx">Backbone Angles</h2> <canvas class="svelte-1feoufx"></canvas> <div class="Other"><div class="control-panel svelte-1feoufx"><div class="slider-container svelte-1feoufx"><label for="angle" class="svelte-1feoufx">Psi Angle (degrees):</label> <input type="range" id="angle" min="0" max="360" step="1" class="svelte-1feoufx"> <span class="svelte-1feoufx"> </span></div> <div class="slider-container svelte-1feoufx"><label for="phiAngle" class="svelte-1feoufx">Phi Angle (degrees):</label> <input type="range" id="phiAngle" min="0" max="360" step="1" class="svelte-1feoufx"> <span class="svelte-1feoufx"> </span></div></div> <!></div></div> <div class="panel svelte-1feoufx"><h2 class="svelte-1feoufx">Energy Landscape</h2> <div class="contour-container svelte-1feoufx"><canvas></canvas></div> <div class="info svelte-1feoufx"><p class="svelte-1feoufx"> </p> <p class="svelte-1feoufx"> </p> <div class="instruction svelte-1feoufx"><p class="highlight svelte-1feoufx">Click on the plot above to add sample points and update the GP model</p></div> <div class="button-group svelte-1feoufx"><!> <button class="info-button svelte-1feoufx"> </button></div> <div class="energy-function svelte-1feoufx"><h3 class="svelte-1feoufx">About the Visualization:</h3> <p class="svelte-1feoufx"> </p> <p class="svelte-1feoufx">The energy function represents different stable conformations of the protein backbone. Lighter regions indicate lower energy (more stable conformations).</p> <p class="svelte-1feoufx">Click directly on the plot to add sample points and build a GP model that learns this energy landscape.</p></div></div></div></div></main>');function Lt(de,V){Ne(V,!1);const S=E(),z=E();let C=E([]),O=[],k=E(),G=E(),q=E(!1),R=E(!1),F=E(20),W=E(!1);const d=400,y=400,i=40,K=d-2*i,H=Re([-Math.PI,Math.PI],[i,d-i]),Z=Re([-Math.PI,Math.PI],[y-i,i]),o={primary:"#3c6382",secondary:"#82ccdd",accent:"#60a3bc",highlight:"#6a89cc",text:"#2c3e50",bond1:"#38ada9",bond2:"#6a89cc",atom1:"#3c6382",atom2:"#60a3bc",atom3:"#82ccdd",atom4:"#38ada9"};let f=1/0,u=-1/0;function v(){const s=ne(-Math.PI,Math.PI,2*Math.PI/50).toArray(),n=ne(-Math.PI,Math.PI,2*Math.PI/50).toArray();for(const a of s)for(const r of n){const c=j(a,r);f=Math.min(f,c),u=Math.max(u,c)}f=Math.floor(f*10)/10,u=Math.ceil(u*10)/10,console.log(`Energy range: ${f} to ${u}`)}function j(e,s){const n=Math.exp(-((e+Math.PI/2)**2)-(s-Math.PI/2)**2/.5),a=Math.exp(-((e+Math.PI/2)**2)-(s+.5)**2/.3),r=Math.exp(-((e-Math.PI/2)**2)-(s+Math.PI/2)**2/.5),c=Math.exp(-((e-Math.PI/2)**2)-(s-.5)**2/.3),M=Math.exp(-((e-0)**2)/.3-(s-Math.PI/4)**2/.2),I=n+a+r+c+M;return-Math.log(I+1e-6)}function U(){g(C,[]),O=[],b()}function $(e){if(t(q)||t(F)<=0)return;const s=t(G).getBoundingClientRect(),n=e.clientX-s.left,a=e.clientY-s.top,r=H.invert(n),c=Z.invert(a);if(n>=i&&n<=d-i&&a>=i&&a<=y-i){g(S,r),g(z,c);const M=j(t(S),t(z));g(C,[...t(C),{phi:t(S),psi:t(z),energy:M}]),g(F,t(F)-1),t(F)===0&&g(W,!0),P(),T()}}function _(){g(F,20),g(C,[]),O=[],g(W,!1),b()}function P(){if(g(q,!0),t(C).length===0){g(q,!1),b();return}setTimeout(()=>{const e=t(C).map(l=>[l.phi,l.psi]),s=t(C).map(l=>l.energy),n=(l,A,se=1)=>{const oe=vt(pt(ht(l,A),2));return ut(-.5*oe/(se*se))},a=e.length,r=je(a,a);for(let l=0;l<a;l++)for(let A=0;A<a;A++)r.set([l,A],n(e[l],e[A]));const c=.01;for(let l=0;l<a;l++)r.set([l,l],r.get([l,l])+c);const M=40,I=ne(-Math.PI,Math.PI,2*Math.PI/M).toArray(),L=ne(-Math.PI,Math.PI,2*Math.PI/M).toArray();O=[];for(const l of I)for(const A of L){const se=[l,A],oe=je(1,a);for(let N=0;N<a;N++)oe.set([0,N],n(se,e[N]));try{const N=dt(r,s),at=ft(oe,N).get([0,0]);O.push({phi:l,psi:A,predicted:at})}catch(N){console.error("Error in GP calculation:",N)}}b(),g(q,!1)},50)}function b(){if(!t(G))return;const e=t(G).getContext("2d");e.clearRect(0,0,d+60,y);const s=rt().domain([u,f]).interpolator(ct);if(t(R)||O.length===0){const a=K/80;for(let r=0;r<80;r++)for(let c=0;c<80;c++){const M=-Math.PI+2*Math.PI*r/80,I=-Math.PI+2*Math.PI*c/80,L=j(M,I),l=H(M),A=Z(I);e.fillStyle=s(L),e.fillRect(l-a/2,A-a/2,a,a)}}else{const n=K/Math.sqrt(O.length);O.forEach(a=>{const r=H(a.phi),c=Z(a.psi);e.fillStyle=s(a.predicted),e.fillRect(r-n/2,c-n/2,n,n)})}w(e,s),e.strokeStyle=o.primary,e.lineWidth=2,e.beginPath(),e.moveTo(i,y-i),e.lineTo(d-i,y-i),e.moveTo(i,i),e.lineTo(i,y-i),e.stroke(),e.fillStyle=o.text,e.font="bold 14px Arial, sans-serif",e.textAlign="center",e.fillText("-π",i,y-i+15),e.fillText("0",d/2,y-i+15),e.fillText("π",d-i,y-i+15),e.fillText("φ",d-i+15,y-i+5),e.textAlign="right",e.fillText("-π",i-5,y-i),e.fillText("0",i-5,y/2),e.fillText("π",i-5,i),e.fillText("ψ",i-15,i-10),t(C).forEach(n=>{const a=H(n.phi),r=Z(n.psi),c=8,M=e.createRadialGradient(a,r,2,a,r,c);M.addColorStop(0,o.highlight),M.addColorStop(1,"rgba(106, 137, 204, 0)"),e.fillStyle=M,e.beginPath(),e.arc(a,r,c,0,2*Math.PI),e.fill(),e.fillStyle=o.accent,e.beginPath(),e.arc(a,r,4,0,2*Math.PI),e.fill(),e.strokeStyle=o.primary,e.lineWidth=1,e.stroke()})}function w(e,s){const a=y-2*i,r=d-i+20,c=i,M=100,I=a/M;for(let l=0;l<M;l++){const A=f+(u-f)*(M-l-1)/M;e.fillStyle=s(A),e.fillRect(r,c+l*I,20,I+1)}e.strokeStyle=o.text,e.lineWidth=1,e.strokeRect(r,c,20,a),e.fillStyle=o.text,e.font="12px Arial, sans-serif",e.textAlign="left",e.fillText(f.toFixed(1),r+20+5,c+a),e.fillText(u.toFixed(1),r+20+5,c);const L=(f+u)/2;e.fillText(L.toFixed(1),r+20+5,c+a/2),e.save(),e.translate(r+20+25,c+a/2),e.rotate(-Math.PI/2),e.textAlign="center",e.fillText("Energy",0,0),e.restore()}function T(){if(!t(k))return;const e=t(k).getContext("2d");e.clearRect(0,0,d,y);const s=d/2,n=y/2,a=120,r=e.createRadialGradient(s,n,0,s,n,a*1.5);r.addColorStop(0,"rgba(60, 99, 130, 0.1)"),r.addColorStop(1,"rgba(245, 246, 250, 0.05)"),e.fillStyle=r,e.fillRect(0,0,d,y);const c=e.createLinearGradient(s-a,n,s+a,n);c.addColorStop(0,o.secondary),c.addColorStop(.5,o.primary),c.addColorStop(1,o.secondary),e.strokeStyle=c,e.lineWidth=3,e.beginPath(),e.moveTo(s-a,n),e.lineTo(s+a,n),e.stroke();const M=[{x:s-a,y:n,color:o.atom1,label:"N",size:24},{x:s-a/2,y:n,color:o.atom2,label:"Cα",size:26},{x:s,y:n,color:o.atom3,label:"C",size:24},{x:s+a/2,y:n,color:o.atom4,label:"O",size:24},{x:s+a,y:n,color:o.atom1,label:"N",size:24}];e.save(),e.translate(s-a/2,n),e.rotate(t(S));const I=e.createLinearGradient(0,0,0,-60);I.addColorStop(0,o.bond1),I.addColorStop(1,o.secondary),e.strokeStyle=I,e.lineWidth=3,e.beginPath(),e.moveTo(0,0),e.lineTo(0,-60),e.stroke(),e.fillStyle=o.text,e.font="bold 14px Arial, sans-serif",e.fillText("φ = "+t(S).toFixed(2),5,-30),e.restore(),e.save(),e.translate(s,n),e.rotate(t(z));const L=e.createLinearGradient(0,0,0,-60);L.addColorStop(0,o.bond2),L.addColorStop(1,o.highlight),e.strokeStyle=L,e.lineWidth=3,e.beginPath(),e.moveTo(0,0),e.lineTo(0,-60),e.stroke(),e.fillStyle=o.text,e.font="bold 14px Arial, sans-serif",e.fillText("ψ = "+t(z).toFixed(2),5,-30),e.restore(),M.forEach(l=>{const A=e.createRadialGradient(l.x,l.y,0,l.x,l.y,l.size*1.2);A.addColorStop(0,l.color),A.addColorStop(1,"rgba(255, 255, 255, 0)"),e.fillStyle=A,e.beginPath(),e.arc(l.x,l.y,l.size*1.2,0,2*Math.PI),e.fill(),e.fillStyle=l.color,e.beginPath(),e.arc(l.x,l.y,l.size,0,2*Math.PI),e.fill(),e.fillStyle="#fff",e.font="bold 14px Arial, sans-serif",e.textAlign="center",e.textBaseline="middle",e.fillText(l.label,l.x,l.y)})}function B(){g(R,!t(R)),b()}Be(()=>{v(),T(),b()}),ae(()=>{},()=>{g(S,0)}),ae(()=>{},()=>{g(z,0)}),ae(()=>(t(k),t(S),t(z)),()=>{t(k)&&(t(S)||t(z))&&T()}),qe(),$e();var D=Mt(),x=m(p(D),2),X=p(x),ee=p(X);h(X);var J=m(X,2),_e=p(J),Xe=m(_e,2);h(J),h(x);var Pe=m(x,2);{var Ye=e=>{var s=mt(),n=p(s),a=m(p(n),4);h(n),h(s),ie("click",a,_),re(e,s)};Fe(Pe,e=>{t(W)&&e(Ye)})}var Ae=m(Pe,2),fe=p(Ae),le=m(p(fe),2);Q(le,"width",d),Q(le,"height",y),Me(le,e=>g(k,e),()=>t(k));var Se=m(le,2),ve=p(Se),pe=p(ve),he=m(p(pe),2);Le(he);var ze=m(he,2),Ke=p(ze);h(ze),h(pe);var Te=m(pe,2),ue=m(p(Te),2);Le(ue);var Ie=m(ue,2),Ze=p(Ie);h(Ie),h(Te),h(ve);var Ue=m(ve,2);yt(Ue,{get angle(){return t(S)},set angle(e){g(S,e)},get phiAngle(){return t(z)},set phiAngle(e){g(z,e)},$$legacy:!0}),h(Se),h(fe);var Ce=m(fe,2),ge=m(p(Ce),2),te=p(ge);Q(te,"width",d+60),Q(te,"height",y),Me(te,e=>g(G,e),()=>t(G)),h(ge);var we=m(ge,2),xe=p(we),Je=p(xe);h(xe);var ye=m(xe,2),Qe=p(ye);h(ye);var me=m(ye,4),Ee=p(me);{var Ve=e=>{var s=bt();ie("click",s,U),re(e,s)};Fe(Ee,e=>{t(C).length>0&&e(Ve)})}var be=m(Ee,2),et=p(be,!0);h(be),h(me);var ke=m(me,2),Oe=m(p(ke),2),tt=p(Oe,!0);h(Oe),ot(4),h(ke),h(we),h(Ce),h(Ae),h(D),lt((e,s)=>{Y(ee,`Lives ${t(F)??""}/20`),Q(_e,"style",`width: ${e??""}%`),Q(Xe,"style",`left: ${e??""}%`),Y(Ke,`${t(z)??""}°`),Y(Ze,`${t(S)??""}°`),it(te,1,nt(t(q)?"loading":""),"svelte-1feoufx"),Y(Je,`Samples: ${t(C).length??""}`),Y(Qe,`Current energy: ${s??""}`),Y(et,t(R)?"Show GP Prediction":"Show Energy Function"),Y(tt,t(R)?"Showing actual energy function":"Showing Gaussian Process prediction")},[()=>Math.max(0,t(F)/20*100),()=>j(t(S),t(z)).toFixed(2)],st),We(he,()=>t(z),e=>g(z,e)),We(ue,()=>t(S),e=>g(S,e)),ie("click",te,$),ie("click",be,B),re(de,D),He()}export{Lt as component};
