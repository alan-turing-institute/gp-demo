import{t as ve,a as fe}from"../chunks/cGtBC6Qd.js";import"../chunks/7LKkzqbz.js";import{a4 as nt,aa as Q,ab as ot,a5 as rt,a6 as v,a1 as h,ac as k,e as t,Z as Qe,a7 as g,a9 as Ie,s as p,i as Ve,aw as Mt,a8 as zt}from"../chunks/BJ4irGt7.js";import{e as se,s as q}from"../chunks/CvaqDwXv.js";import{i as et}from"../chunks/lIaEYNz1.js";import{s as Y,r as tt}from"../chunks/B9r3SdpA.js";import{l as it,s as Pt,c as Tt}from"../chunks/dhIx7U5O.js";import{b as wt,a as lt}from"../chunks/RvGyPHbW.js";import{b as Re}from"../chunks/CUY-1DrG.js";import{i as ct}from"../chunks/CkfO92w8.js";import{o as dt}from"../chunks/Cpzjerpz.js";import{r as de,s as Ct,v as Et,z as at,l as kt,m as It,a as Rt,d as Ot,b as Ft,e as Gt}from"../chunks/PBAI84v4.js";import{_ as Lt}from"../chunks/C1FmrZbK.js";import{p as st}from"../chunks/6XXKwe28.js";var Wt=ve('<main class="svelte-13sjxqj"><div class="viewer-container svelte-13sjxqj"><div id="viewer" class="svelte-13sjxqj"></div></div></main>');function Dt(ge,ee){nt(ee,!1);let P=`
ATOM      1  CH3 ACE     1       2.000   2.090   0.000
ATOM      2  C   ACE     1       3.427   2.641  -0.000
ATOM      3  O   ACE     1       4.391   1.877  -0.000
ATOM      4  N   ALA     2       3.555   3.970  -0.000
ATOM      5  CA  ALA     2       4.853   4.614  -0.000
ATOM     6  HA  ALA     2       5.408   4.316   0.890
ATOM     7  CB  ALA     2       5.661   4.221  -1.232
ATOM     8  C   ALA     2       4.713   6.129   0.000
ATOM     9  O   ALA     2       3.601   6.653   0.000
ATOM     10  N   NME     3       5.846   6.835   0.000
ATOM     11  H   NME     3       6.737   6.359  -0.000
ATOM     12  CH3 NME     3       5.846   8.284   0.000
TER   
END`,T=[6,7,8,9,10,11,12],D=4,R=5,E=st(ee,"angle",8,50),L=st(ee,"phiAngle",8,0);function H(u){let y;Math.abs(u.z)>.9?y={x:0,y:u.z,z:-u.y}:y={x:-u.y,y:u.x,z:0};let r=Math.sqrt(y.x**2+y.y**2+y.z**2);return y.x/=r,y.y/=r,y.z/=r,y}function B(u,y,r,c,I){let V=I*Math.PI/180,j=Math.cos(V),m=Math.sin(V),z=1-j,C=[[j+c.x**2*z,c.x*c.y*z-c.z*m,c.x*c.z*z+c.y*m],[c.y*c.x*z+c.z*m,j+c.y**2*z,c.y*c.z*z-c.x*m],[c.z*c.x*z-c.y*m,c.z*c.y*z+c.x*m,j+c.z**2*z]];return y.forEach(O=>{let F=u[O-1],U=F.x-r.x,G=F.y-r.y,_=F.z-r.z,J=C[0][0]*U+C[0][1]*G+C[0][2]*_,ie=C[1][0]*U+C[1][1]*G+C[1][2]*_,le=C[2][0]*U+C[2][1]*G+C[2][2]*_;F.x=J+r.x,F.y=ie+r.y,F.z=le+r.z}),u}function Z(u,y,r,c,I,V){let m=u.split(`
`).filter(_=>_.startsWith("ATOM")).map(_=>{let J=parseFloat(_.substring(30,38).trim()),ie=parseFloat(_.substring(38,46).trim()),le=parseFloat(_.substring(46,54).trim());return{x:J,y:ie,z:le,line:_}}),z=m[r-1],C=m[c-1],O={x:C.x-z.x,y:C.y-z.y,z:C.z-z.z},F=Math.sqrt(O.x**2+O.y**2+O.z**2);O.x/=F,O.y/=F,O.z/=F;let U=H(O);return m=B(m,y,z,O,I),m=B(m,y,z,U,V),m.forEach(_=>{_.line=_.line.substring(0,30)+_.x.toFixed(3).padStart(8)+_.y.toFixed(3).padStart(8)+_.z.toFixed(3).padStart(8)+_.line.substring(54)}),m.map(_=>_.line).join(`
`)+`
TER
END`}let W=k(),S=k(),K=k();dt(async()=>{if(typeof window<"u")try{const{createViewer:u}=await Lt(async()=>{const{createViewer:y}=await import("../chunks/kNyKxqkf.js").then(r=>r._);return{createViewer:y}},[],import.meta.url);console.log("3Dmol.js loaded successfully"),h(S,u(t(K),{backgroundColor:"white"})),M(!0),window.addEventListener("resize",()=>{t(S)&&(t(S).resize(),t(S).render())})}catch(u){console.error("Failed to load 3Dmol.js:",u)}});function M(u=!0){t(S)&&(console.log("Updating viewer with angles:",E(),L()),t(S).clear(),t(S).addModel(t(W),"pdb"),t(S).setStyle({},{stick:{radius:.2},sphere:{scale:.3}}),u&&t(S).zoomTo(),t(S).render())}Q(()=>(Qe(E()),Qe(L())),()=>{h(W,Z(P,T,D,R,E(),L()))}),Q(()=>(t(S),t(W)),()=>{t(S)&&t(W)&&M(!1)}),ot(),ct();var x=Wt(),o=v(x),te=v(o);Re(te,u=>h(K,u),()=>t(K)),g(o),g(x),fe(ge,x),rt()}var jt=ve(`<div class="game-ended-popup svelte-1x4igff"><div class="popup-content svelte-1x4igff"><h2 class="svelte-1x4igff">Game Ended</h2> <p class="svelte-1x4igff">You've used all your lives!</p> <p class="svelte-1x4igff"> </p> <button class="svelte-1x4igff">Play Again</button></div></div>`),$t=ve('<button class="svelte-1x4igff">Clear Samples</button>'),Nt=ve('<main class="svelte-1x4igff"><h1 class="svelte-1x4igff">Protein Backbone Conformation Explorer</h1> <div class="live-bar-container svelte-1x4igff"><div class="lives-label svelte-1x4igff"> </div> <div class="live-bar svelte-1x4igff"><div class="lives-remaining svelte-1x4igff"></div> <span class="heart svelte-1x4igff">❤️</span></div></div> <div class="score-bar-container svelte-1x4igff"><div class="score-label svelte-1x4igff">Score: <span id="score-percentage"> </span></div> <div class="score-bar svelte-1x4igff"><div class="score-value svelte-1x4igff" id="score-bar"></div> <span class="star svelte-1x4igff" id="score-star">⭐</span></div></div> <!> <div class="level-container svelte-1x4igff"><label for="level" class="level-label svelte-1x4igff">Difficulty:</label> <select id="level" class="svelte-1x4igff"><option>Level 1</option><option>Level 2</option><option>Level 3</option></select></div> <div class="container svelte-1x4igff"><div class="panel svelte-1x4igff"><h2 class="svelte-1x4igff">Backbone Angles</h2> <canvas class="svelte-1x4igff"></canvas> <div class="Other"><div class="control-panel svelte-1x4igff"><div class="slider-container svelte-1x4igff"><label for="angle" class="svelte-1x4igff">Psi Angle (degrees):</label> <input type="range" id="angle" min="0" max="360" step="1" class="svelte-1x4igff"> <span class="svelte-1x4igff"> </span></div> <div class="slider-container svelte-1x4igff"><label for="phiAngle" class="svelte-1x4igff">Phi Angle (degrees):</label> <input type="range" id="phiAngle" min="0" max="360" step="1" class="svelte-1x4igff"> <span class="svelte-1x4igff"> </span></div></div> <!></div></div> <div class="panel svelte-1x4igff"><h2 class="svelte-1x4igff">Energy Landscape</h2> <div class="contour-container svelte-1x4igff"><canvas></canvas></div> <div class="info svelte-1x4igff"><p class="svelte-1x4igff"> </p> <p class="svelte-1x4igff"> </p> <div class="instruction svelte-1x4igff"><p class="highlight svelte-1x4igff">Click on the plot above to add sample points and update the GP model</p></div> <div class="button-group svelte-1x4igff"><!> <button class="info-button svelte-1x4igff"> </button></div> <div class="energy-function svelte-1x4igff"><h3 class="svelte-1x4igff">About the Visualization:</h3> <p class="svelte-1x4igff"> </p> <p class="svelte-1x4igff">The energy function represents different stable conformations of the protein backbone. Lighter regions indicate lower energy (more stable conformations).</p> <p class="svelte-1x4igff">Click directly on the plot to add sample points and build a GP model that learns this energy landscape.</p></div></div></div></div></main>');function li(ge,ee){nt(ee,!1);const P=k(),T=k(),D=k(),R=k();let E=k([]),L=[],H=k(),B=k(),Z=k(!1),W=k(!1),S=k(20),K=k(!1);const M=400,x=400,o=40,te=M-2*o,u=it([0,360],[o,M-o]),y=it([0,360],[x-o,o]),r={primary:"#3c6382",secondary:"#82ccdd",accent:"#60a3bc",highlight:"#6a89cc",text:"#2c3e50",bond1:"#38ada9",bond2:"#6a89cc",atom1:"#3c6382",atom2:"#60a3bc",atom3:"#82ccdd",atom4:"#38ada9"};let c=1/0,I=-1/0;function V(){const s=de(0,360,7.2).toArray(),l=de(0,360,360/50).toArray();for(const i of s)for(const n of l){const a=m(i,n);c=Math.min(c,a),I=Math.max(I,a)}c=Math.floor(c*10)/10,I=Math.ceil(I*10)/10,console.log(`Energy range: ${c} to ${I}`)}function j(e){return e*(Math.PI/180)}function m(e,s){const l=j(e)-Math.PI,i=j(s)-Math.PI,n=Math.exp(-((l+Math.PI/2)**2)-(i-Math.PI/2)**2/.5),a=Math.exp(-((l+Math.PI/2)**2)-(i+.5)**2/.3),d=Math.exp(-((l-Math.PI/2)**2)-(i+Math.PI/2)**2/.5),A=Math.exp(-((l-Math.PI/2)**2)-(i-.5)**2/.3),w=Math.exp(-((l-0)**2)/.3-(i-Math.PI/4)**2/.2);let f=0;return t(R)=="1"?f=n:t(R)=="2"?f=n+a:t(R)=="3"?f=n+a+d+A+w:console.error("Invalid difficulty level: ",t(R)),-Math.log(f+1e-6)}function z(){h(E,[]),L=[],G()}function C(e){if(t(Z)||t(S)<=0)return;const s=t(B).getBoundingClientRect(),l=e.clientX-s.left,i=e.clientY-s.top,n=Math.round(u.invert(l)),a=Math.round(y.invert(i));if(l>=o&&l<=M-o&&i>=o&&i<=x-o){h(P,n),h(T,a);const d=m(t(P),t(T));h(E,[...t(E),{phi:t(P),psi:t(T),energy:d}]),h(S,t(S)-1),t(S)===0&&h(K,!0),U(),J()}}function O(){h(S,20),h(D,0),h(E,[]),L=[],h(K,!1),G()}function F(e,s){if(e.length!==s.length||e.length===0)throw new Error("Arrays must be of the same length and non-empty");const l=e.reduce((d,A)=>d+A,0)/e.length,i=e.reduce((d,A)=>d+Math.pow(A-l,2),0),a=1-e.reduce((d,A,w)=>d+Math.pow(A-s[w],2),0)/i;return Math.max(0,a)}function U(){h(Z,!0);let e=[],s=[];if(t(E).length===0){h(Z,!1),G();return}setTimeout(()=>{console.log("Updating GP model...");const l=t(E).map(b=>[b.phi,b.psi]),i=t(E).map(b=>b.energy),n=(b,$,re=1*(180/Math.PI))=>{const ce=Rt(Ot(Ft(b,$),2));return Gt(-.5*ce/(re*re))},a=l.length,d=at(a,a);for(let b=0;b<a;b++)for(let $=0;$<a;$++)d.set([b,$],n(l[b],l[$]));const A=.01;for(let b=0;b<a;b++)d.set([b,b],d.get([b,b])+A);const w=40,f=de(0,360,360/w).toArray(),N=de(0,360,360/w).toArray();L=[];for(const b of f)for(const $ of N){const re=[b,$],ce=at(1,a);for(let X=0;X<a;X++)ce.set([0,X],n(re,l[X]));try{const X=kt(d,i),Je=It(ce,X).get([0,0]);L.push({phi:b,psi:$,predicted:Je}),s.push(Je),e.push(m(b,$))}catch(X){console.error("Error in GP calculation:",X)}}G(),h(D,F(e,s)),console.log("R2 Score: ",t(D)),h(Z,!1)},50)}function G(){if(!t(B))return;const e=t(B).getContext("2d");e.clearRect(0,0,M+60,x);const s=Ct().domain([I,c]).interpolator(Et);if(t(W)){const i=te/80;for(let n=0;n<80;n++)for(let a=0;a<80;a++){const d=0+360*n/80,A=0+360*a/80,w=m(d,A),f=u(d),N=y(A);e.fillStyle=s(w),e.fillRect(f-i/2,N-i/2,i,i)}}else if(L.length===0){const i=te/80;for(let n=0;n<80;n++)for(let a=0;a<80;a++){const d=0+360*n/80,A=0+360*a/80,w=u(d),f=y(A);e.fillStyle=s(0),e.fillRect(w-i/2,f-i/2,i,i)}}else{const l=te/Math.sqrt(L.length);L.forEach(i=>{const n=u(i.phi),a=y(i.psi);e.fillStyle=s(i.predicted),e.fillRect(n-l/2,a-l/2,l,l)})}_(e,s),e.strokeStyle=r.primary,e.lineWidth=2,e.beginPath(),e.moveTo(o,x-o),e.lineTo(M-o,x-o),e.moveTo(o,o),e.lineTo(o,x-o),e.stroke(),e.fillStyle=r.text,e.font="bold 14px Arial, sans-serif",e.textAlign="center",e.fillText("0",o,x-o+15),e.fillText("180",M/2,x-o+15),e.fillText("360",M-o,x-o+15),e.fillText("φ",M-o+10,x-o+25),e.textAlign="right",e.fillText("0",o-5,x-o),e.fillText("180",o-5,x/2),e.fillText("360",o-5,o),e.fillText("ψ",o-20,o-20),t(E).forEach(l=>{const i=u(l.phi),n=y(l.psi),a=8,d=e.createRadialGradient(i,n,2,i,n,a);d.addColorStop(0,r.highlight),d.addColorStop(1,"rgba(106, 137, 204, 0)"),e.fillStyle=d,e.beginPath(),e.arc(i,n,a,0,2*Math.PI),e.fill(),e.fillStyle=r.accent,e.beginPath(),e.arc(i,n,4,0,2*Math.PI),e.fill(),e.strokeStyle=r.primary,e.lineWidth=1,e.stroke()})}function _(e,s){const i=x-2*o,n=M-o+20,a=o,d=100,A=i/d;for(let f=0;f<d;f++){const N=c+(I-c)*(d-f-1)/d;e.fillStyle=s(N),e.fillRect(n,a+f*A,20,A+1)}e.strokeStyle=r.text,e.lineWidth=1,e.strokeRect(n,a,20,i),e.fillStyle=r.text,e.font="12px Arial, sans-serif",e.textAlign="left",e.fillText(c.toFixed(1),n+20+5,a+i),e.fillText(I.toFixed(1),n+20+5,a);const w=(c+I)/2;e.fillText(w.toFixed(1),n+20+5,a+i/2),e.save(),e.translate(n+20+25,a+i/2),e.rotate(-Math.PI/2),e.textAlign="center",e.fillText("Energy",0,10),e.restore()}function J(){if(!t(H))return;const e=t(H).getContext("2d");e.clearRect(0,0,M,x);const s=M/2,l=x/2,i=120,n=e.createRadialGradient(s,l,0,s,l,i*1.5);n.addColorStop(0,"rgba(60, 99, 130, 0.1)"),n.addColorStop(1,"rgba(245, 246, 250, 0.05)"),e.fillStyle=n,e.fillRect(0,0,M,x);const a=e.createLinearGradient(s-i,l,s+i,l);a.addColorStop(0,r.secondary),a.addColorStop(.5,r.primary),a.addColorStop(1,r.secondary),e.strokeStyle=a,e.lineWidth=3,e.beginPath(),e.moveTo(s-i,l),e.lineTo(s+i,l),e.stroke();const d=[{x:s-i,y:l,color:r.atom1,label:"N",size:24},{x:s-i/2,y:l,color:r.atom2,label:"Cα",size:26},{x:s,y:l,color:r.atom3,label:"C",size:24},{x:s+i/2,y:l,color:r.atom4,label:"O",size:24},{x:s+i,y:l,color:r.atom1,label:"N",size:24}];e.save(),e.translate(s-i/2,l),e.rotate(j(t(P)));const A=e.createLinearGradient(0,0,0,-60);A.addColorStop(0,r.bond1),A.addColorStop(1,r.secondary),e.strokeStyle=A,e.lineWidth=3,e.beginPath(),e.moveTo(0,0),e.lineTo(0,-60),e.stroke(),e.fillStyle=r.text,e.font="bold 14px Arial, sans-serif",e.fillText("φ = "+t(P).toFixed(0),5,-30),e.restore(),e.save(),e.translate(s,l),e.rotate(j(t(T)));const w=e.createLinearGradient(0,0,0,-60);w.addColorStop(0,r.bond2),w.addColorStop(1,r.highlight),e.strokeStyle=w,e.lineWidth=3,e.beginPath(),e.moveTo(0,0),e.lineTo(0,-60),e.stroke(),e.fillStyle=r.text,e.font="bold 14px Arial, sans-serif",e.fillText("ψ = "+t(T).toFixed(0),5,-30),e.restore(),d.forEach(f=>{const N=e.createRadialGradient(f.x,f.y,0,f.x,f.y,f.size*1.2);N.addColorStop(0,f.color),N.addColorStop(1,"rgba(255, 255, 255, 0)"),e.fillStyle=N,e.beginPath(),e.arc(f.x,f.y,f.size*1.2,0,2*Math.PI),e.fill(),e.fillStyle=f.color,e.beginPath(),e.arc(f.x,f.y,f.size,0,2*Math.PI),e.fill(),e.fillStyle="#fff",e.font="bold 14px Arial, sans-serif",e.textAlign="center",e.textBaseline="middle",e.fillText(f.label,f.x,f.y)})}function ie(){h(W,!t(W)),G()}dt(()=>{V(),J(),G()});function le(e){h(R,e.target.value),t(W)&&G(),console.log("Difficulty level set to: ",t(R))}Q(()=>{},()=>{h(P,0)}),Q(()=>{},()=>{h(T,0)}),Q(()=>{},()=>{h(D,0)}),Q(()=>(t(H),t(P),t(T)),()=>{t(H)&&(t(P)||t(T))&&J()}),Q(()=>{},()=>{h(R,"3")}),ot(),ct();var pe=Nt(),he=p(v(pe),2),ue=v(he),ft=v(ue);g(ue);var Oe=p(ue,2),Fe=v(Oe),vt=p(Fe,2);g(Oe),g(he);var xe=p(he,2),ye=v(xe),Ge=p(v(ye)),gt=v(Ge);g(Ge),g(ye);var Le=p(ye,2),We=v(Le),pt=p(We,2);g(Le),g(xe);var De=p(xe,2);{var ht=e=>{var s=jt(),l=v(s),i=p(v(l),4),n=v(i);g(i);var a=p(i,2);g(l),g(s),Ie(d=>q(n,`Final score: ${d??""}%`),[()=>(t(D)*100).toFixed(0)],Ve),se("click",a,O),fe(e,s)};et(De,e=>{t(K)&&e(ht)})}var be=p(De,2),ne=p(v(be),2);Ie(()=>{t(R),Mt(()=>{})});var me=v(ne);me.value=(me.__value="1")==null?"":"1";var _e=p(me);_e.value=(_e.__value="2")==null?"":"2";var je=p(_e);je.value=(je.__value="3")==null?"":"3",g(ne),g(be);var $e=p(be,2),Ae=v($e),oe=p(v(Ae),2);Y(oe,"width",M),Y(oe,"height",x),Re(oe,e=>h(H,e),()=>t(H));var Ne=p(oe,2),Se=v(Ne),Me=v(Se),ze=p(v(Me),2);tt(ze);var qe=p(ze,2),ut=v(qe);g(qe),g(Me);var He=p(Me,2),Pe=p(v(He),2);tt(Pe);var Be=p(Pe,2),xt=v(Be);g(Be),g(He),g(Se);var yt=p(Se,2);Dt(yt,{get angle(){return t(P)},set angle(e){h(P,e)},get phiAngle(){return t(T)},set phiAngle(e){h(T,e)},$$legacy:!0}),g(Ne),g(Ae);var Xe=p(Ae,2),Te=p(v(Xe),2),ae=v(Te);Y(ae,"width",M+60),Y(ae,"height",x),Re(ae,e=>h(B,e),()=>t(B)),g(Te);var Ye=p(Te,2),we=v(Ye),bt=v(we);g(we);var Ce=p(we,2),mt=v(Ce);g(Ce);var Ee=p(Ce,4),Ze=v(Ee);{var _t=e=>{var s=$t();se("click",s,z),fe(e,s)};et(Ze,e=>{t(E).length>0&&e(_t)})}var ke=p(Ze,2),At=v(ke,!0);g(ke),g(Ee);var Ke=p(Ee,2),Ue=p(v(Ke),2),St=v(Ue,!0);g(Ue),zt(4),g(Ke),g(Ye),g(Xe),g($e),g(pe),Ie((e,s,l)=>{q(ft,`Lives ${t(S)??""}/20`),Y(Fe,"style",`width: ${e??""}%`),Y(vt,"style",`left: ${e??""}%`),q(gt,`${s??""}%`),Y(We,"style",`width: ${t(D)*100}%`),Y(pt,"style",`left: ${t(D)*100}%`),q(ut,`${t(T)??""}°`),q(xt,`${t(P)??""}°`),Pt(ae,1,Tt(t(Z)?"loading":""),"svelte-1x4igff"),q(bt,`Samples: ${t(E).length??""}`),q(mt,`Current energy: ${l??""}`),q(At,t(W)?"Show GP Prediction":"Show Energy Function"),q(St,t(W)?"Showing actual energy function":"Showing Gaussian Process prediction")},[()=>Math.max(0,t(S)/20*100),()=>(t(D)*100).toFixed(0),()=>m(t(P),t(T)).toFixed(2)],Ve),wt(ne,()=>t(R),e=>h(R,e)),se("change",ne,le),lt(ze,()=>t(T),e=>h(T,e)),lt(Pe,()=>t(P),e=>h(P,e)),se("click",ae,C),se("click",ke,ie),fe(ge,pe),rt()}export{li as component};
