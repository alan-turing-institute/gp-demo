import{t as ie,a as ae}from"../chunks/cGtBC6Qd.js";import"../chunks/7LKkzqbz.js";import{a4 as tt,a1 as d,ac as F,e as t,aa as se,Z as Be,ab as lt,a6 as i,a7 as n,a5 as at,a9 as he,s as r,i as Ue,aw as gt,f as Ze}from"../chunks/BJ4irGt7.js";import{e as Z,s as K}from"../chunks/CvaqDwXv.js";import{i as be}from"../chunks/lIaEYNz1.js";import{s as J,r as Ae}from"../chunks/B9r3SdpA.js";import{l as Ke,s as Re,c as Je}from"../chunks/dhIx7U5O.js";import{b as ht,a as xe}from"../chunks/CI8f-3O8.js";import{b as Le}from"../chunks/CUY-1DrG.js";import{i as st}from"../chunks/CkfO92w8.js";import{o as Fe}from"../chunks/Cpzjerpz.js";import{r as we,s as ft,v as mt,z as Qe,l as _t,m as bt,a as At,d as xt,b as wt,e as Mt}from"../chunks/PBAI84v4.js";import{_ as zt}from"../chunks/C1FmrZbK.js";import{p as Ve}from"../chunks/6XXKwe28.js";var St=ie('<main class="svelte-13sjxqj"><div class="viewer-container svelte-13sjxqj"><div id="viewer" class="svelte-13sjxqj"></div></div></main>');function et(Me,ve){tt(ve,!1);let P=`
ATOM      1  CH3 ACE     1       2.000   2.090   0.000
ATOM      2  C   ACE     1       3.427   2.641  -0.000
ATOM      3  O   ACE     1       4.391   1.877  -0.000
ATOM      4  N   ALA     2       3.555   3.970  -0.000
ATOM      5  CA  ALA     2       4.853   4.614  -0.000
ATOM     6  HA  ALA     2       5.408   4.316   0.890
ATOM     7  CB  ALA     2       5.661   4.221  -1.232
ATOM     8  C   ALA     2       4.713   6.129   0.000
ATOM     9  O   ALA     2       3.601   6.653   0.000
ATOM     10  N   NME     3       5.846   6.835   0.000
ATOM     11  H   NME     3       6.737   6.359  -0.000
ATOM     12  CH3 NME     3       5.846   8.284   0.000
TER   
END`,T=[6,7,8,9,10,11,12],N=4,W=5,de=Ve(ve,"angle",8,50),L=Ve(ve,"phiAngle",8,0);function U(h){let f;Math.abs(h.z)>.9?f={x:0,y:h.z,z:-h.y}:f={x:-h.y,y:h.x,z:0};let m=Math.sqrt(f.x**2+f.y**2+f.z**2);return f.x/=m,f.y/=m,f.z/=m,f}function q(h,f,m,y,te){let I=te*Math.PI/180,O=Math.cos(I),M=Math.sin(I),z=1-O,S=[[O+y.x**2*z,y.x*y.y*z-y.z*M,y.x*y.z*z+y.y*M],[y.y*y.x*z+y.z*M,O+y.y**2*z,y.y*y.z*z-y.x*M],[y.z*y.x*z-y.y*M,y.z*y.y*z+y.x*M,O+y.z**2*z]];return f.forEach($=>{let j=h[$-1],le=j.x-m.x,ne=j.y-m.y,b=j.z-m.z,H=S[0][0]*le+S[0][1]*ne+S[0][2]*b,ue=S[1][0]*le+S[1][1]*ne+S[1][2]*b,re=S[2][0]*le+S[2][1]*ne+S[2][2]*b;j.x=H+m.x,j.y=ue+m.y,j.z=re+m.z}),h}function Q(h,f,m,y,te,I){let M=h.split(`
`).filter(b=>b.startsWith("ATOM")).map(b=>{let H=parseFloat(b.substring(30,38).trim()),ue=parseFloat(b.substring(38,46).trim()),re=parseFloat(b.substring(46,54).trim());return{x:H,y:ue,z:re,line:b}}),z=M[m-1],S=M[y-1],$={x:S.x-z.x,y:S.y-z.y,z:S.z-z.z},j=Math.sqrt($.x**2+$.y**2+$.z**2);$.x/=j,$.y/=j,$.z/=j;let le=U($);return M=q(M,f,z,$,te),M=q(M,f,z,le,I),M.forEach(b=>{b.line=b.line.substring(0,30)+b.x.toFixed(3).padStart(8)+b.y.toFixed(3).padStart(8)+b.z.toFixed(3).padStart(8)+b.line.substring(54)}),M.map(b=>b.line).join(`
`)+`
TER
END`}let Y=F(),_=F(),ee=F();Fe(async()=>{if(typeof window<"u")try{const{createViewer:h}=await zt(async()=>{const{createViewer:f}=await import("../chunks/kNyKxqkf.js").then(m=>m._);return{createViewer:f}},[],import.meta.url);console.log("3Dmol.js loaded successfully"),d(_,h(t(ee),{backgroundColor:"white"})),C(!0),window.addEventListener("resize",()=>{t(_)&&(t(_).resize(),t(_).render())})}catch(h){console.error("Failed to load 3Dmol.js:",h)}});function C(h=!0){t(_)&&(console.log("Updating viewer with angles:",de(),L()),t(_).clear(),t(_).addModel(t(Y),"pdb"),t(_).setStyle({},{stick:{radius:.2},sphere:{scale:.3}}),h&&t(_).zoomTo(),t(_).render())}se(()=>(Be(de()),Be(L())),()=>{d(Y,Q(P,T,N,W,de(),L()))}),se(()=>(t(_),t(Y)),()=>{t(_)&&t(Y)&&C(!1)}),lt(),st();var x=St(),c=i(x),pe=i(c);Le(pe,h=>d(ee,h),()=>t(ee)),n(c),n(x),ae(Me,x),at()}var Pt=ie(`<div class="game-ended-popup svelte-y22l1a"><div class="popup-content svelte-y22l1a"><h2 class="svelte-y22l1a">Game Ended</h2> <p class="svelte-y22l1a">You've used all your lives!</p> <p class="svelte-y22l1a"> </p> <button class="svelte-y22l1a">Play Again</button></div></div>`),Tt=ie('<button class="svelte-y22l1a">Clear Samples</button>'),Et=ie('<div class="panel svelte-y22l1a"><h2 class="svelte-y22l1a">Backbone Angles</h2> <div class="molecule-visualization svelte-y22l1a"><!></div> <div class="control-panel svelte-y22l1a"><div class="slider-container svelte-y22l1a"><label for="angle" class="svelte-y22l1a">Œ® Angle (degrees):</label> <input type="range" id="angle" min="0" max="360" step="1" class="svelte-y22l1a"> <span class="svelte-y22l1a"> </span></div> <div class="slider-container svelte-y22l1a"><label for="phiAngle" class="svelte-y22l1a">Œ¶ Angle (degrees):</label> <input type="range" id="phiAngle" min="0" max="360" step="1" class="svelte-y22l1a"> <span class="svelte-y22l1a"> </span></div></div></div> <div class="panel svelte-y22l1a"><h2 class="svelte-y22l1a">Energy Landscape</h2> <div class="contour-container svelte-y22l1a"><canvas></canvas></div> <div class="button-group svelte-y22l1a"><!> <button class="info-button svelte-y22l1a"> </button></div></div>',1),kt=ie('<button class="svelte-y22l1a">Clear Samples</button>'),Ct=ie('<div class="grid-item energy-plot svelte-y22l1a"><h2 class="svelte-y22l1a">Energy Landscape</h2> <div class="contour-container svelte-y22l1a"><canvas></canvas></div></div>  <div class="grid-item buttons svelte-y22l1a"><div class="side_instruction svelte-y22l1a"><p class="svelte-y22l1a">Click directly on the plot</p> <div class="arrow-down svelte-y22l1a"></div> <p class="svelte-y22l1a">Sample points with Œ¶ and Œ®</p> <div class="arrow-down svelte-y22l1a"></div> <p class="svelte-y22l1a">Run the simulation</p> <div class="arrow-down svelte-y22l1a"></div> <p class="svelte-y22l1a">Update the emulator model</p></div> <div class="vertical-button-group svelte-y22l1a"><!> <button class="info-button svelte-y22l1a"> </button></div></div> <div class="grid-item molecule-panel svelte-y22l1a"><h2 class="svelte-y22l1a">Backbone Angles</h2> <div class="molecule-visualization svelte-y22l1a"><!></div></div> <div class="grid-item angle-sliders svelte-y22l1a"><div class="instruction svelte-y22l1a"><p class="svelte-y22l1a">Use the gliders view the molecule at various angles.</p> <p class="svelte-y22l1a">Carbon-Nitrogen bond is your axis of rotation</p></div> <div class="vertical-control-panel svelte-y22l1a"><div class="compact-slider-container svelte-y22l1a"><label for="angle-vertical" class="svelte-y22l1a">Œ® Angle:</label> <input type="range" id="angle-vertical" min="0" max="360" step="1" class="svelte-y22l1a"> <span class="svelte-y22l1a"> </span></div> <div class="compact-slider-container svelte-y22l1a"><label for="phiAngle-vertical" class="svelte-y22l1a">Œ¶ Angle:</label> <input type="range" id="phiAngle-vertical" min="0" max="360" step="1" class="svelte-y22l1a"> <span class="svelte-y22l1a"> </span></div></div></div>',1),It=ie('<main class="svelte-y22l1a"><h1 class="svelte-y22l1a">Protein Explorer</h1> <div class="instruction svelte-y22l1a"><p class="svelte-y22l1a">The most stable configuration of a molecule is found by computing its minimum energy through complex and costly quantum mechanical equations. Training an emulator provides a cheaper, sufficiently accurate, and scalable alternative.</p> <p class="svelte-y22l1a">üíª Lets train an emulator that can predict the energy landscape</p> <p class="svelte-y22l1a">üí∑ You have a budget to run 20 simulations to train your emulator.</p> <p class="svelte-y22l1a">üìê Adjust the Œ¶ and Œ® angles to explore the energy landscape of the molecule.</p></div> <div class="bars-container svelte-y22l1a"><div class="live-bar-container svelte-y22l1a"><div class="lives-label"> </div> <div class="live-bar svelte-y22l1a"><div class="lives-remaining svelte-y22l1a"></div> <span class="heart svelte-y22l1a">üí∑</span></div></div> <div></div> <div class="score-bar-container svelte-y22l1a"><div class="score-label">Score: <span id="score-percentage"> </span></div> <div class="score-bar svelte-y22l1a"><div class="score-value svelte-y22l1a" id="score-bar"></div> <span class="star svelte-y22l1a" id="score-star">‚≠ê</span></div></div></div> <!> <div class="level-container svelte-y22l1a"><label for="level" class="level-label svelte-y22l1a">Difficulty:</label> <select id="level" class="svelte-y22l1a"><option>Level 1</option><option>Level 2</option><option>Level 3</option></select></div> <div><!></div> <div class="button-group svelte-y22l1a" style="margin-top: 20px; text-align: center;"><button class="info-button svelte-y22l1a"><span>Go back</span></button></div></main>');function Bt(Me,ve){tt(ve,!1);const P=F(),T=F(),N=F(),W=F();function de(){window.location.href="https://alan-turing-institute.github.io/gp-demo/"}let L=F([]),U=[],q=F(),Q=F(!1),Y=F(!1),_=F(20),ee=F(!1);const C=400,x=400,c=40,pe=C-2*c,h=Ke([0,360],[c,C-c]),f=Ke([0,360],[x-c,c]),m={primary:"#3c6382",accent:"#60a3bc",highlight:"#6a89cc",text:"#2c3e50"};let y=F(!1);function te(){d(y,window.innerHeight>window.innerWidth)}Fe(()=>(M(),H(),te(),window.addEventListener("resize",te),()=>{window.removeEventListener("resize",te)}));let I=1/0,O=-1/0;function M(){const p=we(0,360,7.2).toArray(),o=we(0,360,360/50).toArray();for(const l of p)for(const s of o){const a=S(l,s);I=Math.min(I,a),O=Math.max(O,a)}I=Math.floor(I*10)/10,O=Math.ceil(O*10)/10,console.log(`Energy range: ${I} to ${O}`)}function z(e){return e*(Math.PI/180)}function S(e,p){const o=z(e)-Math.PI,l=z(p)-Math.PI,s=Math.exp(-((o+Math.PI/2)**2)-(l-Math.PI/2)**2/.5),a=Math.exp(-((o+Math.PI/2)**2)-(l+.5)**2/.3),v=Math.exp(-((o-Math.PI/2)**2)-(l+Math.PI/2)**2/.5),g=Math.exp(-((o-Math.PI/2)**2)-(l-.5)**2/.3),w=Math.exp(-((o-0)**2)/.3-(l-Math.PI/4)**2/.2);let A=0;return t(W)=="1"?A=s:t(W)=="2"?A=s+a:t(W)=="3"?A=s+a+v+g+w:console.error("Invalid difficulty level: ",t(W)),-Math.log(A+1e-6)}function $(){d(L,[]),U=[],H(),d(_,20),d(N,0)}function j(e){if(t(Q)||t(_)<=0)return;const p=t(q).getBoundingClientRect(),o=t(q).width/p.width,l=t(q).height/p.height,s=(e.clientX-p.left)*o,a=(e.clientY-p.top)*l,v=Math.round(h.invert(s)),g=Math.round(f.invert(a));if(s>=c&&s<=C-c&&a>=c&&a<=x-c){d(P,v),d(T,g);const w=S(t(P),t(T));d(L,[...t(L),{phi:t(P),psi:t(T),energy:w}]),d(_,t(_)-1),t(_)===0&&d(ee,!0),b()}}function le(){d(_,20),d(N,0),d(L,[]),U=[],d(ee,!1),H()}function ne(e,p){if(e.length!==p.length||e.length===0)throw new Error("Arrays must be of the same length and non-empty");const o=e.reduce((v,g)=>v+g,0)/e.length,l=e.reduce((v,g)=>v+Math.pow(g-o,2),0),a=1-e.reduce((v,g,w)=>v+Math.pow(g-p[w],2),0)/l;return Math.max(0,a)}function b(){d(Q,!0);let e=[],p=[];if(t(L).length===0){d(Q,!1),H();return}setTimeout(()=>{console.log("Updating GP model...");const o=t(L).map(u=>[u.phi,u.psi]),l=t(L).map(u=>u.energy),s=(u,E,V=1*(180/Math.PI))=>{const B=At(xt(wt(u,E),2));return Mt(-.5*B/(V*V))},a=o.length,v=Qe(a,a);for(let u=0;u<a;u++)for(let E=0;E<a;E++)v.set([u,E],s(o[u],o[E]));const g=.01;for(let u=0;u<a;u++)v.set([u,u],v.get([u,u])+g);const w=40,A=we(0,360,360/w).toArray(),X=we(0,360,360/w).toArray();U=[];for(const u of A)for(const E of X){const V=[u,E],B=Qe(1,a);for(let R=0;R<a;R++)B.set([0,R],s(V,o[R]));try{const R=_t(v,l),G=bt(B,R).get([0,0]);U.push({phi:u,psi:E,predicted:G}),p.push(G),e.push(S(u,E))}catch(R){console.error("Error in GP calculation:",R)}}H(),d(N,ne(e,p)),console.log("R2 Score: ",t(N)),d(Q,!1)},50)}function H(){if(!t(q))return;const e=t(q).getContext("2d");e.clearRect(0,0,C+60,x);const p=ft().domain([O,I]).interpolator(mt);if(t(Y)){const l=pe/80;for(let s=0;s<80;s++)for(let a=0;a<80;a++){const v=0+360*s/80,g=0+360*a/80,w=S(v,g),A=h(v),X=f(g);e.fillStyle=p(w),e.fillRect(A-l/2,X-l/2,l,l)}}else if(U.length===0){const l=pe/80;for(let s=0;s<80;s++)for(let a=0;a<80;a++){const v=0+360*s/80,g=0+360*a/80,w=h(v),A=f(g);e.fillStyle=p(0),e.fillRect(w-l/2,A-l/2,l,l)}}else{const o=pe/Math.sqrt(U.length);U.forEach(l=>{const s=h(l.phi),a=f(l.psi);e.fillStyle=p(l.predicted),e.fillRect(s-o/2,a-o/2,o,o)})}ue(e,p),e.strokeStyle=m.primary,e.lineWidth=2,e.beginPath(),e.moveTo(c,x-c),e.lineTo(C-c,x-c),e.moveTo(c,c),e.lineTo(c,x-c),e.stroke(),e.fillStyle=m.text,e.font="bold 14px Arial, sans-serif",e.textAlign="center",e.fillText("0",c,x-c+15),e.fillText("180",C/2,x-c+15),e.fillText("360",C-c,x-c+15),e.fillText("œÜ",C-c+10,x-c+25),e.textAlign="right",e.fillText("0",c-5,x-c),e.fillText("180",c-5,x/2),e.fillText("360",c-5,c),e.fillText("œà",c-20,c-20),t(L).forEach(o=>{const l=h(o.phi),s=f(o.psi),a=8,v=e.createRadialGradient(l,s,2,l,s,a);v.addColorStop(0,m.highlight),v.addColorStop(1,"rgba(106, 137, 204, 0)"),e.fillStyle=v,e.beginPath(),e.arc(l,s,a,0,2*Math.PI),e.fill(),e.fillStyle=m.accent,e.beginPath(),e.arc(l,s,4,0,2*Math.PI),e.fill(),e.strokeStyle=m.primary,e.lineWidth=1,e.stroke()})}function ue(e,p){const l=x-2*c,s=C-c+20,a=c,v=100,g=l/v;for(let A=0;A<v;A++){const X=I+(O-I)*(v-A-1)/v;e.fillStyle=p(X),e.fillRect(s,a+A*g,20,g+1)}e.strokeStyle=m.text,e.lineWidth=1,e.strokeRect(s,a,20,l),e.fillStyle=m.text,e.font="12px Arial, sans-serif",e.textAlign="left",e.fillText(I.toFixed(1),s+20+5,a+l),e.fillText(O.toFixed(1),s+20+5,a);const w=(I+O)/2;e.fillText(w.toFixed(1),s+20+5,a+l/2),e.save(),e.translate(s+20+25,a+l/2),e.rotate(-Math.PI/2),e.textAlign="center",e.fillText("Energy",0,10),e.restore()}function re(){d(Y,!t(Y)),H()}Fe(()=>{M(),setTimeout(()=>{H()},100)});function it(e){d(W,e.target.value),t(Y)&&H(),console.log("Difficulty level set to: ",t(W))}se(()=>{},()=>{d(P,0)}),se(()=>{},()=>{d(T,0)}),se(()=>{},()=>{d(N,0)}),se(()=>(t(P),t(T)),()=>{}),se(()=>{},()=>{d(W,"3")}),lt(),st();var ze=It(),Se=r(i(ze),4),Pe=i(Se),Te=i(Pe),nt=i(Te);n(Te);var $e=r(Te,2),je=i($e),rt=r(je,2);n($e),n(Pe);var De=r(Pe,4),Ee=i(De),We=r(i(Ee)),ot=i(We);n(We),n(Ee);var qe=r(Ee,2),He=i(qe),ct=r(He,2);n(qe),n(De),n(Se);var Ge=r(Se,2);{var vt=e=>{var p=Pt(),o=i(p),l=r(i(o),4),s=i(l);n(l);var a=r(l,2);n(o),n(p),he(v=>K(s,`Final score: ${v??""}%`),[()=>(t(N)*100).toFixed(0)],Ue),Z("click",a,le),ae(e,p)};be(Ge,e=>{t(ee)&&e(vt)})}var ke=r(Ge,2),fe=r(i(ke),2);he(()=>{t(W),gt(()=>{})});var Ce=i(fe);Ce.value=(Ce.__value="1")==null?"":"1";var Ie=r(Ce);Ie.value=(Ie.__value="2")==null?"":"2";var Ne=r(Ie);Ne.value=(Ne.__value="3")==null?"":"3",n(fe),n(ke);var me=r(ke,2),dt=i(me);{var pt=e=>{var p=Et(),o=Ze(p),l=r(i(o),2);J(l,"style",`width: ${C}px; height: ${x}px;`);var s=i(l);et(s,{get angle(){return t(P)},set angle(k){d(P,k)},get phiAngle(){return t(T)},set phiAngle(k){d(T,k)},$$legacy:!0}),n(l);var a=r(l,2),v=i(a),g=r(i(v),2);Ae(g);var w=r(g,2),A=i(w);n(w),n(v);var X=r(v,2),u=r(i(X),2);Ae(u);var E=r(u,2),V=i(E);n(E),n(X),n(a),n(o);var B=r(o,2),R=r(i(B),2),G=i(R);J(G,"width",C+60),J(G,"height",x),Le(G,k=>d(q,k),()=>t(q)),n(R);var oe=r(R,2),ye=i(oe);{var Oe=k=>{var _e=Tt();Z("click",_e,$),ae(k,_e)};be(ye,k=>{t(L).length>0&&k(Oe)})}var ce=r(ye,2),ge=i(ce,!0);n(ce),n(oe),n(B),he(()=>{K(A,`${t(T)??""}¬∞`),K(V,`${t(P)??""}¬∞`),Re(G,1,Je(t(Q)?"loading":""),"svelte-y22l1a"),K(ge,t(Y)?"Show Emulator Prediction":"Show Simulator Function")}),xe(g,()=>t(T),k=>d(T,k)),xe(u,()=>t(P),k=>d(P,k)),Z("click",G,j),Z("click",ce,re),ae(e,p)},ut=e=>{var p=Ct(),o=Ze(p),l=r(i(o),2),s=i(l);J(s,"width",C+60),J(s,"height",x),Le(s,D=>d(q,D),()=>t(q)),n(l),n(o);var a=r(o,2),v=r(i(a),2),g=i(v);{var w=D=>{var Xe=kt();Z("click",Xe,$),ae(D,Xe)};be(g,D=>{t(L).length>0&&D(w)})}var A=r(g,2),X=i(A,!0);n(A),n(v),n(a);var u=r(a,2),E=r(i(u),2),V=i(E);et(V,{get angle(){return t(P)},set angle(D){d(P,D)},get phiAngle(){return t(T)},set phiAngle(D){d(T,D)},$$legacy:!0}),n(E),n(u);var B=r(u,2),R=r(i(B),2),G=i(R),oe=r(i(G),2);Ae(oe);var ye=r(oe,2),Oe=i(ye);n(ye),n(G);var ce=r(G,2),ge=r(i(ce),2);Ae(ge);var k=r(ge,2),_e=i(k);n(k),n(ce),n(R),n(B),he(()=>{Re(s,1,Je(t(Q)?"loading":""),"svelte-y22l1a"),K(X,t(Y)?"Show Emulator Prediction":"Show Simulator Function"),K(Oe,`${t(T)??""}¬∞`),K(_e,`${t(P)??""}¬∞`)}),Z("click",s,j),Z("click",A,re),xe(oe,()=>t(T),D=>d(T,D)),xe(ge,()=>t(P),D=>d(P,D)),ae(e,p)};be(dt,e=>{t(y)?e(ut,!1):e(pt)})}n(me);var Ye=r(me,2),yt=i(Ye);n(Ye),n(ze),he((e,p)=>{K(nt,`Guesses left ${t(_)??""}/20`),J(je,"style",`width: ${e??""}%`),J(rt,"style",`left: ${e??""}%`),K(ot,`${p??""}%`),J(He,"style",`width: ${t(N)*100}%`),J(ct,"style",`left: ${t(N)*100}%`),Re(me,1,`responsive-grid ${(t(y)?"vertical":"horizontal")??""}`,"svelte-y22l1a")},[()=>Math.max(0,t(_)/20*100),()=>(t(N)*100).toFixed(0)],Ue),ht(fe,()=>t(W),e=>d(W,e)),Z("change",fe,it),Z("click",yt,de),ae(Me,ze),at()}export{Bt as component};
