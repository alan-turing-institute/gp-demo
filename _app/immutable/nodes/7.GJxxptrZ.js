import{t as ie,a as ae}from"../chunks/cGtBC6Qd.js";import"../chunks/7LKkzqbz.js";import{a4 as lt,a1 as d,ac as F,e as t,aa as se,Z as Xe,ab as at,a6 as i,a7 as n,a5 as st,a9 as he,s as r,i as Be,aw as ht,f as Ze,a8 as Ke}from"../chunks/BJ4irGt7.js";import{e as Z,s as K}from"../chunks/CvaqDwXv.js";import{i as be}from"../chunks/lIaEYNz1.js";import{s as J,r as Ae}from"../chunks/B9r3SdpA.js";import{l as Je,s as Oe,c as Qe}from"../chunks/dhIx7U5O.js";import{b as ft,a as we}from"../chunks/CI8f-3O8.js";import{b as Le}from"../chunks/CUY-1DrG.js";import{i as it}from"../chunks/CkfO92w8.js";import{o as Fe}from"../chunks/Cpzjerpz.js";import{r as xe,s as mt,v as _t,z as Ve,l as bt,m as At,a as wt,d as xt,b as Mt,e as zt}from"../chunks/PBAI84v4.js";import{_ as St}from"../chunks/C1FmrZbK.js";import{p as et}from"../chunks/6XXKwe28.js";var Pt=ie('<main class="svelte-13sjxqj"><div class="viewer-container svelte-13sjxqj"><div id="viewer" class="svelte-13sjxqj"></div></div></main>');function tt(Me,ce){lt(ce,!1);let P=`
ATOM      1  CH3 ACE     1       2.000   2.090   0.000
ATOM      2  C   ACE     1       3.427   2.641  -0.000
ATOM      3  O   ACE     1       4.391   1.877  -0.000
ATOM      4  N   ALA     2       3.555   3.970  -0.000
ATOM      5  CA  ALA     2       4.853   4.614  -0.000
ATOM     6  HA  ALA     2       5.408   4.316   0.890
ATOM     7  CB  ALA     2       5.661   4.221  -1.232
ATOM     8  C   ALA     2       4.713   6.129   0.000
ATOM     9  O   ALA     2       3.601   6.653   0.000
ATOM     10  N   NME     3       5.846   6.835   0.000
ATOM     11  H   NME     3       6.737   6.359  -0.000
ATOM     12  CH3 NME     3       5.846   8.284   0.000
TER   
END`,T=[6,7,8,9,10,11,12],N=4,W=5,de=et(ce,"angle",8,50),L=et(ce,"phiAngle",8,0);function B(h){let f;Math.abs(h.z)>.9?f={x:0,y:h.z,z:-h.y}:f={x:-h.y,y:h.x,z:0};let m=Math.sqrt(f.x**2+f.y**2+f.z**2);return f.x/=m,f.y/=m,f.z/=m,f}function q(h,f,m,y,te){let I=te*Math.PI/180,R=Math.cos(I),M=Math.sin(I),z=1-R,S=[[R+y.x**2*z,y.x*y.y*z-y.z*M,y.x*y.z*z+y.y*M],[y.y*y.x*z+y.z*M,R+y.y**2*z,y.y*y.z*z-y.x*M],[y.z*y.x*z-y.y*M,y.z*y.y*z+y.x*M,R+y.z**2*z]];return f.forEach($=>{let j=h[$-1],le=j.x-m.x,ne=j.y-m.y,b=j.z-m.z,H=S[0][0]*le+S[0][1]*ne+S[0][2]*b,ue=S[1][0]*le+S[1][1]*ne+S[1][2]*b,re=S[2][0]*le+S[2][1]*ne+S[2][2]*b;j.x=H+m.x,j.y=ue+m.y,j.z=re+m.z}),h}function Q(h,f,m,y,te,I){let M=h.split(`
`).filter(b=>b.startsWith("ATOM")).map(b=>{let H=parseFloat(b.substring(30,38).trim()),ue=parseFloat(b.substring(38,46).trim()),re=parseFloat(b.substring(46,54).trim());return{x:H,y:ue,z:re,line:b}}),z=M[m-1],S=M[y-1],$={x:S.x-z.x,y:S.y-z.y,z:S.z-z.z},j=Math.sqrt($.x**2+$.y**2+$.z**2);$.x/=j,$.y/=j,$.z/=j;let le=B($);return M=q(M,f,z,$,te),M=q(M,f,z,le,I),M.forEach(b=>{b.line=b.line.substring(0,30)+b.x.toFixed(3).padStart(8)+b.y.toFixed(3).padStart(8)+b.z.toFixed(3).padStart(8)+b.line.substring(54)}),M.map(b=>b.line).join(`
`)+`
TER
END`}let U=F(),_=F(),ee=F();Fe(async()=>{if(typeof window<"u")try{const{createViewer:h}=await St(async()=>{const{createViewer:f}=await import("../chunks/kNyKxqkf.js").then(m=>m._);return{createViewer:f}},[],import.meta.url);console.log("3Dmol.js loaded successfully"),d(_,h(t(ee),{backgroundColor:"white"})),k(!0),window.addEventListener("resize",()=>{t(_)&&(t(_).resize(),t(_).render())})}catch(h){console.error("Failed to load 3Dmol.js:",h)}});function k(h=!0){t(_)&&(console.log("Updating viewer with angles:",de(),L()),t(_).clear(),t(_).addModel(t(U),"pdb"),t(_).setStyle({},{stick:{radius:.2},sphere:{scale:.3}}),h&&t(_).zoomTo(),t(_).render())}se(()=>(Xe(de()),Xe(L())),()=>{d(U,Q(P,T,N,W,de(),L()))}),se(()=>(t(_),t(U)),()=>{t(_)&&t(U)&&k(!1)}),at(),it();var w=Pt(),v=i(w),pe=i(v);Le(pe,h=>d(ee,h),()=>t(ee)),n(v),n(w),ae(Me,w),st()}var Tt=ie(`<div class="game-ended-popup svelte-y22l1a"><div class="popup-content svelte-y22l1a"><h2 class="svelte-y22l1a">Game Ended</h2> <p class="svelte-y22l1a">You've used all your lives!</p> <p class="svelte-y22l1a"> </p> <button class="svelte-y22l1a">Play Again</button></div></div>`),Et=ie('<button class="svelte-y22l1a">Clear Samples</button>'),Ct=ie('<div class="panel svelte-y22l1a"><h2 class="svelte-y22l1a">Backbone Angles</h2> <div class="molecule-visualization svelte-y22l1a"><!></div> <div class="control-panel svelte-y22l1a"><div class="slider-container svelte-y22l1a"><label for="angle" class="svelte-y22l1a">Œ® Angle (degrees):</label> <input type="range" id="angle" min="0" max="360" step="1" class="svelte-y22l1a"> <span class="svelte-y22l1a"> </span></div> <div class="slider-container svelte-y22l1a"><label for="phiAngle" class="svelte-y22l1a">Œ¶ Angle (degrees):</label> <input type="range" id="phiAngle" min="0" max="360" step="1" class="svelte-y22l1a"> <span class="svelte-y22l1a"> </span></div> <div class="instruction svelte-y22l1a"><p class="svelte-y22l1a">Use the gliders view the molecule at various angles.</p> <p class="svelte-y22l1a">Carbon-Nitrogen bond is your axis of rotation</p></div></div></div> <div class="panel svelte-y22l1a"><h2 class="svelte-y22l1a">Energy Landscape</h2> <div class="contour-container svelte-y22l1a"><canvas></canvas> <div class="side_instruction svelte-y22l1a"><p class="svelte-y22l1a">Click directly on the plot</p> <div class="arrow-down svelte-y22l1a"></div> <p class="svelte-y22l1a">Sample points with Œ¶ and Œ®</p> <div class="arrow-down svelte-y22l1a"></div> <p class="svelte-y22l1a">Run the simulation</p> <div class="arrow-down svelte-y22l1a"></div> <p class="svelte-y22l1a">Update the emulator model</p></div></div> <div class="button-group svelte-y22l1a"><!> <button class="info-button svelte-y22l1a"> </button></div></div>',1),kt=ie('<button class="svelte-y22l1a">Clear Samples</button>'),It=ie('<div class="grid-item energy-plot svelte-y22l1a"><h2 class="svelte-y22l1a">Energy Landscape</h2> <div class="contour-container svelte-y22l1a"><canvas></canvas></div></div>  <div class="grid-item buttons svelte-y22l1a"><div class="side_instruction svelte-y22l1a"><p class="svelte-y22l1a">Click directly on the plot</p> <div class="arrow-down svelte-y22l1a"></div> <p class="svelte-y22l1a">Sample points with Œ¶ and Œ®</p> <div class="arrow-down svelte-y22l1a"></div> <p class="svelte-y22l1a">Run the simulation</p> <div class="arrow-down svelte-y22l1a"></div> <p class="svelte-y22l1a">Update the emulator model</p></div> <div class="vertical-button-group svelte-y22l1a"><!> <button class="info-button svelte-y22l1a"> </button></div></div> <div class="grid-item molecule-panel svelte-y22l1a"><h2 class="svelte-y22l1a">Backbone Angles</h2> <div class="molecule-visualization svelte-y22l1a"><!></div></div> <div class="grid-item angle-sliders svelte-y22l1a"><div class="instruction svelte-y22l1a"><p class="svelte-y22l1a">Use the gliders view the molecule at various angles.</p> <p class="svelte-y22l1a">Carbon-Nitrogen bond is your axis of rotation</p></div> <div class="vertical-control-panel svelte-y22l1a"><div class="compact-slider-container svelte-y22l1a"><label for="angle-vertical" class="svelte-y22l1a">Œ® Angle:</label> <input type="range" id="angle-vertical" min="0" max="360" step="1" class="svelte-y22l1a"> <span class="svelte-y22l1a"> </span></div> <div class="compact-slider-container svelte-y22l1a"><label for="phiAngle-vertical" class="svelte-y22l1a">Œ¶ Angle:</label> <input type="range" id="phiAngle-vertical" min="0" max="360" step="1" class="svelte-y22l1a"> <span class="svelte-y22l1a"> </span></div></div></div>',1),Rt=ie('<main class="svelte-y22l1a"><h1 class="svelte-y22l1a">Protein Explorer</h1> <div class="instruction svelte-y22l1a"><p class="svelte-y22l1a">The most stable configuration of a molecule is found by computing its minimum energy through complex and costly quantum mechanical equations. Training an emulator provides a cheaper, sufficiently accurate, and scalable alternative.</p> <p class="svelte-y22l1a">üíª Lets train an emulator that can predict the energy landscape</p> <p class="svelte-y22l1a">üí∑ You have a budget to run 20 simulations to train your emulator.</p> <p class="svelte-y22l1a">üìê Adjust the Œ¶ and Œ® angles to explore the energy landscape of the molecule.</p></div> <div class="bars-container svelte-y22l1a"><div class="live-bar-container svelte-y22l1a"><div class="lives-label"> </div> <div class="live-bar svelte-y22l1a"><div class="lives-remaining svelte-y22l1a"></div> <span class="heart svelte-y22l1a">üí∑</span></div></div> <div></div> <div class="score-bar-container svelte-y22l1a"><div class="score-label">Score: <span id="score-percentage"> </span></div> <div class="score-bar svelte-y22l1a"><div class="score-value svelte-y22l1a" id="score-bar"></div> <span class="star svelte-y22l1a" id="score-star">‚≠ê</span></div></div></div> <!> <div class="level-container svelte-y22l1a"><label for="level" class="level-label svelte-y22l1a">Difficulty:</label> <select id="level" class="svelte-y22l1a"><option>Level 1</option><option>Level 2</option><option>Level 3</option></select></div> <div><!></div> <div class="button-group svelte-y22l1a" style="margin-top: 20px; text-align: center;"><button class="info-button svelte-y22l1a"><span>Go back</span></button></div></main>');function Bt(Me,ce){lt(ce,!1);const P=F(),T=F(),N=F(),W=F();function de(){window.location.href="https://alan-turing-institute.github.io/gp-demo/"}let L=F([]),B=[],q=F(),Q=F(!1),U=F(!1),_=F(20),ee=F(!1);const k=400,w=400,v=40,pe=k-2*v,h=Je([0,360],[v,k-v]),f=Je([0,360],[w-v,v]),m={primary:"#3c6382",accent:"#60a3bc",highlight:"#6a89cc",text:"#2c3e50"};let y=F(!1);function te(){d(y,window.innerHeight>window.innerWidth)}Fe(()=>(M(),H(),te(),window.addEventListener("resize",te),()=>{window.removeEventListener("resize",te)}));let I=1/0,R=-1/0;function M(){const p=xe(0,360,7.2).toArray(),o=xe(0,360,360/50).toArray();for(const l of p)for(const s of o){const a=S(l,s);I=Math.min(I,a),R=Math.max(R,a)}I=Math.floor(I*10)/10,R=Math.ceil(R*10)/10,console.log(`Energy range: ${I} to ${R}`)}function z(e){return e*(Math.PI/180)}function S(e,p){const o=z(e)-Math.PI,l=z(p)-Math.PI,s=Math.exp(-((o+Math.PI/2)**2)-(l-Math.PI/2)**2/.5),a=Math.exp(-((o+Math.PI/2)**2)-(l+.5)**2/.3),c=Math.exp(-((o-Math.PI/2)**2)-(l+Math.PI/2)**2/.5),g=Math.exp(-((o-Math.PI/2)**2)-(l-.5)**2/.3),x=Math.exp(-((o-0)**2)/.3-(l-Math.PI/4)**2/.2);let A=0;return t(W)=="1"?A=s:t(W)=="2"?A=s+a:t(W)=="3"?A=s+a+c+g+x:console.error("Invalid difficulty level: ",t(W)),-Math.log(A+1e-6)}function $(){d(L,[]),B=[],H(),d(_,20),d(N,0)}function j(e){if(t(Q)||t(_)<=0)return;const p=t(q).getBoundingClientRect(),o=t(q).width/p.width,l=t(q).height/p.height,s=(e.clientX-p.left)*o,a=(e.clientY-p.top)*l,c=Math.round(h.invert(s)),g=Math.round(f.invert(a));if(s>=v&&s<=k-v&&a>=v&&a<=w-v){d(P,c),d(T,g);const x=S(t(P),t(T));d(L,[...t(L),{phi:t(P),psi:t(T),energy:x}]),d(_,t(_)-1),t(_)===0&&d(ee,!0),b()}}function le(){d(_,20),d(N,0),d(L,[]),B=[],d(ee,!1),H()}function ne(e,p){if(e.length!==p.length||e.length===0)throw new Error("Arrays must be of the same length and non-empty");const o=e.reduce((c,g)=>c+g,0)/e.length,l=e.reduce((c,g)=>c+Math.pow(g-o,2),0),a=1-e.reduce((c,g,x)=>c+Math.pow(g-p[x],2),0)/l;return Math.max(0,a)}function b(){d(Q,!0);let e=[],p=[];if(t(L).length===0){d(Q,!1),H();return}setTimeout(()=>{console.log("Updating GP model...");const o=t(L).map(u=>[u.phi,u.psi]),l=t(L).map(u=>u.energy),s=(u,E,V=1*(180/Math.PI))=>{const X=wt(xt(Mt(u,E),2));return zt(-.5*X/(V*V))},a=o.length,c=Ve(a,a);for(let u=0;u<a;u++)for(let E=0;E<a;E++)c.set([u,E],s(o[u],o[E]));const g=.01;for(let u=0;u<a;u++)c.set([u,u],c.get([u,u])+g);const x=40,A=xe(0,360,360/x).toArray(),Y=xe(0,360,360/x).toArray();B=[];for(const u of A)for(const E of Y){const V=[u,E],X=Ve(1,a);for(let O=0;O<a;O++)X.set([0,O],s(V,o[O]));try{const O=bt(c,l),G=At(X,O).get([0,0]);B.push({phi:u,psi:E,predicted:G}),p.push(G),e.push(S(u,E))}catch(O){console.error("Error in GP calculation:",O)}}H(),d(N,ne(e,p)),console.log("R2 Score: ",t(N)),d(Q,!1)},50)}function H(){if(!t(q))return;const e=t(q).getContext("2d");e.clearRect(0,0,k+60,w);const p=mt().domain([R,I]).interpolator(_t);if(t(U)){const l=pe/80;for(let s=0;s<80;s++)for(let a=0;a<80;a++){const c=0+360*s/80,g=0+360*a/80,x=S(c,g),A=h(c),Y=f(g);e.fillStyle=p(x),e.fillRect(A-l/2,Y-l/2,l,l)}}else if(B.length===0){const l=pe/80;for(let s=0;s<80;s++)for(let a=0;a<80;a++){const c=0+360*s/80,g=0+360*a/80,x=h(c),A=f(g);e.fillStyle=p(0),e.fillRect(x-l/2,A-l/2,l,l)}}else{const o=pe/Math.sqrt(B.length);B.forEach(l=>{const s=h(l.phi),a=f(l.psi);e.fillStyle=p(l.predicted),e.fillRect(s-o/2,a-o/2,o,o)})}ue(e,p),e.strokeStyle=m.primary,e.lineWidth=2,e.beginPath(),e.moveTo(v,w-v),e.lineTo(k-v,w-v),e.moveTo(v,v),e.lineTo(v,w-v),e.stroke(),e.fillStyle=m.text,e.font="bold 14px Arial, sans-serif",e.textAlign="center",e.fillText("0",v,w-v+15),e.fillText("180",k/2,w-v+15),e.fillText("360",k-v,w-v+15),e.fillText("œÜ",k-v+10,w-v+25),e.textAlign="right",e.fillText("0",v-5,w-v),e.fillText("180",v-5,w/2),e.fillText("360",v-5,v),e.fillText("œà",v-20,v-20),t(L).forEach(o=>{const l=h(o.phi),s=f(o.psi),a=8,c=e.createRadialGradient(l,s,2,l,s,a);c.addColorStop(0,m.highlight),c.addColorStop(1,"rgba(106, 137, 204, 0)"),e.fillStyle=c,e.beginPath(),e.arc(l,s,a,0,2*Math.PI),e.fill(),e.fillStyle=m.accent,e.beginPath(),e.arc(l,s,4,0,2*Math.PI),e.fill(),e.strokeStyle=m.primary,e.lineWidth=1,e.stroke()})}function ue(e,p){const l=w-2*v,s=k-v+20,a=v,c=100,g=l/c;for(let A=0;A<c;A++){const Y=I+(R-I)*(c-A-1)/c;e.fillStyle=p(Y),e.fillRect(s,a+A*g,20,g+1)}e.strokeStyle=m.text,e.lineWidth=1,e.strokeRect(s,a,20,l),e.fillStyle=m.text,e.font="12px Arial, sans-serif",e.textAlign="left",e.fillText(I.toFixed(1),s+20+5,a+l),e.fillText(R.toFixed(1),s+20+5,a);const x=(I+R)/2;e.fillText(x.toFixed(1),s+20+5,a+l/2),e.save(),e.translate(s+20+25,a+l/2),e.rotate(-Math.PI/2),e.textAlign="center",e.fillText("Energy",0,10),e.restore()}function re(){d(U,!t(U)),H()}Fe(()=>{M(),setTimeout(()=>{H()},100)});function nt(e){d(W,e.target.value),t(U)&&H(),console.log("Difficulty level set to: ",t(W))}se(()=>{},()=>{d(P,0)}),se(()=>{},()=>{d(T,0)}),se(()=>{},()=>{d(N,0)}),se(()=>(t(P),t(T)),()=>{}),se(()=>{},()=>{d(W,"3")}),at(),it();var ze=Rt(),Se=r(i(ze),4),Pe=i(Se),Te=i(Pe),rt=i(Te);n(Te);var $e=r(Te,2),je=i($e),ot=r(je,2);n($e),n(Pe);var De=r(Pe,4),Ee=i(De),We=r(i(Ee)),vt=i(We);n(We),n(Ee);var qe=r(Ee,2),He=i(qe),ct=r(He,2);n(qe),n(De),n(Se);var Ge=r(Se,2);{var dt=e=>{var p=Tt(),o=i(p),l=r(i(o),4),s=i(l);n(l);var a=r(l,2);n(o),n(p),he(c=>K(s,`Final score: ${c??""}%`),[()=>(t(N)*100).toFixed(0)],Be),Z("click",a,le),ae(e,p)};be(Ge,e=>{t(ee)&&e(dt)})}var Ce=r(Ge,2),fe=r(i(Ce),2);he(()=>{t(W),ht(()=>{})});var ke=i(fe);ke.value=(ke.__value="1")==null?"":"1";var Ie=r(ke);Ie.value=(Ie.__value="2")==null?"":"2";var Ne=r(Ie);Ne.value=(Ne.__value="3")==null?"":"3",n(fe),n(Ce);var me=r(Ce,2),pt=i(me);{var ut=e=>{var p=Ct(),o=Ze(p),l=r(i(o),2);J(l,"style",`width: ${k}px; height: ${w}px;`);var s=i(l);tt(s,{get angle(){return t(P)},set angle(C){d(P,C)},get phiAngle(){return t(T)},set phiAngle(C){d(T,C)},$$legacy:!0}),n(l);var a=r(l,2),c=i(a),g=r(i(c),2);Ae(g);var x=r(g,2),A=i(x);n(x),n(c);var Y=r(c,2),u=r(i(Y),2);Ae(u);var E=r(u,2),V=i(E);n(E),n(Y),Ke(2),n(a),n(o);var X=r(o,2),O=r(i(X),2),G=i(O);J(G,"width",k+60),J(G,"height",w),Le(G,C=>d(q,C),()=>t(q)),Ke(2),n(O);var oe=r(O,2),ye=i(oe);{var Re=C=>{var _e=Et();Z("click",_e,$),ae(C,_e)};be(ye,C=>{t(L).length>0&&C(Re)})}var ve=r(ye,2),ge=i(ve,!0);n(ve),n(oe),n(X),he(()=>{K(A,`${t(T)??""}¬∞`),K(V,`${t(P)??""}¬∞`),Oe(G,1,Qe(t(Q)?"loading":""),"svelte-y22l1a"),K(ge,t(U)?"Show Emulator Prediction":"Show Simulator Function")}),we(g,()=>t(T),C=>d(T,C)),we(u,()=>t(P),C=>d(P,C)),Z("click",G,j),Z("click",ve,re),ae(e,p)},yt=e=>{var p=It(),o=Ze(p),l=r(i(o),2),s=i(l);J(s,"width",k+60),J(s,"height",w),Le(s,D=>d(q,D),()=>t(q)),n(l),n(o);var a=r(o,2),c=r(i(a),2),g=i(c);{var x=D=>{var Ye=kt();Z("click",Ye,$),ae(D,Ye)};be(g,D=>{t(L).length>0&&D(x)})}var A=r(g,2),Y=i(A,!0);n(A),n(c),n(a);var u=r(a,2),E=r(i(u),2),V=i(E);tt(V,{get angle(){return t(P)},set angle(D){d(P,D)},get phiAngle(){return t(T)},set phiAngle(D){d(T,D)},$$legacy:!0}),n(E),n(u);var X=r(u,2),O=r(i(X),2),G=i(O),oe=r(i(G),2);Ae(oe);var ye=r(oe,2),Re=i(ye);n(ye),n(G);var ve=r(G,2),ge=r(i(ve),2);Ae(ge);var C=r(ge,2),_e=i(C);n(C),n(ve),n(O),n(X),he(()=>{Oe(s,1,Qe(t(Q)?"loading":""),"svelte-y22l1a"),K(Y,t(U)?"Show Emulator Prediction":"Show Simulator Function"),K(Re,`${t(T)??""}¬∞`),K(_e,`${t(P)??""}¬∞`)}),Z("click",s,j),Z("click",A,re),we(oe,()=>t(T),D=>d(T,D)),we(ge,()=>t(P),D=>d(P,D)),ae(e,p)};be(pt,e=>{t(y)?e(yt,!1):e(ut)})}n(me);var Ue=r(me,2),gt=i(Ue);n(Ue),n(ze),he((e,p)=>{K(rt,`Guesses left ${t(_)??""}/20`),J(je,"style",`width: ${e??""}%`),J(ot,"style",`left: ${e??""}%`),K(vt,`${p??""}%`),J(He,"style",`width: ${t(N)*100}%`),J(ct,"style",`left: ${t(N)*100}%`),Oe(me,1,`responsive-grid ${(t(y)?"vertical":"horizontal")??""}`,"svelte-y22l1a")},[()=>Math.max(0,t(_)/20*100),()=>(t(N)*100).toFixed(0)],Be),ft(fe,()=>t(W),e=>d(W,e)),Z("change",fe,nt),Z("click",gt,de),ae(Me,ze),st()}export{Bt as component};
