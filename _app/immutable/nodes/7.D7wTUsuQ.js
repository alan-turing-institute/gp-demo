import{t as ie,a as se}from"../chunks/cGtBC6Qd.js";import"../chunks/7LKkzqbz.js";import{a4 as at,a1 as i,ac as R,e as t,aa as le,Z as Ze,ab as st,a6 as r,a7 as o,a5 as lt,a9 as fe,s as c,i as Je,aw as mt,f as Ke,a8 as _t}from"../chunks/BJ4irGt7.js";import{e as J,s as K}from"../chunks/CvaqDwXv.js";import{i as be}from"../chunks/lIaEYNz1.js";import{s as U,r as Ae}from"../chunks/B9r3SdpA.js";import{l as Ue,s as Fe,c as Qe}from"../chunks/dhIx7U5O.js";import{b as yt,a as xe}from"../chunks/CI8f-3O8.js";import{b as Re}from"../chunks/CUY-1DrG.js";import{i as it}from"../chunks/CkfO92w8.js";import{o as Le}from"../chunks/Cpzjerpz.js";import{r as Me,s as bt,v as At,z as Ve,l as xt,m as Mt,a as wt,d as St,b as zt,e as Et}from"../chunks/PBAI84v4.js";import{_ as Pt}from"../chunks/C1FmrZbK.js";import{p as et}from"../chunks/6XXKwe28.js";var Tt=ie('<main class="svelte-13sjxqj"><div class="viewer-container svelte-13sjxqj"><div id="viewer" class="svelte-13sjxqj"></div></div></main>');function tt(we,oe){at(oe,!1);let S=`
ATOM      1  CH3 ACE     1       2.000   2.090   0.000
ATOM      2  C   ACE     1       3.427   2.641  -0.000
ATOM      3  O   ACE     1       4.391   1.877  -0.000
ATOM      4  N   ALA     2       3.555   3.970  -0.000
ATOM      5  CA  ALA     2       4.853   4.614  -0.000
ATOM     6  HA  ALA     2       5.408   4.316   0.890
ATOM     7  CB  ALA     2       5.661   4.221  -1.232
ATOM     8  C   ALA     2       4.713   6.129   0.000
ATOM     9  O   ALA     2       3.601   6.653   0.000
ATOM     10  N   NME     3       5.846   6.835   0.000
ATOM     11  H   NME     3       6.737   6.359  -0.000
ATOM     12  CH3 NME     3       5.846   8.284   0.000
TER   
END`,z=[6,7,8,9,10,11,12],L=4,j=5,ce=et(oe,"angle",8,50),P=et(oe,"phiAngle",8,0);function q(_){let b;Math.abs(_.z)>.9?b={x:0,y:_.z,z:-_.y}:b={x:-_.y,y:_.x,z:0};let A=Math.sqrt(b.x**2+b.y**2+b.z**2);return b.x/=A,b.y/=A,b.z/=A,b}function H(_,b,A,f,de){let V=de*Math.PI/180,Z=Math.cos(V),g=Math.sin(V),m=1-Z,T=[[Z+f.x**2*m,f.x*f.y*m-f.z*g,f.x*f.z*m+f.y*g],[f.y*f.x*m+f.z*g,Z+f.y**2*m,f.y*f.z*m-f.x*g],[f.z*f.x*m-f.y*g,f.z*f.y*m+f.x*g,Z+f.z**2*m]];return b.forEach(D=>{let O=_[D-1],ee=O.x-A.x,ae=O.y-A.y,x=O.z-A.z,pe=T[0][0]*ee+T[0][1]*ae+T[0][2]*x,ue=T[1][0]*ee+T[1][1]*ae+T[1][2]*x,G=T[2][0]*ee+T[2][1]*ae+T[2][2]*x;O.x=pe+A.x,O.y=ue+A.y,O.z=G+A.z}),_}function Q(_,b,A,f,de,V){let g=_.split(`
`).filter(x=>x.startsWith("ATOM")).map(x=>{let pe=parseFloat(x.substring(30,38).trim()),ue=parseFloat(x.substring(38,46).trim()),G=parseFloat(x.substring(46,54).trim());return{x:pe,y:ue,z:G,line:x}}),m=g[A-1],T=g[f-1],D={x:T.x-m.x,y:T.y-m.y,z:T.z-m.z},O=Math.sqrt(D.x**2+D.y**2+D.z**2);D.x/=O,D.y/=O,D.z/=O;let ee=q(D);return g=H(g,b,m,D,de),g=H(g,b,m,ee,V),g.forEach(x=>{x.line=x.line.substring(0,30)+x.x.toFixed(3).padStart(8)+x.y.toFixed(3).padStart(8)+x.z.toFixed(3).padStart(8)+x.line.substring(54)}),g.map(x=>x.line).join(`
`)+`
TER
END`}let $=R(),y=R(),B=R();Le(async()=>{if(typeof window<"u")try{const{createViewer:_}=await Pt(async()=>{const{createViewer:b}=await import("../chunks/kNyKxqkf.js").then(A=>A._);return{createViewer:b}},[],import.meta.url);console.log("3Dmol.js loaded successfully"),i(y,_(t(B),{backgroundColor:"white"})),C(!0),window.addEventListener("resize",()=>{t(y)&&(t(y).resize(),t(y).render())})}catch(_){console.error("Failed to load 3Dmol.js:",_)}});function C(_=!0){t(y)&&(console.log("Updating viewer with angles:",ce(),P()),t(y).clear(),t(y).addModel(t($),"pdb"),t(y).setStyle({},{stick:{radius:.2},sphere:{scale:.3}}),_&&t(y).zoomTo(),t(y).render())}le(()=>(Ze(ce()),Ze(P())),()=>{i($,Q(S,z,L,j,ce(),P()))}),le(()=>(t(y),t($)),()=>{t(y)&&t($)&&C(!1)}),st(),it();var w=Tt(),d=r(w),ve=r(d);Re(ve,_=>i(B,_),()=>t(B)),o(d),o(w),se(we,w),lt()}var kt=ie(`<div class="game-ended-popup svelte-17ca876"><div class="popup-content svelte-17ca876"><h2 class="svelte-17ca876">Game Ended</h2> <p class="svelte-17ca876">You've used all your lives!</p> <p class="svelte-17ca876"> </p> <button class="svelte-17ca876">Play Again</button></div></div>`),It=ie('<button class="svelte-17ca876">Clear Samples</button>'),Ct=ie('<div class="panel svelte-17ca876"><h2 class="svelte-17ca876">Backbone Angles</h2> <div class="molecule-visualization svelte-17ca876"><!></div> <div class="control-panel svelte-17ca876"><div class="slider-container svelte-17ca876"><label for="angle" class="svelte-17ca876">Œ® Angle (degrees):</label> <input type="range" id="angle" min="0" max="360" step="1" class="svelte-17ca876"> <span class="svelte-17ca876"> </span></div> <div class="slider-container svelte-17ca876"><label for="phiAngle" class="svelte-17ca876">Œ¶ Angle (degrees):</label> <input type="range" id="phiAngle" min="0" max="360" step="1" class="svelte-17ca876"> <span class="svelte-17ca876"> </span></div></div></div> <div class="panel svelte-17ca876"><h2 class="svelte-17ca876">Energy Landscape</h2> <div class="contour-container svelte-17ca876"><canvas></canvas></div> <div class="button-group svelte-17ca876"><!> <button class="info-button svelte-17ca876"> </button></div> <div class="instruction svelte-17ca876"><p class="svelte-17ca876">Click directly on the plot above to sample points. This will run the simulation and update the emulator model based on the simulator output.</p></div></div>',1),Ot=ie('<button class="svelte-17ca876">Clear Samples</button>'),Ft=ie('<div class="grid-item energy-plot svelte-17ca876"><h2 class="svelte-17ca876">Energy Landscape</h2> <div class="contour-container svelte-17ca876"><canvas></canvas></div></div> <div class="grid-item buttons svelte-17ca876"><div class="instruction svelte-17ca876"><p class="svelte-17ca876">Click directly on the plot to sample points. This will run the simulation and update the emulator model based on the simulator output.</p></div> <div class="vertical-button-group svelte-17ca876"><!> <button class="info-button svelte-17ca876"> </button></div></div> <div class="grid-item molecule-panel svelte-17ca876"><h2 class="svelte-17ca876">Backbone Angles</h2> <div class="molecule-visualization svelte-17ca876"><!></div></div> <div class="grid-item angle-sliders svelte-17ca876"><div class="vertical-control-panel svelte-17ca876"><div class="compact-slider-container svelte-17ca876"><label for="angle-vertical" class="svelte-17ca876">Œ® Angle:</label> <input type="range" id="angle-vertical" min="0" max="360" step="1" class="svelte-17ca876"> <span class="svelte-17ca876"> </span></div> <div class="compact-slider-container svelte-17ca876"><label for="phiAngle-vertical" class="svelte-17ca876">Œ¶ Angle:</label> <input type="range" id="phiAngle-vertical" min="0" max="360" step="1" class="svelte-17ca876"> <span class="svelte-17ca876"> </span></div></div></div>',1),Rt=ie(`<main class="svelte-17ca876"><h1 class="svelte-17ca876">Protein Explorer</h1> <div class="instruction svelte-17ca876"><p class="svelte-17ca876">Rotating backbone angles changes the protein's shape, affecting its stability. Lower energy regions correspond to more stable conformations.</p></div> <div class="instruction svelte-17ca876"><p class="highlight svelte-17ca876">Your goal is to train an emulator that accurately predicts the energy function using as few protein simulator runs as possible.</p></div> <div class="bars-container svelte-17ca876"><div class="live-bar-container svelte-17ca876"><div class="lives-label"> </div> <div class="live-bar svelte-17ca876"><div class="lives-remaining svelte-17ca876"></div> <span class="heart svelte-17ca876">üí∑</span></div></div> <div></div> <div class="score-bar-container svelte-17ca876"><div class="score-label">Score: <span id="score-percentage"> </span></div> <div class="score-bar svelte-17ca876"><div class="score-value svelte-17ca876" id="score-bar"></div> <span class="star svelte-17ca876" id="score-star">‚≠ê</span></div></div></div> <!> <div class="level-container svelte-17ca876"><label for="level" class="level-label svelte-17ca876">Difficulty:</label> <select id="level" class="svelte-17ca876"><option>Level 1</option><option>Level 2</option><option>Level 3</option></select></div> <div><!></div> <div class="button-group svelte-17ca876" style="margin-top: 20px; text-align: center;"><button class="info-button svelte-17ca876"><span>Go back</span></button></div></main>`);function Kt(we,oe){at(oe,!1);const S=R(),z=R(),L=R(),j=R();function ce(){window.location.href="https://alan-turing-institute.github.io/gp-demo/"}let P=R([]),q=[],H=R(),Q=R(!1),$=R(!1),y=R(20),B=R(!1);const C=400,w=400,d=40,ve=C-2*d,_=Ue([0,360],[d,C-d]),b=Ue([0,360],[w-d,d]),A={primary:"#3c6382",accent:"#60a3bc",highlight:"#6a89cc",text:"#2c3e50"};function f(){localStorage.setItem("proteinExplorerState",JSON.stringify({samples:t(P),gpPredictions:q,lives:t(y),score:t(L),gameEnded:t(B),showEnergyFunction:t($),phi:t(S),psi:t(z)}))}function de(){const e=localStorage.getItem("proteinExplorerState");if(e){const n=JSON.parse(e);i(P,n.samples),q=n.gpPredictions,i(y,n.lives),i(L,n.score),i(B,n.gameEnded),i($,n.showEnergyFunction),i(S,n.phi),i(z,n.psi)}}let V=R(!1);function Z(){i(V,window.innerHeight>window.innerWidth)}Le(()=>(de(),T(),G(),Z(),window.addEventListener("resize",Z),()=>{f(),window.removeEventListener("resize",Z)}));let g=1/0,m=-1/0;function T(){const n=Me(0,360,7.2).toArray(),v=Me(0,360,360/50).toArray();for(const a of n)for(const l of v){const s=O(a,l);g=Math.min(g,s),m=Math.max(m,s)}g=Math.floor(g*10)/10,m=Math.ceil(m*10)/10,console.log(`Energy range: ${g} to ${m}`)}function D(e){return e*(Math.PI/180)}function O(e,n){const v=D(e)-Math.PI,a=D(n)-Math.PI,l=Math.exp(-((v+Math.PI/2)**2)-(a-Math.PI/2)**2/.5),s=Math.exp(-((v+Math.PI/2)**2)-(a+.5)**2/.3),p=Math.exp(-((v-Math.PI/2)**2)-(a+Math.PI/2)**2/.5),h=Math.exp(-((v-Math.PI/2)**2)-(a-.5)**2/.3),E=Math.exp(-((v-0)**2)/.3-(a-Math.PI/4)**2/.2);let M=0;return t(j)=="1"?M=l:t(j)=="2"?M=l+s:t(j)=="3"?M=l+s+p+h+E:console.error("Invalid difficulty level: ",t(j)),-Math.log(M+1e-6)}function ee(){i(P,[]),q=[],G(),i(y,20),i(L,0)}function ae(e){if(t(Q)||t(y)<=0)return;const n=t(H).getBoundingClientRect(),v=t(H).width/n.width,a=t(H).height/n.height,l=(e.clientX-n.left)*v,s=(e.clientY-n.top)*a,p=Math.round(_.invert(l)),h=Math.round(b.invert(s));if(l>=d&&l<=C-d&&s>=d&&s<=w-d){i(S,p),i(z,h);const E=O(t(S),t(z));i(P,[...t(P),{phi:t(S),psi:t(z),energy:E}]),i(y,t(y)-1),t(y)===0&&i(B,!0),ue()}}function x(){i(y,20),i(L,0),i(P,[]),q=[],i(B,!1),G()}function pe(e,n){if(e.length!==n.length||e.length===0)throw new Error("Arrays must be of the same length and non-empty");const v=e.reduce((p,h)=>p+h,0)/e.length,a=e.reduce((p,h)=>p+Math.pow(h-v,2),0),s=1-e.reduce((p,h,E)=>p+Math.pow(h-n[E],2),0)/a;return Math.max(0,s)}function ue(){i(Q,!0);let e=[],n=[];if(t(P).length===0){i(Q,!1),G();return}setTimeout(()=>{console.log("Updating GP model...");const v=t(P).map(u=>[u.phi,u.psi]),a=t(P).map(u=>u.energy),l=(u,k,te=1*(180/Math.PI))=>{const X=wt(St(zt(u,k),2));return Et(-.5*X/(te*te))},s=v.length,p=Ve(s,s);for(let u=0;u<s;u++)for(let k=0;k<s;k++)p.set([u,k],l(v[u],v[k]));const h=.01;for(let u=0;u<s;u++)p.set([u,u],p.get([u,u])+h);const E=40,M=Me(0,360,360/E).toArray(),Y=Me(0,360,360/E).toArray();q=[];for(const u of M)for(const k of Y){const te=[u,k],X=Ve(1,s);for(let F=0;F<s;F++)X.set([0,F],l(te,v[F]));try{const F=xt(p,a),N=Mt(X,F).get([0,0]);q.push({phi:u,psi:k,predicted:N}),n.push(N),e.push(O(u,k))}catch(F){console.error("Error in GP calculation:",F)}}G(),i(L,pe(e,n)),console.log("R2 Score: ",t(L)),i(Q,!1)},50)}function G(){if(!t(H))return;const e=t(H).getContext("2d");e.clearRect(0,0,C+60,w);const n=bt().domain([m,g]).interpolator(At);if(t($)){const a=ve/80;for(let l=0;l<80;l++)for(let s=0;s<80;s++){const p=0+360*l/80,h=0+360*s/80,E=O(p,h),M=_(p),Y=b(h);e.fillStyle=n(E),e.fillRect(M-a/2,Y-a/2,a,a)}}else if(q.length===0){const a=ve/80;for(let l=0;l<80;l++)for(let s=0;s<80;s++){const p=0+360*l/80,h=0+360*s/80,E=_(p),M=b(h);e.fillStyle=n(0),e.fillRect(E-a/2,M-a/2,a,a)}}else{const v=ve/Math.sqrt(q.length);q.forEach(a=>{const l=_(a.phi),s=b(a.psi);e.fillStyle=n(a.predicted),e.fillRect(l-v/2,s-v/2,v,v)})}nt(e,n),e.strokeStyle=A.primary,e.lineWidth=2,e.beginPath(),e.moveTo(d,w-d),e.lineTo(C-d,w-d),e.moveTo(d,d),e.lineTo(d,w-d),e.stroke(),e.fillStyle=A.text,e.font="bold 14px Arial, sans-serif",e.textAlign="center",e.fillText("0",d,w-d+15),e.fillText("180",C/2,w-d+15),e.fillText("360",C-d,w-d+15),e.fillText("œÜ",C-d+10,w-d+25),e.textAlign="right",e.fillText("0",d-5,w-d),e.fillText("180",d-5,w/2),e.fillText("360",d-5,d),e.fillText("œà",d-20,d-20),t(P).forEach(v=>{const a=_(v.phi),l=b(v.psi),s=8,p=e.createRadialGradient(a,l,2,a,l,s);p.addColorStop(0,A.highlight),p.addColorStop(1,"rgba(106, 137, 204, 0)"),e.fillStyle=p,e.beginPath(),e.arc(a,l,s,0,2*Math.PI),e.fill(),e.fillStyle=A.accent,e.beginPath(),e.arc(a,l,4,0,2*Math.PI),e.fill(),e.strokeStyle=A.primary,e.lineWidth=1,e.stroke()})}function nt(e,n){const a=w-2*d,l=C-d+20,s=d,p=100,h=a/p;for(let M=0;M<p;M++){const Y=g+(m-g)*(p-M-1)/p;e.fillStyle=n(Y),e.fillRect(l,s+M*h,20,h+1)}e.strokeStyle=A.text,e.lineWidth=1,e.strokeRect(l,s,20,a),e.fillStyle=A.text,e.font="12px Arial, sans-serif",e.textAlign="left",e.fillText(g.toFixed(1),l+20+5,s+a),e.fillText(m.toFixed(1),l+20+5,s);const E=(g+m)/2;e.fillText(E.toFixed(1),l+20+5,s+a/2),e.save(),e.translate(l+20+25,s+a/2),e.rotate(-Math.PI/2),e.textAlign="center",e.fillText("Energy",0,10),e.restore()}function $e(){i($,!t($)),G()}Le(()=>{T(),G()});function rt(e){i(j,e.target.value),t($)&&G(),console.log("Difficulty level set to: ",t(j))}le(()=>{},()=>{i(S,0)}),le(()=>{},()=>{i(z,0)}),le(()=>{},()=>{i(L,0)}),le(()=>(t(S),t(z)),()=>{}),le(()=>{},()=>{i(j,"3")}),st(),it();var Se=Rt(),ze=c(r(Se),6),Ee=r(ze),Pe=r(Ee),ot=r(Pe);o(Pe);var De=c(Pe,2),We=r(De),ct=c(We,2);o(De),o(Ee);var je=c(Ee,4),Te=r(je),He=c(r(Te)),vt=r(He);o(He),o(Te);var Ge=c(Te,2),Ne=r(Ge),dt=c(Ne,2);o(Ge),o(je),o(ze);var qe=c(ze,2);{var pt=e=>{var n=kt(),v=r(n),a=c(r(v),4),l=r(a);o(a);var s=c(a,2);o(v),o(n),fe(p=>K(l,`Final score: ${p??""}%`),[()=>(t(L)*100).toFixed(0)],Je),J("click",s,x),se(e,n)};be(qe,e=>{t(B)&&e(pt)})}var ke=c(qe,2),me=c(r(ke),2);fe(()=>{t(j),mt(()=>{})});var Ie=r(me);Ie.value=(Ie.__value="1")==null?"":"1";var Ce=c(Ie);Ce.value=(Ce.__value="2")==null?"":"2";var Ye=c(Ce);Ye.value=(Ye.__value="3")==null?"":"3",o(me),o(ke);var _e=c(ke,2),ut=r(_e);{var gt=e=>{var n=Ct(),v=Ke(n),a=c(r(v),2);U(a,"style",`width: ${C}px; height: ${w}px;`);var l=r(a);tt(l,{get angle(){return t(S)},set angle(I){i(S,I)},get phiAngle(){return t(z)},set phiAngle(I){i(z,I)},$$legacy:!0}),o(a);var s=c(a,2),p=r(s),h=c(r(p),2);Ae(h);var E=c(h,2),M=r(E);o(E),o(p);var Y=c(p,2),u=c(r(Y),2);Ae(u);var k=c(u,2),te=r(k);o(k),o(Y),o(s),o(v);var X=c(v,2),F=c(r(X),2),N=r(F);U(N,"width",C+60),U(N,"height",w),Re(N,I=>i(H,I),()=>t(H)),o(F);var ne=c(F,2),ge=r(ne);{var Oe=I=>{var ye=It();J("click",ye,ee),se(I,ye)};be(ge,I=>{t(P).length>0&&I(Oe)})}var re=c(ge,2),he=r(re,!0);o(re),o(ne),_t(2),o(X),fe(()=>{K(M,`${t(z)??""}¬∞`),K(te,`${t(S)??""}¬∞`),Fe(N,1,Qe(t(Q)?"loading":""),"svelte-17ca876"),K(he,t($)?"Show Emulator Prediction":"Show Simulator Function")}),xe(h,()=>t(z),I=>i(z,I)),xe(u,()=>t(S),I=>i(S,I)),J("click",N,ae),J("click",re,$e),se(e,n)},ht=e=>{var n=Ft(),v=Ke(n),a=c(r(v),2),l=r(a);U(l,"width",C+60),U(l,"height",w),Re(l,W=>i(H,W),()=>t(H)),o(a),o(v);var s=c(v,2),p=c(r(s),2),h=r(p);{var E=W=>{var Be=Ot();J("click",Be,ee),se(W,Be)};be(h,W=>{t(P).length>0&&W(E)})}var M=c(h,2),Y=r(M,!0);o(M),o(p),o(s);var u=c(s,2),k=c(r(u),2),te=r(k);tt(te,{get angle(){return t(S)},set angle(W){i(S,W)},get phiAngle(){return t(z)},set phiAngle(W){i(z,W)},$$legacy:!0}),o(k),o(u);var X=c(u,2),F=r(X),N=r(F),ne=c(r(N),2);Ae(ne);var ge=c(ne,2),Oe=r(ge);o(ge),o(N);var re=c(N,2),he=c(r(re),2);Ae(he);var I=c(he,2),ye=r(I);o(I),o(re),o(F),o(X),fe(()=>{Fe(l,1,Qe(t(Q)?"loading":""),"svelte-17ca876"),K(Y,t($)?"Show Emulator Prediction":"Show Simulator Function"),K(Oe,`${t(z)??""}¬∞`),K(ye,`${t(S)??""}¬∞`)}),J("click",l,ae),J("click",M,$e),xe(ne,()=>t(z),W=>i(z,W)),xe(he,()=>t(S),W=>i(S,W)),se(e,n)};be(ut,e=>{t(V)?e(ht,!1):e(gt)})}o(_e);var Xe=c(_e,2),ft=r(Xe);o(Xe),o(Se),fe((e,n)=>{K(ot,`Guesses left ${t(y)??""}/20`),U(We,"style",`width: ${e??""}%`),U(ct,"style",`left: ${e??""}%`),K(vt,`${n??""}%`),U(Ne,"style",`width: ${t(L)*100}%`),U(dt,"style",`left: ${t(L)*100}%`),Fe(_e,1,`responsive-grid ${(t(V)?"vertical":"horizontal")??""}`,"svelte-17ca876")},[()=>Math.max(0,t(y)/20*100),()=>(t(L)*100).toFixed(0)],Je),yt(me,()=>t(j),e=>i(j,e)),J("change",me,rt),J("click",ft,ce),se(we,Se),lt()}export{Kt as component};
