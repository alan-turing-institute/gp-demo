import{t as ce,a as re}from"../chunks/Dl42bQaK.js";import"../chunks/Cns6LDpP.js";import{a5 as qe,ab as ae,ac as He,a6 as $e,a7 as p,a2 as g,ad as I,e as t,$ as Ge,a8 as u,aa as it,s as b,i as st,a9 as ot}from"../chunks/C_nTGglK.js";import{e as oe,s as U}from"../chunks/D15B_ygG.js";import{i as Fe}from"../chunks/BiG_kpbh.js";import{s as Q,r as Le}from"../chunks/CThLS2ih.js";import{l as We,s as nt,c as rt}from"../chunks/CSJ2tm9-.js";import{b as je}from"../chunks/RyJ3Hllu.js";import{b as _e}from"../chunks/BOcuyyEv.js";import{i as Be}from"../chunks/-d2lr63c.js";import{o as Xe}from"../chunks/BfnemT7e.js";import{r as ne,s as ct,v as dt,z as De,l as ft,m as vt,a as pt,d as ut,b as ht,e as gt}from"../chunks/Di72JI2_.js";import{_ as xt}from"../chunks/C1FmrZbK.js";import{p as Ne}from"../chunks/BSqzZcxX.js";var yt=ce('<main class="svelte-13sjxqj"><div class="viewer-container svelte-13sjxqj"><div id="viewer" class="svelte-13sjxqj"></div></div></main>');function mt(de,V){qe(V,!1);let z=`
ATOM      1  CH3 ACE     1       2.000   2.090   0.000
ATOM      2  C   ACE     1       3.427   2.641  -0.000
ATOM      3  O   ACE     1       4.391   1.877  -0.000
ATOM      4  N   ALA     2       3.555   3.970  -0.000
ATOM      5  CA  ALA     2       4.853   4.614  -0.000
ATOM     6  HA  ALA     2       5.408   4.316   0.890
ATOM     7  CB  ALA     2       5.661   4.221  -1.232
ATOM     8  C   ALA     2       4.713   6.129   0.000
ATOM     9  O   ALA     2       3.601   6.653   0.000
ATOM     10  N   NME     3       5.846   6.835   0.000
ATOM     11  H   NME     3       6.737   6.359  -0.000
ATOM     12  CH3 NME     3       5.846   8.284   0.000
TER   
END`,P=[6,7,8,9,10,11,12],E=4,R=5,O=Ne(V,"angle",8,50),G=Ne(V,"phiAngle",8,0);function $(s){let f;Math.abs(s.z)>.9?f={x:0,y:s.z,z:-s.y}:f={x:-s.y,y:s.x,z:0};let h=Math.sqrt(f.x**2+f.y**2+f.z**2);return f.x/=h,f.y/=h,f.z/=h,f}function j(s,f,h,v,q){let L=q*Math.PI/180,Y=Math.cos(L),_=Math.sin(L),A=1-Y,T=[[Y+v.x**2*A,v.x*v.y*A-v.z*_,v.x*v.z*A+v.y*_],[v.y*v.x*A+v.z*_,Y+v.y**2*A,v.y*v.z*A-v.x*_],[v.z*v.x*A-v.y*_,v.z*v.y*A+v.x*_,Y+v.z**2*A]];return f.forEach(S=>{let k=s[S-1],W=k.x-h.x,J=k.y-h.y,x=k.z-h.z,K=T[0][0]*W+T[0][1]*J+T[0][2]*x,Z=T[1][0]*W+T[1][1]*J+T[1][2]*x,ee=T[2][0]*W+T[2][1]*J+T[2][2]*x;k.x=K+h.x,k.y=Z+h.y,k.z=ee+h.z}),s}function F(s,f,h,v,q,L){let _=s.split(`
`).filter(x=>x.startsWith("ATOM")).map(x=>{let K=parseFloat(x.substring(30,38).trim()),Z=parseFloat(x.substring(38,46).trim()),ee=parseFloat(x.substring(46,54).trim());return{x:K,y:Z,z:ee,line:x}}),A=_[h-1],T=_[v-1],S={x:T.x-A.x,y:T.y-A.y,z:T.z-A.z},k=Math.sqrt(S.x**2+S.y**2+S.z**2);S.x/=k,S.y/=k,S.z/=k;let W=$(S);return _=j(_,f,A,S,q),_=j(_,f,A,W,L),_.forEach(x=>{x.line=x.line.substring(0,30)+x.x.toFixed(3).padStart(8)+x.y.toFixed(3).padStart(8)+x.z.toFixed(3).padStart(8)+x.line.substring(54)}),_.map(x=>x.line).join(`
`)+`
TER
END`}let D=I(),d=I(),y=I();Xe(async()=>{if(typeof window<"u")try{const{createViewer:s}=await xt(async()=>{const{createViewer:f}=await import("../chunks/kNyKxqkf.js").then(h=>h._);return{createViewer:f}},[],import.meta.url);console.log("3Dmol.js loaded successfully"),g(d,s(t(y),{backgroundColor:"white"})),n(!0),window.addEventListener("resize",()=>{t(d)&&(t(d).resize(),t(d).render())})}catch(s){console.error("Failed to load 3Dmol.js:",s)}});function n(s=!0){t(d)&&(console.log("Updating viewer with angles:",O(),G()),t(d).clear(),t(d).addModel(t(D),"pdb"),t(d).setStyle({},{stick:{radius:.2},sphere:{scale:.3}}),s&&t(d).zoomTo(),t(d).render())}ae(()=>(Ge(O()),Ge(G())),()=>{g(D,F(z,P,E,R,O(),G()))}),ae(()=>(t(d),t(D)),()=>{t(d)&&t(D)&&n(!1)}),He(),Be();var B=yt(),N=p(B),X=p(N);_e(X,s=>g(y,s),()=>t(y)),u(N),u(B),re(de,B),$e()}var bt=ce(`<div class="game-ended-popup svelte-1feoufx"><div class="popup-content svelte-1feoufx"><h2 class="svelte-1feoufx">Game Ended</h2> <p class="svelte-1feoufx">You've used all your lives!</p> <button class="svelte-1feoufx">Play Again</button></div></div>`),_t=ce('<button class="svelte-1feoufx">Clear Samples</button>'),At=ce('<main class="svelte-1feoufx"><h1 class="svelte-1feoufx">Protein Backbone Conformation Explorer</h1> <div class="live-bar-container svelte-1feoufx"><div class="lives-label svelte-1feoufx"> </div> <div class="live-bar svelte-1feoufx"><div class="lives-remaining svelte-1feoufx"></div> <span class="heart svelte-1feoufx">❤️</span></div></div> <!> <div class="container svelte-1feoufx"><div class="panel svelte-1feoufx"><h2 class="svelte-1feoufx">Backbone Angles</h2> <canvas class="svelte-1feoufx"></canvas> <div class="Other"><div class="control-panel svelte-1feoufx"><div class="slider-container svelte-1feoufx"><label for="angle" class="svelte-1feoufx">Psi Angle (degrees):</label> <input type="range" id="angle" min="0" max="360" step="1" class="svelte-1feoufx"> <span class="svelte-1feoufx"> </span></div> <div class="slider-container svelte-1feoufx"><label for="phiAngle" class="svelte-1feoufx">Phi Angle (degrees):</label> <input type="range" id="phiAngle" min="0" max="360" step="1" class="svelte-1feoufx"> <span class="svelte-1feoufx"> </span></div></div> <!></div></div> <div class="panel svelte-1feoufx"><h2 class="svelte-1feoufx">Energy Landscape</h2> <div class="contour-container svelte-1feoufx"><canvas></canvas></div> <div class="info svelte-1feoufx"><p class="svelte-1feoufx"> </p> <p class="svelte-1feoufx"> </p> <div class="instruction svelte-1feoufx"><p class="highlight svelte-1feoufx">Click on the plot above to add sample points and update the GP model</p></div> <div class="button-group svelte-1feoufx"><!> <button class="info-button svelte-1feoufx"> </button></div> <div class="energy-function svelte-1feoufx"><h3 class="svelte-1feoufx">About the Visualization:</h3> <p class="svelte-1feoufx"> </p> <p class="svelte-1feoufx">The energy function represents different stable conformations of the protein backbone. Lighter regions indicate lower energy (more stable conformations).</p> <p class="svelte-1feoufx">Click directly on the plot to add sample points and build a GP model that learns this energy landscape.</p></div></div></div></div></main>');function Lt(de,V){qe(V,!1);const z=I(),P=I();let E=I([]),R=[],O=I(),G=I(),$=I(!1),j=I(!1),F=I(20),D=I(!1);const d=400,y=400,n=40,B=d-2*n,N=We([0,360],[n,d-n]),X=We([0,360],[y-n,n]),s={primary:"#3c6382",secondary:"#82ccdd",accent:"#60a3bc",highlight:"#6a89cc",text:"#2c3e50",bond1:"#38ada9",bond2:"#6a89cc",atom1:"#3c6382",atom2:"#60a3bc",atom3:"#82ccdd",atom4:"#38ada9"};let f=1/0,h=-1/0;function v(){const o=ne(0,360,7.2).toArray(),i=ne(0,360,360/50).toArray();for(const a of o)for(const r of i){const c=L(a,r);f=Math.min(f,c),h=Math.max(h,c)}f=Math.floor(f*10)/10,h=Math.ceil(h*10)/10,console.log(`Energy range: ${f} to ${h}`)}function q(e){return e*(Math.PI/180)}function L(e,o){const i=q(e)-Math.PI,a=q(o)-Math.PI,r=Math.exp(-((i+Math.PI/2)**2)-(a-Math.PI/2)**2/.5),c=Math.exp(-((i+Math.PI/2)**2)-(a+.5)**2/.3),m=Math.exp(-((i-Math.PI/2)**2)-(a+Math.PI/2)**2/.5),C=Math.exp(-((i-Math.PI/2)**2)-(a-.5)**2/.3),w=Math.exp(-((i-0)**2)/.3-(a-Math.PI/4)**2/.2),l=r+c+m+C+w;return-Math.log(l+1e-6)}function Y(){g(E,[]),R=[],S()}function _(e){if(t($)||t(F)<=0)return;const o=t(G).getBoundingClientRect(),i=e.clientX-o.left,a=e.clientY-o.top,r=Math.round(N.invert(i)),c=Math.round(X.invert(a));if(i>=n&&i<=d-n&&a>=n&&a<=y-n){g(z,r),g(P,c);const m=L(t(z),t(P));g(E,[...t(E),{phi:t(z),psi:t(P),energy:m}]),g(F,t(F)-1),t(F)===0&&g(D,!0),T(),W()}}function A(){g(F,20),g(E,[]),R=[],g(D,!1),S()}function T(){if(g($,!0),t(E).length===0){g($,!1),S();return}setTimeout(()=>{const e=t(E).map(l=>[l.phi,l.psi]),o=t(E).map(l=>l.energy),i=(l,M,ie=1*(180/Math.PI))=>{const se=pt(ut(ht(l,M),2));return gt(-.5*se/(ie*ie))},a=e.length,r=De(a,a);for(let l=0;l<a;l++)for(let M=0;M<a;M++)r.set([l,M],i(e[l],e[M]));const c=.01;for(let l=0;l<a;l++)r.set([l,l],r.get([l,l])+c);const m=40,C=ne(0,360,360/m).toArray(),w=ne(0,360,360/m).toArray();R=[];for(const l of C)for(const M of w){const ie=[l,M],se=De(1,a);for(let H=0;H<a;H++)se.set([0,H],i(ie,e[H]));try{const H=ft(r,o),lt=vt(se,H).get([0,0]);R.push({phi:l,psi:M,predicted:lt})}catch(H){console.error("Error in GP calculation:",H)}}S(),g($,!1)},50)}function S(){if(!t(G))return;const e=t(G).getContext("2d");e.clearRect(0,0,d+60,y);const o=ct().domain([h,f]).interpolator(dt);if(t(j)){const a=B/80;for(let r=0;r<80;r++)for(let c=0;c<80;c++){const m=0+360*r/80,C=0+360*c/80,w=L(m,C),l=N(m),M=X(C);e.fillStyle=o(w),e.fillRect(l-a/2,M-a/2,a,a)}}else if(R.length===0){const a=B/80;for(let r=0;r<80;r++)for(let c=0;c<80;c++){const m=0+360*r/80,C=0+360*c/80,w=N(m),l=X(C);e.fillStyle=o(0),e.fillRect(w-a/2,l-a/2,a,a)}}else{const i=B/Math.sqrt(R.length);R.forEach(a=>{const r=N(a.phi),c=X(a.psi);e.fillStyle=o(a.predicted),e.fillRect(r-i/2,c-i/2,i,i)})}k(e,o),e.strokeStyle=s.primary,e.lineWidth=2,e.beginPath(),e.moveTo(n,y-n),e.lineTo(d-n,y-n),e.moveTo(n,n),e.lineTo(n,y-n),e.stroke(),e.fillStyle=s.text,e.font="bold 14px Arial, sans-serif",e.textAlign="center",e.fillText("0",n,y-n+15),e.fillText("180",d/2,y-n+15),e.fillText("360",d-n,y-n+15),e.fillText("φ",d-n+10,y-n+25),e.textAlign="right",e.fillText("0",n-5,y-n),e.fillText("180",n-5,y/2),e.fillText("360",n-5,n),e.fillText("ψ",n-20,n-20),t(E).forEach(i=>{const a=N(i.phi),r=X(i.psi),c=8,m=e.createRadialGradient(a,r,2,a,r,c);m.addColorStop(0,s.highlight),m.addColorStop(1,"rgba(106, 137, 204, 0)"),e.fillStyle=m,e.beginPath(),e.arc(a,r,c,0,2*Math.PI),e.fill(),e.fillStyle=s.accent,e.beginPath(),e.arc(a,r,4,0,2*Math.PI),e.fill(),e.strokeStyle=s.primary,e.lineWidth=1,e.stroke()})}function k(e,o){const a=y-2*n,r=d-n+20,c=n,m=100,C=a/m;for(let l=0;l<m;l++){const M=f+(h-f)*(m-l-1)/m;e.fillStyle=o(M),e.fillRect(r,c+l*C,20,C+1)}e.strokeStyle=s.text,e.lineWidth=1,e.strokeRect(r,c,20,a),e.fillStyle=s.text,e.font="12px Arial, sans-serif",e.textAlign="left",e.fillText(f.toFixed(1),r+20+5,c+a),e.fillText(h.toFixed(1),r+20+5,c);const w=(f+h)/2;e.fillText(w.toFixed(1),r+20+5,c+a/2),e.save(),e.translate(r+20+25,c+a/2),e.rotate(-Math.PI/2),e.textAlign="center",e.fillText("Energy",0,10),e.restore()}function W(){if(!t(O))return;const e=t(O).getContext("2d");e.clearRect(0,0,d,y);const o=d/2,i=y/2,a=120,r=e.createRadialGradient(o,i,0,o,i,a*1.5);r.addColorStop(0,"rgba(60, 99, 130, 0.1)"),r.addColorStop(1,"rgba(245, 246, 250, 0.05)"),e.fillStyle=r,e.fillRect(0,0,d,y);const c=e.createLinearGradient(o-a,i,o+a,i);c.addColorStop(0,s.secondary),c.addColorStop(.5,s.primary),c.addColorStop(1,s.secondary),e.strokeStyle=c,e.lineWidth=3,e.beginPath(),e.moveTo(o-a,i),e.lineTo(o+a,i),e.stroke();const m=[{x:o-a,y:i,color:s.atom1,label:"N",size:24},{x:o-a/2,y:i,color:s.atom2,label:"Cα",size:26},{x:o,y:i,color:s.atom3,label:"C",size:24},{x:o+a/2,y:i,color:s.atom4,label:"O",size:24},{x:o+a,y:i,color:s.atom1,label:"N",size:24}];e.save(),e.translate(o-a/2,i),e.rotate(q(t(z)));const C=e.createLinearGradient(0,0,0,-60);C.addColorStop(0,s.bond1),C.addColorStop(1,s.secondary),e.strokeStyle=C,e.lineWidth=3,e.beginPath(),e.moveTo(0,0),e.lineTo(0,-60),e.stroke(),e.fillStyle=s.text,e.font="bold 14px Arial, sans-serif",e.fillText("φ = "+t(z).toFixed(0),5,-30),e.restore(),e.save(),e.translate(o,i),e.rotate(q(t(P)));const w=e.createLinearGradient(0,0,0,-60);w.addColorStop(0,s.bond2),w.addColorStop(1,s.highlight),e.strokeStyle=w,e.lineWidth=3,e.beginPath(),e.moveTo(0,0),e.lineTo(0,-60),e.stroke(),e.fillStyle=s.text,e.font="bold 14px Arial, sans-serif",e.fillText("ψ = "+t(P).toFixed(0),5,-30),e.restore(),m.forEach(l=>{const M=e.createRadialGradient(l.x,l.y,0,l.x,l.y,l.size*1.2);M.addColorStop(0,l.color),M.addColorStop(1,"rgba(255, 255, 255, 0)"),e.fillStyle=M,e.beginPath(),e.arc(l.x,l.y,l.size*1.2,0,2*Math.PI),e.fill(),e.fillStyle=l.color,e.beginPath(),e.arc(l.x,l.y,l.size,0,2*Math.PI),e.fill(),e.fillStyle="#fff",e.font="bold 14px Arial, sans-serif",e.textAlign="center",e.textBaseline="middle",e.fillText(l.label,l.x,l.y)})}function J(){g(j,!t(j)),S()}Xe(()=>{v(),W(),S()}),ae(()=>{},()=>{g(z,0)}),ae(()=>{},()=>{g(P,0)}),ae(()=>(t(O),t(z),t(P)),()=>{t(O)&&(t(z)||t(P))&&W()}),He(),Be();var x=At(),K=b(p(x),2),Z=p(K),ee=p(Z);u(Z);var Ae=b(Z,2),Se=p(Ae),Ye=b(Se,2);u(Ae),u(K);var Me=b(K,2);{var Ke=e=>{var o=bt(),i=p(o),a=b(p(i),4);u(i),u(o),oe("click",a,A),re(e,o)};Fe(Me,e=>{t(D)&&e(Ke)})}var ze=b(Me,2),fe=p(ze),le=b(p(fe),2);Q(le,"width",d),Q(le,"height",y),_e(le,e=>g(O,e),()=>t(O));var Pe=b(le,2),ve=p(Pe),pe=p(ve),ue=b(p(pe),2);Le(ue);var Te=b(ue,2),Ze=p(Te);u(Te),u(pe);var Ce=b(pe,2),he=b(p(Ce),2);Le(he);var we=b(he,2),Ue=p(we);u(we),u(Ce),u(ve);var Je=b(ve,2);mt(Je,{get angle(){return t(z)},set angle(e){g(z,e)},get phiAngle(){return t(P)},set phiAngle(e){g(P,e)},$$legacy:!0}),u(Pe),u(fe);var Ee=b(fe,2),ge=b(p(Ee),2),te=p(ge);Q(te,"width",d+60),Q(te,"height",y),_e(te,e=>g(G,e),()=>t(G)),u(ge);var ke=b(ge,2),xe=p(ke),Qe=p(xe);u(xe);var ye=b(xe,2),Ve=p(ye);u(ye);var me=b(ye,4),Ie=p(me);{var et=e=>{var o=_t();oe("click",o,Y),re(e,o)};Fe(Ie,e=>{t(E).length>0&&e(et)})}var be=b(Ie,2),tt=p(be,!0);u(be),u(me);var Oe=b(me,2),Re=b(p(Oe),2),at=p(Re,!0);u(Re),ot(4),u(Oe),u(ke),u(Ee),u(ze),u(x),it((e,o)=>{U(ee,`Lives ${t(F)??""}/20`),Q(Se,"style",`width: ${e??""}%`),Q(Ye,"style",`left: ${e??""}%`),U(Ze,`${t(P)??""}°`),U(Ue,`${t(z)??""}°`),nt(te,1,rt(t($)?"loading":""),"svelte-1feoufx"),U(Qe,`Samples: ${t(E).length??""}`),U(Ve,`Current energy: ${o??""}`),U(tt,t(j)?"Show GP Prediction":"Show Energy Function"),U(at,t(j)?"Showing actual energy function":"Showing Gaussian Process prediction")},[()=>Math.max(0,t(F)/20*100),()=>L(t(z),t(P)).toFixed(2)],st),je(ue,()=>t(P),e=>g(P,e)),je(he,()=>t(z),e=>g(z,e)),oe("click",te,_),oe("click",be,J),re(de,x),$e()}export{Lt as component};
