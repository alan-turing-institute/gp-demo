import{t as pe,a as ve}from"../chunks/cGtBC6Qd.js";import"../chunks/7LKkzqbz.js";import{a4 as lt,aa as K,ab as it,a5 as at,a6 as r,a1 as d,ac as E,e as t,Z as Ke,a7 as c,a9 as Te,s as p,i as Ue,aw as yt}from"../chunks/BJ4irGt7.js";import{e as J,s as Q}from"../chunks/CvaqDwXv.js";import{i as Je}from"../chunks/lIaEYNz1.js";import{s as Z,r as Qe}from"../chunks/B9r3SdpA.js";import{l as Ve,s as _t,c as bt}from"../chunks/dhIx7U5O.js";import{b as At,a as et}from"../chunks/RvGyPHbW.js";import{b as ot}from"../chunks/CUY-1DrG.js";import{i as nt}from"../chunks/CkfO92w8.js";import{o as rt}from"../chunks/Cpzjerpz.js";import{r as de,s as Mt,v as St,z as tt,l as wt,m as Pt,a as Tt,d as Et,b as It,e as Ct}from"../chunks/PBAI84v4.js";import{_ as kt}from"../chunks/C1FmrZbK.js";import{p as st}from"../chunks/6XXKwe28.js";var Ot=pe('<main class="svelte-13sjxqj"><div class="viewer-container svelte-13sjxqj"><div id="viewer" class="svelte-13sjxqj"></div></div></main>');function Rt(ue,V){lt(V,!1);let I=`
ATOM      1  CH3 ACE     1       2.000   2.090   0.000
ATOM      2  C   ACE     1       3.427   2.641  -0.000
ATOM      3  O   ACE     1       4.391   1.877  -0.000
ATOM      4  N   ALA     2       3.555   3.970  -0.000
ATOM      5  CA  ALA     2       4.853   4.614  -0.000
ATOM     6  HA  ALA     2       5.408   4.316   0.890
ATOM     7  CB  ALA     2       5.661   4.221  -1.232
ATOM     8  C   ALA     2       4.713   6.129   0.000
ATOM     9  O   ALA     2       3.601   6.653   0.000
ATOM     10  N   NME     3       5.846   6.835   0.000
ATOM     11  H   NME     3       6.737   6.359  -0.000
ATOM     12  CH3 NME     3       5.846   8.284   0.000
TER   
END`,C=[6,7,8,9,10,11,12],D=4,k=5,ee=st(V,"angle",8,50),P=st(V,"phiAngle",8,0);function $(f){let h;Math.abs(f.z)>.9?h={x:0,y:f.z,z:-f.y}:h={x:-f.y,y:f.x,z:0};let g=Math.sqrt(h.x**2+h.y**2+h.z**2);return h.x/=g,h.y/=g,h.z/=g,h}function H(f,h,g,o,T){let U=T*Math.PI/180,q=Math.cos(U),y=Math.sin(U),b=1-q,M=[[q+o.x**2*b,o.x*o.y*b-o.z*y,o.x*o.z*b+o.y*y],[o.y*o.x*b+o.z*y,q+o.y**2*b,o.y*o.z*b-o.x*y],[o.z*o.x*b-o.y*y,o.z*o.y*b+o.x*y,q+o.z**2*b]];return h.forEach(O=>{let R=f[O-1],X=R.x-g.x,F=R.y-g.y,z=R.z-g.z,se=M[0][0]*X+M[0][1]*F+M[0][2]*z,le=M[1][0]*X+M[1][1]*F+M[1][2]*z,B=M[2][0]*X+M[2][1]*F+M[2][2]*z;R.x=se+g.x,R.y=le+g.y,R.z=B+g.z}),f}function N(f,h,g,o,T,U){let y=f.split(`
`).filter(z=>z.startsWith("ATOM")).map(z=>{let se=parseFloat(z.substring(30,38).trim()),le=parseFloat(z.substring(38,46).trim()),B=parseFloat(z.substring(46,54).trim());return{x:se,y:le,z:B,line:z}}),b=y[g-1],M=y[o-1],O={x:M.x-b.x,y:M.y-b.y,z:M.z-b.z},R=Math.sqrt(O.x**2+O.y**2+O.z**2);O.x/=R,O.y/=R,O.z/=R;let X=$(O);return y=H(y,h,b,O,T),y=H(y,h,b,X,U),y.forEach(z=>{z.line=z.line.substring(0,30)+z.x.toFixed(3).padStart(8)+z.y.toFixed(3).padStart(8)+z.z.toFixed(3).padStart(8)+z.line.substring(54)}),y.map(z=>z.line).join(`
`)+`
TER
END`}let j=E(),m=E(),Y=E();rt(async()=>{if(typeof window<"u")try{const{createViewer:f}=await kt(async()=>{const{createViewer:h}=await import("../chunks/kNyKxqkf.js").then(g=>g._);return{createViewer:h}},[],import.meta.url);console.log("3Dmol.js loaded successfully"),d(m,f(t(Y),{backgroundColor:"white"})),w(!0),window.addEventListener("resize",()=>{t(m)&&(t(m).resize(),t(m).render())})}catch(f){console.error("Failed to load 3Dmol.js:",f)}});function w(f=!0){t(m)&&(console.log("Updating viewer with angles:",ee(),P()),t(m).clear(),t(m).addModel(t(j),"pdb"),t(m).setStyle({},{stick:{radius:.2},sphere:{scale:.3}}),f&&t(m).zoomTo(),t(m).render())}K(()=>(Ke(ee()),Ke(P())),()=>{d(j,N(I,C,D,k,ee(),P()))}),K(()=>(t(m),t(j)),()=>{t(m)&&t(j)&&w(!1)}),it(),nt();var _=Ot(),i=r(_),te=r(i);ot(te,f=>d(Y,f),()=>t(Y)),c(i),c(_),ve(ue,_),at()}var Ft=pe(`<div class="game-ended-popup svelte-1os1z5x"><div class="popup-content svelte-1os1z5x"><h2 class="svelte-1os1z5x">Game Ended</h2> <p class="svelte-1os1z5x">You've used all your lives!</p> <p class="svelte-1os1z5x"> </p> <button class="svelte-1os1z5x">Play Again</button></div></div>`),Lt=pe('<button class="svelte-1os1z5x">Clear Samples</button>'),Dt=pe(`<main class="svelte-1os1z5x"><h1 class="svelte-1os1z5x">Protein Explorer</h1> <div class="live-bar-container svelte-1os1z5x"><div class="lives-label svelte-1os1z5x"> </div> <div class="live-bar svelte-1os1z5x"><div class="lives-remaining svelte-1os1z5x"></div> <span class="heart svelte-1os1z5x">❤️</span></div></div> <div class="score-bar-container svelte-1os1z5x"><div class="score-label svelte-1os1z5x">Score: <span id="score-percentage"> </span></div> <div class="score-bar svelte-1os1z5x"><div class="score-value svelte-1os1z5x" id="score-bar"></div> <span class="star svelte-1os1z5x" id="score-star">⭐</span></div></div> <!> <div class="level-container svelte-1os1z5x"><label for="level" class="level-label svelte-1os1z5x">Difficulty:</label> <select id="level" class="svelte-1os1z5x"><option>Level 1</option><option>Level 2</option><option>Level 3</option></select></div> <div class="container svelte-1os1z5x"><div class="panel svelte-1os1z5x"><h2 class="svelte-1os1z5x">Backbone Angles</h2>  <div class="molecule-visualization svelte-1os1z5x"><!></div> <div class="Other"><div class="control-panel svelte-1os1z5x"><div class="slider-container svelte-1os1z5x"><label for="angle" class="svelte-1os1z5x">Ψ Angle (degrees):</label> <input type="range" id="angle" min="0" max="360" step="1" class="svelte-1os1z5x"> <span class="svelte-1os1z5x"> </span></div> <div class="slider-container svelte-1os1z5x"><label for="phiAngle" class="svelte-1os1z5x">Φ Angle (degrees):</label> <input type="range" id="phiAngle" min="0" max="360" step="1" class="svelte-1os1z5x"> <span class="svelte-1os1z5x"> </span></div></div></div> <div class="info svelte-1os1z5x"><div class="instruction svelte-1os1z5x"><p class="svelte-1os1z5x">Rotating backbone angles changes the protein's shape, affecting its stability. Lower energy regions correspond to more stable conformations.</p> <div class="button-group svelte-1os1z5x"><button class="info-button svelte-1os1z5x"><span>Go back</span></button></div></div></div></div> <div class="panel svelte-1os1z5x"><h2 class="svelte-1os1z5x">Energy Landscape</h2> <div class="contour-container svelte-1os1z5x"><canvas></canvas></div> <div class="info svelte-1os1z5x"><div class="instruction svelte-1os1z5x"><p class="highlight svelte-1os1z5x">Your goal is to train an emulator that accurately predicts the energy function using as few protein simulator runs as possible.</p> <p class="svelte-1os1z5x">Click directly on the plot above to sample points. This will run the simulation and update the emulator model based on the simulator output.</p></div> <div class="button-group svelte-1os1z5x"><!> <button class="info-button svelte-1os1z5x"> </button></div></div></div></div></main>`);function Qt(ue,V){lt(V,!1);const I=E(),C=E(),D=E(),k=E();function ee(){window.location.href="https://alan-turing-institute.github.io/gp-demo/"}let P=E([]),$=[],H=E(),N=E(!1),j=E(!1),m=E(20),Y=E(!1);const w=400,_=400,i=40,te=w-2*i,f=Ve([0,360],[i,w-i]),h=Ve([0,360],[_-i,i]),g={primary:"#3c6382",accent:"#60a3bc",highlight:"#6a89cc",text:"#2c3e50"};let o=1/0,T=-1/0;function U(){const u=de(0,360,7.2).toArray(),n=de(0,360,360/50).toArray();for(const s of u)for(const a of n){const l=y(s,a);o=Math.min(o,l),T=Math.max(T,l)}o=Math.floor(o*10)/10,T=Math.ceil(T*10)/10,console.log(`Energy range: ${o} to ${T}`)}function q(e){return e*(Math.PI/180)}function y(e,u){const n=q(e)-Math.PI,s=q(u)-Math.PI,a=Math.exp(-((n+Math.PI/2)**2)-(s-Math.PI/2)**2/.5),l=Math.exp(-((n+Math.PI/2)**2)-(s+.5)**2/.3),v=Math.exp(-((n-Math.PI/2)**2)-(s+Math.PI/2)**2/.5),A=Math.exp(-((n-Math.PI/2)**2)-(s-.5)**2/.3),L=Math.exp(-((n-0)**2)/.3-(s-Math.PI/4)**2/.2);let S=0;return t(k)=="1"?S=a:t(k)=="2"?S=a+l:t(k)=="3"?S=a+l+v+A+L:console.error("Invalid difficulty level: ",t(k)),-Math.log(S+1e-6)}function b(){d(P,[]),$=[],F(),d(m,20),d(D,0)}function M(e){if(t(N)||t(m)<=0)return;const u=t(H).getBoundingClientRect(),n=e.clientX-u.left,s=e.clientY-u.top,a=Math.round(f.invert(n)),l=Math.round(h.invert(s));if(n>=i&&n<=w-i&&s>=i&&s<=_-i){d(I,a),d(C,l);const v=y(t(I),t(C));d(P,[...t(P),{phi:t(I),psi:t(C),energy:v}]),d(m,t(m)-1),t(m)===0&&d(Y,!0),X()}}function O(){d(m,20),d(D,0),d(P,[]),$=[],d(Y,!1),F()}function R(e,u){if(e.length!==u.length||e.length===0)throw new Error("Arrays must be of the same length and non-empty");const n=e.reduce((v,A)=>v+A,0)/e.length,s=e.reduce((v,A)=>v+Math.pow(A-n,2),0),l=1-e.reduce((v,A,L)=>v+Math.pow(A-u[L],2),0)/s;return Math.max(0,l)}function X(){d(N,!0);let e=[],u=[];if(t(P).length===0){d(N,!1),F();return}setTimeout(()=>{console.log("Updating GP model...");const n=t(P).map(x=>[x.phi,x.psi]),s=t(P).map(x=>x.energy),a=(x,W,re=1*(180/Math.PI))=>{const ce=Tt(Et(It(x,W),2));return Ct(-.5*ce/(re*re))},l=n.length,v=tt(l,l);for(let x=0;x<l;x++)for(let W=0;W<l;W++)v.set([x,W],a(n[x],n[W]));const A=.01;for(let x=0;x<l;x++)v.set([x,x],v.get([x,x])+A);const L=40,S=de(0,360,360/L).toArray(),ae=de(0,360,360/L).toArray();$=[];for(const x of S)for(const W of ae){const re=[x,W],ce=tt(1,l);for(let G=0;G<l;G++)ce.set([0,G],a(re,n[G]));try{const G=wt(v,s),Ze=Pt(ce,G).get([0,0]);$.push({phi:x,psi:W,predicted:Ze}),u.push(Ze),e.push(y(x,W))}catch(G){console.error("Error in GP calculation:",G)}}F(),d(D,R(e,u)),console.log("R2 Score: ",t(D)),d(N,!1)},50)}function F(){if(!t(H))return;const e=t(H).getContext("2d");e.clearRect(0,0,w+60,_);const u=Mt().domain([T,o]).interpolator(St);if(t(j)){const s=te/80;for(let a=0;a<80;a++)for(let l=0;l<80;l++){const v=0+360*a/80,A=0+360*l/80,L=y(v,A),S=f(v),ae=h(A);e.fillStyle=u(L),e.fillRect(S-s/2,ae-s/2,s,s)}}else if($.length===0){const s=te/80;for(let a=0;a<80;a++)for(let l=0;l<80;l++){const v=0+360*a/80,A=0+360*l/80,L=f(v),S=h(A);e.fillStyle=u(0),e.fillRect(L-s/2,S-s/2,s,s)}}else{const n=te/Math.sqrt($.length);$.forEach(s=>{const a=f(s.phi),l=h(s.psi);e.fillStyle=u(s.predicted),e.fillRect(a-n/2,l-n/2,n,n)})}z(e,u),e.strokeStyle=g.primary,e.lineWidth=2,e.beginPath(),e.moveTo(i,_-i),e.lineTo(w-i,_-i),e.moveTo(i,i),e.lineTo(i,_-i),e.stroke(),e.fillStyle=g.text,e.font="bold 14px Arial, sans-serif",e.textAlign="center",e.fillText("0",i,_-i+15),e.fillText("180",w/2,_-i+15),e.fillText("360",w-i,_-i+15),e.fillText("φ",w-i+10,_-i+25),e.textAlign="right",e.fillText("0",i-5,_-i),e.fillText("180",i-5,_/2),e.fillText("360",i-5,i),e.fillText("ψ",i-20,i-20),t(P).forEach(n=>{const s=f(n.phi),a=h(n.psi),l=8,v=e.createRadialGradient(s,a,2,s,a,l);v.addColorStop(0,g.highlight),v.addColorStop(1,"rgba(106, 137, 204, 0)"),e.fillStyle=v,e.beginPath(),e.arc(s,a,l,0,2*Math.PI),e.fill(),e.fillStyle=g.accent,e.beginPath(),e.arc(s,a,4,0,2*Math.PI),e.fill(),e.strokeStyle=g.primary,e.lineWidth=1,e.stroke()})}function z(e,u){const s=_-2*i,a=w-i+20,l=i,v=100,A=s/v;for(let S=0;S<v;S++){const ae=o+(T-o)*(v-S-1)/v;e.fillStyle=u(ae),e.fillRect(a,l+S*A,20,A+1)}e.strokeStyle=g.text,e.lineWidth=1,e.strokeRect(a,l,20,s),e.fillStyle=g.text,e.font="12px Arial, sans-serif",e.textAlign="left",e.fillText(o.toFixed(1),a+20+5,l+s),e.fillText(T.toFixed(1),a+20+5,l);const L=(o+T)/2;e.fillText(L.toFixed(1),a+20+5,l+s/2),e.save(),e.translate(a+20+25,l+s/2),e.rotate(-Math.PI/2),e.textAlign="center",e.fillText("Energy",0,10),e.restore()}function se(){d(j,!t(j)),F()}rt(()=>{U(),F()});function le(e){d(k,e.target.value),t(j)&&F(),console.log("Difficulty level set to: ",t(k))}K(()=>{},()=>{d(I,0)}),K(()=>{},()=>{d(C,0)}),K(()=>{},()=>{d(D,0)}),K(()=>(t(I),t(C)),()=>{}),K(()=>{},()=>{d(k,"3")}),it(),nt();var B=Dt(),fe=p(r(B),2),he=r(fe),ct=r(he);c(he);var Ee=p(he,2),Ie=r(Ee),dt=p(Ie,2);c(Ee),c(fe);var ge=p(fe,2),xe=r(ge),Ce=p(r(xe)),vt=r(Ce);c(Ce),c(xe);var ke=p(xe,2),Oe=r(ke),pt=p(Oe,2);c(ke),c(ge);var Re=p(ge,2);{var ut=e=>{var u=Ft(),n=r(u),s=p(r(n),4),a=r(s);c(s);var l=p(s,2);c(n),c(u),Te(v=>Q(a,`Final score: ${v??""}%`),[()=>(t(D)*100).toFixed(0)],Ue),J("click",l,O),ve(e,u)};Je(Re,e=>{t(Y)&&e(ut)})}var me=p(Re,2),oe=p(r(me),2);Te(()=>{t(k),yt(()=>{})});var ze=r(oe);ze.value=(ze.__value="1")==null?"":"1";var ye=p(ze);ye.value=(ye.__value="2")==null?"":"2";var Fe=p(ye);Fe.value=(Fe.__value="3")==null?"":"3",c(oe),c(me);var Le=p(me,2),_e=r(Le),ne=p(r(_e),2);Z(ne,"style",`width: ${w}px; height: ${_}px;`);var ft=r(ne);Rt(ft,{get angle(){return t(I)},set angle(e){d(I,e)},get phiAngle(){return t(C)},set phiAngle(e){d(C,e)},$$legacy:!0}),c(ne);var be=p(ne,2),De=r(be),Ae=r(De),Me=p(r(Ae),2);Qe(Me);var je=p(Me,2),ht=r(je);c(je),c(Ae);var We=p(Ae,2),Se=p(r(We),2);Qe(Se);var $e=p(Se,2),gt=r($e);c($e),c(We),c(De),c(be);var He=p(be,2),qe=r(He),Ge=p(r(qe),2),xt=r(Ge);c(Ge),c(qe),c(He),c(_e);var Ne=p(_e,2),we=p(r(Ne),2),ie=r(we);Z(ie,"width",w+60),Z(ie,"height",_),ot(ie,e=>d(H,e),()=>t(H)),c(we);var Ye=p(we,2),Xe=p(r(Ye),2),Be=r(Xe);{var mt=e=>{var u=Lt();J("click",u,b),ve(e,u)};Je(Be,e=>{t(P).length>0&&e(mt)})}var Pe=p(Be,2),zt=r(Pe,!0);c(Pe),c(Xe),c(Ye),c(Ne),c(Le),c(B),Te((e,u)=>{Q(ct,`Lives ${t(m)??""}/20`),Z(Ie,"style",`width: ${e??""}%`),Z(dt,"style",`left: ${e??""}%`),Q(vt,`${u??""}%`),Z(Oe,"style",`width: ${t(D)*100}%`),Z(pt,"style",`left: ${t(D)*100}%`),Q(ht,`${t(C)??""}°`),Q(gt,`${t(I)??""}°`),_t(ie,1,bt(t(N)?"loading":""),"svelte-1os1z5x"),Q(zt,t(j)?"Show Emulator Prediction":"Show Simulator Function")},[()=>Math.max(0,t(m)/20*100),()=>(t(D)*100).toFixed(0)],Ue),At(oe,()=>t(k),e=>d(k,e)),J("change",oe,le),et(Me,()=>t(C),e=>d(C,e)),et(Se,()=>t(I),e=>d(I,e)),J("click",xt,ee),J("click",ie,M),J("click",Pe,se),ve(ue,B),at()}export{Qt as component};
