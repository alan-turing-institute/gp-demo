import{t as de,a as ce}from"../chunks/cGtBC6Qd.js";import"../chunks/7LKkzqbz.js";import{a4 as Ke,aa as Q,ab as Ue,a5 as Je,a6 as v,a1 as h,ac as E,e as t,Z as je,a7 as f,a9 as Ne,s as p,i as ft,aw as ht,a8 as pt}from"../chunks/BJ4irGt7.js";import{e as ae,s as K}from"../chunks/CvaqDwXv.js";import{i as He}from"../chunks/lIaEYNz1.js";import{s as J,r as $e}from"../chunks/B9r3SdpA.js";import{l as Be,s as gt,c as ut}from"../chunks/dhIx7U5O.js";import{b as yt,a as Xe}from"../chunks/RvGyPHbW.js";import{b as qe}from"../chunks/CUY-1DrG.js";import{i as Qe}from"../chunks/CkfO92w8.js";import{o as Ve}from"../chunks/Cpzjerpz.js";import{r as re,s as bt,v as mt,z as Ye,l as _t,m as xt,a as At,d as St,b as Mt,e as zt}from"../chunks/PBAI84v4.js";import{_ as qt}from"../chunks/C1FmrZbK.js";import{p as Ze}from"../chunks/6XXKwe28.js";var Pt=de('<main class="svelte-13sjxqj"><div class="viewer-container svelte-13sjxqj"><div id="viewer" class="svelte-13sjxqj"></div></div></main>');function Tt(ve,V){Ke(V,!1);let z=`
ATOM      1  CH3 ACE     1       2.000   2.090   0.000
ATOM      2  C   ACE     1       3.427   2.641  -0.000
ATOM      3  O   ACE     1       4.391   1.877  -0.000
ATOM      4  N   ALA     2       3.555   3.970  -0.000
ATOM      5  CA  ALA     2       4.853   4.614  -0.000
ATOM     6  HA  ALA     2       5.408   4.316   0.890
ATOM     7  CB  ALA     2       5.661   4.221  -1.232
ATOM     8  C   ALA     2       4.713   6.129   0.000
ATOM     9  O   ALA     2       3.601   6.653   0.000
ATOM     10  N   NME     3       5.846   6.835   0.000
ATOM     11  H   NME     3       6.737   6.359  -0.000
ATOM     12  CH3 NME     3       5.846   8.284   0.000
TER   
END`,q=[6,7,8,9,10,11,12],k=4,I=5,L=Ze(V,"angle",8,50),G=Ze(V,"phiAngle",8,0);function $(u){let n;Math.abs(u.z)>.9?n={x:0,y:u.z,z:-u.y}:n={x:-u.y,y:u.x,z:0};let g=Math.sqrt(n.x**2+n.y**2+n.z**2);return n.x/=g,n.y/=g,n.z/=g,n}function D(u,n,g,d,ee){let W=ee*Math.PI/180,F=Math.cos(W),A=Math.sin(W),S=1-F,T=[[F+d.x**2*S,d.x*d.y*S-d.z*A,d.x*d.z*S+d.y*A],[d.y*d.x*S+d.z*A,F+d.y**2*S,d.y*d.z*S-d.x*A],[d.z*d.x*S-d.y*A,d.z*d.y*S+d.x*A,F+d.z**2*S]];return n.forEach(R=>{let x=u[R-1],X=x.x-g.x,N=x.y-g.y,m=x.z-g.z,te=T[0][0]*X+T[0][1]*N+T[0][2]*m,Y=T[1][0]*X+T[1][1]*N+T[1][2]*m,Z=T[2][0]*X+T[2][1]*N+T[2][2]*m;x.x=te+g.x,x.y=Y+g.y,x.z=Z+g.z}),u}function j(u,n,g,d,ee,W){let A=u.split(`
`).filter(m=>m.startsWith("ATOM")).map(m=>{let te=parseFloat(m.substring(30,38).trim()),Y=parseFloat(m.substring(38,46).trim()),Z=parseFloat(m.substring(46,54).trim());return{x:te,y:Y,z:Z,line:m}}),S=A[g-1],T=A[d-1],R={x:T.x-S.x,y:T.y-S.y,z:T.z-S.z},x=Math.sqrt(R.x**2+R.y**2+R.z**2);R.x/=x,R.y/=x,R.z/=x;let X=$(R);return A=D(A,n,S,R,ee),A=D(A,n,S,X,W),A.forEach(m=>{m.line=m.line.substring(0,30)+m.x.toFixed(3).padStart(8)+m.y.toFixed(3).padStart(8)+m.z.toFixed(3).padStart(8)+m.line.substring(54)}),A.map(m=>m.line).join(`
`)+`
TER
END`}let O=E(),P=E(),_=E();Ve(async()=>{if(typeof window<"u")try{const{createViewer:u}=await qt(async()=>{const{createViewer:n}=await import("../chunks/kNyKxqkf.js").then(g=>g._);return{createViewer:n}},[],import.meta.url);console.log("3Dmol.js loaded successfully"),h(P,u(t(_),{backgroundColor:"white"})),b(!0),window.addEventListener("resize",()=>{t(P)&&(t(P).resize(),t(P).render())})}catch(u){console.error("Failed to load 3Dmol.js:",u)}});function b(u=!0){t(P)&&(console.log("Updating viewer with angles:",L(),G()),t(P).clear(),t(P).addModel(t(O),"pdb"),t(P).setStyle({},{stick:{radius:.2},sphere:{scale:.3}}),u&&t(P).zoomTo(),t(P).render())}Q(()=>(je(L()),je(G())),()=>{h(O,j(z,q,k,I,L(),G()))}),Q(()=>(t(P),t(O)),()=>{t(P)&&t(O)&&b(!1)}),Ue(),Qe();var s=Pt(),U=v(s),B=v(U);qe(B,u=>h(_,u),()=>t(_)),f(U),f(s),ce(ve,s),Je()}var Ct=de(`<div class="game-ended-popup svelte-lfhv9q"><div class="popup-content svelte-lfhv9q"><h2 class="svelte-lfhv9q">Game Ended</h2> <p class="svelte-lfhv9q">You've used all your lives!</p> <button class="svelte-lfhv9q">Play Again</button></div></div>`),wt=de('<button class="svelte-lfhv9q">Clear Samples</button>'),Et=de('<main class="svelte-lfhv9q"><h1 class="svelte-lfhv9q">Protein Backbone Conformation Explorer</h1> <div class="live-bar-container svelte-lfhv9q"><div class="lives-label svelte-lfhv9q"> </div> <div class="live-bar svelte-lfhv9q"><div class="lives-remaining svelte-lfhv9q"></div> <span class="heart svelte-lfhv9q">❤️</span></div></div> <!> <div class="level-container svelte-lfhv9q"><label for="level" class="level-label svelte-lfhv9q">Difficulty:</label> <select id="level" class="svelte-lfhv9q"><option>Level 1</option><option>Level 2</option><option>Level 3</option></select></div> <div class="container svelte-lfhv9q"><div class="panel svelte-lfhv9q"><h2 class="svelte-lfhv9q">Backbone Angles</h2> <canvas class="svelte-lfhv9q"></canvas> <div class="Other"><div class="control-panel svelte-lfhv9q"><div class="slider-container svelte-lfhv9q"><label for="angle" class="svelte-lfhv9q">Psi Angle (degrees):</label> <input type="range" id="angle" min="0" max="360" step="1" class="svelte-lfhv9q"> <span class="svelte-lfhv9q"> </span></div> <div class="slider-container svelte-lfhv9q"><label for="phiAngle" class="svelte-lfhv9q">Phi Angle (degrees):</label> <input type="range" id="phiAngle" min="0" max="360" step="1" class="svelte-lfhv9q"> <span class="svelte-lfhv9q"> </span></div></div> <!></div></div> <div class="panel svelte-lfhv9q"><h2 class="svelte-lfhv9q">Energy Landscape</h2> <div class="contour-container svelte-lfhv9q"><canvas></canvas></div> <div class="info svelte-lfhv9q"><p class="svelte-lfhv9q"> </p> <p class="svelte-lfhv9q"> </p> <div class="instruction svelte-lfhv9q"><p class="highlight svelte-lfhv9q">Click on the plot above to add sample points and update the GP model</p></div> <div class="button-group svelte-lfhv9q"><!> <button class="info-button svelte-lfhv9q"> </button></div> <div class="energy-function svelte-lfhv9q"><h3 class="svelte-lfhv9q">About the Visualization:</h3> <p class="svelte-lfhv9q"> </p> <p class="svelte-lfhv9q">The energy function represents different stable conformations of the protein backbone. Lighter regions indicate lower energy (more stable conformations).</p> <p class="svelte-lfhv9q">Click directly on the plot to add sample points and build a GP model that learns this energy landscape.</p></div></div></div></div></main>');function Xt(ve,V){Ke(V,!1);const z=E(),q=E(),k=E();let I=E([]),L=[],G=E(),$=E(),D=E(!1),j=E(!1),O=E(20),P=E(!1);const _=400,b=400,s=40,U=_-2*s,B=Be([0,360],[s,_-s]),u=Be([0,360],[b-s,s]),n={primary:"#3c6382",secondary:"#82ccdd",accent:"#60a3bc",highlight:"#6a89cc",text:"#2c3e50",bond1:"#38ada9",bond2:"#6a89cc",atom1:"#3c6382",atom2:"#60a3bc",atom3:"#82ccdd",atom4:"#38ada9"};let g=1/0,d=-1/0;function ee(){const o=re(0,360,7.2).toArray(),i=re(0,360,360/50).toArray();for(const l of o)for(const r of i){const c=F(l,r);g=Math.min(g,c),d=Math.max(d,c)}g=Math.floor(g*10)/10,d=Math.ceil(d*10)/10,console.log(`Energy range: ${g} to ${d}`)}function W(e){return e*(Math.PI/180)}function F(e,o){const i=W(e)-Math.PI,l=W(o)-Math.PI,r=Math.exp(-((i+Math.PI/2)**2)-(l-Math.PI/2)**2/.5),c=Math.exp(-((i+Math.PI/2)**2)-(l+.5)**2/.3),y=Math.exp(-((i-Math.PI/2)**2)-(l+Math.PI/2)**2/.5),C=Math.exp(-((i-Math.PI/2)**2)-(l-.5)**2/.3),w=Math.exp(-((i-0)**2)/.3-(l-Math.PI/4)**2/.2);let a=0;return t(k)=="1"?a=r:t(k)=="2"?a=r+c:t(k)=="3"?a=r+c+y+C+w:console.error("Invalid difficulty level: ",t(k)),-Math.log(a+1e-6)}function A(){h(I,[]),L=[],x()}function S(e){if(t(D)||t(O)<=0)return;const o=t($).getBoundingClientRect(),i=e.clientX-o.left,l=e.clientY-o.top,r=Math.round(B.invert(i)),c=Math.round(u.invert(l));if(i>=s&&i<=_-s&&l>=s&&l<=b-s){h(z,r),h(q,c);const y=F(t(z),t(q));h(I,[...t(I),{phi:t(z),psi:t(q),energy:y}]),h(O,t(O)-1),t(O)===0&&h(P,!0),R(),N()}}function T(){h(O,20),h(I,[]),L=[],h(P,!1),x()}function R(){if(h(D,!0),t(I).length===0){h(D,!1),x();return}setTimeout(()=>{const e=t(I).map(a=>[a.phi,a.psi]),o=t(I).map(a=>a.energy),i=(a,M,ne=1*(180/Math.PI))=>{const oe=At(St(Mt(a,M),2));return zt(-.5*oe/(ne*ne))},l=e.length,r=Ye(l,l);for(let a=0;a<l;a++)for(let M=0;M<l;M++)r.set([a,M],i(e[a],e[M]));const c=.01;for(let a=0;a<l;a++)r.set([a,a],r.get([a,a])+c);const y=40,C=re(0,360,360/y).toArray(),w=re(0,360,360/y).toArray();L=[];for(const a of C)for(const M of w){const ne=[a,M],oe=Ye(1,l);for(let H=0;H<l;H++)oe.set([0,H],i(ne,e[H]));try{const H=_t(r,o),vt=xt(oe,H).get([0,0]);L.push({phi:a,psi:M,predicted:vt})}catch(H){console.error("Error in GP calculation:",H)}}x(),h(D,!1)},50)}function x(){if(!t($))return;const e=t($).getContext("2d");e.clearRect(0,0,_+60,b);const o=bt().domain([d,g]).interpolator(mt);if(t(j)){const l=U/80;for(let r=0;r<80;r++)for(let c=0;c<80;c++){const y=0+360*r/80,C=0+360*c/80,w=F(y,C),a=B(y),M=u(C);e.fillStyle=o(w),e.fillRect(a-l/2,M-l/2,l,l)}}else if(L.length===0){const l=U/80;for(let r=0;r<80;r++)for(let c=0;c<80;c++){const y=0+360*r/80,C=0+360*c/80,w=B(y),a=u(C);e.fillStyle=o(0),e.fillRect(w-l/2,a-l/2,l,l)}}else{const i=U/Math.sqrt(L.length);L.forEach(l=>{const r=B(l.phi),c=u(l.psi);e.fillStyle=o(l.predicted),e.fillRect(r-i/2,c-i/2,i,i)})}X(e,o),e.strokeStyle=n.primary,e.lineWidth=2,e.beginPath(),e.moveTo(s,b-s),e.lineTo(_-s,b-s),e.moveTo(s,s),e.lineTo(s,b-s),e.stroke(),e.fillStyle=n.text,e.font="bold 14px Arial, sans-serif",e.textAlign="center",e.fillText("0",s,b-s+15),e.fillText("180",_/2,b-s+15),e.fillText("360",_-s,b-s+15),e.fillText("φ",_-s+10,b-s+25),e.textAlign="right",e.fillText("0",s-5,b-s),e.fillText("180",s-5,b/2),e.fillText("360",s-5,s),e.fillText("ψ",s-20,s-20),t(I).forEach(i=>{const l=B(i.phi),r=u(i.psi),c=8,y=e.createRadialGradient(l,r,2,l,r,c);y.addColorStop(0,n.highlight),y.addColorStop(1,"rgba(106, 137, 204, 0)"),e.fillStyle=y,e.beginPath(),e.arc(l,r,c,0,2*Math.PI),e.fill(),e.fillStyle=n.accent,e.beginPath(),e.arc(l,r,4,0,2*Math.PI),e.fill(),e.strokeStyle=n.primary,e.lineWidth=1,e.stroke()})}function X(e,o){const l=b-2*s,r=_-s+20,c=s,y=100,C=l/y;for(let a=0;a<y;a++){const M=g+(d-g)*(y-a-1)/y;e.fillStyle=o(M),e.fillRect(r,c+a*C,20,C+1)}e.strokeStyle=n.text,e.lineWidth=1,e.strokeRect(r,c,20,l),e.fillStyle=n.text,e.font="12px Arial, sans-serif",e.textAlign="left",e.fillText(g.toFixed(1),r+20+5,c+l),e.fillText(d.toFixed(1),r+20+5,c);const w=(g+d)/2;e.fillText(w.toFixed(1),r+20+5,c+l/2),e.save(),e.translate(r+20+25,c+l/2),e.rotate(-Math.PI/2),e.textAlign="center",e.fillText("Energy",0,10),e.restore()}function N(){if(!t(G))return;const e=t(G).getContext("2d");e.clearRect(0,0,_,b);const o=_/2,i=b/2,l=120,r=e.createRadialGradient(o,i,0,o,i,l*1.5);r.addColorStop(0,"rgba(60, 99, 130, 0.1)"),r.addColorStop(1,"rgba(245, 246, 250, 0.05)"),e.fillStyle=r,e.fillRect(0,0,_,b);const c=e.createLinearGradient(o-l,i,o+l,i);c.addColorStop(0,n.secondary),c.addColorStop(.5,n.primary),c.addColorStop(1,n.secondary),e.strokeStyle=c,e.lineWidth=3,e.beginPath(),e.moveTo(o-l,i),e.lineTo(o+l,i),e.stroke();const y=[{x:o-l,y:i,color:n.atom1,label:"N",size:24},{x:o-l/2,y:i,color:n.atom2,label:"Cα",size:26},{x:o,y:i,color:n.atom3,label:"C",size:24},{x:o+l/2,y:i,color:n.atom4,label:"O",size:24},{x:o+l,y:i,color:n.atom1,label:"N",size:24}];e.save(),e.translate(o-l/2,i),e.rotate(W(t(z)));const C=e.createLinearGradient(0,0,0,-60);C.addColorStop(0,n.bond1),C.addColorStop(1,n.secondary),e.strokeStyle=C,e.lineWidth=3,e.beginPath(),e.moveTo(0,0),e.lineTo(0,-60),e.stroke(),e.fillStyle=n.text,e.font="bold 14px Arial, sans-serif",e.fillText("φ = "+t(z).toFixed(0),5,-30),e.restore(),e.save(),e.translate(o,i),e.rotate(W(t(q)));const w=e.createLinearGradient(0,0,0,-60);w.addColorStop(0,n.bond2),w.addColorStop(1,n.highlight),e.strokeStyle=w,e.lineWidth=3,e.beginPath(),e.moveTo(0,0),e.lineTo(0,-60),e.stroke(),e.fillStyle=n.text,e.font="bold 14px Arial, sans-serif",e.fillText("ψ = "+t(q).toFixed(0),5,-30),e.restore(),y.forEach(a=>{const M=e.createRadialGradient(a.x,a.y,0,a.x,a.y,a.size*1.2);M.addColorStop(0,a.color),M.addColorStop(1,"rgba(255, 255, 255, 0)"),e.fillStyle=M,e.beginPath(),e.arc(a.x,a.y,a.size*1.2,0,2*Math.PI),e.fill(),e.fillStyle=a.color,e.beginPath(),e.arc(a.x,a.y,a.size,0,2*Math.PI),e.fill(),e.fillStyle="#fff",e.font="bold 14px Arial, sans-serif",e.textAlign="center",e.textBaseline="middle",e.fillText(a.label,a.x,a.y)})}function m(){h(j,!t(j)),x()}Ve(()=>{ee(),N(),x()});function te(e){h(k,e.target.value),t(j)&&x(),console.log("Difficulty level set to: ",t(k))}Q(()=>{},()=>{h(z,0)}),Q(()=>{},()=>{h(q,0)}),Q(()=>(t(G),t(z),t(q)),()=>{t(G)&&(t(z)||t(q))&&N()}),Q(()=>{},()=>{h(k,"3")}),Ue(),Qe();var Y=Et(),Z=p(v(Y),2),fe=v(Z),et=v(fe);f(fe);var Pe=p(fe,2),Te=v(Pe),tt=p(Te,2);f(Pe),f(Z);var Ce=p(Z,2);{var lt=e=>{var o=Ct(),i=v(o),l=p(v(i),4);f(i),f(o),ae("click",l,T),ce(e,o)};He(Ce,e=>{t(P)&&e(lt)})}var he=p(Ce,2),ie=p(v(he),2);Ne(()=>{t(k),ht(()=>{})});var pe=v(ie);pe.value=(pe.__value="1")==null?"":"1";var ge=p(pe);ge.value=(ge.__value="2")==null?"":"2";var we=p(ge);we.value=(we.__value="3")==null?"":"3",f(ie),f(he);var Ee=p(he,2),ue=v(Ee),se=p(v(ue),2);J(se,"width",_),J(se,"height",b),qe(se,e=>h(G,e),()=>t(G));var ke=p(se,2),ye=v(ke),be=v(ye),me=p(v(be),2);$e(me);var Ie=p(me,2),at=v(Ie);f(Ie),f(be);var Oe=p(be,2),_e=p(v(Oe),2);$e(_e);var Re=p(_e,2),it=v(Re);f(Re),f(Oe),f(ye);var st=p(ye,2);Tt(st,{get angle(){return t(z)},set angle(e){h(z,e)},get phiAngle(){return t(q)},set phiAngle(e){h(q,e)},$$legacy:!0}),f(ke),f(ue);var Le=p(ue,2),xe=p(v(Le),2),le=v(xe);J(le,"width",_+60),J(le,"height",b),qe(le,e=>h($,e),()=>t($)),f(xe);var Ge=p(xe,2),Ae=v(Ge),nt=v(Ae);f(Ae);var Se=p(Ae,2),ot=v(Se);f(Se);var Me=p(Se,4),Fe=v(Me);{var rt=e=>{var o=wt();ae("click",o,A),ce(e,o)};He(Fe,e=>{t(I).length>0&&e(rt)})}var ze=p(Fe,2),ct=v(ze,!0);f(ze),f(Me);var We=p(Me,2),De=p(v(We),2),dt=v(De,!0);f(De),pt(4),f(We),f(Ge),f(Le),f(Ee),f(Y),Ne((e,o)=>{K(et,`Lives ${t(O)??""}/20`),J(Te,"style",`width: ${e??""}%`),J(tt,"style",`left: ${e??""}%`),K(at,`${t(q)??""}°`),K(it,`${t(z)??""}°`),gt(le,1,ut(t(D)?"loading":""),"svelte-lfhv9q"),K(nt,`Samples: ${t(I).length??""}`),K(ot,`Current energy: ${o??""}`),K(ct,t(j)?"Show GP Prediction":"Show Energy Function"),K(dt,t(j)?"Showing actual energy function":"Showing Gaussian Process prediction")},[()=>Math.max(0,t(O)/20*100),()=>F(t(z),t(q)).toFixed(2)],ft),yt(ie,()=>t(k),e=>h(k,e)),ae("change",ie,te),Xe(me,()=>t(q),e=>h(q,e)),Xe(_e,()=>t(z),e=>h(z,e)),ae("click",le,S),ae("click",ze,m),ce(ve,Y),Je()}export{Xt as component};
