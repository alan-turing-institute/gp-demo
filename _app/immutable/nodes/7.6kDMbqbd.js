import{t as pe,a as ve}from"../chunks/cGtBC6Qd.js";import"../chunks/7LKkzqbz.js";import{a4 as tt,aa as J,ab as st,a5 as lt,a6 as r,a1 as d,ac as k,e as t,Z as Be,a7 as c,a9 as we,s as f,i as Ze,aw as zt,a8 as yt}from"../chunks/BJ4irGt7.js";import{e as ie,s as G}from"../chunks/CvaqDwXv.js";import{i as Ke}from"../chunks/lIaEYNz1.js";import{s as U,r as Ue}from"../chunks/B9r3SdpA.js";import{l as Je,s as _t,c as bt}from"../chunks/dhIx7U5O.js";import{b as At,a as Qe}from"../chunks/RvGyPHbW.js";import{b as at}from"../chunks/CUY-1DrG.js";import{i as it}from"../chunks/CkfO92w8.js";import{o as ot}from"../chunks/Cpzjerpz.js";import{r as de,s as Mt,v as St,z as Ve,l as Pt,m as Tt,a as wt,d as Et,b as Ct,e as It}from"../chunks/PBAI84v4.js";import{_ as kt}from"../chunks/C1FmrZbK.js";import{p as et}from"../chunks/6XXKwe28.js";var Ot=pe('<main class="svelte-13sjxqj"><div class="viewer-container svelte-13sjxqj"><div id="viewer" class="svelte-13sjxqj"></div></div></main>');function Rt(fe,ee){tt(ee,!1);let w=`
ATOM      1  CH3 ACE     1       2.000   2.090   0.000
ATOM      2  C   ACE     1       3.427   2.641  -0.000
ATOM      3  O   ACE     1       4.391   1.877  -0.000
ATOM      4  N   ALA     2       3.555   3.970  -0.000
ATOM      5  CA  ALA     2       4.853   4.614  -0.000
ATOM     6  HA  ALA     2       5.408   4.316   0.890
ATOM     7  CB  ALA     2       5.661   4.221  -1.232
ATOM     8  C   ALA     2       4.713   6.129   0.000
ATOM     9  O   ALA     2       3.601   6.653   0.000
ATOM     10  N   NME     3       5.846   6.835   0.000
ATOM     11  H   NME     3       6.737   6.359  -0.000
ATOM     12  CH3 NME     3       5.846   8.284   0.000
TER   
END`,E=[6,7,8,9,10,11,12],D=4,O=5,T=et(ee,"angle",8,50),$=et(ee,"phiAngle",8,0);function N(u){let g;Math.abs(u.z)>.9?g={x:0,y:u.z,z:-u.y}:g={x:-u.y,y:u.x,z:0};let h=Math.sqrt(g.x**2+g.y**2+g.z**2);return g.x/=h,g.y/=h,g.z/=h,g}function q(u,g,h,n,te){let B=te*Math.PI/180,j=Math.cos(B),y=Math.sin(B),_=1-j,S=[[j+n.x**2*_,n.x*n.y*_-n.z*y,n.x*n.z*_+n.y*y],[n.y*n.x*_+n.z*y,j+n.y**2*_,n.y*n.z*_-n.x*y],[n.z*n.x*_-n.y*y,n.z*n.y*_+n.x*y,j+n.z**2*_]];return g.forEach(R=>{let F=u[R-1],I=F.x-h.x,V=F.y-h.y,m=F.z-h.z,se=S[0][0]*I+S[0][1]*V+S[0][2]*m,Z=S[1][0]*I+S[1][1]*V+S[1][2]*m,K=S[2][0]*I+S[2][1]*V+S[2][2]*m;F.x=se+h.x,F.y=Z+h.y,F.z=K+h.z}),u}function Y(u,g,h,n,te,B){let y=u.split(`
`).filter(m=>m.startsWith("ATOM")).map(m=>{let se=parseFloat(m.substring(30,38).trim()),Z=parseFloat(m.substring(38,46).trim()),K=parseFloat(m.substring(46,54).trim());return{x:se,y:Z,z:K,line:m}}),_=y[h-1],S=y[n-1],R={x:S.x-_.x,y:S.y-_.y,z:S.z-_.z},F=Math.sqrt(R.x**2+R.y**2+R.z**2);R.x/=F,R.y/=F,R.z/=F;let I=N(R);return y=q(y,g,_,R,te),y=q(y,g,_,I,B),y.forEach(m=>{m.line=m.line.substring(0,30)+m.x.toFixed(3).padStart(8)+m.y.toFixed(3).padStart(8)+m.z.toFixed(3).padStart(8)+m.line.substring(54)}),y.map(m=>m.line).join(`
`)+`
TER
END`}let C=k(),A=k(),M=k();ot(async()=>{if(typeof window<"u")try{const{createViewer:u}=await kt(async()=>{const{createViewer:g}=await import("../chunks/kNyKxqkf.js").then(h=>h._);return{createViewer:g}},[],import.meta.url);console.log("3Dmol.js loaded successfully"),d(A,u(t(M),{backgroundColor:"white"})),z(!0),window.addEventListener("resize",()=>{t(A)&&(t(A).resize(),t(A).render())})}catch(u){console.error("Failed to load 3Dmol.js:",u)}});function z(u=!0){t(A)&&(console.log("Updating viewer with angles:",T(),$()),t(A).clear(),t(A).addModel(t(C),"pdb"),t(A).setStyle({},{stick:{radius:.2},sphere:{scale:.3}}),u&&t(A).zoomTo(),t(A).render())}J(()=>(Be(T()),Be($())),()=>{d(C,Y(w,E,D,O,T(),$()))}),J(()=>(t(A),t(C)),()=>{t(A)&&t(C)&&z(!1)}),st(),it();var a=Ot(),Q=r(a),X=r(Q);at(X,u=>d(M,u),()=>t(M)),c(Q),c(a),ve(fe,a),lt()}var Ft=pe(`<div class="game-ended-popup svelte-1os1z5x"><div class="popup-content svelte-1os1z5x"><h2 class="svelte-1os1z5x">Game Ended</h2> <p class="svelte-1os1z5x">You've used all your lives!</p> <p class="svelte-1os1z5x"> </p> <button class="svelte-1os1z5x">Play Again</button></div></div>`),Lt=pe('<button class="svelte-1os1z5x">Clear Samples</button>'),Dt=pe('<main class="svelte-1os1z5x"><h1 class="svelte-1os1z5x">Protein Explorer</h1> <div class="live-bar-container svelte-1os1z5x"><div class="lives-label svelte-1os1z5x"> </div> <div class="live-bar svelte-1os1z5x"><div class="lives-remaining svelte-1os1z5x"></div> <span class="heart svelte-1os1z5x">❤️</span></div></div> <div class="score-bar-container svelte-1os1z5x"><div class="score-label svelte-1os1z5x">Score: <span id="score-percentage"> </span></div> <div class="score-bar svelte-1os1z5x"><div class="score-value svelte-1os1z5x" id="score-bar"></div> <span class="star svelte-1os1z5x" id="score-star">⭐</span></div></div> <!> <div class="level-container svelte-1os1z5x"><label for="level" class="level-label svelte-1os1z5x">Difficulty:</label> <select id="level" class="svelte-1os1z5x"><option>Level 1</option><option>Level 2</option><option>Level 3</option></select></div> <div class="container svelte-1os1z5x"><div class="panel svelte-1os1z5x"><h2 class="svelte-1os1z5x">Backbone Angles</h2>  <div class="molecule-visualization svelte-1os1z5x"><!></div> <div class="Other"><div class="control-panel svelte-1os1z5x"><div class="slider-container svelte-1os1z5x"><label for="angle" class="svelte-1os1z5x">Ψ Angle (degrees):</label> <input type="range" id="angle" min="0" max="360" step="1" class="svelte-1os1z5x"> <span class="svelte-1os1z5x"> </span></div> <div class="slider-container svelte-1os1z5x"><label for="phiAngle" class="svelte-1os1z5x">Φ Angle (degrees):</label> <input type="range" id="phiAngle" min="0" max="360" step="1" class="svelte-1os1z5x"> <span class="svelte-1os1z5x"> </span></div></div></div></div> <div class="panel svelte-1os1z5x"><h2 class="svelte-1os1z5x">Energy Landscape</h2> <div class="contour-container svelte-1os1z5x"><canvas></canvas></div> <div class="info svelte-1os1z5x"><p class="svelte-1os1z5x"> </p> <p class="svelte-1os1z5x"> </p> <div class="instruction svelte-1os1z5x"><p class="highlight svelte-1os1z5x">Your goal is to train an accurate emulator using as few simulator runs as possible.</p> <p class="svelte-1os1z5x">Click directly on the plot above to sample points. This will run the simulation and update the emulator model based on the simulator output.</p></div> <div class="button-group svelte-1os1z5x"><!> <button class="info-button svelte-1os1z5x"> </button></div> <div class="energy-function svelte-1os1z5x"><h3 class="svelte-1os1z5x">About the Visualization:</h3> <p class="svelte-1os1z5x">The energy function represents different stable conformations of the protein backbone. Lighter regions indicate more stable conformations (lower energy).</p></div></div></div></div></main>');function Qt(fe,ee){tt(ee,!1);const w=k(),E=k(),D=k(),O=k();let T=k([]),$=[],N=k(),q=k(!1),Y=k(!1),C=k(20),A=k(!1);const M=400,z=400,a=40,Q=M-2*a,X=Je([0,360],[a,M-a]),u=Je([0,360],[z-a,a]),g={primary:"#3c6382",accent:"#60a3bc",highlight:"#6a89cc",text:"#2c3e50"};let h=1/0,n=-1/0;function te(){const p=de(0,360,7.2).toArray(),o=de(0,360,360/50).toArray();for(const s of p)for(const i of o){const l=j(s,i);h=Math.min(h,l),n=Math.max(n,l)}h=Math.floor(h*10)/10,n=Math.ceil(n*10)/10,console.log(`Energy range: ${h} to ${n}`)}function B(e){return e*(Math.PI/180)}function j(e,p){const o=B(e)-Math.PI,s=B(p)-Math.PI,i=Math.exp(-((o+Math.PI/2)**2)-(s-Math.PI/2)**2/.5),l=Math.exp(-((o+Math.PI/2)**2)-(s+.5)**2/.3),v=Math.exp(-((o-Math.PI/2)**2)-(s+Math.PI/2)**2/.5),b=Math.exp(-((o-Math.PI/2)**2)-(s-.5)**2/.3),L=Math.exp(-((o-0)**2)/.3-(s-Math.PI/4)**2/.2);let P=0;return t(O)=="1"?P=i:t(O)=="2"?P=i+l:t(O)=="3"?P=i+l+v+b+L:console.error("Invalid difficulty level: ",t(O)),-Math.log(P+1e-6)}function y(){d(T,[]),$=[],I(),d(C,20),d(D,0)}function _(e){if(t(q)||t(C)<=0)return;const p=t(N).getBoundingClientRect(),o=e.clientX-p.left,s=e.clientY-p.top,i=Math.round(X.invert(o)),l=Math.round(u.invert(s));if(o>=a&&o<=M-a&&s>=a&&s<=z-a){d(w,i),d(E,l);const v=j(t(w),t(E));d(T,[...t(T),{phi:t(w),psi:t(E),energy:v}]),d(C,t(C)-1),t(C)===0&&d(A,!0),F()}}function S(){d(C,20),d(D,0),d(T,[]),$=[],d(A,!1),I()}function R(e,p){if(e.length!==p.length||e.length===0)throw new Error("Arrays must be of the same length and non-empty");const o=e.reduce((v,b)=>v+b,0)/e.length,s=e.reduce((v,b)=>v+Math.pow(b-o,2),0),l=1-e.reduce((v,b,L)=>v+Math.pow(b-p[L],2),0)/s;return Math.max(0,l)}function F(){d(q,!0);let e=[],p=[];if(t(T).length===0){d(q,!1),I();return}setTimeout(()=>{console.log("Updating GP model...");const o=t(T).map(x=>[x.phi,x.psi]),s=t(T).map(x=>x.energy),i=(x,W,re=1*(180/Math.PI))=>{const ce=wt(Et(Ct(x,W),2));return It(-.5*ce/(re*re))},l=o.length,v=Ve(l,l);for(let x=0;x<l;x++)for(let W=0;W<l;W++)v.set([x,W],i(o[x],o[W]));const b=.01;for(let x=0;x<l;x++)v.set([x,x],v.get([x,x])+b);const L=40,P=de(0,360,360/L).toArray(),ae=de(0,360,360/L).toArray();$=[];for(const x of P)for(const W of ae){const re=[x,W],ce=Ve(1,l);for(let H=0;H<l;H++)ce.set([0,H],i(re,o[H]));try{const H=Pt(v,s),Xe=Tt(ce,H).get([0,0]);$.push({phi:x,psi:W,predicted:Xe}),p.push(Xe),e.push(j(x,W))}catch(H){console.error("Error in GP calculation:",H)}}I(),d(D,R(e,p)),console.log("R2 Score: ",t(D)),d(q,!1)},50)}function I(){if(!t(N))return;const e=t(N).getContext("2d");e.clearRect(0,0,M+60,z);const p=Mt().domain([n,h]).interpolator(St);if(t(Y)){const s=Q/80;for(let i=0;i<80;i++)for(let l=0;l<80;l++){const v=0+360*i/80,b=0+360*l/80,L=j(v,b),P=X(v),ae=u(b);e.fillStyle=p(L),e.fillRect(P-s/2,ae-s/2,s,s)}}else if($.length===0){const s=Q/80;for(let i=0;i<80;i++)for(let l=0;l<80;l++){const v=0+360*i/80,b=0+360*l/80,L=X(v),P=u(b);e.fillStyle=p(0),e.fillRect(L-s/2,P-s/2,s,s)}}else{const o=Q/Math.sqrt($.length);$.forEach(s=>{const i=X(s.phi),l=u(s.psi);e.fillStyle=p(s.predicted),e.fillRect(i-o/2,l-o/2,o,o)})}V(e,p),e.strokeStyle=g.primary,e.lineWidth=2,e.beginPath(),e.moveTo(a,z-a),e.lineTo(M-a,z-a),e.moveTo(a,a),e.lineTo(a,z-a),e.stroke(),e.fillStyle=g.text,e.font="bold 14px Arial, sans-serif",e.textAlign="center",e.fillText("0",a,z-a+15),e.fillText("180",M/2,z-a+15),e.fillText("360",M-a,z-a+15),e.fillText("φ",M-a+10,z-a+25),e.textAlign="right",e.fillText("0",a-5,z-a),e.fillText("180",a-5,z/2),e.fillText("360",a-5,a),e.fillText("ψ",a-20,a-20),t(T).forEach(o=>{const s=X(o.phi),i=u(o.psi),l=8,v=e.createRadialGradient(s,i,2,s,i,l);v.addColorStop(0,g.highlight),v.addColorStop(1,"rgba(106, 137, 204, 0)"),e.fillStyle=v,e.beginPath(),e.arc(s,i,l,0,2*Math.PI),e.fill(),e.fillStyle=g.accent,e.beginPath(),e.arc(s,i,4,0,2*Math.PI),e.fill(),e.strokeStyle=g.primary,e.lineWidth=1,e.stroke()})}function V(e,p){const s=z-2*a,i=M-a+20,l=a,v=100,b=s/v;for(let P=0;P<v;P++){const ae=h+(n-h)*(v-P-1)/v;e.fillStyle=p(ae),e.fillRect(i,l+P*b,20,b+1)}e.strokeStyle=g.text,e.lineWidth=1,e.strokeRect(i,l,20,s),e.fillStyle=g.text,e.font="12px Arial, sans-serif",e.textAlign="left",e.fillText(h.toFixed(1),i+20+5,l+s),e.fillText(n.toFixed(1),i+20+5,l);const L=(h+n)/2;e.fillText(L.toFixed(1),i+20+5,l+s/2),e.save(),e.translate(i+20+25,l+s/2),e.rotate(-Math.PI/2),e.textAlign="center",e.fillText("Energy",0,10),e.restore()}function m(){d(Y,!t(Y)),I()}ot(()=>{te(),I()});function se(e){d(O,e.target.value),t(Y)&&I(),console.log("Difficulty level set to: ",t(O))}J(()=>{},()=>{d(w,0)}),J(()=>{},()=>{d(E,0)}),J(()=>{},()=>{d(D,0)}),J(()=>(t(w),t(E)),()=>{}),J(()=>{},()=>{d(O,"3")}),st(),it();var Z=Dt(),K=f(r(Z),2),he=r(K),nt=r(he);c(he);var Ee=f(he,2),Ce=r(Ee),rt=f(Ce,2);c(Ee),c(K);var ue=f(K,2),ge=r(ue),Ie=f(r(ge)),ct=r(Ie);c(Ie),c(ge);var ke=f(ge,2),Oe=r(ke),dt=f(Oe,2);c(ke),c(ue);var Re=f(ue,2);{var vt=e=>{var p=Ft(),o=r(p),s=f(r(o),4),i=r(s);c(s);var l=f(s,2);c(o),c(p),we(v=>G(i,`Final score: ${v??""}%`),[()=>(t(D)*100).toFixed(0)],Ze),ie("click",l,S),ve(e,p)};Ke(Re,e=>{t(A)&&e(vt)})}var xe=f(Re,2),oe=f(r(xe),2);we(()=>{t(O),zt(()=>{})});var me=r(oe);me.value=(me.__value="1")==null?"":"1";var ze=f(me);ze.value=(ze.__value="2")==null?"":"2";var Fe=f(ze);Fe.value=(Fe.__value="3")==null?"":"3",c(oe),c(xe);var Le=f(xe,2),ye=r(Le),ne=f(r(ye),2);U(ne,"style",`width: ${M}px; height: ${z}px;`);var pt=r(ne);Rt(pt,{get angle(){return t(w)},set angle(e){d(w,e)},get phiAngle(){return t(E)},set phiAngle(e){d(E,e)},$$legacy:!0}),c(ne);var De=f(ne,2),$e=r(De),_e=r($e),be=f(r(_e),2);Ue(be);var je=f(be,2),ft=r(je);c(je),c(_e);var We=f(_e,2),Ae=f(r(We),2);Ue(Ae);var qe=f(Ae,2),ht=r(qe);c(qe),c(We),c($e),c(De),c(ye);var He=f(ye,2),Me=f(r(He),2),le=r(Me);U(le,"width",M+60),U(le,"height",z),at(le,e=>d(N,e),()=>t(N)),c(Me);var Ge=f(Me,2),Se=r(Ge),ut=r(Se);c(Se);var Pe=f(Se,2),gt=r(Pe);c(Pe);var Ne=f(Pe,4),Ye=r(Ne);{var xt=e=>{var p=Lt();ie("click",p,y),ve(e,p)};Ke(Ye,e=>{t(T).length>0&&e(xt)})}var Te=f(Ye,2),mt=r(Te,!0);c(Te),c(Ne),yt(2),c(Ge),c(He),c(Le),c(Z),we((e,p,o)=>{G(nt,`Lives ${t(C)??""}/20`),U(Ce,"style",`width: ${e??""}%`),U(rt,"style",`left: ${e??""}%`),G(ct,`${p??""}%`),U(Oe,"style",`width: ${t(D)*100}%`),U(dt,"style",`left: ${t(D)*100}%`),G(ft,`${t(E)??""}°`),G(ht,`${t(w)??""}°`),_t(le,1,bt(t(q)?"loading":""),"svelte-1os1z5x"),G(ut,`Samples: ${t(T).length??""}`),G(gt,`Current energy: ${o??""}`),G(mt,t(Y)?"Show Emulator Prediction":"Show Simulator Function")},[()=>Math.max(0,t(C)/20*100),()=>(t(D)*100).toFixed(0),()=>j(t(w),t(E)).toFixed(2)],Ze),At(oe,()=>t(O),e=>d(O,e)),ie("change",oe,se),Qe(be,()=>t(E),e=>d(E,e)),Qe(Ae,()=>t(w),e=>d(w,e)),ie("click",le,_),ie("click",Te,m),ve(fe,Z),lt()}export{Qt as component};
