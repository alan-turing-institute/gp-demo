import{t as ae,a as ne}from"../chunks/cGtBC6Qd.js";import"../chunks/7LKkzqbz.js";import{a4 as st,a1 as a,ac as R,e as t,aa as le,Z as Ze,ab as nt,a6 as o,a7 as r,a5 as lt,a9 as ye,s as c,i as Je,aw as ft,f as Ke,a8 as xt}from"../chunks/BJ4irGt7.js";import{e as J,s as K}from"../chunks/CvaqDwXv.js";import{i as _e}from"../chunks/lIaEYNz1.js";import{s as U,r as be}from"../chunks/B9r3SdpA.js";import{l as Ue,s as Fe,c as Qe}from"../chunks/dhIx7U5O.js";import{b as mt,a as Ae}from"../chunks/CI8f-3O8.js";import{b as Re}from"../chunks/CUY-1DrG.js";import{i as at}from"../chunks/CkfO92w8.js";import{o as Le}from"../chunks/Cpzjerpz.js";import{r as Me,s as _t,v as bt,z as Ve,l as At,m as Mt,a as wt,d as St,b as zt,e as Et}from"../chunks/PBAI84v4.js";import{_ as Pt}from"../chunks/C1FmrZbK.js";import{p as et}from"../chunks/6XXKwe28.js";var Tt=ae('<main class="svelte-13sjxqj"><div class="viewer-container svelte-13sjxqj"><div id="viewer" class="svelte-13sjxqj"></div></div></main>');function tt(we,re){st(re,!1);let S=`
ATOM      1  CH3 ACE     1       2.000   2.090   0.000
ATOM      2  C   ACE     1       3.427   2.641  -0.000
ATOM      3  O   ACE     1       4.391   1.877  -0.000
ATOM      4  N   ALA     2       3.555   3.970  -0.000
ATOM      5  CA  ALA     2       4.853   4.614  -0.000
ATOM     6  HA  ALA     2       5.408   4.316   0.890
ATOM     7  CB  ALA     2       5.661   4.221  -1.232
ATOM     8  C   ALA     2       4.713   6.129   0.000
ATOM     9  O   ALA     2       3.601   6.653   0.000
ATOM     10  N   NME     3       5.846   6.835   0.000
ATOM     11  H   NME     3       6.737   6.359  -0.000
ATOM     12  CH3 NME     3       5.846   8.284   0.000
TER   
END`,z=[6,7,8,9,10,11,12],L=4,j=5,ce=et(re,"angle",8,50),P=et(re,"phiAngle",8,0);function q(x){let _;Math.abs(x.z)>.9?_={x:0,y:x.z,z:-x.y}:_={x:-x.y,y:x.x,z:0};let b=Math.sqrt(_.x**2+_.y**2+_.z**2);return _.x/=b,_.y/=b,_.z/=b,_}function H(x,_,b,y,de){let V=de*Math.PI/180,Z=Math.cos(V),u=Math.sin(V),f=1-Z,T=[[Z+y.x**2*f,y.x*y.y*f-y.z*u,y.x*y.z*f+y.y*u],[y.y*y.x*f+y.z*u,Z+y.y**2*f,y.y*y.z*f-y.x*u],[y.z*y.x*f-y.y*u,y.z*y.y*f+y.x*u,Z+y.z**2*f]];return _.forEach(D=>{let O=x[D-1],ee=O.x-b.x,se=O.y-b.y,A=O.z-b.z,he=T[0][0]*ee+T[0][1]*se+T[0][2]*A,pe=T[1][0]*ee+T[1][1]*se+T[1][2]*A,G=T[2][0]*ee+T[2][1]*se+T[2][2]*A;O.x=he+b.x,O.y=pe+b.y,O.z=G+b.z}),x}function Q(x,_,b,y,de,V){let u=x.split(`
`).filter(A=>A.startsWith("ATOM")).map(A=>{let he=parseFloat(A.substring(30,38).trim()),pe=parseFloat(A.substring(38,46).trim()),G=parseFloat(A.substring(46,54).trim());return{x:he,y:pe,z:G,line:A}}),f=u[b-1],T=u[y-1],D={x:T.x-f.x,y:T.y-f.y,z:T.z-f.z},O=Math.sqrt(D.x**2+D.y**2+D.z**2);D.x/=O,D.y/=O,D.z/=O;let ee=q(D);return u=H(u,_,f,D,de),u=H(u,_,f,ee,V),u.forEach(A=>{A.line=A.line.substring(0,30)+A.x.toFixed(3).padStart(8)+A.y.toFixed(3).padStart(8)+A.z.toFixed(3).padStart(8)+A.line.substring(54)}),u.map(A=>A.line).join(`
`)+`
TER
END`}let $=R(),m=R(),B=R();Le(async()=>{if(typeof window<"u")try{const{createViewer:x}=await Pt(async()=>{const{createViewer:_}=await import("../chunks/kNyKxqkf.js").then(b=>b._);return{createViewer:_}},[],import.meta.url);console.log("3Dmol.js loaded successfully"),a(m,x(t(B),{backgroundColor:"white"})),C(!0),window.addEventListener("resize",()=>{t(m)&&(t(m).resize(),t(m).render())})}catch(x){console.error("Failed to load 3Dmol.js:",x)}});function C(x=!0){t(m)&&(console.log("Updating viewer with angles:",ce(),P()),t(m).clear(),t(m).addModel(t($),"pdb"),t(m).setStyle({},{stick:{radius:.2},sphere:{scale:.3}}),x&&t(m).zoomTo(),t(m).render())}le(()=>(Ze(ce()),Ze(P())),()=>{a($,Q(S,z,L,j,ce(),P()))}),le(()=>(t(m),t($)),()=>{t(m)&&t($)&&C(!1)}),nt(),at();var w=Tt(),d=o(w),ve=o(d);Re(ve,x=>a(B,x),()=>t(B)),r(d),r(w),ne(we,w),lt()}var kt=ae(`<div class="game-ended-popup svelte-oxyhcn"><div class="popup-content svelte-oxyhcn"><h2 class="svelte-oxyhcn">Game Ended</h2> <p class="svelte-oxyhcn">You've used all your lives!</p> <p class="svelte-oxyhcn"> </p> <button class="svelte-oxyhcn">Play Again</button></div></div>`),It=ae('<button class="svelte-oxyhcn">Clear Samples</button>'),Ct=ae('<div class="panel svelte-oxyhcn"><h2 class="svelte-oxyhcn">Backbone Angles</h2> <div class="molecule-visualization svelte-oxyhcn"><!></div> <div class="control-panel svelte-oxyhcn"><div class="slider-container svelte-oxyhcn"><label for="angle" class="svelte-oxyhcn">Ψ Angle (degrees):</label> <input type="range" id="angle" min="0" max="360" step="1" class="svelte-oxyhcn"> <span class="svelte-oxyhcn"> </span></div> <div class="slider-container svelte-oxyhcn"><label for="phiAngle" class="svelte-oxyhcn">Φ Angle (degrees):</label> <input type="range" id="phiAngle" min="0" max="360" step="1" class="svelte-oxyhcn"> <span class="svelte-oxyhcn"> </span></div></div></div> <div class="panel svelte-oxyhcn"><h2 class="svelte-oxyhcn">Energy Landscape</h2> <div class="contour-container svelte-oxyhcn"><canvas></canvas></div> <div class="button-group svelte-oxyhcn"><!> <button class="info-button svelte-oxyhcn"> </button></div> <div class="instruction svelte-oxyhcn"><p class="svelte-oxyhcn">Click directly on the plot above to sample points. This will run the simulation and update the emulator model based on the simulator output.</p></div></div>',1),Ot=ae('<button class="svelte-oxyhcn">Clear Samples</button>'),Ft=ae('<div class="grid-item energy-plot svelte-oxyhcn"><h2 class="svelte-oxyhcn">Energy Landscape</h2> <div class="contour-container svelte-oxyhcn"><canvas></canvas></div></div> <div class="grid-item buttons svelte-oxyhcn"><div class="instruction svelte-oxyhcn"><p class="svelte-oxyhcn">Click directly on the plot to sample points. This will run the simulation and update the emulator model based on the simulator output.</p></div> <div class="vertical-button-group svelte-oxyhcn"><!> <button class="info-button svelte-oxyhcn"> </button></div></div> <div class="grid-item molecule-panel svelte-oxyhcn"><h2 class="svelte-oxyhcn">Backbone Angles</h2> <div class="molecule-visualization svelte-oxyhcn"><!></div></div> <div class="grid-item angle-sliders svelte-oxyhcn"><div class="vertical-control-panel svelte-oxyhcn"><div class="compact-slider-container svelte-oxyhcn"><label for="angle-vertical" class="svelte-oxyhcn">Ψ Angle:</label> <input type="range" id="angle-vertical" min="0" max="360" step="1" class="svelte-oxyhcn"> <span class="svelte-oxyhcn"> </span></div> <div class="compact-slider-container svelte-oxyhcn"><label for="phiAngle-vertical" class="svelte-oxyhcn">Φ Angle:</label> <input type="range" id="phiAngle-vertical" min="0" max="360" step="1" class="svelte-oxyhcn"> <span class="svelte-oxyhcn"> </span></div></div></div>',1),Rt=ae(`<main class="svelte-oxyhcn"><h1 class="svelte-oxyhcn">Protein Explorer</h1> <div class="instruction svelte-oxyhcn"><p class="svelte-oxyhcn">Rotating backbone angles changes the protein's shape, affecting its stability. Lower energy regions correspond to more stable conformations.</p></div> <div class="instruction svelte-oxyhcn"><p class="highlight svelte-oxyhcn">Your goal is to train an emulator that accurately predicts the energy function using as few protein simulator runs as possible.</p></div> <div class="bars-container svelte-oxyhcn"><div class="live-bar-container svelte-oxyhcn"><div class="lives-label"> </div> <div class="live-bar svelte-oxyhcn"><div class="lives-remaining svelte-oxyhcn"></div> <span class="heart svelte-oxyhcn">❤️</span></div></div> <div class="score-bar-container svelte-oxyhcn"><div class="score-label">Score: <span id="score-percentage"> </span></div> <div class="score-bar svelte-oxyhcn"><div class="score-value svelte-oxyhcn" id="score-bar"></div> <span class="star svelte-oxyhcn" id="score-star">⭐</span></div></div></div> <!> <div class="level-container svelte-oxyhcn"><label for="level" class="level-label svelte-oxyhcn">Difficulty:</label> <select id="level" class="svelte-oxyhcn"><option>Level 1</option><option>Level 2</option><option>Level 3</option></select></div> <div><!></div> <div class="button-group svelte-oxyhcn" style="margin-top: 20px; text-align: center;"><button class="info-button svelte-oxyhcn"><span>Go back</span></button></div></main>`);function Kt(we,re){st(re,!1);const S=R(),z=R(),L=R(),j=R();function ce(){window.location.href="https://alan-turing-institute.github.io/gp-demo/"}let P=R([]),q=[],H=R(),Q=R(!1),$=R(!1),m=R(20),B=R(!1);const C=400,w=400,d=40,ve=C-2*d,x=Ue([0,360],[d,C-d]),_=Ue([0,360],[w-d,d]),b={primary:"#3c6382",accent:"#60a3bc",highlight:"#6a89cc",text:"#2c3e50"};function y(){localStorage.setItem("proteinExplorerState",JSON.stringify({samples:t(P),gpPredictions:q,lives:t(m),score:t(L),gameEnded:t(B),showEnergyFunction:t($),phi:t(S),psi:t(z)}))}function de(){const e=localStorage.getItem("proteinExplorerState");if(e){const i=JSON.parse(e);a(P,i.samples),q=i.gpPredictions,a(m,i.lives),a(L,i.score),a(B,i.gameEnded),a($,i.showEnergyFunction),a(S,i.phi),a(z,i.psi)}}let V=R(!1);function Z(){a(V,window.innerHeight>window.innerWidth)}Le(()=>(de(),T(),G(),Z(),window.addEventListener("resize",Z),()=>{y(),window.removeEventListener("resize",Z)}));let u=1/0,f=-1/0;function T(){const i=Me(0,360,7.2).toArray(),v=Me(0,360,360/50).toArray();for(const s of i)for(const l of v){const n=O(s,l);u=Math.min(u,n),f=Math.max(f,n)}u=Math.floor(u*10)/10,f=Math.ceil(f*10)/10,console.log(`Energy range: ${u} to ${f}`)}function D(e){return e*(Math.PI/180)}function O(e,i){const v=D(e)-Math.PI,s=D(i)-Math.PI,l=Math.exp(-((v+Math.PI/2)**2)-(s-Math.PI/2)**2/.5),n=Math.exp(-((v+Math.PI/2)**2)-(s+.5)**2/.3),h=Math.exp(-((v-Math.PI/2)**2)-(s+Math.PI/2)**2/.5),g=Math.exp(-((v-Math.PI/2)**2)-(s-.5)**2/.3),E=Math.exp(-((v-0)**2)/.3-(s-Math.PI/4)**2/.2);let M=0;return t(j)=="1"?M=l:t(j)=="2"?M=l+n:t(j)=="3"?M=l+n+h+g+E:console.error("Invalid difficulty level: ",t(j)),-Math.log(M+1e-6)}function ee(){a(P,[]),q=[],G(),a(m,20),a(L,0)}function se(e){if(t(Q)||t(m)<=0)return;const i=t(H).getBoundingClientRect(),v=t(H).width/i.width,s=t(H).height/i.height,l=(e.clientX-i.left)*v,n=(e.clientY-i.top)*s,h=Math.round(x.invert(l)),g=Math.round(_.invert(n));if(l>=d&&l<=C-d&&n>=d&&n<=w-d){a(S,h),a(z,g);const E=O(t(S),t(z));a(P,[...t(P),{phi:t(S),psi:t(z),energy:E}]),a(m,t(m)-1),t(m)===0&&a(B,!0),pe()}}function A(){a(m,20),a(L,0),a(P,[]),q=[],a(B,!1),G()}function he(e,i){if(e.length!==i.length||e.length===0)throw new Error("Arrays must be of the same length and non-empty");const v=e.reduce((h,g)=>h+g,0)/e.length,s=e.reduce((h,g)=>h+Math.pow(g-v,2),0),n=1-e.reduce((h,g,E)=>h+Math.pow(g-i[E],2),0)/s;return Math.max(0,n)}function pe(){a(Q,!0);let e=[],i=[];if(t(P).length===0){a(Q,!1),G();return}setTimeout(()=>{console.log("Updating GP model...");const v=t(P).map(p=>[p.phi,p.psi]),s=t(P).map(p=>p.energy),l=(p,k,te=1*(180/Math.PI))=>{const X=wt(St(zt(p,k),2));return Et(-.5*X/(te*te))},n=v.length,h=Ve(n,n);for(let p=0;p<n;p++)for(let k=0;k<n;k++)h.set([p,k],l(v[p],v[k]));const g=.01;for(let p=0;p<n;p++)h.set([p,p],h.get([p,p])+g);const E=40,M=Me(0,360,360/E).toArray(),Y=Me(0,360,360/E).toArray();q=[];for(const p of M)for(const k of Y){const te=[p,k],X=Ve(1,n);for(let F=0;F<n;F++)X.set([0,F],l(te,v[F]));try{const F=At(h,s),N=Mt(X,F).get([0,0]);q.push({phi:p,psi:k,predicted:N}),i.push(N),e.push(O(p,k))}catch(F){console.error("Error in GP calculation:",F)}}G(),a(L,he(e,i)),console.log("R2 Score: ",t(L)),a(Q,!1)},50)}function G(){if(!t(H))return;const e=t(H).getContext("2d");e.clearRect(0,0,C+60,w);const i=_t().domain([f,u]).interpolator(bt);if(t($)){const s=ve/80;for(let l=0;l<80;l++)for(let n=0;n<80;n++){const h=0+360*l/80,g=0+360*n/80,E=O(h,g),M=x(h),Y=_(g);e.fillStyle=i(E),e.fillRect(M-s/2,Y-s/2,s,s)}}else if(q.length===0){const s=ve/80;for(let l=0;l<80;l++)for(let n=0;n<80;n++){const h=0+360*l/80,g=0+360*n/80,E=x(h),M=_(g);e.fillStyle=i(0),e.fillRect(E-s/2,M-s/2,s,s)}}else{const v=ve/Math.sqrt(q.length);q.forEach(s=>{const l=x(s.phi),n=_(s.psi);e.fillStyle=i(s.predicted),e.fillRect(l-v/2,n-v/2,v,v)})}it(e,i),e.strokeStyle=b.primary,e.lineWidth=2,e.beginPath(),e.moveTo(d,w-d),e.lineTo(C-d,w-d),e.moveTo(d,d),e.lineTo(d,w-d),e.stroke(),e.fillStyle=b.text,e.font="bold 14px Arial, sans-serif",e.textAlign="center",e.fillText("0",d,w-d+15),e.fillText("180",C/2,w-d+15),e.fillText("360",C-d,w-d+15),e.fillText("φ",C-d+10,w-d+25),e.textAlign="right",e.fillText("0",d-5,w-d),e.fillText("180",d-5,w/2),e.fillText("360",d-5,d),e.fillText("ψ",d-20,d-20),t(P).forEach(v=>{const s=x(v.phi),l=_(v.psi),n=8,h=e.createRadialGradient(s,l,2,s,l,n);h.addColorStop(0,b.highlight),h.addColorStop(1,"rgba(106, 137, 204, 0)"),e.fillStyle=h,e.beginPath(),e.arc(s,l,n,0,2*Math.PI),e.fill(),e.fillStyle=b.accent,e.beginPath(),e.arc(s,l,4,0,2*Math.PI),e.fill(),e.strokeStyle=b.primary,e.lineWidth=1,e.stroke()})}function it(e,i){const s=w-2*d,l=C-d+20,n=d,h=100,g=s/h;for(let M=0;M<h;M++){const Y=u+(f-u)*(h-M-1)/h;e.fillStyle=i(Y),e.fillRect(l,n+M*g,20,g+1)}e.strokeStyle=b.text,e.lineWidth=1,e.strokeRect(l,n,20,s),e.fillStyle=b.text,e.font="12px Arial, sans-serif",e.textAlign="left",e.fillText(u.toFixed(1),l+20+5,n+s),e.fillText(f.toFixed(1),l+20+5,n);const E=(u+f)/2;e.fillText(E.toFixed(1),l+20+5,n+s/2),e.save(),e.translate(l+20+25,n+s/2),e.rotate(-Math.PI/2),e.textAlign="center",e.fillText("Energy",0,10),e.restore()}function $e(){a($,!t($)),G()}Le(()=>{T(),G()});function ot(e){a(j,e.target.value),t($)&&G(),console.log("Difficulty level set to: ",t(j))}le(()=>{},()=>{a(S,0)}),le(()=>{},()=>{a(z,0)}),le(()=>{},()=>{a(L,0)}),le(()=>(t(S),t(z)),()=>{}),le(()=>{},()=>{a(j,"3")}),nt(),at();var Se=Rt(),ze=c(o(Se),6),Ee=o(ze),Pe=o(Ee),rt=o(Pe);r(Pe);var De=c(Pe,2),We=o(De),ct=c(We,2);r(De),r(Ee);var je=c(Ee,2),Te=o(je),He=c(o(Te)),vt=o(He);r(He),r(Te);var Ge=c(Te,2),Ne=o(Ge),dt=c(Ne,2);r(Ge),r(je),r(ze);var qe=c(ze,2);{var ht=e=>{var i=kt(),v=o(i),s=c(o(v),4),l=o(s);r(s);var n=c(s,2);r(v),r(i),ye(h=>K(l,`Final score: ${h??""}%`),[()=>(t(L)*100).toFixed(0)],Je),J("click",n,A),ne(e,i)};_e(qe,e=>{t(B)&&e(ht)})}var ke=c(qe,2),fe=c(o(ke),2);ye(()=>{t(j),ft(()=>{})});var Ie=o(fe);Ie.value=(Ie.__value="1")==null?"":"1";var Ce=c(Ie);Ce.value=(Ce.__value="2")==null?"":"2";var Ye=c(Ce);Ye.value=(Ye.__value="3")==null?"":"3",r(fe),r(ke);var xe=c(ke,2),pt=o(xe);{var ut=e=>{var i=Ct(),v=Ke(i),s=c(o(v),2);U(s,"style",`width: ${C}px; height: ${w}px;`);var l=o(s);tt(l,{get angle(){return t(S)},set angle(I){a(S,I)},get phiAngle(){return t(z)},set phiAngle(I){a(z,I)},$$legacy:!0}),r(s);var n=c(s,2),h=o(n),g=c(o(h),2);be(g);var E=c(g,2),M=o(E);r(E),r(h);var Y=c(h,2),p=c(o(Y),2);be(p);var k=c(p,2),te=o(k);r(k),r(Y),r(n),r(v);var X=c(v,2),F=c(o(X),2),N=o(F);U(N,"width",C+60),U(N,"height",w),Re(N,I=>a(H,I),()=>t(H)),r(F);var ie=c(F,2),ue=o(ie);{var Oe=I=>{var me=It();J("click",me,ee),ne(I,me)};_e(ue,I=>{t(P).length>0&&I(Oe)})}var oe=c(ue,2),ge=o(oe,!0);r(oe),r(ie),xt(2),r(X),ye(()=>{K(M,`${t(z)??""}°`),K(te,`${t(S)??""}°`),Fe(N,1,Qe(t(Q)?"loading":""),"svelte-oxyhcn"),K(ge,t($)?"Show Emulator Prediction":"Show Simulator Function")}),Ae(g,()=>t(z),I=>a(z,I)),Ae(p,()=>t(S),I=>a(S,I)),J("click",N,se),J("click",oe,$e),ne(e,i)},gt=e=>{var i=Ft(),v=Ke(i),s=c(o(v),2),l=o(s);U(l,"width",C+60),U(l,"height",w),Re(l,W=>a(H,W),()=>t(H)),r(s),r(v);var n=c(v,2),h=c(o(n),2),g=o(h);{var E=W=>{var Be=Ot();J("click",Be,ee),ne(W,Be)};_e(g,W=>{t(P).length>0&&W(E)})}var M=c(g,2),Y=o(M,!0);r(M),r(h),r(n);var p=c(n,2),k=c(o(p),2),te=o(k);tt(te,{get angle(){return t(S)},set angle(W){a(S,W)},get phiAngle(){return t(z)},set phiAngle(W){a(z,W)},$$legacy:!0}),r(k),r(p);var X=c(p,2),F=o(X),N=o(F),ie=c(o(N),2);be(ie);var ue=c(ie,2),Oe=o(ue);r(ue),r(N);var oe=c(N,2),ge=c(o(oe),2);be(ge);var I=c(ge,2),me=o(I);r(I),r(oe),r(F),r(X),ye(()=>{Fe(l,1,Qe(t(Q)?"loading":""),"svelte-oxyhcn"),K(Y,t($)?"Show Emulator Prediction":"Show Simulator Function"),K(Oe,`${t(z)??""}°`),K(me,`${t(S)??""}°`)}),J("click",l,se),J("click",M,$e),Ae(ie,()=>t(z),W=>a(z,W)),Ae(ge,()=>t(S),W=>a(S,W)),ne(e,i)};_e(pt,e=>{t(V)?e(gt,!1):e(ut)})}r(xe);var Xe=c(xe,2),yt=o(Xe);r(Xe),r(Se),ye((e,i)=>{K(rt,`Guesses left ${t(m)??""}/20`),U(We,"style",`width: ${e??""}%`),U(ct,"style",`left: ${e??""}%`),K(vt,`${i??""}%`),U(Ne,"style",`width: ${t(L)*100}%`),U(dt,"style",`left: ${t(L)*100}%`),Fe(xe,1,`responsive-grid ${(t(V)?"vertical":"horizontal")??""}`,"svelte-oxyhcn")},[()=>Math.max(0,t(m)/20*100),()=>(t(L)*100).toFixed(0)],Je),mt(fe,()=>t(j),e=>a(j,e)),J("change",fe,ot),J("click",yt,ce),ne(we,Se),lt()}export{Kt as component};
