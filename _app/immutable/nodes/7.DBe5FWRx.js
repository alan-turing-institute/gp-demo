import{t as be,a as ue}from"../chunks/CknnPd0c.js";import"../chunks/CNG2NFgN.js";import{C as Se,D as ye,E as we,F as Te,g as t,G as Ie,s as P,H as u,J as O,v as _,K as y,I as Ge,n as Re}from"../chunks/b4YXpo2F.js";import{s as ee,e as ge}from"../chunks/D9L4vpgH.js";import{b as ze,i as Le}from"../chunks/CVY2Vr_5.js";import{r as Me,l as Pe,s as de,a as We,c as De}from"../chunks/C-bOGmB4.js";import{i as Ce}from"../chunks/fREFhDGP.js";import{o as Ee}from"../chunks/CNR5l_I-.js";import{r as he,s as He,v as Ne,z as Ae,l as $e,m as qe,a as je,d as Be,b as Xe,e as Ye}from"../chunks/CtdLbz7C.js";import{_ as Ke}from"../chunks/C1FmrZbK.js";import{b as _e}from"../chunks/BxuO3b5h.js";var Ze=be('<main class="svelte-1tzehgw"><div class="control-panel svelte-1tzehgw"><div class="slider-container svelte-1tzehgw"><label for="angle" class="svelte-1tzehgw">Psi Angle (degrees):</label> <input type="range" id="angle" min="0" max="360" step="1" class="svelte-1tzehgw"> <span class="svelte-1tzehgw"> </span></div> <div class="slider-container svelte-1tzehgw"><label for="phiAngle" class="svelte-1tzehgw">Phi Angle (degrees):</label> <input type="range" id="phiAngle" min="0" max="360" step="1" class="svelte-1tzehgw"> <span class="svelte-1tzehgw"> </span></div></div> <div class="viewer-container svelte-1tzehgw"><div id="viewer" class="svelte-1tzehgw"></div></div></main>');function Je(ve,pe){Se(pe,!1);let G=`
ATOM      1  CH3 ACE     1       2.000   2.090   0.000
ATOM      2  C   ACE     1       3.427   2.641  -0.000
ATOM      3  O   ACE     1       4.391   1.877  -0.000
ATOM      4  N   ALA     2       3.555   3.970  -0.000
ATOM      5  CA  ALA     2       4.853   4.614  -0.000
ATOM     6  HA  ALA     2       5.408   4.316   0.890
ATOM     7  CB  ALA     2       5.661   4.221  -1.232
ATOM     8  C   ALA     2       4.713   6.129   0.000
ATOM     9  O   ALA     2       3.601   6.653   0.000
ATOM     10  N   NME     3       5.846   6.835   0.000
ATOM     11  H   NME     3       6.737   6.359  -0.000
ATOM     12  CH3 NME     3       5.846   8.284   0.000
TER   
END`,R=[6,7,8,9,10,11,12],F=4,W=5,T=O(50),k=O(0);function j(h){let f;Math.abs(h.z)>.9?f={x:0,y:h.z,z:-h.y}:f={x:-h.y,y:h.x,z:0};let x=Math.sqrt(f.x**2+f.y**2+f.z**2);return f.x/=x,f.y/=x,f.z/=x,f}function D(h,f,x,c,N){let Y=N*Math.PI/180,K=Math.cos(Y),m=Math.sin(Y),z=1-K,b=[[K+c.x**2*z,c.x*c.y*z-c.z*m,c.x*c.z*z+c.y*m],[c.y*c.x*z+c.z*m,K+c.y**2*z,c.y*c.z*z-c.x*m],[c.z*c.x*z-c.y*m,c.z*c.y*z+c.x*m,K+c.z**2*z]];return f.forEach(C=>{let w=h[C-1],Z=w.x-x.x,$=w.y-x.y,p=w.z-x.z,J=b[0][0]*Z+b[0][1]*$+b[0][2]*p,V=b[1][0]*Z+b[1][1]*$+b[1][2]*p,ae=b[2][0]*Z+b[2][1]*$+b[2][2]*p;w.x=J+x.x,w.y=V+x.y,w.z=ae+x.z}),h}function A(h,f,x,c,N,Y){let m=h.split(`
`).filter(p=>p.startsWith("ATOM")).map(p=>{let J=parseFloat(p.substring(30,38).trim()),V=parseFloat(p.substring(38,46).trim()),ae=parseFloat(p.substring(46,54).trim());return{x:J,y:V,z:ae,line:p}}),z=m[x-1],b=m[c-1],C={x:b.x-z.x,y:b.y-z.y,z:b.z-z.z},w=Math.sqrt(C.x**2+C.y**2+C.z**2);C.x/=w,C.y/=w,C.z/=w;let Z=j(C);return m=D(m,f,z,C,N),m=D(m,f,z,Z,Y),m.forEach(p=>{p.line=p.line.substring(0,30)+p.x.toFixed(3).padStart(8)+p.y.toFixed(3).padStart(8)+p.z.toFixed(3).padStart(8)+p.line.substring(54)}),m.map(p=>p.line).join(`
`)+`
TER
END`}let v=O(),l=O(),U=O();Ee(async()=>{if(typeof window<"u")try{const{createViewer:h}=await Ke(async()=>{const{createViewer:f}=await import("../chunks/kNyKxqkf.js").then(x=>x._);return{createViewer:f}},[],import.meta.url);console.log("3Dmol.js loaded successfully"),_(l,h(t(U),{backgroundColor:"white"})),B(!0),window.addEventListener("resize",()=>{t(l)&&(t(l).resize(),t(l).render())})}catch(h){console.error("Failed to load 3Dmol.js:",h)}});function B(h=!0){t(l)&&(console.log("Updating viewer with angles:",t(T),t(k)),t(l).clear(),t(l).addModel(t(v),"pdb"),t(l).setStyle({},{stick:{radius:.2},sphere:{scale:.3}}),h&&t(l).zoomTo(),t(l).render())}ye(()=>(t(T),t(k)),()=>{_(v,A(G,R,F,W,t(T),t(k)))}),ye(()=>(t(l),t(v)),()=>{t(l)&&t(v)&&B(!1)}),we(),Ce();var H=Ze(),d=u(H),S=u(d),I=P(u(S),2);Me(I);var ne=P(I,2),Q=u(ne);y(ne),y(S);var ie=P(S,2),te=P(u(ie),2);Me(te);var se=P(te,2),X=u(se);y(se),y(ie),y(d);var oe=P(d,2),le=u(oe);ze(le,h=>_(U,h),()=>t(U)),y(oe),y(H),Te(()=>{ee(Q,`${t(T)??""}°`),ee(X,`${t(k)??""}°`)}),_e(I,()=>t(T),h=>_(T,h)),_e(te,()=>t(k),h=>_(k,h)),ue(ve,H),Ie()}var Ue=be('<button class="svelte-lzu280">Clear Samples</button>'),Qe=be('<main class="svelte-lzu280"><h1 class="svelte-lzu280">Protein Backbone Conformation Explorer</h1> <div class="container svelte-lzu280"><div class="panel svelte-lzu280"><h2 class="svelte-lzu280">Backbone Angles</h2> <canvas class="svelte-lzu280"></canvas> <div class="Other"><!></div></div> <div class="panel svelte-lzu280"><h2 class="svelte-lzu280">Energy Landscape</h2> <div class="contour-container svelte-lzu280"><canvas></canvas></div> <div class="info svelte-lzu280"><p class="svelte-lzu280"> </p> <p class="svelte-lzu280"> </p> <div class="instruction svelte-lzu280"><p class="highlight svelte-lzu280">Click on the plot above to add sample points and update the GP model</p></div> <div class="button-group svelte-lzu280"><!> <button class="info-button svelte-lzu280"> </button></div> <div class="energy-function svelte-lzu280"><h3 class="svelte-lzu280">About the Visualization:</h3> <p class="svelte-lzu280"> </p> <p class="svelte-lzu280">The energy function represents different stable conformations of the protein backbone. Darker regions indicate lower energy (more stable conformations).</p> <p class="svelte-lzu280">Click directly on the plot to add sample points and build a GP model that learns this energy landscape.</p></div></div></div></div></main>');function dt(ve,pe){Se(pe,!1);let G=O(0),R=O(0),F=O([]),W=[],T=O(),k=O(),j=O(!1),D=O(!1);const A=400,v=400,l=40,U=A-2*l,B=Pe([-Math.PI,Math.PI],[l,A-l]),H=Pe([-Math.PI,Math.PI],[v-l,l]),d={primary:"#3c6382",secondary:"#82ccdd",accent:"#60a3bc",highlight:"#6a89cc",text:"#2c3e50",bond1:"#38ada9",bond2:"#6a89cc",atom1:"#3c6382",atom2:"#60a3bc",atom3:"#82ccdd",atom4:"#38ada9"};let S=1/0,I=-1/0;function ne(){const i=he(-Math.PI,Math.PI,2*Math.PI/50).toArray(),s=he(-Math.PI,Math.PI,2*Math.PI/50).toArray();for(const a of i)for(const o of s){const r=Q(a,o);S=Math.min(S,r),I=Math.max(I,r)}S=Math.floor(S*10)/10,I=Math.ceil(I*10)/10,console.log(`Energy range: ${S} to ${I}`)}function Q(e,i){const s=Math.exp(-((e+Math.PI/2)**2)-(i-Math.PI/2)**2/.5),a=Math.exp(-((e+Math.PI/2)**2)-(i+.5)**2/.3),o=Math.exp(-((e-Math.PI/2)**2)-(i+Math.PI/2)**2/.5),r=Math.exp(-((e-Math.PI/2)**2)-(i-.5)**2/.3),g=Math.exp(-((e-0)**2)/.3-(i-Math.PI/4)**2/.2),E=s+a+o+r+g;return-Math.log(E+1e-6)}function ie(){_(F,[]),W=[],X()}function te(e){if(t(j))return;const i=t(k).getBoundingClientRect(),s=e.clientX-i.left,a=e.clientY-i.top,o=B.invert(s),r=H.invert(a);if(s>=l&&s<=A-l&&a>=l&&a<=v-l){_(G,o),_(R,r);const g=Q(t(G),t(R));_(F,[...t(F),{phi:t(G),psi:t(R),energy:g}]),se(),le()}}function se(){if(_(j,!0),t(F).length===0){_(j,!1),X();return}setTimeout(()=>{const e=t(F).map(n=>[n.phi,n.psi]),i=t(F).map(n=>n.energy),s=(n,M,re=1)=>{const ce=je(Be(Xe(n,M),2));return Ye(-.5*ce/(re*re))},a=e.length,o=Ae(a,a);for(let n=0;n<a;n++)for(let M=0;M<a;M++)o.set([n,M],s(e[n],e[M]));const r=.01;for(let n=0;n<a;n++)o.set([n,n],o.get([n,n])+r);const g=40,E=he(-Math.PI,Math.PI,2*Math.PI/g).toArray(),L=he(-Math.PI,Math.PI,2*Math.PI/g).toArray();W=[];for(const n of E)for(const M of L){const re=[n,M],ce=Ae(1,a);for(let q=0;q<a;q++)ce.set([0,q],s(re,e[q]));try{const q=$e(o,i),Fe=qe(ce,q).get([0,0]);W.push({phi:n,psi:M,predicted:Fe})}catch(q){console.error("Error in GP calculation:",q)}}X(),_(j,!1)},50)}function X(){if(!t(k))return;const e=t(k).getContext("2d");e.clearRect(0,0,A+60,v);const i=He().domain([I,S]).interpolator(Ne);if(t(D)||W.length===0){const a=U/80;for(let o=0;o<80;o++)for(let r=0;r<80;r++){const g=-Math.PI+2*Math.PI*o/80,E=-Math.PI+2*Math.PI*r/80,L=Q(g,E),n=B(g),M=H(E);e.fillStyle=i(L),e.fillRect(n-a/2,M-a/2,a,a)}}else{const s=U/Math.sqrt(W.length);W.forEach(a=>{const o=B(a.phi),r=H(a.psi);e.fillStyle=i(a.predicted),e.fillRect(o-s/2,r-s/2,s,s)})}oe(e,i),e.strokeStyle=d.primary,e.lineWidth=2,e.beginPath(),e.moveTo(l,v-l),e.lineTo(A-l,v-l),e.moveTo(l,l),e.lineTo(l,v-l),e.stroke(),e.fillStyle=d.text,e.font="bold 14px Arial, sans-serif",e.textAlign="center",e.fillText("-π",l,v-l+15),e.fillText("0",A/2,v-l+15),e.fillText("π",A-l,v-l+15),e.fillText("φ",A-l+15,v-l+5),e.textAlign="right",e.fillText("-π",l-5,v-l),e.fillText("0",l-5,v/2),e.fillText("π",l-5,l),e.fillText("ψ",l-15,l-10),t(F).forEach(s=>{const a=B(s.phi),o=H(s.psi),r=8,g=e.createRadialGradient(a,o,2,a,o,r);g.addColorStop(0,d.highlight),g.addColorStop(1,"rgba(106, 137, 204, 0)"),e.fillStyle=g,e.beginPath(),e.arc(a,o,r,0,2*Math.PI),e.fill(),e.fillStyle=d.accent,e.beginPath(),e.arc(a,o,4,0,2*Math.PI),e.fill(),e.strokeStyle=d.primary,e.lineWidth=1,e.stroke()})}function oe(e,i){const a=v-2*l,o=A-l+20,r=l,g=100,E=a/g;for(let n=0;n<g;n++){const M=S+(I-S)*(g-n-1)/g;e.fillStyle=i(M),e.fillRect(o,r+n*E,20,E+1)}e.strokeStyle=d.text,e.lineWidth=1,e.strokeRect(o,r,20,a),e.fillStyle=d.text,e.font="12px Arial, sans-serif",e.textAlign="left",e.fillText(S.toFixed(1),o+20+5,r+a),e.fillText(I.toFixed(1),o+20+5,r);const L=(S+I)/2;e.fillText(L.toFixed(1),o+20+5,r+a/2),e.save(),e.translate(o+20+25,r+a/2),e.rotate(-Math.PI/2),e.textAlign="center",e.fillText("Energy",0,0),e.restore()}function le(){if(!t(T))return;const e=t(T).getContext("2d");e.clearRect(0,0,A,v);const i=A/2,s=v/2,a=120,o=e.createRadialGradient(i,s,0,i,s,a*1.5);o.addColorStop(0,"rgba(60, 99, 130, 0.1)"),o.addColorStop(1,"rgba(245, 246, 250, 0.05)"),e.fillStyle=o,e.fillRect(0,0,A,v);const r=e.createLinearGradient(i-a,s,i+a,s);r.addColorStop(0,d.secondary),r.addColorStop(.5,d.primary),r.addColorStop(1,d.secondary),e.strokeStyle=r,e.lineWidth=3,e.beginPath(),e.moveTo(i-a,s),e.lineTo(i+a,s),e.stroke();const g=[{x:i-a,y:s,color:d.atom1,label:"N",size:24},{x:i-a/2,y:s,color:d.atom2,label:"Cα",size:26},{x:i,y:s,color:d.atom3,label:"C",size:24},{x:i+a/2,y:s,color:d.atom4,label:"O",size:24},{x:i+a,y:s,color:d.atom1,label:"N",size:24}];e.save(),e.translate(i-a/2,s),e.rotate(t(G));const E=e.createLinearGradient(0,0,0,-60);E.addColorStop(0,d.bond1),E.addColorStop(1,d.secondary),e.strokeStyle=E,e.lineWidth=3,e.beginPath(),e.moveTo(0,0),e.lineTo(0,-60),e.stroke(),e.fillStyle=d.text,e.font="bold 14px Arial, sans-serif",e.fillText("φ = "+t(G).toFixed(2),5,-30),e.restore(),e.save(),e.translate(i,s),e.rotate(t(R));const L=e.createLinearGradient(0,0,0,-60);L.addColorStop(0,d.bond2),L.addColorStop(1,d.highlight),e.strokeStyle=L,e.lineWidth=3,e.beginPath(),e.moveTo(0,0),e.lineTo(0,-60),e.stroke(),e.fillStyle=d.text,e.font="bold 14px Arial, sans-serif",e.fillText("ψ = "+t(R).toFixed(2),5,-30),e.restore(),g.forEach(n=>{const M=e.createRadialGradient(n.x,n.y,0,n.x,n.y,n.size*1.2);M.addColorStop(0,n.color),M.addColorStop(1,"rgba(255, 255, 255, 0)"),e.fillStyle=M,e.beginPath(),e.arc(n.x,n.y,n.size*1.2,0,2*Math.PI),e.fill(),e.fillStyle=n.color,e.beginPath(),e.arc(n.x,n.y,n.size,0,2*Math.PI),e.fill(),e.fillStyle="#fff",e.font="bold 14px Arial, sans-serif",e.textAlign="center",e.textBaseline="middle",e.fillText(n.label,n.x,n.y)})}function h(){_(D,!t(D)),X()}Ee(()=>{ne(),le(),X()}),ye(()=>(t(T),t(G),t(R)),()=>{t(T)&&(t(G)||t(R))&&le()}),we(),Ce();var f=Qe(),x=P(u(f),2),c=u(x),N=P(u(c),2);de(N,"width",A),de(N,"height",v),ze(N,e=>_(T,e),()=>t(T));var Y=P(N,2),K=u(Y);Je(K,{}),y(Y),y(c);var m=P(c,2),z=P(u(m),2),b=u(z);de(b,"width",A+60),de(b,"height",v),ze(b,e=>_(k,e),()=>t(k)),y(z);var C=P(z,2),w=u(C),Z=u(w);y(w);var $=P(w,2),p=u($);y($);var J=P($,4),V=u(J);{var ae=e=>{var i=Ue();ge("click",i,ie),ue(e,i)};Le(V,e=>{t(F).length>0&&e(ae)})}var fe=P(V,2),ke=u(fe,!0);y(fe),y(J);var me=P(J,2),xe=P(u(me),2),Oe=u(xe,!0);y(xe),Re(4),y(me),y(C),y(m),y(x),y(f),Te(e=>{We(b,1,De(t(j)?"loading":""),"svelte-lzu280"),ee(Z,`Samples: ${t(F).length??""}`),ee(p,`Current energy: ${e??""}`),ee(ke,t(D)?"Show GP Prediction":"Show Energy Function"),ee(Oe,t(D)?"Showing actual energy function":"Showing Gaussian Process prediction")},[()=>Q(t(G),t(R)).toFixed(2)],Ge),ge("click",b,te),ge("click",fe,h),ue(ve,f),Ie()}export{dt as component};
