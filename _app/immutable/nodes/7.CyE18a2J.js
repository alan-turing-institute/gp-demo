import{t as pe,a as ce}from"../chunks/cGtBC6Qd.js";import"../chunks/7LKkzqbz.js";import{a4 as lt,aa as U,ab as at,a5 as it,a6 as o,a1 as d,ac as I,e as t,Z as Ke,a7 as v,a9 as Ce,s as p,i as Ue,aw as At,a8 as xt}from"../chunks/BJ4irGt7.js";import{e as Q,s as N}from"../chunks/CvaqDwXv.js";import{i as Je}from"../chunks/lIaEYNz1.js";import{s as K,r as Qe}from"../chunks/B9r3SdpA.js";import{l as Ve,s as Mt,c as zt}from"../chunks/dhIx7U5O.js";import{b as St,a as et}from"../chunks/RvGyPHbW.js";import{b as nt}from"../chunks/CUY-1DrG.js";import{i as rt}from"../chunks/CkfO92w8.js";import{o as ot}from"../chunks/Cpzjerpz.js";import{r as de,s as Pt,v as Tt,z as tt,l as Et,m as Ct,a as It,d as kt,b as Ot,e as Rt}from"../chunks/PBAI84v4.js";import{_ as Ft}from"../chunks/C1FmrZbK.js";import{p as st}from"../chunks/6XXKwe28.js";var Lt=pe('<main class="svelte-13sjxqj"><div class="viewer-container svelte-13sjxqj"><div id="viewer" class="svelte-13sjxqj"></div></div></main>');function Dt(ue,V){lt(V,!1);let T=`
ATOM      1  CH3 ACE     1       2.000   2.090   0.000
ATOM      2  C   ACE     1       3.427   2.641  -0.000
ATOM      3  O   ACE     1       4.391   1.877  -0.000
ATOM      4  N   ALA     2       3.555   3.970  -0.000
ATOM      5  CA  ALA     2       4.853   4.614  -0.000
ATOM     6  HA  ALA     2       5.408   4.316   0.890
ATOM     7  CB  ALA     2       5.661   4.221  -1.232
ATOM     8  C   ALA     2       4.713   6.129   0.000
ATOM     9  O   ALA     2       3.601   6.653   0.000
ATOM     10  N   NME     3       5.846   6.835   0.000
ATOM     11  H   NME     3       6.737   6.359  -0.000
ATOM     12  CH3 NME     3       5.846   8.284   0.000
TER   
END`,E=[6,7,8,9,10,11,12],D=4,k=5,ee=st(V,"angle",8,50),S=st(V,"phiAngle",8,0);function W(f){let h;Math.abs(f.z)>.9?h={x:0,y:f.z,z:-f.y}:h={x:-f.y,y:f.x,z:0};let g=Math.sqrt(h.x**2+h.y**2+h.z**2);return h.x/=g,h.y/=g,h.z/=g,h}function H(f,h,g,n,C){let J=C*Math.PI/180,q=Math.cos(J),w=Math.sin(J),A=1-q,M=[[q+n.x**2*A,n.x*n.y*A-n.z*w,n.x*n.z*A+n.y*w],[n.y*n.x*A+n.z*w,q+n.y**2*A,n.y*n.z*A-n.x*w],[n.z*n.x*A-n.y*w,n.z*n.y*A+n.x*w,q+n.z**2*A]];return h.forEach(O=>{let R=f[O-1],B=R.x-g.x,F=R.y-g.y,_=R.z-g.z,se=M[0][0]*B+M[0][1]*F+M[0][2]*_,le=M[1][0]*B+M[1][1]*F+M[1][2]*_,Z=M[2][0]*B+M[2][1]*F+M[2][2]*_;R.x=se+g.x,R.y=le+g.y,R.z=Z+g.z}),f}function Y(f,h,g,n,C,J){let w=f.split(`
`).filter(_=>_.startsWith("ATOM")).map(_=>{let se=parseFloat(_.substring(30,38).trim()),le=parseFloat(_.substring(38,46).trim()),Z=parseFloat(_.substring(46,54).trim());return{x:se,y:le,z:Z,line:_}}),A=w[g-1],M=w[n-1],O={x:M.x-A.x,y:M.y-A.y,z:M.z-A.z},R=Math.sqrt(O.x**2+O.y**2+O.z**2);O.x/=R,O.y/=R,O.z/=R;let B=W(O);return w=H(w,h,A,O,C),w=H(w,h,A,B,J),w.forEach(_=>{_.line=_.line.substring(0,30)+_.x.toFixed(3).padStart(8)+_.y.toFixed(3).padStart(8)+_.z.toFixed(3).padStart(8)+_.line.substring(54)}),w.map(_=>_.line).join(`
`)+`
TER
END`}let $=I(),y=I(),X=I();ot(async()=>{if(typeof window<"u")try{const{createViewer:f}=await Ft(async()=>{const{createViewer:h}=await import("../chunks/kNyKxqkf.js").then(g=>g._);return{createViewer:h}},[],import.meta.url);console.log("3Dmol.js loaded successfully"),d(y,f(t(X),{backgroundColor:"white"})),P(!0),window.addEventListener("resize",()=>{t(y)&&(t(y).resize(),t(y).render())})}catch(f){console.error("Failed to load 3Dmol.js:",f)}});function P(f=!0){t(y)&&(console.log("Updating viewer with angles:",ee(),S()),t(y).clear(),t(y).addModel(t($),"pdb"),t(y).setStyle({},{stick:{radius:.2},sphere:{scale:.3}}),f&&t(y).zoomTo(),t(y).render())}U(()=>(Ke(ee()),Ke(S())),()=>{d($,Y(T,E,D,k,ee(),S()))}),U(()=>(t(y),t($)),()=>{t(y)&&t($)&&P(!1)}),at(),rt();var b=Lt(),a=o(b),te=o(a);nt(te,f=>d(X,f),()=>t(X)),v(a),v(b),ce(ue,b),it()}var $t=pe(`<div class="game-ended-popup svelte-1e61vwd"><div class="popup-content svelte-1e61vwd"><h2 class="svelte-1e61vwd">Game Ended</h2> <p class="svelte-1e61vwd">You've used all your lives!</p> <p class="svelte-1e61vwd"> </p> <button class="svelte-1e61vwd">Play Again</button></div></div>`),jt=pe('<button class="svelte-1e61vwd">Clear Samples</button>'),Wt=pe('<main class="svelte-1e61vwd"><div class="header-container svelte-1e61vwd"><h1 class="svelte-1e61vwd">Protein Explorer</h1> <button class="home-button svelte-1e61vwd"><span>Home</span></button></div> <div class="live-bar-container svelte-1e61vwd"><div class="lives-label svelte-1e61vwd"> </div> <div class="live-bar svelte-1e61vwd"><div class="lives-remaining svelte-1e61vwd"></div> <span class="heart svelte-1e61vwd">❤️</span></div></div> <div class="score-bar-container svelte-1e61vwd"><div class="score-label svelte-1e61vwd">Score: <span id="score-percentage"> </span></div> <div class="score-bar svelte-1e61vwd"><div class="score-value svelte-1e61vwd" id="score-bar"></div> <span class="star svelte-1e61vwd" id="score-star">⭐</span></div></div> <!> <div class="level-container svelte-1e61vwd"><label for="level" class="level-label svelte-1e61vwd">Difficulty:</label> <select id="level" class="svelte-1e61vwd"><option>Level 1</option><option>Level 2</option><option>Level 3</option></select></div> <div class="container svelte-1e61vwd"><div class="panel svelte-1e61vwd"><h2 class="svelte-1e61vwd">Backbone Angles</h2>  <div class="molecule-visualization svelte-1e61vwd"><!></div> <div class="Other"><div class="control-panel svelte-1e61vwd"><div class="slider-container svelte-1e61vwd"><label for="angle" class="svelte-1e61vwd">Ψ Angle (degrees):</label> <input type="range" id="angle" min="0" max="360" step="1" class="svelte-1e61vwd"> <span class="svelte-1e61vwd"> </span></div> <div class="slider-container svelte-1e61vwd"><label for="phiAngle" class="svelte-1e61vwd">Φ Angle (degrees):</label> <input type="range" id="phiAngle" min="0" max="360" step="1" class="svelte-1e61vwd"> <span class="svelte-1e61vwd"> </span></div></div></div></div> <div class="panel svelte-1e61vwd"><h2 class="svelte-1e61vwd">Energy Landscape</h2> <div class="contour-container svelte-1e61vwd"><canvas></canvas></div> <div class="info svelte-1e61vwd"><p class="svelte-1e61vwd"> </p> <p class="svelte-1e61vwd"> </p> <div class="instruction svelte-1e61vwd"><p class="highlight svelte-1e61vwd">Your goal is to train an accurate emulator using as few simulator runs as possible.</p> <p class="svelte-1e61vwd">Click directly on the plot above to sample points. This will run the simulation and update the emulator model based on the simulator output.</p></div> <div class="button-group svelte-1e61vwd"><!> <button class="info-button svelte-1e61vwd"> </button></div> <div class="energy-function svelte-1e61vwd"><h3 class="svelte-1e61vwd">About the Visualization:</h3> <p class="svelte-1e61vwd">The energy function represents different stable conformations of the protein backbone. Lighter regions indicate more stable conformations (lower energy).</p></div></div></div></div></main>');function ts(ue,V){lt(V,!1);const T=I(),E=I(),D=I(),k=I();function ee(){window.location.href="https://alan-turing-institute.github.io/gp-demo/"}let S=I([]),W=[],H=I(),Y=I(!1),$=I(!1),y=I(20),X=I(!1);const P=400,b=400,a=40,te=P-2*a,f=Ve([0,360],[a,P-a]),h=Ve([0,360],[b-a,a]),g={primary:"#3c6382",accent:"#60a3bc",highlight:"#6a89cc",text:"#2c3e50"};let n=1/0,C=-1/0;function J(){const u=de(0,360,7.2).toArray(),r=de(0,360,360/50).toArray();for(const s of u)for(const i of r){const l=w(s,i);n=Math.min(n,l),C=Math.max(C,l)}n=Math.floor(n*10)/10,C=Math.ceil(C*10)/10,console.log(`Energy range: ${n} to ${C}`)}function q(e){return e*(Math.PI/180)}function w(e,u){const r=q(e)-Math.PI,s=q(u)-Math.PI,i=Math.exp(-((r+Math.PI/2)**2)-(s-Math.PI/2)**2/.5),l=Math.exp(-((r+Math.PI/2)**2)-(s+.5)**2/.3),c=Math.exp(-((r-Math.PI/2)**2)-(s+Math.PI/2)**2/.5),x=Math.exp(-((r-Math.PI/2)**2)-(s-.5)**2/.3),L=Math.exp(-((r-0)**2)/.3-(s-Math.PI/4)**2/.2);let z=0;return t(k)=="1"?z=i:t(k)=="2"?z=i+l:t(k)=="3"?z=i+l+c+x+L:console.error("Invalid difficulty level: ",t(k)),-Math.log(z+1e-6)}function A(){d(S,[]),W=[],F(),d(y,20),d(D,0)}function M(e){if(t(Y)||t(y)<=0)return;const u=t(H).getBoundingClientRect(),r=e.clientX-u.left,s=e.clientY-u.top,i=Math.round(f.invert(r)),l=Math.round(h.invert(s));if(r>=a&&r<=P-a&&s>=a&&s<=b-a){d(T,i),d(E,l);const c=w(t(T),t(E));d(S,[...t(S),{phi:t(T),psi:t(E),energy:c}]),d(y,t(y)-1),t(y)===0&&d(X,!0),B()}}function O(){d(y,20),d(D,0),d(S,[]),W=[],d(X,!1),F()}function R(e,u){if(e.length!==u.length||e.length===0)throw new Error("Arrays must be of the same length and non-empty");const r=e.reduce((c,x)=>c+x,0)/e.length,s=e.reduce((c,x)=>c+Math.pow(x-r,2),0),l=1-e.reduce((c,x,L)=>c+Math.pow(x-u[L],2),0)/s;return Math.max(0,l)}function B(){d(Y,!0);let e=[],u=[];if(t(S).length===0){d(Y,!1),F();return}setTimeout(()=>{console.log("Updating GP model...");const r=t(S).map(m=>[m.phi,m.psi]),s=t(S).map(m=>m.energy),i=(m,j,oe=1*(180/Math.PI))=>{const ve=It(kt(Ot(m,j),2));return Rt(-.5*ve/(oe*oe))},l=r.length,c=tt(l,l);for(let m=0;m<l;m++)for(let j=0;j<l;j++)c.set([m,j],i(r[m],r[j]));const x=.01;for(let m=0;m<l;m++)c.set([m,m],c.get([m,m])+x);const L=40,z=de(0,360,360/L).toArray(),ie=de(0,360,360/L).toArray();W=[];for(const m of z)for(const j of ie){const oe=[m,j],ve=tt(1,l);for(let G=0;G<l;G++)ve.set([0,G],i(oe,r[G]));try{const G=Et(c,s),Ze=Ct(ve,G).get([0,0]);W.push({phi:m,psi:j,predicted:Ze}),u.push(Ze),e.push(w(m,j))}catch(G){console.error("Error in GP calculation:",G)}}F(),d(D,R(e,u)),console.log("R2 Score: ",t(D)),d(Y,!1)},50)}function F(){if(!t(H))return;const e=t(H).getContext("2d");e.clearRect(0,0,P+60,b);const u=Pt().domain([C,n]).interpolator(Tt);if(t($)){const s=te/80;for(let i=0;i<80;i++)for(let l=0;l<80;l++){const c=0+360*i/80,x=0+360*l/80,L=w(c,x),z=f(c),ie=h(x);e.fillStyle=u(L),e.fillRect(z-s/2,ie-s/2,s,s)}}else if(W.length===0){const s=te/80;for(let i=0;i<80;i++)for(let l=0;l<80;l++){const c=0+360*i/80,x=0+360*l/80,L=f(c),z=h(x);e.fillStyle=u(0),e.fillRect(L-s/2,z-s/2,s,s)}}else{const r=te/Math.sqrt(W.length);W.forEach(s=>{const i=f(s.phi),l=h(s.psi);e.fillStyle=u(s.predicted),e.fillRect(i-r/2,l-r/2,r,r)})}_(e,u),e.strokeStyle=g.primary,e.lineWidth=2,e.beginPath(),e.moveTo(a,b-a),e.lineTo(P-a,b-a),e.moveTo(a,a),e.lineTo(a,b-a),e.stroke(),e.fillStyle=g.text,e.font="bold 14px Arial, sans-serif",e.textAlign="center",e.fillText("0",a,b-a+15),e.fillText("180",P/2,b-a+15),e.fillText("360",P-a,b-a+15),e.fillText("φ",P-a+10,b-a+25),e.textAlign="right",e.fillText("0",a-5,b-a),e.fillText("180",a-5,b/2),e.fillText("360",a-5,a),e.fillText("ψ",a-20,a-20),t(S).forEach(r=>{const s=f(r.phi),i=h(r.psi),l=8,c=e.createRadialGradient(s,i,2,s,i,l);c.addColorStop(0,g.highlight),c.addColorStop(1,"rgba(106, 137, 204, 0)"),e.fillStyle=c,e.beginPath(),e.arc(s,i,l,0,2*Math.PI),e.fill(),e.fillStyle=g.accent,e.beginPath(),e.arc(s,i,4,0,2*Math.PI),e.fill(),e.strokeStyle=g.primary,e.lineWidth=1,e.stroke()})}function _(e,u){const s=b-2*a,i=P-a+20,l=a,c=100,x=s/c;for(let z=0;z<c;z++){const ie=n+(C-n)*(c-z-1)/c;e.fillStyle=u(ie),e.fillRect(i,l+z*x,20,x+1)}e.strokeStyle=g.text,e.lineWidth=1,e.strokeRect(i,l,20,s),e.fillStyle=g.text,e.font="12px Arial, sans-serif",e.textAlign="left",e.fillText(n.toFixed(1),i+20+5,l+s),e.fillText(C.toFixed(1),i+20+5,l);const L=(n+C)/2;e.fillText(L.toFixed(1),i+20+5,l+s/2),e.save(),e.translate(i+20+25,l+s/2),e.rotate(-Math.PI/2),e.textAlign="center",e.fillText("Energy",0,10),e.restore()}function se(){d($,!t($)),F()}ot(()=>{J(),F()});function le(e){d(k,e.target.value),t($)&&F(),console.log("Difficulty level set to: ",t(k))}U(()=>{},()=>{d(T,0)}),U(()=>{},()=>{d(E,0)}),U(()=>{},()=>{d(D,0)}),U(()=>(t(T),t(E)),()=>{}),U(()=>{},()=>{d(k,"3")}),at(),rt();var Z=Wt(),fe=o(Z),vt=p(o(fe),2);v(fe);var he=p(fe,2),ge=o(he),dt=o(ge);v(ge);var Ie=p(ge,2),ke=o(Ie),ct=p(ke,2);v(Ie),v(he);var me=p(he,2),ye=o(me),Oe=p(o(ye)),pt=o(Oe);v(Oe),v(ye);var Re=p(ye,2),Fe=o(Re),ut=p(Fe,2);v(Re),v(me);var Le=p(me,2);{var ft=e=>{var u=$t(),r=o(u),s=p(o(r),4),i=o(s);v(s);var l=p(s,2);v(r),v(u),Ce(c=>N(i,`Final score: ${c??""}%`),[()=>(t(D)*100).toFixed(0)],Ue),Q("click",l,O),ce(e,u)};Je(Le,e=>{t(X)&&e(ft)})}var we=p(Le,2),ne=p(o(we),2);Ce(()=>{t(k),At(()=>{})});var _e=o(ne);_e.value=(_e.__value="1")==null?"":"1";var be=p(_e);be.value=(be.__value="2")==null?"":"2";var De=p(be);De.value=(De.__value="3")==null?"":"3",v(ne),v(we);var $e=p(we,2),Ae=o($e),re=p(o(Ae),2);K(re,"style",`width: ${P}px; height: ${b}px;`);var ht=o(re);Dt(ht,{get angle(){return t(T)},set angle(e){d(T,e)},get phiAngle(){return t(E)},set phiAngle(e){d(E,e)},$$legacy:!0}),v(re);var je=p(re,2),We=o(je),xe=o(We),Me=p(o(xe),2);Qe(Me);var He=p(Me,2),gt=o(He);v(He),v(xe);var qe=p(xe,2),ze=p(o(qe),2);Qe(ze);var Ge=p(ze,2),mt=o(Ge);v(Ge),v(qe),v(We),v(je),v(Ae);var Ne=p(Ae,2),Se=p(o(Ne),2),ae=o(Se);K(ae,"width",P+60),K(ae,"height",b),nt(ae,e=>d(H,e),()=>t(H)),v(Se);var Ye=p(Se,2),Pe=o(Ye),yt=o(Pe);v(Pe);var Te=p(Pe,2),wt=o(Te);v(Te);var Xe=p(Te,4),Be=o(Xe);{var _t=e=>{var u=jt();Q("click",u,A),ce(e,u)};Je(Be,e=>{t(S).length>0&&e(_t)})}var Ee=p(Be,2),bt=o(Ee,!0);v(Ee),v(Xe),xt(2),v(Ye),v(Ne),v($e),v(Z),Ce((e,u,r)=>{N(dt,`Lives ${t(y)??""}/20`),K(ke,"style",`width: ${e??""}%`),K(ct,"style",`left: ${e??""}%`),N(pt,`${u??""}%`),K(Fe,"style",`width: ${t(D)*100}%`),K(ut,"style",`left: ${t(D)*100}%`),N(gt,`${t(E)??""}°`),N(mt,`${t(T)??""}°`),Mt(ae,1,zt(t(Y)?"loading":""),"svelte-1e61vwd"),N(yt,`Samples: ${t(S).length??""}`),N(wt,`Current energy: ${r??""}`),N(bt,t($)?"Show Emulator Prediction":"Show Simulator Function")},[()=>Math.max(0,t(y)/20*100),()=>(t(D)*100).toFixed(0),()=>w(t(T),t(E)).toFixed(2)],Ue),Q("click",vt,ee),St(ne,()=>t(k),e=>d(k,e)),Q("change",ne,le),et(Me,()=>t(E),e=>d(E,e)),et(ze,()=>t(T),e=>d(T,e)),Q("click",ae,M),Q("click",Ee,se),ce(ue,Z),it()}export{ts as component};
