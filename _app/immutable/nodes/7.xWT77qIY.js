import{t as dt,a as it}from"../chunks/DDK9J2ve.js";import"../chunks/D6NYvkbl.js";import{p as It,l as _t,j as Tt,t as Ct,k as kt,s as b,m as v,o as At,g as l,q as _,v as x,n as st,w as u}from"../chunks/Dk8vFEre.js";import{e as J,s as H}from"../chunks/DHzYZD1q.js";import{b as nt,i as Gt}from"../chunks/BgWHAIsa.js";import{l as rt,s as O,a as wt,c as Et}from"../chunks/BrztiYA3.js";import{i as Rt}from"../chunks/xHnnKOVN.js";import{o as Wt}from"../chunks/B6DROYHl.js";import{r as V,s as Ft,v as Lt,z as ct,l as qt,m as Ht,a as Ot,d as Vt,b as Bt,e as Xt}from"../chunks/Bo287F7M.js";var $t=dt('<button class="svelte-lzu280">Clear Samples</button>'),jt=dt('<main class="svelte-lzu280"><h1 class="svelte-lzu280">Protein Backbone Conformation Explorer</h1> <div class="container svelte-lzu280"><div class="panel svelte-lzu280"><h2 class="svelte-lzu280">Backbone Angles</h2> <canvas class="svelte-lzu280"></canvas> <div class="Other"></div></div> <div class="panel svelte-lzu280"><h2 class="svelte-lzu280">Energy Landscape</h2> <div class="contour-container svelte-lzu280"><canvas></canvas></div> <div class="info svelte-lzu280"><p class="svelte-lzu280"> </p> <p class="svelte-lzu280"> </p> <div class="instruction svelte-lzu280"><p class="highlight svelte-lzu280">Click on the plot above to add sample points and update the GP model</p></div> <div class="button-group svelte-lzu280"><!> <button class="info-button svelte-lzu280"> </button></div> <div class="energy-function svelte-lzu280"><h3 class="svelte-lzu280">About the Visualization:</h3> <p class="svelte-lzu280"> </p> <p class="svelte-lzu280">The energy function represents different stable conformations of the protein backbone. Darker regions indicate lower energy (more stable conformations).</p> <p class="svelte-lzu280">Click directly on the plot to add sample points and build a GP model that learns this energy landscape.</p></div></div></div></div></main>');function ee(ht,ft){It(ft,!1);let M=_(0),z=_(0),m=_([]),T=[],C=_(),k=_(),A=_(!1),G=_(!1);const p=400,h=400,i=40,Q=p-2*i,R=rt([-Math.PI,Math.PI],[i,p-i]),W=rt([-Math.PI,Math.PI],[h-i,i]),c={primary:"#3c6382",secondary:"#82ccdd",accent:"#60a3bc",highlight:"#6a89cc",text:"#2c3e50",bond1:"#38ada9",bond2:"#6a89cc",atom1:"#3c6382",atom2:"#60a3bc",atom3:"#82ccdd",atom4:"#38ada9"};let y=1/0,P=-1/0;function pt(){const o=V(-Math.PI,Math.PI,2*Math.PI/50).toArray(),s=V(-Math.PI,Math.PI,2*Math.PI/50).toArray();for(const e of o)for(const n of s){const r=F(e,n);y=Math.min(y,r),P=Math.max(P,r)}y=Math.floor(y*10)/10,P=Math.ceil(P*10)/10,console.log(`Energy range: ${y} to ${P}`)}function F(t,o){const s=Math.exp(-((t+Math.PI/2)**2)-(o-Math.PI/2)**2/.5),e=Math.exp(-((t+Math.PI/2)**2)-(o+.5)**2/.3),n=Math.exp(-((t-Math.PI/2)**2)-(o+Math.PI/2)**2/.5),r=Math.exp(-((t-Math.PI/2)**2)-(o-.5)**2/.3),d=Math.exp(-((t-0)**2)/.3-(o-Math.PI/4)**2/.2),g=s+e+n+r+d;return-Math.log(g+1e-6)}function gt(){x(m,[]),T=[],w()}function vt(t){if(l(A))return;const o=l(k).getBoundingClientRect(),s=t.clientX-o.left,e=t.clientY-o.top,n=R.invert(s),r=W.invert(e);if(s>=i&&s<=p-i&&e>=i&&e<=h-i){x(M,n),x(z,r);const d=F(l(M),l(z));x(m,[...l(m),{phi:l(M),psi:l(z),energy:d}]),ut(),B()}}function ut(){if(x(A,!0),l(m).length===0){x(A,!1),w();return}setTimeout(()=>{const t=l(m).map(a=>[a.phi,a.psi]),o=l(m).map(a=>a.energy),s=(a,f,L=1)=>{const q=Ot(Vt(Bt(a,f),2));return Xt(-.5*q/(L*L))},e=t.length,n=ct(e,e);for(let a=0;a<e;a++)for(let f=0;f<e;f++)n.set([a,f],s(t[a],t[f]));const r=.01;for(let a=0;a<e;a++)n.set([a,a],n.get([a,a])+r);const d=40,g=V(-Math.PI,Math.PI,2*Math.PI/d).toArray(),S=V(-Math.PI,Math.PI,2*Math.PI/d).toArray();T=[];for(const a of g)for(const f of S){const L=[a,f],q=ct(1,e);for(let I=0;I<e;I++)q.set([0,I],s(L,t[I]));try{const I=qt(n,o),zt=Ht(q,I).get([0,0]);T.push({phi:a,psi:f,predicted:zt})}catch(I){console.error("Error in GP calculation:",I)}}w(),x(A,!1)},50)}function w(){if(!l(k))return;const t=l(k).getContext("2d");t.clearRect(0,0,p+60,h);const o=Ft().domain([P,y]).interpolator(Lt);if(l(G)||T.length===0){const e=Q/80;for(let n=0;n<80;n++)for(let r=0;r<80;r++){const d=-Math.PI+2*Math.PI*n/80,g=-Math.PI+2*Math.PI*r/80,S=F(d,g),a=R(d),f=W(g);t.fillStyle=o(S),t.fillRect(a-e/2,f-e/2,e,e)}}else{const s=Q/Math.sqrt(T.length);T.forEach(e=>{const n=R(e.phi),r=W(e.psi);t.fillStyle=o(e.predicted),t.fillRect(n-s/2,r-s/2,s,s)})}yt(t,o),t.strokeStyle=c.primary,t.lineWidth=2,t.beginPath(),t.moveTo(i,h-i),t.lineTo(p-i,h-i),t.moveTo(i,i),t.lineTo(i,h-i),t.stroke(),t.fillStyle=c.text,t.font="bold 14px Arial, sans-serif",t.textAlign="center",t.fillText("-π",i,h-i+15),t.fillText("0",p/2,h-i+15),t.fillText("π",p-i,h-i+15),t.fillText("φ",p-i+15,h-i+5),t.textAlign="right",t.fillText("-π",i-5,h-i),t.fillText("0",i-5,h/2),t.fillText("π",i-5,i),t.fillText("ψ",i-15,i-10),l(m).forEach(s=>{const e=R(s.phi),n=W(s.psi),r=8,d=t.createRadialGradient(e,n,2,e,n,r);d.addColorStop(0,c.highlight),d.addColorStop(1,"rgba(106, 137, 204, 0)"),t.fillStyle=d,t.beginPath(),t.arc(e,n,r,0,2*Math.PI),t.fill(),t.fillStyle=c.accent,t.beginPath(),t.arc(e,n,4,0,2*Math.PI),t.fill(),t.strokeStyle=c.primary,t.lineWidth=1,t.stroke()})}function yt(t,o){const e=h-2*i,n=p-i+20,r=i,d=100,g=e/d;for(let a=0;a<d;a++){const f=y+(P-y)*(d-a-1)/d;t.fillStyle=o(f),t.fillRect(n,r+a*g,20,g+1)}t.strokeStyle=c.text,t.lineWidth=1,t.strokeRect(n,r,20,e),t.fillStyle=c.text,t.font="12px Arial, sans-serif",t.textAlign="left",t.fillText(y.toFixed(1),n+20+5,r+e),t.fillText(P.toFixed(1),n+20+5,r);const S=(y+P)/2;t.fillText(S.toFixed(1),n+20+5,r+e/2),t.save(),t.translate(n+20+25,r+e/2),t.rotate(-Math.PI/2),t.textAlign="center",t.fillText("Energy",0,0),t.restore()}function B(){if(!l(C))return;const t=l(C).getContext("2d");t.clearRect(0,0,p,h);const o=p/2,s=h/2,e=120,n=t.createRadialGradient(o,s,0,o,s,e*1.5);n.addColorStop(0,"rgba(60, 99, 130, 0.1)"),n.addColorStop(1,"rgba(245, 246, 250, 0.05)"),t.fillStyle=n,t.fillRect(0,0,p,h);const r=t.createLinearGradient(o-e,s,o+e,s);r.addColorStop(0,c.secondary),r.addColorStop(.5,c.primary),r.addColorStop(1,c.secondary),t.strokeStyle=r,t.lineWidth=3,t.beginPath(),t.moveTo(o-e,s),t.lineTo(o+e,s),t.stroke();const d=[{x:o-e,y:s,color:c.atom1,label:"N",size:24},{x:o-e/2,y:s,color:c.atom2,label:"Cα",size:26},{x:o,y:s,color:c.atom3,label:"C",size:24},{x:o+e/2,y:s,color:c.atom4,label:"O",size:24},{x:o+e,y:s,color:c.atom1,label:"N",size:24}];t.save(),t.translate(o-e/2,s),t.rotate(l(M));const g=t.createLinearGradient(0,0,0,-60);g.addColorStop(0,c.bond1),g.addColorStop(1,c.secondary),t.strokeStyle=g,t.lineWidth=3,t.beginPath(),t.moveTo(0,0),t.lineTo(0,-60),t.stroke(),t.fillStyle=c.text,t.font="bold 14px Arial, sans-serif",t.fillText("φ = "+l(M).toFixed(2),5,-30),t.restore(),t.save(),t.translate(o,s),t.rotate(l(z));const S=t.createLinearGradient(0,0,0,-60);S.addColorStop(0,c.bond2),S.addColorStop(1,c.highlight),t.strokeStyle=S,t.lineWidth=3,t.beginPath(),t.moveTo(0,0),t.lineTo(0,-60),t.stroke(),t.fillStyle=c.text,t.font="bold 14px Arial, sans-serif",t.fillText("ψ = "+l(z).toFixed(2),5,-30),t.restore(),d.forEach(a=>{const f=t.createRadialGradient(a.x,a.y,0,a.x,a.y,a.size*1.2);f.addColorStop(0,a.color),f.addColorStop(1,"rgba(255, 255, 255, 0)"),t.fillStyle=f,t.beginPath(),t.arc(a.x,a.y,a.size*1.2,0,2*Math.PI),t.fill(),t.fillStyle=a.color,t.beginPath(),t.arc(a.x,a.y,a.size,0,2*Math.PI),t.fill(),t.fillStyle="#fff",t.font="bold 14px Arial, sans-serif",t.textAlign="center",t.textBaseline="middle",t.fillText(a.label,a.x,a.y)})}function bt(){x(G,!l(G)),w()}Wt(()=>{pt(),B(),w()}),_t(()=>(l(C),l(M),l(z)),()=>{l(C)&&(l(M)||l(z))&&B()}),Tt(),Rt();var X=jt(),U=b(v(X),2),$=v(U),j=b(v($),2);O(j,"width",p),O(j,"height",h),nt(j,t=>x(C,t),()=>l(C)),st(2),u($);var tt=b($,2),D=b(v(tt),2),E=v(D);O(E,"width",p+60),O(E,"height",h),nt(E,t=>x(k,t),()=>l(k)),u(D);var et=b(D,2),N=v(et),xt=v(N);u(N);var Y=b(N,2),mt=v(Y);u(Y);var K=b(Y,4),at=v(K);{var Pt=t=>{var o=$t();J("click",o,gt),it(t,o)};Gt(at,t=>{l(m).length>0&&t(Pt)})}var Z=b(at,2),St=v(Z,!0);u(Z),u(K);var lt=b(K,2),ot=b(v(lt),2),Mt=v(ot,!0);u(ot),st(4),u(lt),u(et),u(tt),u(U),u(X),Ct(t=>{wt(E,1,Et(l(A)?"loading":""),"svelte-lzu280"),H(xt,`Samples: ${l(m).length??""}`),H(mt,`Current energy: ${t??""}`),H(St,l(G)?"Show GP Prediction":"Show Energy Function"),H(Mt,l(G)?"Showing actual energy function":"Showing Gaussian Process prediction")},[()=>F(l(M),l(z)).toFixed(2)],At),J("click",E,vt),J("click",Z,bt),it(ht,X),kt()}export{ee as component};
