import{t as pe,a as ve}from"../chunks/cGtBC6Qd.js";import"../chunks/7LKkzqbz.js";import{a4 as et,aa as K,ab as tt,a5 as st,a6 as d,a1 as r,ac as E,e as t,Z as Xe,a7 as v,a9 as Te,s as u,i as Be,aw as xt,a8 as mt}from"../chunks/BJ4irGt7.js";import{e as J,s as Q}from"../chunks/CvaqDwXv.js";import{i as Ze}from"../chunks/lIaEYNz1.js";import{s as Z,r as Ke}from"../chunks/B9r3SdpA.js";import{l as Ue,s as zt,c as yt}from"../chunks/dhIx7U5O.js";import{b as _t,a as Je}from"../chunks/RvGyPHbW.js";import{b as lt}from"../chunks/CUY-1DrG.js";import{i as it}from"../chunks/CkfO92w8.js";import{o as at}from"../chunks/Cpzjerpz.js";import{r as de,s as bt,v as At,z as Qe,l as Mt,m as St,a as wt,d as Pt,b as Tt,e as Et}from"../chunks/PBAI84v4.js";import{_ as It}from"../chunks/C1FmrZbK.js";import{p as Ve}from"../chunks/6XXKwe28.js";var Ct=pe('<main class="svelte-13sjxqj"><div class="viewer-container svelte-13sjxqj"><div id="viewer" class="svelte-13sjxqj"></div></div></main>');function kt(ue,V){et(V,!1);let I=`
ATOM      1  CH3 ACE     1       2.000   2.090   0.000
ATOM      2  C   ACE     1       3.427   2.641  -0.000
ATOM      3  O   ACE     1       4.391   1.877  -0.000
ATOM      4  N   ALA     2       3.555   3.970  -0.000
ATOM      5  CA  ALA     2       4.853   4.614  -0.000
ATOM     6  HA  ALA     2       5.408   4.316   0.890
ATOM     7  CB  ALA     2       5.661   4.221  -1.232
ATOM     8  C   ALA     2       4.713   6.129   0.000
ATOM     9  O   ALA     2       3.601   6.653   0.000
ATOM     10  N   NME     3       5.846   6.835   0.000
ATOM     11  H   NME     3       6.737   6.359  -0.000
ATOM     12  CH3 NME     3       5.846   8.284   0.000
TER   
END`,C=[6,7,8,9,10,11,12],D=4,k=5,ee=Ve(V,"angle",8,50),P=Ve(V,"phiAngle",8,0);function $(f){let h;Math.abs(f.z)>.9?h={x:0,y:f.z,z:-f.y}:h={x:-f.y,y:f.x,z:0};let g=Math.sqrt(h.x**2+h.y**2+h.z**2);return h.x/=g,h.y/=g,h.z/=g,h}function H(f,h,g,o,T){let U=T*Math.PI/180,q=Math.cos(U),y=Math.sin(U),b=1-q,M=[[q+o.x**2*b,o.x*o.y*b-o.z*y,o.x*o.z*b+o.y*y],[o.y*o.x*b+o.z*y,q+o.y**2*b,o.y*o.z*b-o.x*y],[o.z*o.x*b-o.y*y,o.z*o.y*b+o.x*y,q+o.z**2*b]];return h.forEach(O=>{let R=f[O-1],X=R.x-g.x,F=R.y-g.y,z=R.z-g.z,se=M[0][0]*X+M[0][1]*F+M[0][2]*z,le=M[1][0]*X+M[1][1]*F+M[1][2]*z,B=M[2][0]*X+M[2][1]*F+M[2][2]*z;R.x=se+g.x,R.y=le+g.y,R.z=B+g.z}),f}function N(f,h,g,o,T,U){let y=f.split(`
`).filter(z=>z.startsWith("ATOM")).map(z=>{let se=parseFloat(z.substring(30,38).trim()),le=parseFloat(z.substring(38,46).trim()),B=parseFloat(z.substring(46,54).trim());return{x:se,y:le,z:B,line:z}}),b=y[g-1],M=y[o-1],O={x:M.x-b.x,y:M.y-b.y,z:M.z-b.z},R=Math.sqrt(O.x**2+O.y**2+O.z**2);O.x/=R,O.y/=R,O.z/=R;let X=$(O);return y=H(y,h,b,O,T),y=H(y,h,b,X,U),y.forEach(z=>{z.line=z.line.substring(0,30)+z.x.toFixed(3).padStart(8)+z.y.toFixed(3).padStart(8)+z.z.toFixed(3).padStart(8)+z.line.substring(54)}),y.map(z=>z.line).join(`
`)+`
TER
END`}let j=E(),m=E(),Y=E();at(async()=>{if(typeof window<"u")try{const{createViewer:f}=await It(async()=>{const{createViewer:h}=await import("../chunks/kNyKxqkf.js").then(g=>g._);return{createViewer:h}},[],import.meta.url);console.log("3Dmol.js loaded successfully"),r(m,f(t(Y),{backgroundColor:"white"})),w(!0),window.addEventListener("resize",()=>{t(m)&&(t(m).resize(),t(m).render())})}catch(f){console.error("Failed to load 3Dmol.js:",f)}});function w(f=!0){t(m)&&(console.log("Updating viewer with angles:",ee(),P()),t(m).clear(),t(m).addModel(t(j),"pdb"),t(m).setStyle({},{stick:{radius:.2},sphere:{scale:.3}}),f&&t(m).zoomTo(),t(m).render())}K(()=>(Xe(ee()),Xe(P())),()=>{r(j,N(I,C,D,k,ee(),P()))}),K(()=>(t(m),t(j)),()=>{t(m)&&t(j)&&w(!1)}),tt(),it();var _=Ct(),i=d(_),te=d(i);lt(te,f=>r(Y,f),()=>t(Y)),v(i),v(_),ve(ue,_),st()}var Ot=pe(`<div class="game-ended-popup svelte-1os1z5x"><div class="popup-content svelte-1os1z5x"><h2 class="svelte-1os1z5x">Game Ended</h2> <p class="svelte-1os1z5x">You've used all your lives!</p> <p class="svelte-1os1z5x"> </p> <button class="svelte-1os1z5x">Play Again</button></div></div>`),Rt=pe('<button class="svelte-1os1z5x">Clear Samples</button>'),Ft=pe(`<main class="svelte-1os1z5x"><h1 class="svelte-1os1z5x">Protein Explorer</h1> <div class="live-bar-container svelte-1os1z5x"><div class="lives-label svelte-1os1z5x"> </div> <div class="live-bar svelte-1os1z5x"><div class="lives-remaining svelte-1os1z5x"></div> <span class="heart svelte-1os1z5x">❤️</span></div></div> <div class="score-bar-container svelte-1os1z5x"><div class="score-label svelte-1os1z5x">Score: <span id="score-percentage"> </span></div> <div class="score-bar svelte-1os1z5x"><div class="score-value svelte-1os1z5x" id="score-bar"></div> <span class="star svelte-1os1z5x" id="score-star">⭐</span></div></div> <!> <div class="level-container svelte-1os1z5x"><label for="level" class="level-label svelte-1os1z5x">Difficulty:</label> <select id="level" class="svelte-1os1z5x"><option>Level 1</option><option>Level 2</option><option>Level 3</option></select></div> <div class="container svelte-1os1z5x"><div class="panel svelte-1os1z5x"><h2 class="svelte-1os1z5x">Backbone Angles</h2>  <div class="molecule-visualization svelte-1os1z5x"><!></div> <div class="Other"><div class="control-panel svelte-1os1z5x"><div class="slider-container svelte-1os1z5x"><label for="angle" class="svelte-1os1z5x">Ψ Angle (degrees):</label> <input type="range" id="angle" min="0" max="360" step="1" class="svelte-1os1z5x"> <span class="svelte-1os1z5x"> </span></div> <div class="slider-container svelte-1os1z5x"><label for="phiAngle" class="svelte-1os1z5x">Φ Angle (degrees):</label> <input type="range" id="phiAngle" min="0" max="360" step="1" class="svelte-1os1z5x"> <span class="svelte-1os1z5x"> </span></div></div></div> <div class="instruction svelte-1os1z5x"><p class="svelte-1os1z5x">Rotating backbone angles changes the protein's shape, affecting its stability. Lower energy regions correspond to more stable conformations.</p></div></div> <div class="panel svelte-1os1z5x"><h2 class="svelte-1os1z5x">Energy Landscape</h2> <div class="contour-container svelte-1os1z5x"><canvas></canvas></div> <div class="instruction svelte-1os1z5x"><p class="highlight svelte-1os1z5x">Your goal is to train an emulator that accurately predicts the energy function using as few protein simulator runs as possible.</p></div> <div class="button-group svelte-1os1z5x"><!> <button class="info-button svelte-1os1z5x"> </button></div> <div class="instruction svelte-1os1z5x"><p class="svelte-1os1z5x">Click directly on the plot above to sample points. This will run the simulation and update the emulator model based on the simulator output.</p></div> <div class="button-group svelte-1os1z5x"><button class="info-button svelte-1os1z5x"><span>Go back</span></button></div></div></div></main>`);function Ut(ue,V){et(V,!1);const I=E(),C=E(),D=E(),k=E();function ee(){window.location.href="https://alan-turing-institute.github.io/gp-demo/"}let P=E([]),$=[],H=E(),N=E(!1),j=E(!1),m=E(20),Y=E(!1);const w=400,_=400,i=40,te=w-2*i,f=Ue([0,360],[i,w-i]),h=Ue([0,360],[_-i,i]),g={primary:"#3c6382",accent:"#60a3bc",highlight:"#6a89cc",text:"#2c3e50"};let o=1/0,T=-1/0;function U(){const p=de(0,360,7.2).toArray(),n=de(0,360,360/50).toArray();for(const s of p)for(const a of n){const l=y(s,a);o=Math.min(o,l),T=Math.max(T,l)}o=Math.floor(o*10)/10,T=Math.ceil(T*10)/10,console.log(`Energy range: ${o} to ${T}`)}function q(e){return e*(Math.PI/180)}function y(e,p){const n=q(e)-Math.PI,s=q(p)-Math.PI,a=Math.exp(-((n+Math.PI/2)**2)-(s-Math.PI/2)**2/.5),l=Math.exp(-((n+Math.PI/2)**2)-(s+.5)**2/.3),c=Math.exp(-((n-Math.PI/2)**2)-(s+Math.PI/2)**2/.5),A=Math.exp(-((n-Math.PI/2)**2)-(s-.5)**2/.3),L=Math.exp(-((n-0)**2)/.3-(s-Math.PI/4)**2/.2);let S=0;return t(k)=="1"?S=a:t(k)=="2"?S=a+l:t(k)=="3"?S=a+l+c+A+L:console.error("Invalid difficulty level: ",t(k)),-Math.log(S+1e-6)}function b(){r(P,[]),$=[],F(),r(m,20),r(D,0)}function M(e){if(t(N)||t(m)<=0)return;const p=t(H).getBoundingClientRect(),n=e.clientX-p.left,s=e.clientY-p.top,a=Math.round(f.invert(n)),l=Math.round(h.invert(s));if(n>=i&&n<=w-i&&s>=i&&s<=_-i){r(I,a),r(C,l);const c=y(t(I),t(C));r(P,[...t(P),{phi:t(I),psi:t(C),energy:c}]),r(m,t(m)-1),t(m)===0&&r(Y,!0),X()}}function O(){r(m,20),r(D,0),r(P,[]),$=[],r(Y,!1),F()}function R(e,p){if(e.length!==p.length||e.length===0)throw new Error("Arrays must be of the same length and non-empty");const n=e.reduce((c,A)=>c+A,0)/e.length,s=e.reduce((c,A)=>c+Math.pow(A-n,2),0),l=1-e.reduce((c,A,L)=>c+Math.pow(A-p[L],2),0)/s;return Math.max(0,l)}function X(){r(N,!0);let e=[],p=[];if(t(P).length===0){r(N,!1),F();return}setTimeout(()=>{console.log("Updating GP model...");const n=t(P).map(x=>[x.phi,x.psi]),s=t(P).map(x=>x.energy),a=(x,W,re=1*(180/Math.PI))=>{const ce=wt(Pt(Tt(x,W),2));return Et(-.5*ce/(re*re))},l=n.length,c=Qe(l,l);for(let x=0;x<l;x++)for(let W=0;W<l;W++)c.set([x,W],a(n[x],n[W]));const A=.01;for(let x=0;x<l;x++)c.set([x,x],c.get([x,x])+A);const L=40,S=de(0,360,360/L).toArray(),ae=de(0,360,360/L).toArray();$=[];for(const x of S)for(const W of ae){const re=[x,W],ce=Qe(1,l);for(let G=0;G<l;G++)ce.set([0,G],a(re,n[G]));try{const G=Mt(c,s),Ye=St(ce,G).get([0,0]);$.push({phi:x,psi:W,predicted:Ye}),p.push(Ye),e.push(y(x,W))}catch(G){console.error("Error in GP calculation:",G)}}F(),r(D,R(e,p)),console.log("R2 Score: ",t(D)),r(N,!1)},50)}function F(){if(!t(H))return;const e=t(H).getContext("2d");e.clearRect(0,0,w+60,_);const p=bt().domain([T,o]).interpolator(At);if(t(j)){const s=te/80;for(let a=0;a<80;a++)for(let l=0;l<80;l++){const c=0+360*a/80,A=0+360*l/80,L=y(c,A),S=f(c),ae=h(A);e.fillStyle=p(L),e.fillRect(S-s/2,ae-s/2,s,s)}}else if($.length===0){const s=te/80;for(let a=0;a<80;a++)for(let l=0;l<80;l++){const c=0+360*a/80,A=0+360*l/80,L=f(c),S=h(A);e.fillStyle=p(0),e.fillRect(L-s/2,S-s/2,s,s)}}else{const n=te/Math.sqrt($.length);$.forEach(s=>{const a=f(s.phi),l=h(s.psi);e.fillStyle=p(s.predicted),e.fillRect(a-n/2,l-n/2,n,n)})}z(e,p),e.strokeStyle=g.primary,e.lineWidth=2,e.beginPath(),e.moveTo(i,_-i),e.lineTo(w-i,_-i),e.moveTo(i,i),e.lineTo(i,_-i),e.stroke(),e.fillStyle=g.text,e.font="bold 14px Arial, sans-serif",e.textAlign="center",e.fillText("0",i,_-i+15),e.fillText("180",w/2,_-i+15),e.fillText("360",w-i,_-i+15),e.fillText("φ",w-i+10,_-i+25),e.textAlign="right",e.fillText("0",i-5,_-i),e.fillText("180",i-5,_/2),e.fillText("360",i-5,i),e.fillText("ψ",i-20,i-20),t(P).forEach(n=>{const s=f(n.phi),a=h(n.psi),l=8,c=e.createRadialGradient(s,a,2,s,a,l);c.addColorStop(0,g.highlight),c.addColorStop(1,"rgba(106, 137, 204, 0)"),e.fillStyle=c,e.beginPath(),e.arc(s,a,l,0,2*Math.PI),e.fill(),e.fillStyle=g.accent,e.beginPath(),e.arc(s,a,4,0,2*Math.PI),e.fill(),e.strokeStyle=g.primary,e.lineWidth=1,e.stroke()})}function z(e,p){const s=_-2*i,a=w-i+20,l=i,c=100,A=s/c;for(let S=0;S<c;S++){const ae=o+(T-o)*(c-S-1)/c;e.fillStyle=p(ae),e.fillRect(a,l+S*A,20,A+1)}e.strokeStyle=g.text,e.lineWidth=1,e.strokeRect(a,l,20,s),e.fillStyle=g.text,e.font="12px Arial, sans-serif",e.textAlign="left",e.fillText(o.toFixed(1),a+20+5,l+s),e.fillText(T.toFixed(1),a+20+5,l);const L=(o+T)/2;e.fillText(L.toFixed(1),a+20+5,l+s/2),e.save(),e.translate(a+20+25,l+s/2),e.rotate(-Math.PI/2),e.textAlign="center",e.fillText("Energy",0,10),e.restore()}function se(){r(j,!t(j)),F()}at(()=>{U(),F()});function le(e){r(k,e.target.value),t(j)&&F(),console.log("Difficulty level set to: ",t(k))}K(()=>{},()=>{r(I,0)}),K(()=>{},()=>{r(C,0)}),K(()=>{},()=>{r(D,0)}),K(()=>(t(I),t(C)),()=>{}),K(()=>{},()=>{r(k,"3")}),tt(),it();var B=Ft(),fe=u(d(B),2),he=d(fe),ot=d(he);v(he);var Ee=u(he,2),Ie=d(Ee),nt=u(Ie,2);v(Ee),v(fe);var ge=u(fe,2),xe=d(ge),Ce=u(d(xe)),rt=d(Ce);v(Ce),v(xe);var ke=u(xe,2),Oe=d(ke),ct=u(Oe,2);v(ke),v(ge);var Re=u(ge,2);{var dt=e=>{var p=Ot(),n=d(p),s=u(d(n),4),a=d(s);v(s);var l=u(s,2);v(n),v(p),Te(c=>Q(a,`Final score: ${c??""}%`),[()=>(t(D)*100).toFixed(0)],Be),J("click",l,O),ve(e,p)};Ze(Re,e=>{t(Y)&&e(dt)})}var me=u(Re,2),oe=u(d(me),2);Te(()=>{t(k),xt(()=>{})});var ze=d(oe);ze.value=(ze.__value="1")==null?"":"1";var ye=u(ze);ye.value=(ye.__value="2")==null?"":"2";var Fe=u(ye);Fe.value=(Fe.__value="3")==null?"":"3",v(oe),v(me);var Le=u(me,2),_e=d(Le),ne=u(d(_e),2);Z(ne,"style",`width: ${w}px; height: ${_}px;`);var vt=d(ne);kt(vt,{get angle(){return t(I)},set angle(e){r(I,e)},get phiAngle(){return t(C)},set phiAngle(e){r(C,e)},$$legacy:!0}),v(ne);var De=u(ne,2),je=d(De),be=d(je),Ae=u(d(be),2);Ke(Ae);var We=u(Ae,2),pt=d(We);v(We),v(be);var $e=u(be,2),Me=u(d($e),2);Ke(Me);var He=u(Me,2),ut=d(He);v(He),v($e),v(je),v(De),mt(2),v(_e);var qe=u(_e,2),Se=u(d(qe),2),ie=d(Se);Z(ie,"width",w+60),Z(ie,"height",_),lt(ie,e=>r(H,e),()=>t(H)),v(Se);var we=u(Se,4),Ge=d(we);{var ft=e=>{var p=Rt();J("click",p,b),ve(e,p)};Ze(Ge,e=>{t(P).length>0&&e(ft)})}var Pe=u(Ge,2),ht=d(Pe,!0);v(Pe),v(we);var Ne=u(we,4),gt=d(Ne);v(Ne),v(qe),v(Le),v(B),Te((e,p)=>{Q(ot,`Lives ${t(m)??""}/20`),Z(Ie,"style",`width: ${e??""}%`),Z(nt,"style",`left: ${e??""}%`),Q(rt,`${p??""}%`),Z(Oe,"style",`width: ${t(D)*100}%`),Z(ct,"style",`left: ${t(D)*100}%`),Q(pt,`${t(C)??""}°`),Q(ut,`${t(I)??""}°`),zt(ie,1,yt(t(N)?"loading":""),"svelte-1os1z5x"),Q(ht,t(j)?"Show Emulator Prediction":"Show Simulator Function")},[()=>Math.max(0,t(m)/20*100),()=>(t(D)*100).toFixed(0)],Be),_t(oe,()=>t(k),e=>r(k,e)),J("change",oe,le),Je(Ae,()=>t(C),e=>r(C,e)),Je(Me,()=>t(I),e=>r(I,e)),J("click",ie,M),J("click",Pe,se),J("click",gt,ee),ve(ue,B),st()}export{Ut as component};
