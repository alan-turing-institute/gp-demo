import{t as B,a as q}from"../chunks/cGtBC6Qd.js";import"../chunks/7LKkzqbz.js";import{a4 as ae,aa as Et,ab as oe,a9 as et,a5 as le,s as p,a6 as f,i as Ct,e as i,ac as A,a1 as v,a7 as y,f as Wt,a8 as ne}from"../chunks/BJ4irGt7.js";import{e as G,s as K}from"../chunks/CvaqDwXv.js";import{i as it}from"../chunks/lIaEYNz1.js";import{s as P}from"../chunks/B9r3SdpA.js";import{l as ft,s as yt,c as Ft}from"../chunks/dhIx7U5O.js";import{b as st}from"../chunks/CUY-1DrG.js";import{i as re}from"../chunks/CkfO92w8.js";import{o as Rt}from"../chunks/Cpzjerpz.js";import{r as at,s as ce,v as Vt,z as It,l as de,m as ve}from"../chunks/PBAI84v4.js";var he=B(`<div class="game-ended-popup svelte-1yd1xj5"><div class="popup-content svelte-1yd1xj5"><h2 class="svelte-1yd1xj5">Game Ended</h2> <p class="svelte-1yd1xj5">You've used all your lives!</p> <p class="svelte-1yd1xj5"> </p> <button class="svelte-1yd1xj5">Play Again</button></div></div>`),fe=B('<button class="svelte-1yd1xj5">Clear Samples</button>'),ye=B('<div class="panel svelte-1yd1xj5"><h2 class="svelte-1yd1xj5">Asteroid Visualization</h2> <canvas class="svelte-1yd1xj5"></canvas></div> <div class="panel svelte-1yd1xj5"><h2 class="svelte-1yd1xj5">Flyby distance past Earth</h2> <div class="contour-container svelte-1yd1xj5"><canvas></canvas></div> <div class="button-group svelte-1yd1xj5"><!> <button class="info-button svelte-1yd1xj5"> </button></div> <div class="instruction svelte-1yd1xj5"><p class="svelte-1yd1xj5">Click directly on the plot above to sample points. This will run the simulation and update the emulator model based on the simulator output.</p></div></div>',1),ge=B('<button class="svelte-1yd1xj5">Clear Samples</button>'),pe=B('<div class="grid-item energy-plot svelte-1yd1xj5"><h2 class="svelte-1yd1xj5">Flyby distance past Earth</h2> <div class="contour-container svelte-1yd1xj5"><canvas></canvas></div></div> <div class="grid-item buttons svelte-1yd1xj5"><div class="instruction svelte-1yd1xj5"><p class="svelte-1yd1xj5">Click directly on the plot to sample points. This will run the simulation and update the emulator model based on the simulator output.</p></div> <div class="vertical-button-group svelte-1yd1xj5"><!> <button class="info-button svelte-1yd1xj5"> </button></div></div> <div class="grid-item molecule-panel svelte-1yd1xj5"><h2 class="svelte-1yd1xj5">Asteroid Visualization</h2> <canvas class="svelte-1yd1xj5"></canvas></div>',1),ue=B('<main class="svelte-1yd1xj5"><h1 class="svelte-1yd1xj5">Asteroid Explorer</h1> <div class="instruction svelte-1yd1xj5"><p class="svelte-1yd1xj5">Flyby distance is the closest approach distance given an object’s hyperbolic speed and impact parameter. A value of 0 indicates a collision with Earth.</p></div> <div class="instruction svelte-1yd1xj5"><p class="highlight svelte-1yd1xj5">Your goal is to train an emulator that accurately predicts flyby distance using as few asteroid simulator runs as possible.</p></div> <div class="bars-container svelte-1yd1xj5"><div class="live-bar-container svelte-1yd1xj5"><div class="lives-label"> </div> <div class="live-bar svelte-1yd1xj5"><div class="lives-remaining svelte-1yd1xj5"></div> <span class="heart svelte-1yd1xj5">❤️</span></div></div> <div class="score-bar-container svelte-1yd1xj5"><div class="score-label">Score: <span id="score-percentage"> </span></div> <div class="score-bar svelte-1yd1xj5"><div class="score-value svelte-1yd1xj5" id="score-bar"></div> <span class="star svelte-1yd1xj5" id="score-star">⭐</span></div></div></div> <!> <div><!></div> <div class="button-group svelte-1yd1xj5" style="margin-top: 20px; text-align: center;"><button class="info-button svelte-1yd1xj5"><span>Go back</span></button></div></main>');function Me(Gt,Yt){ae(Yt,!1);const M=A();function $t(){window.location.href="https://alan-turing-institute.github.io/gp-demo/"}const u={primary:"#3c6382",accent:"#60a3bc",highlight:"#6a89cc",text:"#2c3e50",surface:"#dcdde1",error:"#e55039"};let Y=A(5e3),$=A(3),w=A([]),E=[],C=A(),k=A(),H=A(!1),O=A(!1),z=A(20),D=A(!1);const W=6371;function Ot(){localStorage.setItem("asteroidExplorerState",JSON.stringify({samples:i(w),gpPredictions:E,lives:i(z),score:i(M),gameEnded:i(D),showEnergyFunction:i(O),phi,psi}))}function Ht(){const t=localStorage.getItem("asteroidExplorerState");if(t){const o=JSON.parse(t);v(w,o.samples),E=o.gpPredictions,v(z,o.lives),v(M,o.score),v(D,o.gameEnded),v(O,o.showEnergyFunction),phi=o.phi,psi=o.psi}}let ot=A(!1);function lt(){v(ot,window.innerHeight>window.innerWidth)}Rt(()=>(Ht(),gt(),Q(),L(),lt(),window.addEventListener("resize",lt),()=>{Ot(),window.removeEventListener("resize",lt)}));function Lt(t,o,n=398600.4418,e=6371){const s=Math.sqrt(1+Math.pow(o,2)*Math.pow(t,4)/Math.pow(n,2)),a=n*(s-1)/Math.pow(t,2);return a>=e?a:0}function Z(t,o){return Lt(o,t)}const j=400,S=400,r=40,nt=j-2*r,N=ft().domain([5e3,5*W]).range([r,j-r]),J=ft().domain([3,20]).range([S-r,r]);let F=1/0,V=-1/0;function gt(){const o=at(5e3,5*W,(5*W-5e3)/50).toArray(),n=at(3,20,17/50).toArray();for(const e of o)for(const s of n){const a=Z(e,s);F=Math.min(F,a),V=Math.max(V,a)}F=Math.floor(F*10)/10,V=Math.ceil(V*10)/10,console.log(`Energy range: ${F} to ${V}`)}function pt(){v(w,[]),E=[],L(),v(z,20),v(M,0)}function ut(t){if(i(H)||i(z)<=0)return;const o=i(k).getBoundingClientRect(),n=i(k).width/o.width,e=i(k).height/o.height,s=(t.clientX-o.left)*n,a=(t.clientY-o.top)*e;if(s>=r&&s<=j-r&&a>=r&&a<=S-r){const l=N.invert(s),h=J.invert(a);v(Y,l),v($,h);const b=Z(i(Y),i($));v(w,[...i(w),{angle:i(Y),velocity:i($),energy:b}]),v(z,i(z)-1),i(z)===0&&v(D,!0),Bt(),Q()}}function Xt(){v(z,20),v(M,0),v(w,[]),E=[],v(D,!1),L()}function qt(t,o){if(t.length!==o.length||t.length===0)throw new Error("Arrays must be of the same length and non-empty");const n=t.reduce((l,h)=>l+h,0)/t.length,e=t.reduce((l,h)=>l+Math.pow(h-n,2),0),a=1-t.reduce((l,h,b)=>l+Math.pow(h-o[b],2),0)/e;return Math.max(0,a)}function Bt(){v(H,!0);let t=[],o=[];if(i(w).length===0){v(H,!1);return}setTimeout(()=>{const n=i(w).map(c=>[c.angle,c.velocity]),e=i(w).map(c=>c.energy),s=(c,d)=>{const g=(c[0]-d[0])/1e4,T=(c[1]-d[1])/5;return Math.exp(-.5*(g*g+T*T))},a=n.length,l=It(a,a);for(let c=0;c<a;c++)for(let d=0;d<a;d++)l.set([c,d],s(n[c],n[d]));const h=.01;for(let c=0;c<a;c++)l.set([c,c],l.get([c,c])+h);const b=40,m=at(5e3,5*W,(5*W-5e3)/b).toArray(),_=at(3,20,17/b).toArray();E=[];for(const c of m)for(const d of _){const g=[c,d],T=It(1,a);for(let x=0;x<a;x++)T.set([0,x],s(g,n[x]));try{const x=de(l,e),X=ve(T,x).get([0,0]);E.push({angle:c,velocity:d,predicted:X}),o.push(X),t.push(Z(c,d))}catch(x){console.error("Error in GP calculation:",x)}}L(),v(M,qt(t,o)),v(H,!1)},50)}function L(){if(!i(k))return;const t=i(k).getContext("2d");t.clearRect(0,0,i(k).width,i(k).height);const o=ce(Vt).domain([V,F]).interpolator(Vt);if(i(O)){const e=nt/80;for(let s=0;s<80;s++)for(let a=0;a<80;a++){const l=5e3+(5*W-5e3)*s/80,h=3+17*a/80,b=Z(l,h),m=N(l),_=J(h);t.fillStyle=o(b),t.fillRect(m-e/2,_-e/2,e,e)}}else if(E.length===0){const e=nt/80;for(let s=0;s<80;s++)for(let a=0;a<80;a++){const l=5e3+(5*W-5e3)*s/80,h=3+17*a/80,b=N(l),m=J(h);t.fillStyle=o(0),t.fillRect(b-e/2,m-e/2,e,e)}}else{const n=nt/Math.sqrt(E.length);E.forEach(e=>{const s=N(e.angle),a=J(e.velocity);t.fillStyle=o(e.predicted),t.fillRect(s-n/2,a-n/2,n,n)})}Dt(t,o),t.strokeStyle=u.primary,t.lineWidth=2,t.beginPath(),t.moveTo(r,S-r),t.lineTo(j-r,S-r),t.moveTo(r,r),t.lineTo(r,S-r),t.stroke(),t.fillStyle=u.text,t.font="12px Arial, sans-serif",t.textAlign="center",t.fillText("5000",r,S-r+15),t.fillText(String(5*W),j-r,S-r+15),t.fillText("Impact parameter (km)",j/2,S-r+20),t.textAlign="right",t.fillText("3",r-10,S-r),t.fillText("20",r-10,r),t.save(),t.translate(r-15,S/2-25),t.rotate(-Math.PI/2),t.fillText("Velocity (km/s)",0,0),t.restore(),i(w).forEach(n=>{const e=N(n.angle),s=J(n.velocity),a=10,l=t.createRadialGradient(e,s,2,e,s,a);l.addColorStop(0,u.highlight),l.addColorStop(1,"rgba(106, 137, 204, 0)"),t.fillStyle=l,t.beginPath(),t.arc(e,s,a,0,2*Math.PI),t.fill(),t.fillStyle=u.accent,t.beginPath(),t.arc(e,s,6,0,2*Math.PI),t.fill(),t.strokeStyle=u.primary,t.lineWidth=1,t.stroke()})}function Dt(t,o){const e=S-2*r,s=j-r+20,a=r,l=100,h=e/l;for(let d=0;d<l;d++){const g=F+(V-F)*(l-d-1)/l;t.fillStyle=o(g),t.fillRect(s,a+d*h,20,h+1)}t.strokeStyle=u.text,t.lineWidth=1,t.strokeRect(s,a,20,e),t.fillStyle=u.text,t.font="14px Arial, sans-serif",t.textAlign="left";const b=5,m=a+e;t.beginPath(),t.moveTo(s,m),t.lineTo(s+20,m),t.stroke(),t.fillText(F.toFixed(1),s+20+b,m+5);const _=a;t.beginPath(),t.moveTo(s,_),t.lineTo(s+20,_),t.stroke(),t.fillText(V.toFixed(1),s+20+b,_+5);const c=a+e/2;t.beginPath(),t.moveTo(s,c),t.stroke(),t.save(),t.translate(s-25,a+e/2),t.rotate(Math.PI/2),t.textAlign="center",t.fillText("Flyby Distance (km)",0,-60),t.restore()}function Q(){if(!i(C))return;const t=i(C).getContext("2d");t.clearRect(0,0,j,S);const e=ft().domain([5e3,5*W]).range([S-r-30,r])(i(Y)),s=r*2;t.save(),t.setLineDash([5,5]),t.beginPath(),t.moveTo(0,e),t.lineTo(j,e),t.strokeStyle=u.error,t.lineWidth=1,t.stroke(),t.restore();const a=20,l=12,h=2*Math.PI/l;t.beginPath();for(let tt=0;tt<l;tt++){const Pt=tt*h,se=.8+Math.random()*.4,At=a*se,Mt=s+At*Math.cos(Pt),zt=e+At*Math.sin(Pt);tt===0?t.moveTo(Mt,zt):t.lineTo(Mt,zt)}t.closePath(),t.fillStyle=u.surface,t.fill(),t.strokeStyle=u.primary,t.lineWidth=2,t.stroke(),t.fillStyle=u.text,t.font="12px Arial",t.textAlign="center",t.fillText("Asteroid",s,e+a+15);const m=i($)*10;t.beginPath(),t.moveTo(s,e),t.lineTo(s+m,e),t.strokeStyle=u.error,t.lineWidth=3,t.stroke();const _=8;t.beginPath(),t.moveTo(s+m,e),t.lineTo(s+m-_,e-_/2),t.lineTo(s+m-_,e+_/2),t.closePath(),t.fillStyle=u.error,t.fill();const c=s+m/2,d=e;t.fillStyle=u.text,t.font="12px Arial",t.textAlign="center",t.fillText("velocity",c+25,d-10);const g=20,T=j-r-g,x=S-r-g,X=t.createRadialGradient(T,x,g*.3,T,x,g);X.addColorStop(0,"#66ccff"),X.addColorStop(1,"#003366"),t.beginPath(),t.arc(T,x,g,0,2*Math.PI),t.fillStyle=X,t.fill(),t.strokeStyle="#002244",t.lineWidth=2,t.stroke(),t.beginPath(),t.moveTo(0,x),t.lineTo(j,x),t.strokeStyle=u.primary,t.lineWidth=2,t.stroke();const R=(s+T)/2;t.beginPath(),t.moveTo(R,e),t.lineTo(R,x),t.strokeStyle=u.text,t.lineWidth=1,t.stroke();const I=5;t.beginPath(),t.moveTo(R,e),t.lineTo(R-I,e+I),t.lineTo(R+I,e+I),t.closePath(),t.fillStyle=u.text,t.fill(),t.beginPath(),t.moveTo(R,x),t.lineTo(R-I,x-I),t.lineTo(R+I,x-I),t.closePath(),t.fillStyle=u.text,t.fill(),t.save(),t.fillStyle=u.text,t.font="12px Arial",t.textAlign="left",t.fillText("impact parameter",R+5,(e+x)/2),t.restore(),t.fillStyle=u.text,t.font="12px Arial",t.textAlign="center",t.fillText("Earth",T,x+g+15),t.fillStyle=u.text,t.font="14px Arial",t.textAlign="left",t.fillText(`Impact Parameter: ${i(Y).toFixed(0)} km`,20,30),t.fillText(`Velocity: ${i($).toFixed(2)} km/s`,20,50)}function mt(){v(O,!i(O)),L()}Rt(()=>{console.log("Astroid canvas:",i(C)),console.log("Contour canvas:",i(k)),gt(),Q(),L()}),Et(()=>{},()=>{v(M,0)}),Et(()=>(i(C),i(Y),i($)),()=>{i(C)&&(i(Y)!==void 0||i($)!==void 0)&&Q()}),oe(),re();var rt=ue(),ct=p(f(rt),6),dt=f(ct),vt=f(dt),Nt=f(vt);y(vt);var xt=p(vt,2),bt=f(xt),Jt=p(bt,2);y(xt),y(dt);var St=p(dt,2),ht=f(St),_t=p(f(ht)),Kt=f(_t);y(_t),y(ht);var jt=p(ht,2),Tt=f(jt),Zt=p(Tt,2);y(jt),y(St),y(ct);var wt=p(ct,2);{var Qt=t=>{var o=he(),n=f(o),e=p(f(n),4),s=f(e);y(e);var a=p(e,2);y(n),y(o),et(l=>K(s,`Final score: ${l??""}%`),[()=>(i(M)*100).toFixed(0)],Ct),G("click",a,Xt),q(t,o)};it(wt,t=>{i(D)&&t(Qt)})}var U=p(wt,2),Ut=f(U);{var te=t=>{var o=ye(),n=Wt(o),e=p(f(n),2);P(e,"width",j),P(e,"height",S),st(e,d=>v(C,d),()=>i(C)),y(n);var s=p(n,2),a=p(f(s),2),l=f(a);P(l,"width",j+60),P(l,"height",S),st(l,d=>v(k,d),()=>i(k)),y(a);var h=p(a,2),b=f(h);{var m=d=>{var g=fe();G("click",g,pt),q(d,g)};it(b,d=>{i(w).length>0&&d(m)})}var _=p(b,2),c=f(_,!0);y(_),y(h),ne(2),y(s),et(()=>{yt(l,1,Ft(i(H)?"loading":""),"svelte-1yd1xj5"),K(c,i(O)?"Show Emulator Prediction":"Show Simulator Function")}),G("click",l,ut),G("click",_,mt),q(t,o)},ee=t=>{var o=pe(),n=Wt(o),e=p(f(n),2),s=f(e);P(s,"width",j+60),P(s,"height",S),st(s,g=>v(k,g),()=>i(k)),y(e),y(n);var a=p(n,2),l=p(f(a),2),h=f(l);{var b=g=>{var T=ge();G("click",T,pt),q(g,T)};it(h,g=>{i(w).length>0&&g(b)})}var m=p(h,2),_=f(m,!0);y(m),y(l),y(a);var c=p(a,2),d=p(f(c),2);P(d,"width",j),P(d,"height",S),st(d,g=>v(C,g),()=>i(C)),y(c),et(()=>{yt(s,1,Ft(i(H)?"loading":""),"svelte-1yd1xj5"),K(_,i(O)?"Show Emulator Prediction":"Show Simulator Function")}),G("click",s,ut),G("click",m,mt),q(t,o)};it(Ut,t=>{i(ot)?t(ee,!1):t(te)})}y(U);var kt=p(U,2),ie=f(kt);y(kt),y(rt),et((t,o)=>{K(Nt,`Guesses left ${i(z)??""}/20`),P(bt,"style",`width: ${t??""}%`),P(Jt,"style",`left: ${t??""}%`),K(Kt,`${o??""}%`),P(Tt,"style",`width: ${i(M)*100}%`),P(Zt,"style",`left: ${i(M)*100}%`),yt(U,1,`responsive-grid ${(i(ot)?"vertical":"horizontal")??""}`,"svelte-1yd1xj5")},[()=>Math.max(0,i(z)/20*100),()=>(i(M)*100).toFixed(0)],Ct),G("click",ie,$t),q(Gt,rt),le()}export{Me as component};
