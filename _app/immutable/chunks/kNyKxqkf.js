function _mergeNamespaces(K,C){for(var d=0;d<C.length;d++){const M=C[d];if(typeof M!="string"&&!Array.isArray(M)){for(const L in M)if(L!=="default"&&!(L in K)){const w=Object.getOwnPropertyDescriptor(M,L);w&&Object.defineProperty(K,L,w.get?w:{enumerable:!0,get:()=>M[L]})}}}return Object.freeze(Object.defineProperty(K,Symbol.toStringTag,{value:"Module"}))}var _3Dmol$2={exports:{}};/*!
 * 3dmol v2.4.2
 * JavaScript/TypeScript molecular visualization library
 * Author: David Koes and contributors
 */var _3Dmol$1=_3Dmol$2.exports,hasRequired_3Dmol;function require_3Dmol(){return hasRequired_3Dmol||(hasRequired_3Dmol=1,function(module,exports){(function(C,d){module.exports=d()})(_3Dmol$1,()=>(()=>{var __webpack_modules__={"./node_modules/iobuffer/lib-esm/IOBuffer.js":(K,C,d)=>{d.r(C),d.d(C,{IOBuffer:()=>g});var M=d("./node_modules/iobuffer/lib-esm/text.browser.js");const L=1024*8,w=(()=>{const _=new Uint8Array(4),A=new Uint32Array(_.buffer);return!((A[0]=1)&_[0])})(),O={int8:globalThis.Int8Array,uint8:globalThis.Uint8Array,int16:globalThis.Int16Array,uint16:globalThis.Uint16Array,int32:globalThis.Int32Array,uint32:globalThis.Uint32Array,uint64:globalThis.BigUint64Array,int64:globalThis.BigInt64Array,float32:globalThis.Float32Array,float64:globalThis.Float64Array};class g{constructor(A=L,c={}){let y=!1;typeof A=="number"?A=new ArrayBuffer(A):(y=!0,this.lastWrittenByte=A.byteLength);const b=c.offset?c.offset>>>0:0,u=A.byteLength-b;let p=b;(ArrayBuffer.isView(A)||A instanceof g)&&(A.byteLength!==A.buffer.byteLength&&(p=A.byteOffset+b),A=A.buffer),y?this.lastWrittenByte=u:this.lastWrittenByte=0,this.buffer=A,this.length=u,this.byteLength=u,this.byteOffset=p,this.offset=0,this.littleEndian=!0,this._data=new DataView(this.buffer,p,u),this._mark=0,this._marks=[]}available(A=1){return this.offset+A<=this.length}isLittleEndian(){return this.littleEndian}setLittleEndian(){return this.littleEndian=!0,this}isBigEndian(){return!this.littleEndian}setBigEndian(){return this.littleEndian=!1,this}skip(A=1){return this.offset+=A,this}back(A=1){return this.offset-=A,this}seek(A){return this.offset=A,this}mark(){return this._mark=this.offset,this}reset(){return this.offset=this._mark,this}pushMark(){return this._marks.push(this.offset),this}popMark(){const A=this._marks.pop();if(A===void 0)throw new Error("Mark stack empty");return this.seek(A),this}rewind(){return this.offset=0,this}ensureAvailable(A=1){if(!this.available(A)){const y=(this.offset+A)*2,b=new Uint8Array(y);b.set(new Uint8Array(this.buffer)),this.buffer=b.buffer,this.length=this.byteLength=y,this._data=new DataView(this.buffer)}return this}readBoolean(){return this.readUint8()!==0}readInt8(){return this._data.getInt8(this.offset++)}readUint8(){return this._data.getUint8(this.offset++)}readByte(){return this.readUint8()}readBytes(A=1){return this.readArray(A,"uint8")}readArray(A,c){const y=O[c].BYTES_PER_ELEMENT*A,b=this.byteOffset+this.offset,u=this.buffer.slice(b,b+y);if(this.littleEndian===w&&c!=="uint8"&&c!=="int8"){const r=new Uint8Array(this.buffer.slice(b,b+y));r.reverse();const e=new O[c](r.buffer);return this.offset+=y,e.reverse(),e}const p=new O[c](u);return this.offset+=y,p}readInt16(){const A=this._data.getInt16(this.offset,this.littleEndian);return this.offset+=2,A}readUint16(){const A=this._data.getUint16(this.offset,this.littleEndian);return this.offset+=2,A}readInt32(){const A=this._data.getInt32(this.offset,this.littleEndian);return this.offset+=4,A}readUint32(){const A=this._data.getUint32(this.offset,this.littleEndian);return this.offset+=4,A}readFloat32(){const A=this._data.getFloat32(this.offset,this.littleEndian);return this.offset+=4,A}readFloat64(){const A=this._data.getFloat64(this.offset,this.littleEndian);return this.offset+=8,A}readBigInt64(){const A=this._data.getBigInt64(this.offset,this.littleEndian);return this.offset+=8,A}readBigUint64(){const A=this._data.getBigUint64(this.offset,this.littleEndian);return this.offset+=8,A}readChar(){return String.fromCharCode(this.readInt8())}readChars(A=1){let c="";for(let y=0;y<A;y++)c+=this.readChar();return c}readUtf8(A=1){return(0,M.decode)(this.readBytes(A))}decodeText(A=1,c="utf-8"){return(0,M.decode)(this.readBytes(A),c)}writeBoolean(A){return this.writeUint8(A?255:0),this}writeInt8(A){return this.ensureAvailable(1),this._data.setInt8(this.offset++,A),this._updateLastWrittenByte(),this}writeUint8(A){return this.ensureAvailable(1),this._data.setUint8(this.offset++,A),this._updateLastWrittenByte(),this}writeByte(A){return this.writeUint8(A)}writeBytes(A){this.ensureAvailable(A.length);for(let c=0;c<A.length;c++)this._data.setUint8(this.offset++,A[c]);return this._updateLastWrittenByte(),this}writeInt16(A){return this.ensureAvailable(2),this._data.setInt16(this.offset,A,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeUint16(A){return this.ensureAvailable(2),this._data.setUint16(this.offset,A,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeInt32(A){return this.ensureAvailable(4),this._data.setInt32(this.offset,A,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeUint32(A){return this.ensureAvailable(4),this._data.setUint32(this.offset,A,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat32(A){return this.ensureAvailable(4),this._data.setFloat32(this.offset,A,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat64(A){return this.ensureAvailable(8),this._data.setFloat64(this.offset,A,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeBigInt64(A){return this.ensureAvailable(8),this._data.setBigInt64(this.offset,A,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeBigUint64(A){return this.ensureAvailable(8),this._data.setBigUint64(this.offset,A,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeChar(A){return this.writeUint8(A.charCodeAt(0))}writeChars(A){for(let c=0;c<A.length;c++)this.writeUint8(A.charCodeAt(c));return this}writeUtf8(A){return this.writeBytes((0,M.encode)(A))}toArray(){return new Uint8Array(this.buffer,this.byteOffset,this.lastWrittenByte)}_updateLastWrittenByte(){this.offset>this.lastWrittenByte&&(this.lastWrittenByte=this.offset)}}},"./node_modules/iobuffer/lib-esm/text-encoding-polyfill.js":function(){(function(K){if(K.TextEncoder&&K.TextDecoder)return!1;function C(M="utf-8"){if(M!=="utf-8")throw new RangeError(`Failed to construct 'TextEncoder': The encoding label provided ('${M}') is invalid.`)}Object.defineProperty(C.prototype,"encoding",{value:"utf-8"}),C.prototype.encode=function(M,L={stream:!1}){if(L.stream)throw new Error("Failed to encode: the 'stream' option is unsupported.");let w=0;const O=M.length;let g=0,_=Math.max(32,O+(O>>1)+7),A=new Uint8Array(_>>3<<3);for(;w<O;){let c=M.charCodeAt(w++);if(c>=55296&&c<=56319){if(w<O){const y=M.charCodeAt(w);(y&64512)===56320&&(++w,c=((c&1023)<<10)+(y&1023)+65536)}if(c>=55296&&c<=56319)continue}if(g+4>A.length){_+=8,_*=1+w/M.length*2,_=_>>3<<3;const y=new Uint8Array(_);y.set(A),A=y}if((c&4294967168)===0){A[g++]=c;continue}else if((c&4294965248)===0)A[g++]=c>>6&31|192;else if((c&4294901760)===0)A[g++]=c>>12&15|224,A[g++]=c>>6&63|128;else if((c&4292870144)===0)A[g++]=c>>18&7|240,A[g++]=c>>12&63|128,A[g++]=c>>6&63|128;else continue;A[g++]=c&63|128}return A.slice(0,g)};function d(M="utf-8",L={fatal:!1}){if(M!=="utf-8")throw new RangeError(`Failed to construct 'TextDecoder': The encoding label provided ('${M}') is invalid.`);if(L.fatal)throw new Error("Failed to construct 'TextDecoder': the 'fatal' option is unsupported.")}Object.defineProperty(d.prototype,"encoding",{value:"utf-8"}),Object.defineProperty(d.prototype,"fatal",{value:!1}),Object.defineProperty(d.prototype,"ignoreBOM",{value:!1}),d.prototype.decode=function(M,L={stream:!1}){if(L.stream)throw new Error("Failed to decode: the 'stream' option is unsupported.");const w=new Uint8Array(M);let O=0;const g=w.length,_=[];for(;O<g;){const A=w[O++];if(A===0)break;if((A&128)===0)_.push(A);else if((A&224)===192){const c=w[O++]&63;_.push((A&31)<<6|c)}else if((A&240)===224){const c=w[O++]&63,y=w[O++]&63;_.push((A&31)<<12|c<<6|y)}else if((A&248)===240){const c=w[O++]&63,y=w[O++]&63,b=w[O++]&63;let u=(A&7)<<18|c<<12|y<<6|b;u>65535&&(u-=65536,_.push(u>>>10&1023|55296),u=56320|u&1023),_.push(u)}}return String.fromCharCode.apply(null,_)},K.TextEncoder=C,K.TextDecoder=d})(typeof window<"u"?window:typeof self<"u"?self:this)},"./node_modules/iobuffer/lib-esm/text.browser.js":(K,C,d)=>{d.r(C),d.d(C,{decode:()=>M,encode:()=>w}),d("./node_modules/iobuffer/lib-esm/text-encoding-polyfill.js");function M(O,g="utf8"){return new TextDecoder(g).decode(O)}const L=new TextEncoder;function w(O){return L.encode(O)}},"./node_modules/netcdfjs/lib-esm/data.js":(K,C,d)=>{d.r(C),d.d(C,{nonRecord:()=>L,record:()=>w});var M=d("./node_modules/netcdfjs/lib-esm/types.js");function L(O,g){const _=(0,M.str2num)(g.type),A=g.size/(0,M.num2bytes)(_),c=new Array(A);for(let y=0;y<A;y++)c[y]=(0,M.readType)(O,_,1);return c}function w(O,g,_){const A=(0,M.str2num)(g.type),c=g.size?g.size/(0,M.num2bytes)(A):1,y=_.length,b=new Array(y),u=_.recordStep;if(u)for(let p=0;p<y;p++){const r=O.offset;b[p]=(0,M.readType)(O,A,c),O.seek(r+u)}else throw new Error("recordDimension.recordStep is undefined");return b}},"./node_modules/netcdfjs/lib-esm/header.js":(K,C,d)=>{d.r(C),d.d(C,{header:()=>c});var M=d("./node_modules/netcdfjs/lib-esm/types.js"),L=d("./node_modules/netcdfjs/lib-esm/utils.js");const w=0,O=10,g=11,_=12,A=0;function c(p,r){const e={version:r},i={length:p.readUint32()},s=y(p);Array.isArray(s)||(i.id=s.recordId,i.name=s.recordName,e.dimensions=s.dimensions),e.globalAttributes=b(p);const a=u(p,i==null?void 0:i.id,r);return Array.isArray(a)||(e.variables=a.variables,i.recordStep=a.recordStep),e.recordDimension=i,e}function y(p){const r={};let e,i;const s=p.readUint32();let a;if(s===w)return(0,L.notNetcdf)(p.readUint32()!==w,"wrong empty tag for list of dimensions"),[];{(0,L.notNetcdf)(s!==O,"wrong tag for list of dimensions");const h=p.readUint32();a=new Array(h);for(let t=0;t<h;t++){const n=(0,L.readName)(p),f=p.readUint32();f===A&&(e=t,i=n),a[t]={name:n,size:f}}}return e!==void 0&&(r.recordId=e),i!==void 0&&(r.recordName=i),r.dimensions=a,r}function b(p){const r=p.readUint32();let e;if(r===w)return(0,L.notNetcdf)(p.readUint32()!==w,"wrong empty tag for list of attributes"),[];{(0,L.notNetcdf)(r!==_,"wrong tag for list of attributes");const i=p.readUint32();e=new Array(i);for(let s=0;s<i;s++){const a=(0,L.readName)(p),h=p.readUint32();(0,L.notNetcdf)(h<1||h>6,`non valid type ${h}`);const t=p.readUint32(),n=(0,M.readType)(p,h,t);(0,L.padding)(p),e[s]={name:a,type:(0,M.num2str)(h),value:n}}}return e}function u(p,r,e){const i=p.readUint32();let s=0,a;if(i===w)return(0,L.notNetcdf)(p.readUint32()!==w,"wrong empty tag for list of variables"),[];{(0,L.notNetcdf)(i!==g,"wrong tag for list of variables");const h=p.readUint32();a=new Array(h);for(let t=0;t<h;t++){const n=(0,L.readName)(p),f=p.readUint32(),o=new Array(f);for(let P=0;P<f;P++)o[P]=p.readUint32();const v=b(p),m=p.readUint32();(0,L.notNetcdf)(m<1&&m>6,`non valid type ${m}`);const E=p.readUint32();let S=p.readUint32();e===2&&((0,L.notNetcdf)(S>0,"offsets larger than 4GB not supported"),S=p.readUint32());let T=!1;typeof r<"u"&&o[0]===r&&(s+=E,T=!0),a[t]={name:n,dimensions:o,attributes:v,type:(0,M.num2str)(m),size:E,offset:S,record:T}}}return{variables:a,recordStep:s}}},"./node_modules/netcdfjs/lib-esm/index.js":(K,C,d)=>{d.r(C),d.d(C,{NetCDFReader:()=>M.NetCDFReader});var M=d("./node_modules/netcdfjs/lib-esm/parser.js")},"./node_modules/netcdfjs/lib-esm/parser.js":(K,C,d)=>{d.r(C),d.d(C,{NetCDFReader:()=>_});var M=d("./node_modules/iobuffer/lib-esm/IOBuffer.js"),L=d("./node_modules/netcdfjs/lib-esm/data.js"),w=d("./node_modules/netcdfjs/lib-esm/header.js"),O=d("./node_modules/netcdfjs/lib-esm/toString.js"),g=d("./node_modules/netcdfjs/lib-esm/utils.js");class _{constructor(c){this.toString=O.toString;const y=new M.IOBuffer(c);y.setBigEndian(),(0,g.notNetcdf)(y.readChars(3)!=="CDF","should start with CDF");const b=y.readByte();(0,g.notNetcdf)(b>2,"unknown version"),this.header=(0,w.header)(y,b),this.buffer=y}get version(){return this.header.version===1?"classic format":"64-bit offset format"}get recordDimension(){return this.header.recordDimension}get dimensions(){return this.header.dimensions}get globalAttributes(){return this.header.globalAttributes}getAttribute(c){const y=this.globalAttributes.find(b=>b.name===c);return y?y.value:null}getDataVariableAsString(c){const y=this.getDataVariable(c);return y?y.join(""):null}get variables(){return this.header.variables}getDataVariable(c){let y;if(typeof c=="string"?y=this.header.variables.find(b=>b.name===c):y=c,y===void 0)throw new Error("Not a valid NetCDF v3.x file: variable not found");return this.buffer.seek(y.offset),y.record?(0,L.record)(this.buffer,y,this.header.recordDimension):(0,L.nonRecord)(this.buffer,y)}dataVariableExists(c){return this.header.variables.find(b=>b.name===c)!==void 0}attributeExists(c){return this.globalAttributes.find(b=>b.name===c)!==void 0}}},"./node_modules/netcdfjs/lib-esm/toString.js":(K,C,d)=>{d.r(C),d.d(C,{toString:()=>M});function M(){const L=[];L.push("DIMENSIONS");for(const O of this.dimensions)L.push(`  ${O.name.padEnd(30)} = size: ${O.size}`);L.push(""),L.push("GLOBAL ATTRIBUTES");for(const O of this.globalAttributes)L.push(`  ${O.name.padEnd(30)} = ${O.value}`);const w=JSON.parse(JSON.stringify(this.variables));L.push(""),L.push("VARIABLES:");for(const O of w){O.value=this.getDataVariable(O);let g=JSON.stringify(O.value);g.length>50&&(g=g.substring(0,50)),isNaN(O.value.length)||(g+=` (length: ${O.value.length})`),L.push(`  ${O.name.padEnd(30)} = ${g}`)}return L.join(`
`)}},"./node_modules/netcdfjs/lib-esm/types.js":(K,C,d)=>{d.r(C),d.d(C,{num2bytes:()=>w,num2str:()=>L,readType:()=>_,str2num:()=>O});const M={BYTE:1,CHAR:2,SHORT:3,INT:4,FLOAT:5,DOUBLE:6};function L(c){switch(Number(c)){case M.BYTE:return"byte";case M.CHAR:return"char";case M.SHORT:return"short";case M.INT:return"int";case M.FLOAT:return"float";case M.DOUBLE:return"double";default:return"undefined"}}function w(c){switch(Number(c)){case M.BYTE:return 1;case M.CHAR:return 1;case M.SHORT:return 2;case M.INT:return 4;case M.FLOAT:return 4;case M.DOUBLE:return 8;default:return-1}}function O(c){switch(String(c)){case"byte":return M.BYTE;case"char":return M.CHAR;case"short":return M.SHORT;case"int":return M.INT;case"float":return M.FLOAT;case"double":return M.DOUBLE;default:return-1}}function g(c,y){if(c!==1){const b=new Array(c);for(let u=0;u<c;u++)b[u]=y();return b}else return y()}function _(c,y,b){switch(y){case M.BYTE:return Array.from(c.readBytes(b));case M.CHAR:return A(c.readChars(b));case M.SHORT:return g(b,c.readInt16.bind(c));case M.INT:return g(b,c.readInt32.bind(c));case M.FLOAT:return g(b,c.readFloat32.bind(c));case M.DOUBLE:return g(b,c.readFloat64.bind(c));default:throw new Error(`non valid type ${y}`)}}function A(c){return c.charCodeAt(c.length-1)===0?c.substring(0,c.length-1):c}},"./node_modules/netcdfjs/lib-esm/utils.js":(K,C,d)=>{d.r(C),d.d(C,{notNetcdf:()=>M,padding:()=>L,readName:()=>w});function M(O,g){if(O)throw new TypeError(`Not a valid NetCDF v3.x file: ${g}`)}function L(O){O.offset%4!==0&&O.skip(4-O.offset%4)}function w(O){const g=O.readUint32(),_=O.readChars(g);return L(O),_}},"./src/WebGL/shaders/lib/basic/basic.frag":(K,C,d)=>{d.r(C),d.d(C,{default:()=>M});const M=`uniform mat4 viewMatrix;
uniform float opacity;
uniform vec3 fogColor;
uniform float fogNear;
uniform float fogFar;
varying vec3 vColor;
//DEFINEFRAGCOLOR
void main() {
    gl_FragColor = vec4( vColor, opacity );
    float depth = gl_FragCoord.z / gl_FragCoord.w;
    float fogFactor = smoothstep( fogNear, fogFar, depth );
    gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );
}`},"./src/WebGL/shaders/lib/basic/basic.vert":(K,C,d)=>{d.r(C),d.d(C,{default:()=>M});const M=`uniform mat4 modelViewMatrix;
uniform mat4 projectionMatrix;
uniform mat4 viewMatrix;
uniform mat3 normalMatrix;

attribute vec3 position;
attribute vec3 color;

varying vec3 vColor;

void main() {

    vColor = color;
    vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );
    gl_Position = projectionMatrix * mvPosition;

}`},"./src/WebGL/shaders/lib/blur/blur.frag":(K,C,d)=>{d.r(C),d.d(C,{default:()=>M});const M=`const float INV_TOTAL_SAMPLES_FACTOR = 1.0 / 9.0;
uniform highp sampler2D inTex;
varying highp vec2 vTexCoords;
    
void main() {
 
 vec2 texelSize = 1.0 / vec2(textureSize(inTex,0));
 float blurred_visibility_factor = 0.0f;
 for (int t = -1; t <= 1; ++t) {
  for (int s = -1; s <= 1; ++s) {
   vec2 offset = vec2(float(s), float(t)) * texelSize;
   blurred_visibility_factor += texture2D(inTex, vTexCoords + offset).r;
  }
 }
    
 gl_FragDepthEXT = blurred_visibility_factor * INV_TOTAL_SAMPLES_FACTOR;
 
}`},"./src/WebGL/shaders/lib/blur/blur.vert":(K,C,d)=>{d.r(C),d.d(C,{default:()=>M});const M=`attribute vec2 vertexPosition;
varying highp vec2 vTexCoords;
const vec2 scale = vec2(0.5, 0.5);

void main() {
   vTexCoords  = vertexPosition * scale + scale; // scale vertex attribute to [0,1] range
   gl_Position = vec4(vertexPosition, 0.0, 1.0);
}
        `},"./src/WebGL/shaders/lib/instanced/instanced.frag":(K,C,d)=>{d.r(C),d.d(C,{default:()=>M});const M=`uniform mat4 viewMatrix;
uniform float opacity;

uniform vec3 fogColor;
uniform float fogNear;
uniform float fogFar;
#ifdef SHADED
uniform highp sampler2D shading;
#endif
varying vec3 vLightFront;
varying vec3 vColor;
//DEFINEFRAGCOLOR

void main() {

    gl_FragColor = vec4( vec3 ( 1.0 ), opacity );

    #ifndef WIREFRAME
    gl_FragColor.xyz *= vLightFront;
    #endif

#ifdef SHADED
    ivec2 dim = textureSize(shading,0);
    float shadowFactor = texture2D(shading,vec2(gl_FragCoord.x/float(dim.x),gl_FragCoord.y/float(dim.y))).r;
    vColor *= shadowFactor;
#endif
    gl_FragColor = gl_FragColor * vec4( vColor, opacity );
    float depth = gl_FragCoord.z / gl_FragCoord.w;

    float fogFactor = smoothstep( fogNear, fogFar, depth );

    gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );

}


`},"./src/WebGL/shaders/lib/instanced/instanced.vert":(K,C,d)=>{d.r(C),d.d(C,{default:()=>M});const M=`

uniform mat4 modelViewMatrix;
uniform mat4 projectionMatrix;
uniform mat4 viewMatrix;
uniform mat3 normalMatrix;
uniform vec3 directionalLightColor[ 1 ];
uniform vec3 directionalLightDirection[ 1 ];

attribute vec3 offset;
attribute vec3 position;
attribute vec3 normal;
attribute vec3 color;
attribute float radius;

varying vec3 vColor;
varying vec3 vLightFront;

void main() {

    vColor = color;

    vec3 objectNormal = normal;
    vec3 transformedNormal = normalMatrix * objectNormal;
    vec4 mvPosition = modelViewMatrix * vec4( position * radius + offset, 1.0 );

    vLightFront = vec3( 0.0 );

    transformedNormal = normalize( transformedNormal );

    vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ 0 ], 0.0 );
    vec3 dirVector = normalize( lDirection.xyz );
    float dotProduct = dot( transformedNormal, dirVector );
    vec3 directionalLightWeighting = vec3( max( dotProduct, 0.0 ) );

    vLightFront += directionalLightColor[ 0 ] * directionalLightWeighting;

    gl_Position = projectionMatrix * mvPosition;
}

`},"./src/WebGL/shaders/lib/lambert/lambert.frag":(K,C,d)=>{d.r(C),d.d(C,{default:()=>M});const M=`uniform mat4 viewMatrix;
uniform float opacity;

uniform vec3 fogColor;
uniform float fogNear;
uniform float fogFar;
#ifdef SHADED
uniform highp sampler2D shading;
#endif
varying vec3 vLightFront;
varying vec3 vColor;
//DEFINEFRAGCOLOR

void main() {

    gl_FragColor = vec4( vec3 ( 1.0 ), opacity );

    #ifndef WIREFRAME
    gl_FragColor.xyz *= vLightFront;
    #endif
#ifdef SHADED
    ivec2 dim = textureSize(shading,0);
    float shadowFactor = texture2D(shading,vec2(gl_FragCoord.x/float(dim.x),gl_FragCoord.y/float(dim.y))).r;
    vColor *= shadowFactor;
#endif
    gl_FragColor = gl_FragColor * vec4( vColor, opacity );
    float depth = gl_FragCoord.z / gl_FragCoord.w;

    float fogFactor = smoothstep( fogNear, fogFar, depth );

    gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );

}`},"./src/WebGL/shaders/lib/lambert/lambert.vert":(K,C,d)=>{d.r(C),d.d(C,{default:()=>M});const M=`
uniform mat4 modelViewMatrix;
uniform mat4 projectionMatrix;
uniform mat4 viewMatrix;
uniform mat3 normalMatrix;
uniform vec3 directionalLightColor[ 1 ];
uniform vec3 directionalLightDirection[ 1 ];

attribute vec3 position;
attribute vec3 normal;
attribute vec3 color;

varying vec3 vColor;
varying vec3 vLightFront;

void main() {

    vColor = color;

    vec3 objectNormal = normal;
    vec3 transformedNormal = normalMatrix * objectNormal;
    vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );

    vLightFront = vec3( 0.0 );

    transformedNormal = normalize( transformedNormal );

    vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ 0 ], 0.0 );
    vec3 dirVector = normalize( lDirection.xyz );
    float dotProduct = dot( transformedNormal, dirVector );
    vec3 directionalLightWeighting = vec3( max( dotProduct, 0.0 ) );

    vLightFront += directionalLightColor[ 0 ] * directionalLightWeighting;

    gl_Position = projectionMatrix * mvPosition;
}`},"./src/WebGL/shaders/lib/lambertdouble/lambertdouble.frag":(K,C,d)=>{d.r(C),d.d(C,{default:()=>M});const M=`
#ifdef SHADED
uniform highp sampler2D shading;
#endif

uniform mat4 viewMatrix;
uniform float opacity;

uniform vec3 fogColor;
uniform float fogNear;
uniform float fogFar;

varying vec3 vLightFront;
varying vec3 vLightBack;

varying vec3 vColor;


//DEFINEFRAGCOLOR

void main() {

    gl_FragColor = vec4( vec3 ( 1.0 ), opacity );

    #ifndef WIREFRAME
    if ( gl_FrontFacing )
       gl_FragColor.xyz *= vLightFront;
    else
       gl_FragColor.xyz *= vLightBack;
    #endif

    vec3 color = vColor;
#ifdef SHADED
    ivec2 dim = textureSize(shading,0);
    float shadowFactor = texture2D(shading,vec2(gl_FragCoord.x/float(dim.x),gl_FragCoord.y/float(dim.y))).r;
    color *= shadowFactor;
#endif
    gl_FragColor = gl_FragColor * vec4( color, opacity );
    float depth = gl_FragCoord.z / gl_FragCoord.w;

    float fogFactor = smoothstep( fogNear, fogFar, depth );

    gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );

}


`},"./src/WebGL/shaders/lib/lambertdouble/lambertdouble.vert":(K,C,d)=>{d.r(C),d.d(C,{default:()=>M});const M=`

uniform mat4 modelViewMatrix;
uniform mat4 projectionMatrix;
uniform mat4 viewMatrix;
uniform mat3 normalMatrix;
uniform vec3 directionalLightColor[ 1 ];
uniform vec3 directionalLightDirection[ 1 ];

attribute vec3 position;
attribute vec3 normal;
attribute vec3 color;

varying vec3 vColor;
varying vec3 vLightFront;
varying vec3 vLightBack;

void main() {

    vColor = color;

    vec3 objectNormal = normal;
    vec3 transformedNormal = normalMatrix * objectNormal;
    vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );

    vLightFront = vec3( 0.0 );
    vLightBack = vec3( 0.0 );

    transformedNormal = normalize( transformedNormal );

    vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ 0 ], 0.0 );
    vec3 dirVector = normalize( lDirection.xyz );
    float dotProduct = dot( transformedNormal, dirVector );
    vec3 directionalLightWeighting = vec3( max( dotProduct, 0.0 ) );
    vec3 directionalLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );

    vLightFront += directionalLightColor[ 0 ] * directionalLightWeighting;
    vLightBack += directionalLightColor[ 0 ] * directionalLightWeightingBack;

    gl_Position = projectionMatrix * mvPosition;
}

`},"./src/WebGL/shaders/lib/outline/outline.frag":(K,C,d)=>{d.r(C),d.d(C,{default:()=>M});const M=`

uniform float opacity;
uniform vec3 outlineColor;
uniform vec3 fogColor;
uniform float fogNear;
uniform float fogFar;
//DEFINEFRAGCOLOR

void main() {
    gl_FragColor = vec4( outlineColor, 1 );

    float depth = gl_FragCoord.z / gl_FragCoord.w;
    float fogFactor = smoothstep( fogNear, fogFar, depth );
    gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );    
}


`},"./src/WebGL/shaders/lib/outline/outline.vert":(K,C,d)=>{d.r(C),d.d(C,{default:()=>M});const M=`

uniform mat4 modelViewMatrix;
uniform mat4 projectionMatrix;
uniform float outlineWidth;
uniform float outlinePushback;
uniform float vWidth;
uniform float vHeight;
uniform float outlineMaxPixels;

attribute vec3 position;
attribute vec3 normal;
attribute vec3 color;

void main() {

    vec4 norm = modelViewMatrix*vec4(normalize(normal),0.0);
    vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );
    mvPosition.xy += norm.xy*outlineWidth;
    vec4 outpos = projectionMatrix * mvPosition;

    if(outlineMaxPixels > 0.0) {
        vec4 unadjusted = projectionMatrix*modelViewMatrix * vec4( position, 1.0 );
        float w = outpos.w;
        //normalize homogeneous coords
        unadjusted /= unadjusted.w;
        outpos /= outpos.w;
        vec2 diff = outpos.xy-unadjusted.xy;
        //put into pixels
        diff.x *= vWidth;
        diff.y *= vHeight;
        if ( length(diff) > outlineMaxPixels) {
            vec2 ndiff = normalize(diff)*outlineMaxPixels;
            ndiff.x /= vWidth;
            ndiff.y /= vHeight;
            outpos.xy = unadjusted.xy;
            outpos.xy += ndiff;
        }
        outpos *= w; //if I don't do this things blow up
    }
    gl_Position = outpos;
    mvPosition.z -= outlinePushback; //go backwards in model space
    vec4 pushpos = projectionMatrix*mvPosition; //project to get z in projection space, I'm probably missing some simple math to do the same thing..
    gl_Position.z = gl_Position.w*pushpos.z/pushpos.w;
}

`},"./src/WebGL/shaders/lib/screen/screen.frag":(K,C,d)=>{d.r(C),d.d(C,{default:()=>M});const M=`uniform sampler2D colormap;
varying highp vec2 vTexCoords;
uniform vec2 dimensions;
//DEFINEFRAGCOLOR
void main (void) {
   gl_FragColor = texture2D(colormap, vTexCoords);

   //gl_FragColor.g = gl_FragColor.b =  gl_FragColor.r; //debug shading 
}
        `},"./src/WebGL/shaders/lib/screen/screen.vert":(K,C,d)=>{d.r(C),d.d(C,{default:()=>M});const M=`attribute vec2 vertexPosition;
varying highp vec2 vTexCoords;
const vec2 scale = vec2(0.5, 0.5);

void main() {
   vTexCoords  = vertexPosition * scale + scale; // scale vertex attribute to [0,1] range
   gl_Position = vec4(vertexPosition, 0.0, 1.0);
}
        `},"./src/WebGL/shaders/lib/screenaa/screenaa.frag":(K,C,d)=>{d.r(C),d.d(C,{default:()=>M});const M=`uniform highp sampler2D colormap;
varying highp vec2 vTexCoords;


// Basic FXAA implementation based on the code on geeks3d.com 
#define FXAA_REDUCE_MIN (1.0/ 128.0)
#define FXAA_REDUCE_MUL (1.0 / 8.0)
#define FXAA_SPAN_MAX 8.0


vec4 applyFXAA(vec2 fragCoord, highp sampler2D tex)
{
    vec4 color;
    ivec2 dim = textureSize(tex,0);
    vec2 dimensions = vec2(float(dim.x),float(dim.y));
    vec2 inverseVP = vec2(1.0 / dimensions.x, 1.0 / dimensions.y);
    vec4 rgbNW = texture2D(tex, fragCoord + vec2(-1.0, -1.0) * inverseVP);
    vec4 rgbNE = texture2D(tex, fragCoord + vec2(1.0, -1.0) * inverseVP);
    vec4 rgbSW = texture2D(tex, fragCoord + vec2(-1.0, 1.0) * inverseVP);
    vec4 rgbSE = texture2D(tex, fragCoord + vec2(1.0, 1.0) * inverseVP);
    vec4 rgbM  = texture2D(tex, fragCoord );
    vec3 luma = vec3(0.299, 0.587, 0.114);
    float lumaNW = dot(rgbNW.xyz, luma);
    float lumaNE = dot(rgbNE.xyz, luma);
    float lumaSW = dot(rgbSW.xyz, luma);
    float lumaSE = dot(rgbSE.xyz, luma);
    float lumaM  = dot(rgbM.xyz,  luma);
    float lumaMin = min(lumaM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));
    float lumaMax = max(lumaM, max(max(lumaNW, lumaNE), max(lumaSW, lumaSE)));

    vec2 dir;
    dir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));
    dir.y =  ((lumaNW + lumaSW) - (lumaNE + lumaSE));

    float dirReduce = max((lumaNW + lumaNE + lumaSW + lumaSE) *
                        (0.25 * FXAA_REDUCE_MUL), FXAA_REDUCE_MIN);

    float rcpDirMin = 1.0 / (min(abs(dir.x), abs(dir.y)) + dirReduce);
    dir = min(vec2(FXAA_SPAN_MAX, FXAA_SPAN_MAX),
            max(vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX),
            dir * rcpDirMin)) * inverseVP;

    vec4 rgbA = 0.5 * (
        texture2D(tex, fragCoord + dir * (1.0 / 3.0 - 0.5)) +
        texture2D(tex, fragCoord  + dir * (2.0 / 3.0 - 0.5)));
    vec4 rgbB = rgbA * 0.5 + 0.25 * (
        texture2D(tex, fragCoord  + dir * -0.5) +
        texture2D(tex, fragCoord  + dir * 0.5));

    float lumaB = dot(rgbB.xyz, luma);
    if ((lumaB < lumaMin) || (lumaB > lumaMax))
        color = rgbA;
    else
        color = rgbB;

    return color;
}


//DEFINEFRAGCOLOR
void main (void) {
    ivec2 dim = textureSize(colormap,0);

  gl_FragColor = applyFXAA(vTexCoords, colormap);
}
        `},"./src/WebGL/shaders/lib/screenaa/screenaa.vert":(K,C,d)=>{d.r(C),d.d(C,{default:()=>M});const M=`attribute vec2 vertexPosition;
varying highp vec2 vTexCoords;
const vec2 scale = vec2(0.5, 0.5);

void main() {
   vTexCoords  = vertexPosition * scale + scale; // scale vertex attribute to [0,1] range
   gl_Position = vec4(vertexPosition, 0.0, 1.0);
}
        `},"./src/WebGL/shaders/lib/sphereimposter/sphereimposter.frag":(K,C,d)=>{d.r(C),d.d(C,{default:()=>M});const M=`
uniform mat4 viewMatrix;
uniform float opacity;
uniform mat4 projectionMatrix;

uniform vec3 fogColor;
uniform float fogNear;
uniform float fogFar;
uniform float uDepth;
uniform vec3 directionalLightColor[ 1 ];

varying vec3 vColor;
varying vec2 mapping;
varying float rval;
varying vec3 vLight;
varying vec3 center;

#ifdef SHADED
uniform highp sampler2D shading;
#endif

//DEFINEFRAGCOLOR

void main() {
    float lensqr = dot(mapping,mapping);
    float rsqr = rval*rval;
    if(lensqr > rsqr)
       discard;
    float z = sqrt(rsqr-lensqr);
    vec3 cameraPos = center+ vec3(mapping.x,mapping.y,z);
    vec4 clipPos = projectionMatrix * vec4(cameraPos, 1.0);
    float ndcDepth = clipPos.z / clipPos.w;
    gl_FragDepthEXT = ((gl_DepthRange.diff * ndcDepth) + gl_DepthRange.near + gl_DepthRange.far) / 2.0;
    vec3 norm = normalize(vec3(mapping.x,mapping.y,z));
    float dotProduct = dot( norm, vLight );
    vec3 directionalLightWeighting = vec3( max( dotProduct, 0.0 ) );
    vec3 vLight = directionalLightColor[ 0 ] * directionalLightWeighting;
    vec3 color = vLight*vColor;
#ifdef SHADED
    ivec2 dim = textureSize(shading,0);
    float shadowFactor = texture2D(shading,vec2(gl_FragCoord.x/float(dim.x),gl_FragCoord.y/float(dim.y))).r;
    color *= shadowFactor;
#endif    
    gl_FragColor = vec4(color, opacity*opacity );
    float fogFactor = smoothstep( fogNear, fogFar, gl_FragDepthEXT/gl_FragCoord.w );
    gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );
}

`},"./src/WebGL/shaders/lib/sphereimposter/sphereimposter.vert":(K,C,d)=>{d.r(C),d.d(C,{default:()=>M});const M=`uniform mat4 modelViewMatrix;
uniform mat4 projectionMatrix;
uniform mat4 viewMatrix;
uniform mat3 normalMatrix;
uniform vec3 directionalLightColor[ 1 ];
uniform vec3 directionalLightDirection[ 1 ];

attribute vec3 position;
attribute vec3 normal;
attribute vec3 color;

varying vec2 mapping;
varying vec3 vColor;
varying float rval;
varying vec3 vLight;
varying vec3 center;

void main() {

    vColor = color;
    vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );
    center = mvPosition.xyz;
    vec4 projPosition = projectionMatrix * mvPosition;
    vec4 adjust = projectionMatrix* vec4(normal,0.0); adjust.z = 0.0; adjust.w = 0.0;
    vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ 0 ], 0.0 );
    vLight = normalize( lDirection.xyz );
    mapping = normal.xy;
    rval = abs(normal.x);
    gl_Position = projPosition+adjust;

}
`},"./src/WebGL/shaders/lib/sphereimposteroutline/sphereimposteroutline.frag":(K,C,d)=>{d.r(C),d.d(C,{default:()=>M});const M=`

uniform float opacity;
uniform vec3 outlineColor;
uniform vec3 fogColor;
uniform float fogNear;
uniform float fogFar;
uniform mat4 projectionMatrix;
varying vec2 mapping;
varying float rval;
varying vec3 center;

uniform float outlinePushback;

//DEFINEFRAGCOLOR

void main() {
    float lensqr = dot(mapping,mapping);
    float rsqr = rval*rval;
    if(lensqr > rsqr)
       discard;
    float z = sqrt(rsqr-lensqr);
    vec3 cameraPos = center+ vec3(mapping.x,mapping.y,z-outlinePushback);
    vec4 clipPos = projectionMatrix * vec4(cameraPos, 1.0);
    float ndcDepth = clipPos.z / clipPos.w;
    gl_FragDepthEXT = ((gl_DepthRange.diff * ndcDepth) + gl_DepthRange.near + gl_DepthRange.far) / 2.0;
    gl_FragColor = vec4(outlineColor, 1 );
}


`},"./src/WebGL/shaders/lib/sphereimposteroutline/sphereimposteroutline.vert":(K,C,d)=>{d.r(C),d.d(C,{default:()=>M});const M=`

uniform mat4 modelViewMatrix;
uniform mat4 projectionMatrix;
uniform float outlineWidth;
uniform float outlinePushback;
uniform float outlineMaxPixels;
uniform float vWidth;
uniform float vHeight;

attribute vec3 position;
attribute vec3 normal;
attribute vec3 color;

varying vec2 mapping;
varying float rval;
varying vec3 center;

void main() {

    vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );
    center = mvPosition.xyz;
    vec4 projPosition = projectionMatrix * mvPosition;
    vec2 norm = normal.xy + vec2(sign(normal.x)*outlineWidth,sign(normal.y)*outlineWidth);

    vec4 adjust = projectionMatrix* vec4(norm,normal.z,1.0); 
    mapping = norm.xy;
    rval = abs(norm.x);
    gl_Position = projPosition+vec4(adjust.xy,0.0,0.0);

    if(outlineMaxPixels > 0.0) {
        vec4 unadjusted = projectionMatrix*vec4(center.x+normal.x, center.y,center.z,1.0); 
        vec4 ccoord = projectionMatrix*vec4(center.xyz,1.0);
        adjust = projectionMatrix* vec4(center.x+norm.x,center.y,center.z,1.0); 
        //subtract center 
        unadjusted.xyz -= ccoord.xyz;
        adjust.xyz -= ccoord.xyz;
        unadjusted /= unadjusted.w;
        adjust /= adjust.w;
        float diff = abs(adjust.x-unadjusted.x);
        diff *= vWidth;
        if(diff > outlineMaxPixels) {
            
            float fixlen = abs(unadjusted.x) + outlineMaxPixels/vWidth;
            //adjsut reval by ratio of lengths
            rval *= fixlen/abs(adjust.x);
        }

    }
}

`},"./src/WebGL/shaders/lib/sprite/sprite.frag":(K,C,d)=>{d.r(C),d.d(C,{default:()=>M});const M=`

uniform vec3 color;
uniform sampler2D map;
uniform float opacity;

uniform int fogType;
uniform vec3 fogColor;
uniform float fogDensity;
uniform float fogNear;
uniform float fogFar;
uniform float alphaTest;

varying vec2 vUV;
//DEFINEFRAGCOLOR

void main() {

    vec4 texture = texture2D(map, vUV);

    if (texture.a <= alphaTest) discard;

    gl_FragColor = vec4(color * texture.xyz, texture.a * opacity);

    if (fogType > 0) {

        float depth = gl_FragCoord.z / gl_FragCoord.w;
        float fogFactor = 0.0;

        if (fogType == 1) {
            fogFactor = smoothstep(fogNear, fogFar, depth);
        }

        else {
            const float LOG2 = 1.442695;
            float fogFactor = exp2(- fogDensity * fogDensity * depth * depth * LOG2);
            fogFactor = 1.0 - clamp(fogFactor, 0.0, 1.0);
        }

        gl_FragColor = mix(gl_FragColor, vec4(fogColor, gl_FragColor.w), fogFactor);

    }
}

`},"./src/WebGL/shaders/lib/sprite/sprite.vert":(K,C,d)=>{d.r(C),d.d(C,{default:()=>M});const M=`

uniform int useScreenCoordinates;
uniform vec3 screenPosition;
uniform mat4 modelViewMatrix;
uniform mat4 projectionMatrix;
uniform float rotation;
uniform vec2 scale;
uniform vec2 alignment;
uniform vec2 uvOffset;
uniform vec2 uvScale;

attribute vec2 position;
attribute vec2 uv;

varying vec2 vUV;

void main() {

    vUV = uvOffset + uv * uvScale;

    vec2 alignedPosition = position + alignment;

    vec2 rotatedPosition;
    rotatedPosition.x = ( cos(rotation) * alignedPosition.x - sin(rotation) * alignedPosition.y ) * scale.x;
    rotatedPosition.y = ( sin(rotation) * alignedPosition.x + cos(rotation) * alignedPosition.y ) * scale.y;

    vec4 finalPosition;

    if(useScreenCoordinates != 0) {
        finalPosition = vec4(screenPosition.xy + rotatedPosition, screenPosition.z, 1.0);
    }

    else {
        finalPosition = projectionMatrix * modelViewMatrix * vec4(0.0, 0.0, 0.0, 1.0); finalPosition /= finalPosition.w;
        finalPosition.xy += rotatedPosition; 
    }

    gl_Position = finalPosition;

}

`},"./src/WebGL/shaders/lib/ssao/ssao.frag":(K,C,d)=>{d.r(C),d.d(C,{default:()=>M});const M=`uniform sampler2D depthmap;
varying highp vec2 vTexCoords;
uniform float vWidth;
uniform float vHeight;
uniform float total_strength;
uniform float radius;
uniform mat4 projinv;
uniform mat4 projectionMatrix;

//code for pseudorandom vector from chatgpt
float hash(vec3 p) {
    p = fract(p * vec3(0.1031, 0.1030, 0.0973));
    p += dot(p, p.yzx + 33.33);
    return fract((p.x + p.y) * p.z);
}

// Generate a pseudorandom vec3 from a seed vec3
vec3 pseudorandomVec3(vec3 seed) {
    vec3 randomVec;
    randomVec.x = hash(seed);
    randomVec.y = hash(seed + vec3(1.0, 0.0, 17.1));
    randomVec.z = hash(seed + vec3(0.0, 13.23, 0.0));
    return randomVec;
}

void main(void)
{   
   const float base = 0.2;
   const float area = 0.75;
   const int cycles = 1;

   const int samples = 64;
   vec3 sample_sphere[64] = vec3[](
      vec3(0.091258,-0.510164,0.000000),
      vec3(-0.204347,-0.872967,0.187199),
      vec3(0.009690,-0.263696,-0.110414),
      vec3(0.175208,-0.563987,0.228527),
      vec3(-0.001824,-0.003113,-0.000323),
      vec3(0.411134,-0.719869,-0.261530),
      vec3(-0.074272,-0.377368,0.276290),
      vec3(-0.147773,-0.381587,-0.284529),
      vec3(0.173317,-0.199635,0.063295),
      vec3(-0.186452,-0.199460,0.076965),
      vec3(0.143985,-0.308160,-0.307687),
      vec3(0.053194,-0.148286,0.169589),
      vec3(-0.547656,-0.486476,-0.317378),
      vec3(0.020804,-0.015092,-0.004574),
      vec3(-0.038006,-0.043165,0.054059),
      vec3(-0.094795,-0.443908,-0.731525),
      vec3(0.547552,-0.396466,0.461477),
      vec3(-0.176886,-0.089989,0.007315),
      vec3(0.074401,-0.048840,-0.074039),
      vec3(-0.008240,-0.075697,0.178197),
      vec3(-0.307880,-0.185053,-0.368943),
      vec3(0.309520,-0.108483,0.041646),
      vec3(-0.773478,-0.292946,0.538166),
      vec3(0.184487,-0.231594,-0.820065),
      vec3(0.207318,-0.100531,0.361797),
      vec3(-0.173306,-0.037737,-0.055289),
      vec3(0.548102,-0.105342,-0.253237),
      vec3(-0.119342,-0.043907,0.285162),
      vec3(-0.270247,-0.087861,-0.751357),
      vec3(0.449312,-0.039777,0.236146),
      vec3(-0.743773,-0.036095,0.196056),
      vec3(0.148819,-0.004300,-0.231448),
      vec3(0.008773,0.000809,0.051047),
      vec3(-0.461467,0.027390,-0.357386),
      vec3(0.169626,0.013338,-0.014053),
      vec3(-0.043786,0.007095,0.047331),
      vec3(0.004821,0.140371,-0.988260),
      vec3(0.092402,0.023994,0.101860),
      vec3(-0.295335,0.061530,-0.027372),
      vec3(0.024903,0.007537,-0.018901),
      vec3(-0.081463,0.125402,0.447794),
      vec3(-0.397119,0.231805,-0.631062),
      vec3(0.163853,0.059014,0.044905),
      vec3(-0.495220,0.214357,0.254139),
      vec3(0.306123,0.373687,-0.825715),
      vec3(0.021665,0.026737,0.053220),
      vec3(-0.208231,0.117129,-0.098685),
      vec3(0.139749,0.080968,-0.043086),
      vec3(-0.153599,0.182814,0.262090),
      vec3(-0.159673,0.496777,-0.743568),
      vec3(0.134797,0.117152,0.095753),
      vec3(-0.155626,0.120533,0.019395),
      vec3(0.042311,0.054462,-0.049709),
      vec3(0.001257,0.031288,0.034468),
      vec3(-0.002271,0.003199,-0.002304),
      vec3(0.662104,0.717307,0.033854),
      vec3(-0.373100,0.576021,0.308274),
      vec3(0.024233,0.231316,-0.173688),
      vec3(0.161311,0.420217,0.234273),
      vec3(-0.045248,0.078031,-0.010411),
      vec3(0.167453,0.376942,-0.094872),
      vec3(-0.056194,0.433247,0.173218),
      vec3(-0.016224,0.123149,-0.035569),
      vec3(0.067127,0.407641,0.028479)
   );

   float depth = texture2D(depthmap, vTexCoords).r;
   if(depth == 1.0) {
      discard;
   }

   vec4 screen_position = vec4(vTexCoords, depth,1.0);
   vec4 pos = projinv*screen_position;
   pos /= pos.w;
   vec3 position = pos.xyz;

   //approximate the normal from the depth map; I find this simpler
   //than trying to recompute the exact normal within every possible object shader

   //pixel offset positions in screen space
   ivec2 dim = textureSize(depthmap,0);
   vec2 offset1 = vec2(0.0,1.0/float(dim.y));
   vec2 offset2 = vec2(1.0/float(dim.x),0.0);
   float depth1 = texture2D(depthmap, vTexCoords + offset1).r;
   float depth2 = texture2D(depthmap, vTexCoords + offset2).r;
   
   vec3 p1 = vec3(screen_position.xy+offset1, depth1 - depth);
   vec3 p2 = vec3(screen_position.xy+offset2, depth2 - depth);

   //convert to model space
   vec4 pos1 = projinv*vec4(p1,1);
   pos1 /= pos1.w;
   vec4 pos2 = projinv*vec4(p2,1);
   pos2 /= pos2.w;

   vec3 normal = normalize(cross(pos1.xyz-position, pos2.xyz-position)); //model normal, important we normalize in model space

   //pseudo random number

   float occlusion = 0.0;
   for(int c = 0; c < cycles; c++) {
   vec3 random = normalize(pseudorandomVec3(position+float(c)));
   for(int i=0; i < samples; i++) {

      vec3 ray = radius * reflect(sample_sphere[i],random);
      vec3 hemi_ray = position + sign(dot(ray,normal)) * ray; //model space
      vec4 hemi_screen = projectionMatrix*vec4(hemi_ray,1.0);
      hemi_screen /= hemi_screen.w;
      
      float occ_depth = texture2D(depthmap, clamp(hemi_screen.xy,0.0,1.0)).r;
      float difference = hemi_screen.z - occ_depth;
      
      occlusion += step(0.0, difference) * (1.0-smoothstep(0.0, area, difference));
   }
   }
   float ao = 1.0 - total_strength * occlusion * (1.0 / float(cycles*samples));
   gl_FragDepthEXT = clamp(ao+base,0.0,1.0);

}`},"./src/WebGL/shaders/lib/ssao/ssao.vert":(K,C,d)=>{d.r(C),d.d(C,{default:()=>M});const M=`attribute vec2 vertexPosition;
varying highp vec2 vTexCoords;
const vec2 scale = vec2(0.5, 0.5);

void main() {
   vTexCoords  = vertexPosition * scale + scale; // scale vertex attribute to [0,1] range
   gl_Position = vec4(vertexPosition, 0.0, 1.0);
}
        `},"./src/WebGL/shaders/lib/stickimposter/stickimposter.partial.frag":(K,C,d)=>{d.r(C),d.d(C,{default:()=>M});const M=`    float dotProduct = dot( norm, vLight );
    vec3 light = vec3( max( dotProduct, 0.0 ) );
    color *= light;
#ifdef SHADED
    ivec2 dim = textureSize(shading,0);
    float shadowFactor = texture2D(shading,vec2(gl_FragCoord.x/float(dim.x),gl_FragCoord.y/float(dim.y))).r;
    color *= shadowFactor;
#endif    
    gl_FragColor = vec4(color, opacity*opacity );
    float fogFactor = smoothstep( fogNear, fogFar, depth );
    gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );
}`},"./src/WebGL/shaders/lib/stickimposter/stickimposter.vert":(K,C,d)=>{d.r(C),d.d(C,{default:()=>M});const M=`

uniform mat4 modelViewMatrix;
uniform mat4 projectionMatrix;
uniform mat4 viewMatrix;
uniform mat3 normalMatrix;
uniform vec3 directionalLightColor[ 1 ];
uniform vec3 directionalLightDirection[ 1 ];

attribute vec3 position;
attribute vec3 normal;
attribute vec3 color;
attribute float radius;

varying vec3 vColor;
varying vec3 vLight;
varying vec3 cposition;
varying vec3 p1;
varying vec3 p2;
varying float r;

void main() {

    vColor = color; vColor.z = abs(vColor.z); //z indicates which vertex and so would vary
    r = abs(radius);
    vec4 to = modelViewMatrix*vec4(normal, 1.0); //normal is other point of cylinder
    vec4 pt = modelViewMatrix*vec4(position, 1.0);
    vec4 mvPosition = pt;
    p1 = pt.xyz; p2 = to.xyz;
    vec3 norm = to.xyz-pt.xyz;
    float mult = 1.1; //slop to account for perspective of sphere
    if(length(p1) > length(p2)) { //billboard at level of closest point
       mvPosition = to;
    }
    vec3 n = normalize(mvPosition.xyz);
    bool isperspective = (projectionMatrix[3][3] == 0.0);
//intersect with the plane defined by the camera looking at the billboard point
    if(color.z >= 0.0) { //p1
       if(isperspective) { //perspective
         vec3 pnorm = normalize(p1);
         float t = dot(mvPosition.xyz-p1,n)/dot(pnorm,n);
         mvPosition.xyz = p1+t*pnorm; 
       } else { //orthographic
         mvPosition.xyz = p1;
       }
    } else {
      if(isperspective) { //perspective
         vec3 pnorm = normalize(p2);
         float t = dot(mvPosition.xyz-p2,n)/dot(pnorm,n);
         mvPosition.xyz = p2+t*pnorm;
       } else { //orthographic
         mvPosition.xyz = p2;
       } 
       mult *= -1.0;
    }

    if(isperspective) { //perspective
      vec3 cr = normalize(cross(mvPosition.xyz,norm))*radius;
      vec3 doublecr = normalize(cross(mvPosition.xyz,cr))*radius;
      mvPosition.xyz +=  mult*(cr + doublecr).xyz;
    } else {
      vec3 cr = normalize(cross(vec3(0.0,0.0,-1.0),norm))*radius;
      vec3 doublecr = normalize(cross(vec3(0.0,0.0,-1.0),cr))*radius;
      mvPosition.xyz +=  mult*(cr + doublecr).xyz;     
    }

    cposition = mvPosition.xyz;
    gl_Position = projectionMatrix * mvPosition;
    vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ 0 ], 0.0 );
    vLight = normalize( lDirection.xyz )*directionalLightColor[0]; //not really sure this is right, but color is always white so..
}

`},"./src/WebGL/shaders/lib/stickimposter/stickimposterFragmentShader.partial.frag":(K,C,d)=>{d.r(C),d.d(C,{default:()=>M});const M=`uniform float opacity;
uniform mat4 projectionMatrix;

uniform vec3 fogColor;
uniform float fogNear;
uniform float fogFar;

varying vec3 vLight;
varying vec3 vColor;
varying vec3 cposition;
varying vec3 p1;
varying vec3 p2;
varying float r;

#ifdef SHADED
uniform highp sampler2D shading;
#endif

//DEFINEFRAGCOLOR

//cylinder-ray intersection testing taken from http://mrl.nyu.edu/~dzorin/cg05/lecture12.pdf
//also useful: http://stackoverflow.com/questions/9595300/cylinder-impostor-in-glsl
//with a bit more care (caps) this could be a general cylinder imposter (see also outline)
void main() {
    vec3 color = abs(vColor);
    vec3 pos = cposition;
    vec3 p = pos; //ray point
    vec3 v = vec3(0.0,0.0,-1.0); //ray normal - orthographic
    if(projectionMatrix[3][3] == 0.0) v = normalize(pos); //ray normal - perspective
    vec3 pa = p1; //cyl start
    vec3 va = normalize(p2-p1); //cyl norm
    vec3 tmp1 = v-(dot(v,va)*va);
    vec3 deltap = p-pa;
    float A = dot(tmp1,tmp1);
    if(A == 0.0) discard;
    vec3 tmp2 = deltap-(dot(deltap,va)*va);
    float B = 2.0*dot(tmp1, tmp2);
    float C = dot(tmp2,tmp2)-r*r;
//quadratic equation!
    float det = (B*B) - (4.0*A*C);
    if(det < 0.0) discard;
    float sqrtDet = sqrt(det);
    float posT = (-B+sqrtDet)/(2.0*A);
    float negT = (-B-sqrtDet)/(2.0*A);
    float intersectionT = min(posT,negT);
    vec3 qi = p+v*intersectionT;
    float dotp1 = dot(va,qi-p1);
    float dotp2 = dot(va,qi-p2);
    vec3 norm;
    if( dotp1 < 0.0 || dotp2 > 0.0) { //(p-c)^2 + 2(p-c)vt +v^2+t^2 - r^2 = 0
       vec3 cp;
       if( dotp1 < 0.0) {  
//        if(vColor.x < 0.0 ) discard; //color sign bit indicates if we should cap or not
        cp = p1;
       } else {
//          if(vColor.y < 0.0 ) discard;
          cp = p2;
       }
       vec3 diff = p-cp;
       A = dot(v,v);
       B = dot(diff,v)*2.0;
       C = dot(diff,diff)-r*r;
       det = (B*B) - (4.0*C);
       if(det < 0.0) discard;
       sqrtDet = sqrt(det);
       posT = (-B+sqrtDet)/(2.0);
       negT = (-B-sqrtDet)/(2.0);
       float t = min(posT,negT);
       qi = p+v*t; 
       norm = normalize(qi-cp); 
    } else {
       norm = normalize(qi-(dotp1*va + p1));
    }
    vec4 clipPos = projectionMatrix * vec4(qi, 1.0);
    float ndcDepth = clipPos.z / clipPos.w;
    float depth = ((gl_DepthRange.diff * ndcDepth) + gl_DepthRange.near + gl_DepthRange.far) / 2.0;
    gl_FragDepthEXT = depth;`},"./src/WebGL/shaders/lib/stickimposteroutline/stickimposteroutline.vert":(K,C,d)=>{d.r(C),d.d(C,{default:()=>M});const M=`

uniform mat4 modelViewMatrix;
uniform mat4 projectionMatrix;
uniform mat4 viewMatrix;
uniform mat3 normalMatrix;
uniform vec3 directionalLightColor[ 1 ];
uniform vec3 directionalLightDirection[ 1 ];
uniform vec3 outlineColor;
uniform float outlineWidth;
uniform float outlinePushback;
uniform float outlineMaxPixels;
uniform float vWidth;
uniform mat4 projinv;


attribute vec3 position;
attribute vec3 normal;
attribute vec3 color;
attribute float radius;

varying vec3 vColor;
varying vec3 vLight;
varying vec3 cposition;
varying vec3 p1;
varying vec3 p2;
varying float r;

void main() {

    vColor = outlineColor;
    float rad = radius+sign(radius)*outlineWidth;
    r = abs(rad);

    vec4 to = modelViewMatrix*vec4(normal, 1.0); //normal is other point of cylinder
    vec4 pt = modelViewMatrix*vec4(position, 1.0);
//pushback
    float scale = 1.0;
    if(projectionMatrix[3][3] != 0.0) { //orthographic
        to.z -= outlinePushback;
        pt.z -= outlinePushback;
    } else { //perspective
        vec4 midbefore = pt;
        if(length(to.xyz) < length(pt)) {
            midbefore = to;
        }
        vec4 midafter = midbefore;
        midafter.xyz += normalize(midbefore.xyz)*outlinePushback;

        to.xyz += normalize(to.xyz)*outlinePushback;
        pt.xyz += normalize(pt.xyz)*outlinePushback;

        //figure out a scaling factor for radius to account for perspective setback
        vec4 midbeforer = vec4(midbefore.x+rad,midbefore.y, midbefore.z, midbefore.w);
        vec4 midafterr = vec4(midafter.x+rad,midafter.y, midafter.z, midafter.w);

        vec4 mb = projectionMatrix*midbefore;
        vec4 mbr = projectionMatrix*midbeforer;
        vec4 ma = projectionMatrix*midafter;
        vec4 mar = projectionMatrix*midafterr;
        mb /= mb.w;
        mbr /= mbr.w;
        ma /= ma.w;
        mar /= mar.w;
        scale = abs((mbr.x-mb.x)/(mar.x-ma.x));
        rad *= scale;
        r = abs(rad);
    }
    vec4 mvPosition = pt;
    p1 = pt.xyz; p2 = to.xyz;
    vec3 norm = to.xyz-pt.xyz;
    float mult = 1.1; //slop to account for perspective of sphere
    if(length(p1) > length(p2)) { //billboard at level of closest point
       mvPosition = to;
    }

    vec3 n = normalize(mvPosition.xyz);
//intersect with the plane defined by the camera looking at the billboard point
    if(color.z >= 0.0) { //p1
       vec3 pnorm = normalize(p1);
       float t = dot(mvPosition.xyz-p1,n)/dot(pnorm,n);
       mvPosition.xyz = p1+t*pnorm;
    } else {
       vec3 pnorm = normalize(p2);
       float t = dot(mvPosition.xyz-p2,n)/dot(pnorm,n);
       mvPosition.xyz = p2+t*pnorm;
       mult *= -1.0;
    }

    if(outlineMaxPixels > 0.0) {
        vec4 cpos = mvPosition;
        vec4 unadjusted = projectionMatrix*vec4(cpos.x+abs(scale*radius), cpos.y,cpos.z,cpos.w); 
        vec4 ccoord = projectionMatrix*cpos;
        vec4 adjust = projectionMatrix*vec4(cpos.x+r,cpos.y,cpos.z,cpos.w); 
        unadjusted /= unadjusted.w;
        adjust /= adjust.w;
        unadjusted.xyz -= ccoord.xyz/ccoord.w;
        adjust.xyz -= ccoord.xyz/ccoord.w;
        float diff = abs(adjust.x-unadjusted.x);
        diff *= vWidth; //this should now be in pixels
        if(diff > outlineMaxPixels) {
            float fixlen = abs(unadjusted.x) + outlineMaxPixels/vWidth; 
            vec4 pcoord = ccoord;
            pcoord.x += fixlen*pcoord.w;
            vec4 altc = projinv*pcoord;
            r= abs(altc.x-cpos.x);
        }
    }

    vec3 cr = normalize(cross(mvPosition.xyz,norm))*rad;
    vec3 doublecr = normalize(cross(mvPosition.xyz,cr))*rad;
    mvPosition.xy +=  mult*(cr + doublecr).xy;
    cposition = mvPosition.xyz;
    gl_Position = projectionMatrix * mvPosition;
    vLight = vec3(1.0,1.0,1.0);
}

`},"./src/WebGL/shaders/lib/volumetric/volumetric.frag":(K,C,d)=>{d.r(C),d.d(C,{default:()=>M});const M=`
uniform highp sampler3D data;
uniform highp sampler2D colormap;
uniform highp sampler2D depthmap;


uniform mat4 textmat;
uniform mat4 projinv;
uniform mat4 projectionMatrix;

uniform float step;
uniform float subsamples;
uniform float maxdepth;
uniform float transfermin;
uniform float transfermax;
in  vec4 mvPosition;
out vec4 color;
void main(void) {

   vec4 pos = mvPosition;
   bool seengood = false;
   float i = 0.0;
   color = vec4(1,1,1,0);
   float increment = 1.0/subsamples;
   float maxsteps = (maxdepth*subsamples/step);
//there's probably a better way to do this..
//calculate farthest possible point in model coordinates
   vec4 maxpos = vec4(pos.x,pos.y,pos.z-maxdepth,1.0);
// convert to projection
   maxpos = projectionMatrix*maxpos;
   vec4 startp = projectionMatrix*pos;
// homogonize
   maxpos /= maxpos.w;
   startp /= startp.w;
//take x,y from start and z from max
   maxpos = vec4(startp.x,startp.y,maxpos.z,1.0);
//convert back to model space
   maxpos = projinv*maxpos;
   maxpos /= maxpos.w;
   float incr = step/subsamples;
//get depth from depthmap
//startp is apparently [-1,1]
   vec2 tpos = startp.xy/2.0+0.5;
   float depth = texture(depthmap, tpos).r;
//compute vector between start and end
   vec4 direction = maxpos-pos;
   for( i = 0.0; i <= maxsteps; i++) {
      vec4 pt = (pos+(i/maxsteps)*direction);
      vec4 ppt = projectionMatrix*pt;
      float ptdepth = ppt.z/ppt.w;
      ptdepth = ((gl_DepthRange.diff * ptdepth) + gl_DepthRange.near + gl_DepthRange.far) / 2.0;
      if(ptdepth > depth) break;
      pt = textmat*pt;
//       pt /= pt.w;
      if(pt.x >= -0.01 && pt.y >= -0.01 && pt.z >= -0.01 && pt.x <= 1.01 && pt.y <= 1.01 && pt.z <= 1.01) {
         seengood = true;
      } else if(seengood) {
         break;
      }
      if( pt.x < -0.01 || pt.x > 1.01 || pt.y < -0.01 || pt.y > 1.01 || pt.z < -0.01 || pt.z > 1.01  ){
          color.a = 0.0;
          continue;
      }
      else {
         float val = texture(data, pt.zyx).r;
         if(isinf(val)) continue; //masked out
         float cval = (val-transfermin)/(transfermax-transfermin); //scale to texture 0-1 range
         vec4 val_color = texture(colormap, vec2(cval,0.5));
         color.rgb = color.rgb*color.a + (1.0-color.a)*val_color.a*val_color.rgb;
         color.a += (1.0 - color.a) * val_color.a; 
         if(color.a > 0.0) color.rgb /= color.a;
//          color = vec4(pt.x, pt.y, pt.z, 1.0);
      }
//       color = vec4(pt.x, pt.y, pt.z, 0.0)
    }
}

        `},"./src/WebGL/shaders/lib/volumetric/volumetric.vert":(K,C,d)=>{d.r(C),d.d(C,{default:()=>M});const M=`uniform mat4 modelViewMatrix;
uniform mat4 projectionMatrix;
uniform mat4 viewMatrix;

in vec3 position;
out vec4 mvPosition;
void main() {

    mvPosition = modelViewMatrix * vec4( position, 1.0 );
    gl_Position = projectionMatrix*mvPosition;
}
`},"./src/GLDraw.ts":(K,C,d)=>{d.r(C),d.d(C,{CAP:()=>L,GLDraw:()=>w});var M=d("./src/WebGL/math/index.ts"),L;(function(O){O[O.NONE=0]="NONE",O[O.FLAT=1]="FLAT",O[O.ROUND=2]="ROUND"})(L||(L={}));var w;(function(O){function g(r,e,i){var s=Math.hypot(r,e),a,h,t,n,f;s<1e-4?(h=0,t=1):(h=-r/s,t=e/s),e=-h*r+t*e,a=Math.hypot(e,i),a<1e-4?(n=0,f=1):(n=i/a,f=e/a);var o=new Float32Array(9);return o[0]=t,o[1]=h,o[2]=0,o[3]=-h*f,o[4]=t*f,o[5]=n,o[6]=h*n,o[7]=-t*n,o[8]=f,o}class _{constructor(){this.cache={};let e=[],i=4,s=Math.pow(2,i),a=2,h=Math.pow(2,a),t=s/h,n;for(e[0]=new M.Vector3(-1,0,0),e[t]=new M.Vector3(0,0,1),e[t*2]=new M.Vector3(1,0,0),e[t*3]=new M.Vector3(0,0,-1),a=3;a<=i;a++){for(h=Math.pow(2,a-1),t=s/h,n=0;n<h-1;n++)e[t/2+n*t]=e[n*t].clone().add(e[(n+1)*t]).normalize();n=h-1,e[t/2+n*t]=e[n*t].clone().add(e[0]).normalize()}this.basisVectors=e}getVerticesForRadius(e,i,s){if(typeof this.cache<"u"&&this.cache[e]!==void 0&&this.cache[e][i+s]!==void 0)return this.cache[e][i+s];for(var a=this.basisVectors.length,h=[],t=[],n,f=0;f<a;f++)h.push(this.basisVectors[f].clone().multiplyScalar(e)),h.push(this.basisVectors[f].clone().multiplyScalar(e)),n=this.basisVectors[f].clone().normalize(),t.push(n),t.push(n);var o=[],v=10,m=a,E=0,S=Math.PI*2,T=0,P=Math.PI,I,B,R=!1,z=!1;for(B=0;B<=v;B++){R=B===0||B===v,z=B===v/2;var U=[],W=[];for(I=0;I<=m;I++){if(z){var F=I<m?2*I:0;W.push(F+1),U.push(F);continue}var N=I/m,q=B/v;if(!R||I===0)if(I<m){var J=new M.Vector3;J.x=-e*Math.cos(E+N*S)*Math.sin(T+q*P),i==1?J.y=0:J.y=e*Math.cos(T+q*P),J.z=e*Math.sin(E+N*S)*Math.sin(T+q*P),Math.abs(J.x)<1e-5&&(J.x=0),Math.abs(J.y)<1e-5&&(J.y=0),Math.abs(J.z)<1e-5&&(J.z=0),i==L.FLAT?(n=new M.Vector3(0,Math.cos(T+q*P),0),n.normalize()):(n=new M.Vector3(J.x,J.y,J.z),n.normalize()),h.push(J),t.push(n),U.push(h.length-1)}else U.push(h.length-m);else R&&U.push(h.length-1)}z&&o.push(W),o.push(U)}var oe={vertices:h,normals:t,verticesRows:o,w:m,h:v};return e in this.cache||(this.cache[e]={}),this.cache[e][i+s]=oe,oe}}var A=new _;function c(r,e,i,s,a,h=0,t=0){if(!e||!i)return;let n=function(_e){if(typeof _e=="string"){let ke=_e;return ke.toLowerCase()=="flat"?L.FLAT:ke.toLowerCase()=="round"?L.ROUND:L.NONE}else return _e};h=n(h),t=n(t);var f=t||h;a=a||{r:0,g:0,b:0};var o=g(i.x-e.x,i.y-e.y,i.z-e.z),v=A.getVerticesForRadius(s,t,"to"),m=v.w,E=v.h,S=f?E*m+2:2*m,T=r.updateGeoGroup(S),P=v.vertices,I=v.normals,B=v.verticesRows,R=B[E/2],z=B[E/2+1],U=T.vertices,W,F,N,q,J,oe,le=T.vertexArray,fe=T.normalArray,ie=T.colorArray,ne=T.faceArray;for(N=0;N<m;++N){var we=2*N;q=o[0]*P[we].x+o[3]*P[we].y+o[6]*P[we].z,J=o[1]*P[we].x+o[4]*P[we].y+o[7]*P[we].z,oe=o[5]*P[we].y+o[8]*P[we].z,W=3*(U+we),F=T.faceidx,le[W]=q+e.x,le[W+1]=J+e.y,le[W+2]=oe+e.z,le[W+3]=q+i.x,le[W+4]=J+i.y,le[W+5]=oe+i.z,fe[W]=q,fe[W+3]=q,fe[W+1]=J,fe[W+4]=J,fe[W+2]=oe,fe[W+5]=oe,ie[W]=a.r,ie[W+3]=a.r,ie[W+1]=a.g,ie[W+4]=a.g,ie[W+2]=a.b,ie[W+5]=a.b,ne[F]=z[N]+U,ne[F+1]=z[N+1]+U,ne[F+2]=R[N]+U,ne[F+3]=R[N]+U,ne[F+4]=z[N+1]+U,ne[F+5]=R[N+1]+U,T.faceidx+=6}if(f){var Ee=t?0:E/2,Se=h?E+1:E/2+1,de,ee,me,De,Ie,Fe,Ue,ze,Re,Pe,Oe,Ae,Ne,je,k,Z,Y,ve,re,Le,Me,V,ae,pe,Te,se,ye,j,Ce,We,D,ue;for(J=Ee;J<Se;J++)if(J!==E/2){var ce=J<=E/2?i:e,H=A.getVerticesForRadius(s,t,"to"),te=A.getVerticesForRadius(s,h,"from");for(ce===i?(P=H.vertices,I=H.normals,B=H.verticesRows):ce==e&&(P=te.vertices,I=te.normals,B=te.verticesRows),q=0;q<m;q++)F=T.faceidx,de=B[J][q+1],Ce=(de+U)*3,ee=B[J][q],We=(ee+U)*3,me=B[J+1][q],D=(me+U)*3,De=B[J+1][q+1],ue=(De+U)*3,Ie=o[0]*P[de].x+o[3]*P[de].y+o[6]*P[de].z,Fe=o[0]*P[ee].x+o[3]*P[ee].y+o[6]*P[ee].z,Ue=o[0]*P[me].x+o[3]*P[me].y+o[6]*P[me].z,ze=o[0]*P[De].x+o[3]*P[De].y+o[6]*P[De].z,Re=o[1]*P[de].x+o[4]*P[de].y+o[7]*P[de].z,Pe=o[1]*P[ee].x+o[4]*P[ee].y+o[7]*P[ee].z,Oe=o[1]*P[me].x+o[4]*P[me].y+o[7]*P[me].z,Ae=o[1]*P[De].x+o[4]*P[De].y+o[7]*P[De].z,Ne=o[5]*P[de].y+o[8]*P[de].z,je=o[5]*P[ee].y+o[8]*P[ee].z,k=o[5]*P[me].y+o[8]*P[me].z,Z=o[5]*P[De].y+o[8]*P[De].z,le[Ce]=Ie+ce.x,le[We]=Fe+ce.x,le[D]=Ue+ce.x,le[ue]=ze+ce.x,le[Ce+1]=Re+ce.y,le[We+1]=Pe+ce.y,le[D+1]=Oe+ce.y,le[ue+1]=Ae+ce.y,le[Ce+2]=Ne+ce.z,le[We+2]=je+ce.z,le[D+2]=k+ce.z,le[ue+2]=Z+ce.z,ie[Ce]=a.r,ie[We]=a.r,ie[D]=a.r,ie[ue]=a.r,ie[Ce+1]=a.g,ie[We+1]=a.g,ie[D+1]=a.g,ie[ue+1]=a.g,ie[Ce+2]=a.b,ie[We+2]=a.b,ie[D+2]=a.b,ie[ue+2]=a.b,Y=o[0]*I[de].x+o[3]*I[de].y+o[6]*I[de].z,ve=o[0]*I[ee].x+o[3]*I[ee].y+o[6]*I[ee].z,re=o[0]*I[me].x+o[3]*I[me].y+o[6]*I[me].z,Le=o[0]*I[De].x+o[3]*I[De].y+o[6]*I[De].z,Me=o[1]*I[de].x+o[4]*I[de].y+o[7]*I[de].z,V=o[1]*I[ee].x+o[4]*I[ee].y+o[7]*I[ee].z,ae=o[1]*I[me].x+o[4]*I[me].y+o[7]*I[me].z,pe=o[1]*I[De].x+o[4]*I[De].y+o[7]*I[De].z,Te=o[5]*I[de].y+o[8]*I[de].z,se=o[5]*I[ee].y+o[8]*I[ee].z,ye=o[5]*I[me].y+o[8]*I[me].z,j=o[5]*I[De].y+o[8]*I[De].z,J===0?(fe[Ce]=Y,fe[D]=re,fe[ue]=Le,fe[Ce+1]=Me,fe[D+1]=ae,fe[ue+1]=pe,fe[Ce+2]=Te,fe[D+2]=ye,fe[ue+2]=j,ne[F]=de+U,ne[F+1]=me+U,ne[F+2]=De+U,T.faceidx+=3):J===Se-1?(fe[Ce]=Y,fe[We]=ve,fe[D]=re,fe[Ce+1]=Me,fe[We+1]=V,fe[D+1]=ae,fe[Ce+2]=Te,fe[We+2]=se,fe[D+2]=ye,ne[F]=de+U,ne[F+1]=ee+U,ne[F+2]=me+U,T.faceidx+=3):(fe[Ce]=Y,fe[We]=ve,fe[ue]=Le,fe[Ce+1]=Me,fe[We+1]=V,fe[ue+1]=pe,fe[Ce+2]=Te,fe[We+2]=se,fe[ue+2]=j,fe[We]=ve,fe[D]=re,fe[ue]=Le,fe[We+1]=V,fe[D+1]=ae,fe[ue+1]=pe,fe[We+2]=se,fe[D+2]=ye,fe[ue+2]=j,ne[F]=de+U,ne[F+1]=ee+U,ne[F+2]=De+U,ne[F+3]=ee+U,ne[F+4]=me+U,ne[F+5]=De+U,T.faceidx+=6)}}T.vertices+=S}O.drawCylinder=c;function y(r,e,i,s,a){if(!e||!i)return;a=a||{r:0,g:0,b:0};let h=new M.Vector3(i.x-e.x,i.y-e.y,i.z-e.z);var t=g(h.x,h.y,h.z);h=h.normalize();var n=A.basisVectors.length,f=A.basisVectors,o=n+2,v=r.updateGeoGroup(o),m=v.vertices,E,S,T,P,I,B,R=v.vertexArray,z=v.normalArray,U=v.colorArray,W=v.faceArray;for(E=m*3,R[E]=e.x,R[E+1]=e.y,R[E+2]=e.z,z[E]=-h.x,z[E+1]=-h.y,z[E+2]=-h.z,U[E]=a.r,U[E+1]=a.g,U[E+2]=a.b,R[E+3]=i.x,R[E+4]=i.y,R[E+5]=i.z,z[E+3]=h.x,z[E+4]=h.y,z[E+5]=h.z,U[E+3]=a.r,U[E+4]=a.g,U[E+5]=a.b,E+=6,T=0;T<n;++T){var F=f[T].clone();F.multiplyScalar(s),P=t[0]*F.x+t[3]*F.y+t[6]*F.z,I=t[1]*F.x+t[4]*F.y+t[7]*F.z,B=t[5]*F.y+t[8]*F.z,R[E]=P+e.x,R[E+1]=I+e.y,R[E+2]=B+e.z,z[E]=P,z[E+1]=I,z[E+2]=B,U[E]=a.r,U[E+1]=a.g,U[E+2]=a.b,E+=3}for(v.vertices+=n+2,S=v.faceidx,T=0;T<n;T++){var N=m+2+T,q=m+2+(T+1)%n;W[S]=N,W[S+1]=q,W[S+2]=m,S+=3,W[S]=N,W[S+1]=q,W[S+2]=m+1,S+=3}v.faceidx+=6*n}O.drawCone=y;class b{constructor(){this.cache=new Map}getVerticesForRadius(e,i){i=i||2,this.cache.has(i)||this.cache.set(i,new Map);let s=this.cache.get(i);if(s.has(e))return s.get(e);var a={vertices:[],verticesRows:[],normals:[]},h=16*i,t=10*i;e<1&&(h=10*i,t=8*i);var n=0,f=Math.PI*2,o=0,v=Math.PI,m,E;for(E=0;E<=t;E++){let T=[];for(m=0;m<=h;m++){let P=m/h,I=E/t,B=-e*Math.cos(n+P*f)*Math.sin(o+I*v),R=e*Math.cos(o+I*v),z=e*Math.sin(n+P*f)*Math.sin(o+I*v);var S=new M.Vector3(B,R,z);S.normalize(),a.vertices.push({x:B,y:R,z}),a.normals.push(S),T.push(a.vertices.length-1)}a.verticesRows.push(T)}return s.set(e,a),a}}var u=new b;function p(r,e,i,s,a){var h=u.getVerticesForRadius(i,a),t=h.vertices,n=h.normals,f=r.updateGeoGroup(t.length),o=f.vertices,v=f.vertexArray,m=f.colorArray,E=f.faceArray,S=f.lineArray,T=f.normalArray;for(let B=0,R=t.length;B<R;++B){let z=3*(o+B),U=t[B];v[z]=U.x+e.x,v[z+1]=U.y+e.y,v[z+2]=U.z+e.z,m[z]=s.r,m[z+1]=s.g,m[z+2]=s.b}f.vertices+=t.length;let P=h.verticesRows,I=P.length-1;for(let B=0;B<I;B++){let R=P[B].length-1;for(let z=0;z<R;z++){let U=f.faceidx,W=f.lineidx,F=P[B][z+1]+o,N=F*3,q=P[B][z]+o,J=q*3,oe=P[B+1][z]+o,le=oe*3,fe=P[B+1][z+1]+o,ie=fe*3,ne=n[F-o],we=n[q-o],Ee=n[oe-o],Se=n[fe-o];Math.abs(t[F-o].y)===i?(T[N]=ne.x,T[le]=Ee.x,T[ie]=Se.x,T[N+1]=ne.y,T[le+1]=Ee.y,T[ie+1]=Se.y,T[N+2]=ne.z,T[le+2]=Ee.z,T[ie+2]=Se.z,E[U]=F,E[U+1]=oe,E[U+2]=fe,S[W]=F,S[W+1]=oe,S[W+2]=F,S[W+3]=fe,S[W+4]=oe,S[W+5]=fe,f.faceidx+=3,f.lineidx+=6):Math.abs(t[oe-o].y)===i?(T[N]=ne.x,T[J]=we.x,T[le]=Ee.x,T[N+1]=ne.y,T[J+1]=we.y,T[le+1]=Ee.y,T[N+2]=ne.z,T[J+2]=we.z,T[le+2]=Ee.z,E[U]=F,E[U+1]=q,E[U+2]=oe,S[W]=F,S[W+1]=q,S[W+2]=F,S[W+3]=oe,S[W+4]=q,S[W+5]=oe,f.faceidx+=3,f.lineidx+=6):(T[N]=ne.x,T[J]=we.x,T[ie]=Se.x,T[N+1]=ne.y,T[J+1]=we.y,T[ie+1]=Se.y,T[N+2]=ne.z,T[J+2]=we.z,T[ie+2]=Se.z,T[J]=we.x,T[le]=Ee.x,T[ie]=Se.x,T[J+1]=we.y,T[le+1]=Ee.y,T[ie+1]=Se.y,T[J+2]=we.z,T[le+2]=Ee.z,T[ie+2]=Se.z,E[U]=F,E[U+1]=q,E[U+2]=fe,E[U+3]=q,E[U+4]=oe,E[U+5]=fe,S[W]=F,S[W+1]=q,S[W+2]=F,S[W+3]=fe,S[W+4]=q,S[W+5]=oe,S[W+6]=oe,S[W+7]=fe,f.faceidx+=6,f.lineidx+=8)}}}O.drawSphere=p})(w||(w={}))},"./src/GLModel.ts":(K,C,d)=>{d.r(C),d.d(C,{GLModel:()=>p});var M=d("./src/WebGL/index.ts"),L=d("./src/WebGL/shapes/index.ts"),w=d("./src/WebGL/math/index.ts"),O=d("./src/colors.ts"),g=d("./src/GLDraw.ts"),_=d("./src/glcartoon.ts"),A=d("./src/utilities.ts"),c=d("./src/Gradient.ts"),y=d("./src/parsers/index.ts"),b=d("./node_modules/netcdfjs/lib-esm/index.js"),u=d("./src/parsers/utils/assignBonds.ts");class p{static sameObj(e,i){return e&&i?JSON.stringify(e)==JSON.stringify(i):e==i}constructor(e,i){this.atoms=[],this.frames=[],this.box=null,this.atomdfs=null,this.id=0,this.hidden=!1,this.molObj=null,this.renderedMolObj=null,this.lastColors=null,this.modelData={},this.modelDatas=null,this.idMatrix=new w.Matrix4,this.dontDuplicateAtoms=!0,this.defaultColor=O.elementColors.defaultColor,this.defaultStickRadius=.25,this.options=i||{},this.ElementColors=this.options.defaultcolors?this.options.defaultcolors:O.elementColors.defaultColors,this.defaultSphereRadius=this.options.defaultSphereRadius?this.options.defaultSphereRadius:1.5,this.defaultCartoonQuality=this.options.cartoonQuality?this.options.cartoonQuality:10,this.id=e}getRadiusFromStyle(e,i){var s=this.defaultSphereRadius;if(typeof i.radius<"u")s=i.radius;else if(p.vdwRadii[e.elem])s=p.vdwRadii[e.elem];else if(e.elem.length>1){let a=e.elem;a=a[0].toUpperCase()+a[1].toLowerCase(),p.vdwRadii[a]&&(s=p.vdwRadii[a])}return typeof i.scale<"u"&&(s*=i.scale),s}drawAtomCross(e,i){if(e.style.cross){var s=e.style.cross;if(!s.hidden){var a=s.linewidth||p.defaultlineWidth;i[a]||(i[a]=new M.Geometry);var h=i[a].updateGeoGroup(6),t=this.getRadiusFromStyle(e,s),n=[[t,0,0],[-t,0,0],[0,t,0],[0,-t,0],[0,0,t],[0,0,-t]],f=e.clickable||e.hoverable;f&&e.intersectionShape===void 0&&(e.intersectionShape={sphere:[],cylinder:[],line:[]});for(var o=(0,A.getColorFromStyle)(e,s),v=h.vertexArray,m=h.colorArray,E=0;E<6;E++){var S=h.vertices*3;if(h.vertices++,v[S]=e.x+n[E][0],v[S+1]=e.y+n[E][1],v[S+2]=e.z+n[E][2],m[S]=o.r,m[S+1]=o.g,m[S+2]=o.b,f){var T=new w.Vector3(n[E][0],n[E][1],n[E][2]);T.multiplyScalar(.1),T.set(T.x+e.x,T.y+e.y,T.z+e.z),e.intersectionShape.line.push(T)}}}}}getGoodCross(e,i,s,a){for(var h=null,t=-1,n=0,f=e.bonds.length;n<f;n++)if(e.bonds[n]!=i.index){let v=e.bonds[n],m=this.atoms[v],S=new w.Vector3(m.x,m.y,m.z).clone();S.sub(s);let T=S.clone();T.cross(a);var o=T.lengthSq();if(o>t&&(t=o,h=T,t>.1))return h}return h}getSideBondV(e,i,s){var a,h,t,n,f,o=new w.Vector3(e.x,e.y,e.z),v=new w.Vector3(i.x,i.y,i.z),m=v.clone(),E=null;if(m.sub(o),e.bonds.length===1)i.bonds.length===1?(E=m.clone(),Math.abs(E.x)>1e-4?E.y+=1:E.x+=1):(a=(s+1)%i.bonds.length,h=i.bonds[a],t=this.atoms[h],t.index==e.index&&(a=(a+1)%i.bonds.length,h=i.bonds[a],t=this.atoms[h]),n=new w.Vector3(t.x,t.y,t.z),f=n.clone(),f.sub(o),E=f.clone(),E.cross(m));else if(E=this.getGoodCross(e,i,o,m),E.lengthSq()<.01){var S=this.getGoodCross(i,e,o,m);S!=null&&(E=S)}return E.lengthSq()<.01&&(E=m.clone(),Math.abs(E.x)>1e-4?E.y+=1:E.x+=1),E.cross(m),E.normalize(),E}addLine(e,i,s,a,h,t){e[s]=a.x,e[s+1]=a.y,e[s+2]=a.z,i[s]=t.r,i[s+1]=t.g,i[s+2]=t.b,e[s+3]=h.x,e[s+4]=h.y,e[s+5]=h.z,i[s+3]=t.r,i[s+4]=t.g,i[s+5]=t.b}drawBondLines(e,i,s){if(e.style.line){var a=e.style.line;if(!a.hidden){var h,t,n,f,o=a.linewidth||p.defaultlineWidth;s[o]||(s[o]=new M.Geometry);for(var v=s[o].updateGeoGroup(6*e.bonds.length),m=v.vertexArray,E=v.colorArray,S=0;S<e.bonds.length;S++){var T=e.bonds[S],P=i[T];if(P.style.line&&!(e.index>=P.index)){var I=new w.Vector3(e.x,e.y,e.z),B=new w.Vector3(P.x,P.y,P.z),R=I.clone().add(B).multiplyScalar(.5),z=!1,U=e.clickable||e.hoverable,W=P.clickable||P.hoverable;(U||W)&&(U&&(e.intersectionShape===void 0&&(e.intersectionShape={sphere:[],cylinder:[],line:[],triangle:[]}),e.intersectionShape.line.push(I),e.intersectionShape.line.push(R)),W&&(P.intersectionShape===void 0&&(P.intersectionShape={sphere:[],cylinder:[],line:[],triangle:[]}),P.intersectionShape.line.push(R),P.intersectionShape.line.push(B)));var F=(0,A.getColorFromStyle)(e,e.style.line),N=(0,A.getColorFromStyle)(P,P.style.line);if(e.bondStyles&&e.bondStyles[S]){var q=e.bondStyles[S];if(!q.iswire)continue;q.singleBond&&(z=!0),typeof q.color1<"u"&&(F=O.CC.color(q.color1)),typeof q.color2<"u"&&(N=O.CC.color(q.color2))}var J=v.vertices*3,oe,le;if(e.bondOrder[S]>1&&e.bondOrder[S]<4&&!z){var fe=this.getSideBondV(e,P,S),ie=B.clone();ie.sub(I),e.bondOrder[S]==2?(fe.multiplyScalar(.1),h=I.clone(),h.add(fe),t=I.clone(),t.sub(fe),n=h.clone(),n.add(ie),f=t.clone(),f.add(ie),F==N?(v.vertices+=4,this.addLine(m,E,J,h,n,F),this.addLine(m,E,J+6,t,f,F)):(v.vertices+=8,ie.multiplyScalar(.5),oe=h.clone(),oe.add(ie),le=t.clone(),le.add(ie),this.addLine(m,E,J,h,oe,F),this.addLine(m,E,J+6,oe,n,N),this.addLine(m,E,J+12,t,le,F),this.addLine(m,E,J+18,le,f,N))):e.bondOrder[S]==3&&(fe.multiplyScalar(.1),h=I.clone(),h.add(fe),t=I.clone(),t.sub(fe),n=h.clone(),n.add(ie),f=t.clone(),f.add(ie),F==N?(v.vertices+=6,this.addLine(m,E,J,I,B,F),this.addLine(m,E,J+6,h,n,F),this.addLine(m,E,J+12,t,f,F)):(v.vertices+=12,ie.multiplyScalar(.5),oe=h.clone(),oe.add(ie),le=t.clone(),le.add(ie),this.addLine(m,E,J,I,R,F),this.addLine(m,E,J+6,R,B,N),this.addLine(m,E,J+12,h,oe,F),this.addLine(m,E,J+18,oe,n,N),this.addLine(m,E,J+24,t,le,F),this.addLine(m,E,J+30,le,f,N)))}else F==N?(v.vertices+=2,this.addLine(m,E,J,I,B,F)):(v.vertices+=4,this.addLine(m,E,J,I,R,F),this.addLine(m,E,J+6,R,B,N))}}}}}drawAtomSphere(e,i){if(e.style.sphere){var s=e.style.sphere;if(!s.hidden){var a=(0,A.getColorFromStyle)(e,s),h=this.getRadiusFromStyle(e,s);if((e.clickable===!0||e.hoverable)&&e.intersectionShape!==void 0){var t=new w.Vector3(e.x,e.y,e.z);e.intersectionShape.sphere.push(new L.Sphere(t,h))}g.GLDraw.drawSphere(i,e,h,a)}}}drawAtomClickSphere(e){if(e.style.clicksphere){var i=e.style.clicksphere;if(!i.hidden){var s=this.getRadiusFromStyle(e,i);if((e.clickable===!0||e.hoverable)&&e.intersectionShape!==void 0){var a=new w.Vector3(e.x,e.y,e.z);e.intersectionShape.sphere.push(new L.Sphere(a,s))}}}}drawAtomInstanced(e,i){if(e.style.sphere){var s=e.style.sphere;if(!s.hidden){var a=this.getRadiusFromStyle(e,s),h=(0,A.getColorFromStyle)(e,s),t=i.updateGeoGroup(1),n=t.vertices,f=n*3,o=t.vertexArray,v=t.colorArray,m=t.radiusArray;if(o[f]=e.x,o[f+1]=e.y,o[f+2]=e.z,v[f]=h.r,v[f+1]=h.g,v[f+2]=h.b,m[n]=a,(e.clickable===!0||e.hoverable)&&e.intersectionShape!==void 0){var E=new w.Vector3(e.x,e.y,e.z);e.intersectionShape.sphere.push(new L.Sphere(E,a))}t.vertices+=1}}}drawSphereImposter(e,i,s,a){var h=e.updateGeoGroup(4),t,n=h.vertices,f=n*3,o=h.vertexArray,v=h.colorArray;for(t=0;t<4;t++)o[f+3*t]=i.x,o[f+3*t+1]=i.y,o[f+3*t+2]=i.z;var m=h.normalArray;for(t=0;t<4;t++)v[f+3*t]=a.r,v[f+3*t+1]=a.g,v[f+3*t+2]=a.b;m[f+0]=-s,m[f+1]=s,m[f+2]=0,m[f+3]=-s,m[f+4]=-s,m[f+5]=0,m[f+6]=s,m[f+7]=-s,m[f+8]=0,m[f+9]=s,m[f+10]=s,m[f+11]=0,h.vertices+=4;var E=h.faceArray,S=h.faceidx;E[S+0]=n,E[S+1]=n+1,E[S+2]=n+2,E[S+3]=n+2,E[S+4]=n+3,E[S+5]=n,h.faceidx+=6}drawAtomImposter(e,i){if(e.style.sphere){var s=e.style.sphere;if(!s.hidden){var a=this.getRadiusFromStyle(e,s),h=(0,A.getColorFromStyle)(e,s);if((e.clickable===!0||e.hoverable)&&e.intersectionShape!==void 0){var t=new w.Vector3(e.x,e.y,e.z);e.intersectionShape.sphere.push(new L.Sphere(t,a))}this.drawSphereImposter(i,e,a,h)}}}calculateDashes(e,i,s,a,h){var t=Math.sqrt(Math.pow(e.x-i.x,2)+Math.pow(e.y-i.y,2)+Math.pow(e.z-i.z,2));s=Math.max(s,0),h=Math.max(h,0)+2*s,a=Math.max(a,.001),a+h>t&&(a=t,h=0);var n=Math.floor((t-a)/(a+h))+1,f=n*a;h=(t-f)/n;for(var o,v=new w.Vector3(e.x,e.y,e.z),m=new w.Vector3((i.x-e.x)/(t/h),(i.y-e.y)/(t/h),(i.z-e.z)/(t/h)),E=new w.Vector3((i.x-e.x)/(t/a),(i.y-e.y)/(t/a),(i.z-e.z)/(t/a)),S=[],T=0;T<n;T++)o=new w.Vector3(v.x+E.x,v.y+E.y,v.z+E.z),S.push({from:v,to:o}),v=new w.Vector3(o.x+m.x,o.y+m.y,o.z+m.z);return S}static drawStickImposter(e,i,s,a,h,t=0,n=0){for(var f=e.updateGeoGroup(4),o=f.vertices,v=o*3,m=f.vertexArray,E=f.colorArray,S=f.radiusArray,T=f.normalArray,P=h.r,I=h.g,B=h.b,R=function(N){var q=-N;return q==0&&(q=-1e-4),q},z=v,U=0;U<4;U++)m[z]=i.x,T[z]=s.x,E[z]=P,z++,m[z]=i.y,T[z]=s.y,E[z]=I,z++,m[z]=i.z,T[z]=s.z,U<2?E[z]=B:E[z]=R(B),z++;f.vertices+=4,S[o]=-a,S[o+1]=a,S[o+2]=-a,S[o+3]=a;var W=f.faceArray,F=f.faceidx;W[F+0]=o,W[F+1]=o+1,W[F+2]=o+2,W[F+3]=o+2,W[F+4]=o+3,W[F+5]=o,f.faceidx+=6}drawBondSticks(e,i,s){var a,h;if(e.style.stick){var t=e.style.stick;if(!t.hidden){var n=t.radius||this.defaultStickRadius,f=t.doubleBondScaling||.4,o=t.tripleBondScaling||.25,v=((a=t.dashedBondConfig)===null||a===void 0?void 0:a.dashLength)||.1,m=((h=t.dashedBondConfig)===null||h===void 0?void 0:h.gapLength)||.25,E=n,S=t.singleBonds||!1,T=t.dashedBonds||!1,P=0,I=0,B,R,z,U,W,F,N,q,J,oe,le,fe=(0,A.getColorFromStyle)(e,t),ie,ne,we;!e.capDrawn&&e.bonds.length<4&&(P=2);var Ee=ae=>{var pe=s.imposter?p.drawStickImposter:g.GLDraw.drawCylinder;return!T&&ae>=1?pe:(Te,se,ye,j,Ce,We=0,D=0,ue=.1,ce=.25)=>{var H=this.calculateDashes(se,ye,j,ue,ce);H.forEach(te=>{pe(Te,te.from,te.to,j,Ce,We,D)})}};for(z=0;z<e.bonds.length;z++){var Se=Ee(e.bondOrder[z]),de=e.bonds[z],ee=i[de];if(ie=ne=we=null,e.index<ee.index){var me=ee.style;if(!me.stick||me.stick.hidden)continue;var De=(0,A.getColorFromStyle)(ee,me.stick);if(E=n,U=S,e.bondStyles&&e.bondStyles[z]){if(W=e.bondStyles[z],W.iswire)continue;W.radius&&(E=W.radius),W.singleBond&&(U=!0),typeof W.color1<"u"&&(fe=O.CC.color(W.color1)),typeof W.color2<"u"&&(De=O.CC.color(W.color2))}var Ie=new w.Vector3(e.x,e.y,e.z),Fe=new w.Vector3(ee.x,ee.y,ee.z);if(e.bondOrder[z]<=1||U||e.bondOrder[z]>3){if(e.bondOrder[z]<1&&(E*=e.bondOrder[z]),!ee.capDrawn&&ee.bonds.length<4&&(I=2),fe!=De?(ie=new w.Vector3().addVectors(Ie,Fe).multiplyScalar(.5),Se(s,Ie,ie,E,fe,P,0,v,m),Se(s,ie,Fe,E,De,0,I,v,m)):Se(s,Ie,Fe,E,fe,P,I,v,m),B=e.clickable||e.hoverable,R=ee.clickable||ee.hoverable,B||R){if(ie||(ie=new w.Vector3().addVectors(Ie,Fe).multiplyScalar(.5)),B){var Ue=new L.Cylinder(Ie,ie,E),ze=new L.Sphere(Ie,E);e.intersectionShape.cylinder.push(Ue),e.intersectionShape.sphere.push(ze)}if(R){var Re=new L.Cylinder(Fe,ie,E),Pe=new L.Sphere(Fe,E);ee.intersectionShape.cylinder.push(Re),ee.intersectionShape.sphere.push(Pe)}}}else if(e.bondOrder[z]>1){var Oe=0,Ae=0;E!=n&&(Oe=2,Ae=2);var Ne=Fe.clone(),je=null;Ne.sub(Ie);var k,Z,Y,ve,re;je=this.getSideBondV(e,ee,z),e.bondOrder[z]==2?(k=E*f,je.multiplyScalar(k*1.5),Z=Ie.clone(),Z.add(je),Y=Ie.clone(),Y.sub(je),ve=Z.clone(),ve.add(Ne),re=Y.clone(),re.add(Ne),fe!=De?(ie=new w.Vector3().addVectors(Z,ve).multiplyScalar(.5),ne=new w.Vector3().addVectors(Y,re).multiplyScalar(.5),Se(s,Z,ie,k,fe,Oe,0),Se(s,ie,ve,k,De,0,Ae),Se(s,Y,ne,k,fe,Oe,0),Se(s,ne,re,k,De,0,Ae)):(Se(s,Z,ve,k,fe,Oe,Ae),Se(s,Y,re,k,fe,Oe,Ae)),B=e.clickable||e.hoverable,R=ee.clickable||ee.hoverable,(B||R)&&(ie||(ie=new w.Vector3().addVectors(Z,ve).multiplyScalar(.5)),ne||(ne=new w.Vector3().addVectors(Y,re).multiplyScalar(.5)),B&&(F=new L.Cylinder(Z,ie,k),N=new L.Cylinder(Y,ne,k),e.intersectionShape.cylinder.push(F),e.intersectionShape.cylinder.push(N)),R&&(J=new L.Cylinder(ve,ie,k),oe=new L.Cylinder(re,ne,k),ee.intersectionShape.cylinder.push(J),ee.intersectionShape.cylinder.push(oe)))):e.bondOrder[z]==3&&(k=E*o,je.cross(Ne),je.normalize(),je.multiplyScalar(k*3),Z=Ie.clone(),Z.add(je),Y=Ie.clone(),Y.sub(je),ve=Z.clone(),ve.add(Ne),re=Y.clone(),re.add(Ne),fe!=De?(ie=new w.Vector3().addVectors(Z,ve).multiplyScalar(.5),ne=new w.Vector3().addVectors(Y,re).multiplyScalar(.5),we=new w.Vector3().addVectors(Ie,Fe).multiplyScalar(.5),Se(s,Z,ie,k,fe,Oe,0),Se(s,ie,ve,k,De,0,Ae),Se(s,Ie,we,k,fe,P,0),Se(s,we,Fe,k,De,0,I),Se(s,Y,ne,k,fe,Oe,0),Se(s,ne,re,k,De,0,Ae)):(Se(s,Z,ve,k,fe,Oe,Ae),Se(s,Ie,Fe,k,fe,P,I),Se(s,Y,re,k,fe,Oe,Ae)),B=e.clickable||e.hoverable,R=ee.clickable||ee.hoverable,(B||R)&&(ie||(ie=new w.Vector3().addVectors(Z,ve).multiplyScalar(.5)),ne||(ne=new w.Vector3().addVectors(Y,re).multiplyScalar(.5)),we||(we=new w.Vector3().addVectors(Ie,Fe).multiplyScalar(.5)),B&&(F=new L.Cylinder(Z.clone(),ie.clone(),k),N=new L.Cylinder(Y.clone(),ne.clone(),k),q=new L.Cylinder(Ie.clone(),we.clone(),k),e.intersectionShape.cylinder.push(F),e.intersectionShape.cylinder.push(N),e.intersectionShape.cylinder.push(q)),R&&(J=new L.Cylinder(ve.clone(),ie.clone(),k),oe=new L.Cylinder(re.clone(),ne.clone(),k),le=new L.Cylinder(Fe.clone(),we.clone(),k),ee.intersectionShape.cylinder.push(J),ee.intersectionShape.cylinder.push(oe),ee.intersectionShape.cylinder.push(le))))}}}var Le=!1,Me=0,V=!1;for(z=0;z<e.bonds.length;z++)U=S,e.bondStyles&&e.bondStyles[z]&&(W=e.bondStyles[z],W.singleBond&&(U=!0),W.radius&&W.radius!=n&&(V=!0)),(U||e.bondOrder[z]==1)&&Me++;V?Me>0&&(Le=!0):Me==0&&(e.bonds.length>0||t.showNonBonded)&&(Le=!0),Le&&(E=n,s.imposter?this.drawSphereImposter(s.sphereGeometry,e,E,fe):g.GLDraw.drawSphere(s,e,E,fe))}}}createMolObj(e,i){i=i||{};var s=new M.Object3D,a=[],h={},t={},n=this.drawAtomSphere,f=null,o=null;i.supportsImposters?(n=this.drawAtomImposter,f=new M.Geometry(!0),f.imposter=!0,o=new M.Geometry(!0,!0),o.imposter=!0,o.sphereGeometry=new M.Geometry(!0),o.sphereGeometry.imposter=!0,o.drawnCaps={}):i.supportsAIA?(n=this.drawAtomInstanced,f=new M.Geometry(!1,!0,!0),f.instanced=!0,o=new M.Geometry(!0)):(f=new M.Geometry(!0),o=new M.Geometry(!0));var v,m,E,S,T={},P=[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY];for(v=0,E=e.length;v<E;v++){var I=e[v];if(I&&I.style){(I.clickable||I.hoverable)&&I.intersectionShape===void 0&&(I.intersectionShape={sphere:[],cylinder:[],line:[],triangle:[]}),S={line:void 0,cross:void 0,stick:void 0,sphere:void 0};for(m in S)I.style[m]?I.style[m].opacity?S[m]=parseFloat(I.style[m].opacity):S[m]=1:S[m]=void 0,T[m]?S[m]!=null&&T[m]!=S[m]&&(console.log("Warning: "+m+" opacity is ambiguous"),T[m]=1):T[m]=S[m];n.call(this,I,f),this.drawAtomClickSphere(I),this.drawAtomCross(I,t),this.drawBondLines(I,e,h),this.drawBondSticks(I,e,o),typeof I.style.cartoon<"u"&&!I.style.cartoon.hidden&&(I.style.cartoon.color==="spectrum"&&typeof I.resi=="number"&&!I.hetflag&&(I.resi<P[0]&&(P[0]=I.resi),I.resi>P[1]&&(P[1]=I.resi)),a.push(I))}}if(a.length>0&&(0,_.drawCartoon)(s,a,P,this.defaultCartoonQuality),f&&f.vertices>0){f.initTypedArrays();var B=null,R=null;f.imposter?B=new M.SphereImposterMaterial({ambient:0,vertexColors:!0,reflectivity:0}):f.instanced?(R=new M.Geometry(!0),g.GLDraw.drawSphere(R,{x:0,y:0,z:0},1,new O.Color(.5,.5,.5)),R.initTypedArrays(),B=new M.InstancedMaterial({sphereMaterial:new M.MeshLambertMaterial({ambient:0,vertexColors:!0,reflectivity:0}),sphere:R})):B=new M.MeshLambertMaterial({ambient:0,vertexColors:!0,reflectivity:0}),T.sphere<1&&T.sphere>=0&&(B.transparent=!0,B.opacity=T.sphere),R=new M.Mesh(f,B),s.add(R)}if(o.vertices>0){var z=null,U=null,W=o.sphereGeometry;(!W||typeof W.vertices>"u"||W.vertices==0)&&(W=null),o.initTypedArrays(),W&&W.initTypedArrays();var F={ambient:0,vertexColors:!0,reflectivity:0};o.imposter?(z=new M.StickImposterMaterial(F),U=new M.SphereImposterMaterial(F)):(z=new M.MeshLambertMaterial(F),U=new M.MeshLambertMaterial(F),z.wireframe&&(o.setUpWireframe(),W&&W.setUpWireframe())),T.stick<1&&T.stick>=0&&(z.transparent=!0,z.opacity=T.stick,U.transparent=!0,U.opacity=T.stick);var N=new M.Mesh(o,z);if(s.add(N),W){var q=new M.Mesh(W,U);s.add(q)}}var J;for(v in h)if(h.hasOwnProperty(v)){J=v;var oe=new M.LineBasicMaterial({linewidth:J,vertexColors:!0});T.line<1&&T.line>=0&&(oe.transparent=!0,oe.opacity=T.line),h[v].initTypedArrays();var le=new M.Line(h[v],oe,M.LineStyle.LinePieces);s.add(le)}for(v in t)if(t.hasOwnProperty(v)){J=v;var fe=new M.LineBasicMaterial({linewidth:J,vertexColors:!0});T.cross<1&&T.cross>=0&&(fe.transparent=!0,fe.opacity=T.cross),t[v].initTypedArrays();var ie=new M.Line(t[v],fe,M.LineStyle.LinePieces);s.add(ie)}if(this.dontDuplicateAtoms&&this.modelData.symmetries&&this.modelData.symmetries.length>0){var ne=new M.Object3D,we;for(we=0;we<this.modelData.symmetries.length;we++){var Ee=new M.Object3D;Ee=s.clone(),Ee.matrix.copy(this.modelData.symmetries[we]),Ee.matrixAutoUpdate=!1,ne.add(Ee)}return ne}return s}getInternalState(){return{atoms:this.atoms,frames:this.frames}}setInternalState(e){this.atoms=e.atoms,this.frames=e.frames,this.molObj=null}getCrystData(){if(this.modelData.cryst){if(!this.modelData.cryst.matrix){const e=this.modelData.cryst;this.modelData.cryst.matrix=(0,w.conversionMatrix3)(e.a,e.b,e.c,e.alpha,e.beta,e.gamma)}return this.modelData.cryst}else return null}setCrystData(e,i,s,a,h,t){e=e||1,i=i||1,s=s||1,a=a||90,h=h||90,t=t||90;const n=(0,w.conversionMatrix3)(e,i,s,a,h,t);this.modelData.cryst={a:e,b:i,c:s,alpha:a,beta:h,gamma:t,matrix:n}}setCrystMatrix(e){e=e||new w.Matrix3(1,0,0,0,1,0,0,0,1),this.modelData.cryst={matrix:e}}getSymmetries(){return typeof this.modelData.symmetries>"u"&&(this.modelData.symmetries=[this.idMatrix]),this.modelData.symmetries}setSymmetries(e){typeof e>"u"?this.modelData.symmetries=[this.idMatrix]:this.modelData.symmetries=e}getID(){return this.id}getNumFrames(){return this.frames.numFrames!=null?this.frames.numFrames:this.frames.length}adjustCoord(e,i,s,a){var h=i-e;return h<-s?i+a:h>s?i-a:i}adjustCoordinatesToBox(){if(this.box&&this.atomdfs)for(var e=this.box[0],i=this.box[1],s=this.box[2],a=e*.9,h=i*.9,t=s*.9,n=0;n<this.atomdfs.length;n++)for(var f=this.atomdfs[n],o=1;o<f.length;o++){var v=this.atoms[f[o][0]],m=this.atoms[f[o][1]];v.x=this.adjustCoord(m.x,v.x,a,e),v.y=this.adjustCoord(m.y,v.y,h,i),v.z=this.adjustCoord(m.z,v.z,t,s)}}setFrame(e,i){var s=this.getNumFrames();let a=this;return new Promise(function(h,t){if(s==0&&h(),(e<0||e>=s)&&(e=s-1),a.frames.url!=null){var n=a.frames.url;(0,A.getbin)(n+"/traj/frame/"+e+"/"+a.frames.path,void 0,"POST",void 0).then(function(f){for(var o=new Float32Array(f,44),v=0,m=0;m<a.atoms.length;m++)a.atoms[m].x=o[v++],a.atoms[m].y=o[v++],a.atoms[m].z=o[v++];a.box&&a.atomdfs&&a.adjustCoordinatesToBox(),h()}).catch(t)}else a.atoms=a.frames[e],h();a.molObj=null,a.modelDatas&&e<a.modelDatas.length&&(a.modelData=a.modelDatas[e],a.unitCellObjects&&i&&(i.removeUnitCell(a),i.addUnitCell(a)))})}addFrame(e){this.frames.push(e)}vibrate(e=10,i=1,s=!1,a,h){var t=0,n=e;s&&(t=-e,n=e),this.frames!==void 0&&this.frames.origIndex!==void 0?this.setFrame(this.frames.origIndex):this.setFrame(0),t<n&&(this.frames=[]),s&&(this.frames.origIndex=e);for(var f=t;f<n;f++){var o=[],v=this.frames.length;if(f==0&&!h){this.frames.push(this.atoms);continue}for(var m=0;m<this.atoms.length;m++){var E=(0,A.getAtomProperty)(this.atoms[m],"dx"),S=(0,A.getAtomProperty)(this.atoms[m],"dy"),T=(0,A.getAtomProperty)(this.atoms[m],"dz"),P=new w.Vector3(E,S,T),I=new w.Vector3(this.atoms[m].x,this.atoms[m].y,this.atoms[m].z),B=f*i/e;P.multiplyScalar(B),I.add(P);var R={};for(var z in this.atoms[m])R[z]=this.atoms[m][z];if(R.x=I.x,R.y=I.y,R.z=I.z,o.push(R),a&&h){var U=(0,A.extend)({},h),W=new w.Vector3(E,S,T);if(W.multiplyScalar(i),W.add(I),U.start=I,U.end=W,U.frame=v,!U.color){var F=R.style.sphere;F||(F=R.style.stick),F||(F=R.style.line),U.color=(0,A.getColorFromStyle)(R,F)}a.addArrow(U)}}this.frames.push(o)}}setAtomDefaults(e){for(let i=0;i<e.length;i++){let s=e[i];s&&(s.style=s.style||(0,A.deepCopy)(p.defaultAtomStyle),s.color=s.color||this.ElementColors[s.elem]||this.defaultColor,s.model=this.id,(s.clickable||s.hoverable)&&(s.intersectionShape={sphere:[],cylinder:[],line:[],triangle:[]}))}}addMolData(e,i,s={}){var a=p.parseMolData(e,i,s);this.dontDuplicateAtoms=!s.duplicateAssemblyAtoms;var h=a.modelData;if(h&&(Array.isArray(h)?(this.modelData=h[0],s.frames&&(this.modelDatas=h)):this.modelData=h),a.box?this.box=a.box:this.box=null,this.frames.length==0){for(let n=0;n<a.length;n++)a[n].length!=0&&this.frames.push(a[n]);this.frames[0]&&(this.atoms=this.frames[0])}else if(s.frames)for(let n=0;n<a.length;n++)this.frames.push(a[n]);else for(var t=0;t<a.length;t++)this.addAtoms(a[t]);for(let n=0;n<this.frames.length;n++)this.setAtomDefaults(this.frames[n]);s.vibrate&&s.vibrate.frames&&s.vibrate.amplitude&&this.vibrate(s.vibrate.frames,s.vibrate.amplitude),s.style&&this.setStyle({},s.style)}setDontDuplicateAtoms(e){this.dontDuplicateAtoms=e}setModelData(e){this.modelData=e}propertyMatches(e,i){if(e==i)return!0;if(typeof i=="string"&&typeof e=="number"){var s=i.match(/(-?\d+)\s*-\s*(-?\d+)/);if(s){var a=parseInt(s[1]),h=parseInt(s[2]);if(s&&e>=a&&e<=h)return!0}}return!1}static deepCopyAndCache(e,i){if(typeof e!="object"||e==null||e.__cache_created)return e;const s={};for(const a in e){const h=e[a];if(Array.isArray(h)){s[a]=[];for(let t=0;t<h.length;t++)s[a].push(p.deepCopyAndCache(h[t],i))}else typeof h=="object"&&a!="properties"&&a!="model"?s[a]=p.deepCopyAndCache(h,i):s[a]=h;if(a=="and"||a=="or"){const t=[];for(const n of s[a]){const f=new Set;for(const o of i.selectedAtoms(n))f.add(o.index);t.push(f)}if(a=="and"){const n=function(o,v){const m=new Set;for(const E of v)o.has(E)&&m.add(E);return m};let f=new Set(t[0]);for(const o of t.splice(1))f=n(f,o);s[a].__cached_results=f}else if(a=="or"){const n=new Set;for(const f of t)for(const o of f)n.add(o);s[a].__cached_results=n}}}return s.__cache_created=!0,s}atomIsSelected(e,i){if(typeof i>"u")return!0;var s=!!i.invert,a=!0;for(var h in i)if(h=="and"||h=="or"||h=="not"){if(h=="not"){if(this.atomIsSelected(e,i[h])){a=!1;break}}else if(i[h].__cached_results===void 0&&(i=p.deepCopyAndCache(i,this)),a=i[h].__cached_results.has(e.index),!a)break}else if(h==="predicate"){if(!i.predicate(e)){a=!1;break}}else if(h=="properties"&&e[h]){for(var t in i.properties)if(!t.startsWith("__cache")){if(typeof e.properties[t]>"u"){a=!1;break}if(e.properties[t]!=i.properties[t]){a=!1;break}}}else if(i.hasOwnProperty(h)&&!p.ignoredKeys.has(h)&&!h.startsWith("__cache")){if(typeof e[h]>"u"){a=!1;break}var n=!1;if(h==="bonds"){var f=i[h];if(f!=e.bonds.length){a=!1;break}}else if(Array.isArray(i[h])){var o=i[h],v=e[h];for(let m=0;m<o.length;m++)if(this.propertyMatches(v,o[m])){n=!0;break}if(!n){a=!1;break}}else{let m=i[h];if(!this.propertyMatches(e[h],m)){a=!1;break}}}return s?!a:a}static squaredDistance(e,i){var s=i.x-e.x,a=i.y-e.y,h=i.z-e.z;return s*s+a*a+h*h}expandAtomList(e,i){if(i<=0)return e;for(var s=(0,A.getExtent)(e,void 0),a=[[],[],[]],h=0;h<3;h++)a[0][h]=s[0][h]-i,a[1][h]=s[1][h]+i,a[2][h]=s[2][h];var t=[];for(let v=0;v<this.atoms.length;v++){var n=this.atoms[v].x,f=this.atoms[v].y,o=this.atoms[v].z;n>=a[0][0]&&n<=a[1][0]&&f>=a[0][1]&&f<=a[1][1]&&o>=a[0][2]&&o<=a[1][2]&&(n>=s[0][0]&&n<=s[1][0]&&f>=s[0][1]&&f<=s[1][1]&&o>=s[0][2]&&o<=s[1][2]||t.push(this.atoms[v]))}return t}static getFloat(e){return typeof e=="number"?e:parseFloat(e)}selectedAtoms(e,i){var s=[];e=p.deepCopyAndCache(e||{},this),i||(i=this.atoms);for(var a=i.length,h=0;h<a;h++){var t=i[h];t&&this.atomIsSelected(t,e)&&s.push(t)}if(e.hasOwnProperty("expand")){const R=p.getFloat(e.expand);let z=this.expandAtomList(s,R),U=s.length;const W=R*R;for(let F=0;F<z.length;F++)for(let N=0;N<U;N++){var n=p.squaredDistance(z[F],s[N]);n<W&&n>0&&s.push(z[F])}}if(e.hasOwnProperty("within")&&e.within.hasOwnProperty("sel")&&e.within.hasOwnProperty("distance")){var f=this.selectedAtoms(e.within.sel,this.atoms),o={};const R=p.getFloat(e.within.distance),z=R*R;for(let U=0;U<f.length;U++)for(let W=0;W<s.length;W++){let F=p.squaredDistance(f[U],s[W]);F<z&&F>0&&(o[W]=1)}var v=[];if(e.within.invert)for(let U=0;U<s.length;U++)o[U]||v.push(s[U]);else for(let U in o)v.push(s[U]);s=v}if(e.hasOwnProperty("byres")){var m={},E=[],S=[];for(let R=0;R<s.length;R++){let z=s[R];var T=z.chain,P=z.resi;if(m[T]===void 0&&(m[T]={}),z.hasOwnProperty("resi")&&m[T][P]===void 0){for(m[T][P]=!0,S.push(z);S.length>0;)if(z=S.pop(),T=z.chain,P=z.resi,E[z.index]===void 0){E[z.index]=!0;for(var I=0;I<z.bonds.length;I++){var B=this.atoms[z.bonds[I]];E[B.index]===void 0&&B.hasOwnProperty("resi")&&B.chain==T&&B.resi==P&&(S.push(B),s.push(B))}}}}}return s}addAtoms(e){this.molObj=null;var i=this.atoms.length,s=[],a;for(a=0;a<e.length;a++)typeof e[a].index>"u"&&(e[a].index=a),typeof e[a].serial>"u"&&(e[a].serial=a),s[e[a].index]=i+a;for(a=0;a<e.length;a++){var h=e[a],t=s[h.index],n=(0,A.extend)({},h);n.index=t,n.bonds=[],n.bondOrder=[],n.model=this.id,n.style=n.style||(0,A.deepCopy)(p.defaultAtomStyle),typeof n.color>"u"&&(n.color=this.ElementColors[n.elem]||this.defaultColor);for(var f=h.bonds?h.bonds.length:0,o=0;o<f;o++){var v=s[h.bonds[o]];typeof v<"u"&&(n.bonds.push(v),n.bondOrder.push(h.bondOrder?h.bondOrder[o]:1))}this.atoms.push(n)}}assignBonds(){(0,u.assignBonds)(this.atoms,{assignBonds:!0})}removeAtoms(e){this.molObj=null;var i=[],s;for(s=0;s<e.length;s++)i[e[s].index]=!0;var a=[];for(s=0;s<this.atoms.length;s++){var h=this.atoms[s];i[h.index]||a.push(h)}this.atoms=[],this.addAtoms(a)}setStyle(e,i,s){typeof i>"u"&&typeof s>"u"&&(i=e,e={}),e=e,typeof i=="string"&&(i=(0,A.specStringToObject)(i));var a=!1,h=this,t=function(f){var o=h.selectedAtoms(e,f);for(let v=0;v<f.length;v++)f[v]&&(f[v].capDrawn=!1);for(let v=0;v<o.length;v++){a=!0,(o[v].clickable||o[v].hoverable)&&(o[v].intersectionShape={sphere:[],cylinder:[],line:[],triangle:[]}),s||(o[v].style={});for(let m in i)i.hasOwnProperty(m)&&(o[v].style[m]=o[v].style[m]||{},Object.assign(o[v].style[m],i[m]))}};if(e.frame!==void 0&&e.frame<this.frames.length){let f=e.frame;f<0&&(f=this.frames.length+f),t(this.frames[f])}else{t(this.atoms);for(var n=0;n<this.frames.length;n++)this.frames[n]!==this.atoms&&t(this.frames[n])}a&&(this.molObj=null)}setClickable(e,i,s){if(i=!!i,s=(0,A.makeFunction)(s),s===null){console.log("Callback is not a function");return}var a=this.selectedAtoms(e,this.atoms),h=a.length;for(let t=0;t<h;t++)a[t].intersectionShape={sphere:[],cylinder:[],line:[],triangle:[]},a[t].clickable=i,s&&(a[t].callback=s);h>0&&(this.molObj=null)}setHoverable(e,i,s,a){if(i=!!i,s=(0,A.makeFunction)(s),a=(0,A.makeFunction)(a),s===null){console.log("Hover_callback is not a function");return}if(a===null){console.log("Unhover_callback is not a function");return}var h=this.selectedAtoms(e,this.atoms),t=h.length;for(let n=0;n<t;n++)h[n].intersectionShape={sphere:[],cylinder:[],line:[],triangle:[]},h[n].hoverable=i,s&&(h[n].hover_callback=s),a&&(h[n].unhover_callback=a);t>0&&(this.molObj=null)}enableContextMenu(e,i){i=!!i;var s,a=this.selectedAtoms(e,this.atoms),h=a.length;for(s=0;s<h;s++)a[s].intersectionShape={sphere:[],cylinder:[],line:[],triangle:[]},a[s].contextMenuEnabled=i;h>0&&(this.molObj=null)}setColorByElement(e,i){if(!(this.molObj!==null&&p.sameObj(i,this.lastColors))){this.lastColors=i;var s=this.selectedAtoms(e,s);s.length>0&&(this.molObj=null);for(var a=0;a<s.length;a++){var h=s[a];typeof i[h.elem]<"u"&&(h.color=i[h.elem])}}}setColorByProperty(e,i,s,a){var h,t,n=this.selectedAtoms(e,n);for(this.lastColors=null,n.length>0&&(this.molObj=null),typeof s=="string"&&typeof c.Gradient.builtinGradients[s]<"u"&&(s=new c.Gradient.builtinGradients[s]),s=s,a||(a=s.range()),a||(a=(0,A.getPropertyRange)(n,i)),h=0;h<n.length;h++){t=n[h];var f=(0,A.getAtomProperty)(t,i);f!=null&&(t.color=s.valueToHex(parseFloat(t.properties[i]),a))}}setColorByFunction(e,i){var s=this.selectedAtoms(e,s);if(typeof i=="function"){this.lastColors=null,s.length>0&&(this.molObj=null);for(let a=0;a<s.length;a++){let h=s[a];h.color=i(h)}}}toCDObject(e=!1){var i={a:[],b:[]};e&&(i.s=[]);for(let a=0;a<this.atoms.length;a++){let h={},t=this.atoms[a];if(h.x=t.x,h.y=t.y,h.z=t.z,t.elem!="C"&&(h.l=t.elem),e){for(var s=0;s<i.s.length&&JSON.stringify(t.style)!==JSON.stringify(i.s[s]);)s++;s===i.s.length&&i.s.push(t.style),s!==0&&(h.s=s)}i.a.push(h);for(let n=0;n<t.bonds.length;n++){let f=a,o=t.bonds[n];if(f>=o)continue;let v={b:f,e:o},m=t.bondOrder[n];m!=1&&(v.o=m),i.b.push(v)}}return i}globj(e,i){(this.molObj===null||i.regen)&&(this.molObj=this.createMolObj(this.atoms,i),this.renderedMolObj&&(e.remove(this.renderedMolObj),this.renderedMolObj=null),this.renderedMolObj=this.molObj.clone(),this.hidden&&(this.renderedMolObj.setVisible(!1),this.molObj.setVisible(!1)),e.add(this.renderedMolObj))}exportVRML(){var e=this.createMolObj(this.atoms,{supportsImposters:!1,supportsAIA:!1});return e.vrml()}removegl(e){this.renderedMolObj&&(this.renderedMolObj.geometry!==void 0&&this.renderedMolObj.geometry.dispose(),this.renderedMolObj.material!==void 0&&this.renderedMolObj.material.dispose(),e.remove(this.renderedMolObj),this.renderedMolObj=null),this.molObj=null}hide(){this.hidden=!0,this.renderedMolObj&&this.renderedMolObj.setVisible(!1),this.molObj&&this.molObj.setVisible(!1)}show(){this.hidden=!1,this.renderedMolObj&&this.renderedMolObj.setVisible(!0),this.molObj&&this.molObj.setVisible(!0)}addPropertyLabels(e,i,s,a){for(var h=this.selectedAtoms(i,h),t=(0,A.deepCopy)(a),n=0;n<h.length;n++){var f=h[n],o=null;typeof f[e]<"u"?o=String(f[e]):typeof f.properties[e]<"u"&&(o=String(f.properties[e])),o!=null&&(t.position=f,s.addLabel(o,t))}}addResLabels(e,i,s,a=!1){var h=[],t=function(f,o){for(var v=f.selectedAtoms(e,v),m={},E=0;E<v.length;E++){var S=v[E],T=S.chain,P=S.resn,I=S.resi,B=P+""+I;m[T]||(m[T]={}),m[T][B]||(m[T][B]=[]),m[T][B].push(S)}var R=(0,A.deepCopy)(s);for(let U in m)if(m.hasOwnProperty(U)){var z=m[U];for(let W in z)if(z.hasOwnProperty(W)){let F=z[W],N=new w.Vector3(0,0,0);for(let J=0;J<F.length;J++){let oe=F[J];N.x+=oe.x,N.y+=oe.y,N.z+=oe.z}N.divideScalar(F.length),R.position=N,R.frame=o;let q=i.addLabel(W,R,void 0,!0);h.push(q)}}};if(a){var n=this.getNumFrames();let f=this.atoms;for(let o=0;o<n;o++)this.frames[o]&&(this.atoms=this.frames[o],t(this,o));this.atoms=f}else t(this);return h}setupDFS(){this.atomdfs=[];var e=this,i=new Int8Array(this.atoms.length);i.fill(0);for(var s=function(n,f,o){o.push([n,f]);var v=e.atoms[n];i[n]=1;for(var m=0;m<v.bonds.length;m++){var E=v.bonds[m];e.atoms[E]&&!i[E]&&s(E,n,o)}},a=0;a<this.atoms.length;a++){var h=this.atoms[a];if(h&&!i[a]){var t=[];s(a,-1,t),this.atomdfs.push(t)}}}setCoordinatesFromURL(e,i){this.frames=[];var s=this;return this.box&&this.setupDFS(),e.startsWith("http")||(e="http://"+e),(0,A.get)(e+"/traj/numframes/"+i,function(a){if(!isNaN(parseInt(a)))return s.frames.push(s.atoms),s.frames.numFrames=a,s.frames.url=e,s.frames.path=i,s.setFrame(0)})}setCoordinates(e,i){if(i=i||"",!e)return[];if(/\.gz$/.test(i)){i=i.replace(/\.gz$/,"");try{e=(0,A.inflateString)(e)}catch(m){console.log(m)}}var s={mdcrd:"",inpcrd:"",pdb:"",netcdf:"",array:""};if(s.hasOwnProperty(i)){this.frames=[];for(var a=this.atoms.length,h=p.parseCrd(e,i),t=0;t<h.length;){for(var n=[],f=0;f<a;f++){var o={};for(var v in this.atoms[f])o[v]=this.atoms[f][v];n[f]=o,n[f].x=h[t++],n[f].y=h[t++],n[f].z=h[t++]}this.frames.push(n)}return this.atoms=this.frames[0],this.frames}return[]}addAtomSpecs(e){}static parseCrd(e,i){var s=[],a=0;if(i=="pdb")for(var h=e.indexOf(`
ATOM`);h!=-1;){for(;e.slice(h,h+5)==`
ATOM`||e.slice(h,h+7)==`
HETATM`;)s[a++]=parseFloat(e.slice(h+31,h+39)),s[a++]=parseFloat(e.slice(h+39,h+47)),s[a++]=parseFloat(e.slice(h+47,h+55)),h=e.indexOf(`
`,h+54),e.slice(h,h+4)==`
TER`&&(h=e.indexOf(`
`,h+5));h=e.indexOf(`
ATOM`,h)}else if(i=="netcdf"){var t=new b.NetCDFReader(e);s=[].concat.apply([],t.getDataVariable("coordinates"))}else{if(i=="array"||Array.isArray(e))return e.flat(2);{let n=e.indexOf(`
`);i=="inpcrd"&&(n=e.indexOf(`
`,n+1)),e=e.slice(n+1),s=e.match(/\S+/g).map(parseFloat)}}return s}static parseMolData(e,i="",s){if(!e)return[];if(/\.gz$/.test(i)){i=i.replace(/\.gz$/,"");try{i.match(/bcif/i)?e=(0,A.inflateString)(e,!1):e=(0,A.inflateString)(e)}catch(t){console.log(t)}}typeof y.Parsers[i]>"u"&&(i=i.split(".").pop(),typeof y.Parsers[i]>"u"&&(console.log("Unknown format: "+i),e instanceof Uint8Array?i="bcif":e.match(/^@<TRIPOS>MOLECULE/gm)?i="mol2":e.match(/^data_/gm)&&e.match(/^loop_/gm)?i="cif":e.match(/^HETATM/gm)||e.match(/^ATOM/gm)?i="pdb":e.match(/ITEM: TIMESTEP/gm)?i="lammpstrj":e.match(/^.*\n.*\n.\s*(\d+)\s+(\d+)/gm)?i="sdf":e.match(/^%VERSION\s+VERSION_STAMP/gm)?i="prmtop":i="xyz",console.log("Best guess: "+i)));var a=y.Parsers[i],h=a(e,s);return h}}p.defaultAtomStyle={line:{}},p.defaultlineWidth=1,p.vdwRadii={H:1.2,He:1.4,Li:1.82,Be:1.53,B:1.92,C:1.7,N:1.55,O:1.52,F:1.47,Ne:1.54,Na:2.27,Mg:1.73,Al:1.84,Si:2.1,P:1.8,S:1.8,Cl:1.75,Ar:1.88,K:2.75,Ca:2.31,Ni:1.63,Cu:1.4,Zn:1.39,Ga:1.87,Ge:2.11,As:1.85,Se:1.9,Br:1.85,Kr:2.02,Rb:3.03,Sr:2.49,Pd:1.63,Ag:1.72,Cd:1.58,In:1.93,Sn:2.17,Sb:2.06,Te:2.06,I:1.98,Xe:2.16,Cs:3.43,Ba:2.68,Pt:1.75,Au:1.66,Hg:1.55,Tl:1.96,Pb:2.02,Bi:2.07,Po:1.97,At:2.02,Rn:2.2,Fr:3.48,Ra:2.83,U:1.86},p.ignoredKeys=new Set(["props","invert","model","frame","byres","expand","within","and","or","not"])},"./src/GLShape.ts":(K,C,d)=>{d.r(C),d.d(C,{GLShape:()=>b,splitMesh:()=>u});var M=d("./src/WebGL/index.ts"),L=d("./src/WebGL/shapes/index.ts"),w=d("./src/WebGL/math/index.ts"),O=d("./src/colors.ts"),g=d("./src/ProteinSurface4.ts"),_=d("./src/VolumeData.ts"),A=d("./src/GLDraw.ts"),c=d("./src/glcartoon.ts"),y=d("./src/utilities.ts");class b{static finalizeGeo(r){var e=r.updateGeoGroup(0);e.vertices>0&&e.truncateArrayBuffers(!0,!0)}static updateColor(r,e){e=e||O.CC.color(e),r.colorsNeedUpdate=!0;var i,s,a;e.constructor!==Array&&(i=e.r,s=e.g,a=e.b);for(let h in r.geometryGroups){let t=r.geometryGroups[h],n=t.colorArray;for(let f=0,o=t.vertices;f<o;++f){if(e.constructor===Array){let v=e[f];i=v.r,s=v.g,a=v.b}n[f*3]=i,n[f*3+1]=s,n[f*3+2]=a}}}static drawArrow(r,e,i){var s=i.start,a=i.end,h=i.radius,t=i.radiusRatio,n=i.mid,f=i.midpos;if(!(s&&a))return;var o=e.updateGeoGroup(51),v=new w.Vector3(a.x,a.y,a.z).sub(s);if(f){let se=v.length();f>0?n=f/se:n=(se+f)/se}v.multiplyScalar(n);var m=new w.Vector3(s.x,s.y,s.z).add(v),E=v.clone().negate();let S=new w.Vector3(s.x,s.y,s.z);r.intersectionShape.cylinder.push(new L.Cylinder(S,m.clone(),h)),r.intersectionShape.sphere.push(new L.Sphere(S,h));var T=[];T[0]=v.clone(),Math.abs(T[0].x)>1e-4?T[0].y+=1:T[0].x+=1,T[0].cross(v),T[0].normalize(),T[4]=T[0].clone(),T[4].crossVectors(T[0],v),T[4].normalize(),T[8]=T[0].clone().negate(),T[12]=T[4].clone().negate(),T[2]=T[0].clone().add(T[4]).normalize(),T[6]=T[4].clone().add(T[8]).normalize(),T[10]=T[8].clone().add(T[12]).normalize(),T[14]=T[12].clone().add(T[0]).normalize(),T[1]=T[0].clone().add(T[2]).normalize(),T[3]=T[2].clone().add(T[4]).normalize(),T[5]=T[4].clone().add(T[6]).normalize(),T[7]=T[6].clone().add(T[8]).normalize(),T[9]=T[8].clone().add(T[10]).normalize(),T[11]=T[10].clone().add(T[12]).normalize(),T[13]=T[12].clone().add(T[14]).normalize(),T[15]=T[14].clone().add(T[0]).normalize();var P=o.vertices,I=o.vertexArray,B=o.faceArray,R=o.normalArray,z=o.lineArray,U,W,F;for(W=0,F=T.length;W<F;++W){U=3*(P+3*W);var N=T[W].clone().multiplyScalar(h).add(s),q=T[W].clone().multiplyScalar(h).add(m),J=T[W].clone().multiplyScalar(h*t).add(m);if(I[U]=N.x,I[U+1]=N.y,I[U+2]=N.z,I[U+3]=q.x,I[U+4]=q.y,I[U+5]=q.z,I[U+6]=J.x,I[U+7]=J.y,I[U+8]=J.z,W>0){var oe=I[U-3],le=I[U-2],fe=I[U-1],ie=new w.Vector3(oe,le,fe),ne=new w.Vector3(a.x,a.y,a.z),we=m.clone(),Ee=new w.Vector3(J.x,J.y,J.z);r.intersectionShape.triangle.push(new L.Triangle(Ee,ne,ie)),r.intersectionShape.triangle.push(new L.Triangle(ie.clone(),we,Ee.clone()))}}o.vertices+=48,U=o.vertices*3,I[U]=s.x,I[U+1]=s.y,I[U+2]=s.z,I[U+3]=m.x,I[U+4]=m.y,I[U+5]=m.z,I[U+6]=a.x,I[U+7]=a.y,I[U+8]=a.z,o.vertices+=3;var Se,de,ee,me,De,Ie,Fe,Ue,ze,Re,Pe,Oe,Ae,Ne,je,k,Z,Y,ve,re=o.vertices-3,Le=o.vertices-2,Me=o.vertices-1,V=re*3,ae=Le*3,pe=Me*3;for(W=0,F=T.length-1;W<F;++W){var Te=P+3*W;U=Te*3,de=o.faceidx,ee=o.lineidx,me=Te,Re=me*3,De=Te+1,Pe=De*3,Ie=Te+2,Oe=Ie*3,Fe=Te+4,Ae=Fe*3,Ue=Te+5,Ne=Ue*3,ze=Te+3,je=ze*3,k=Z=T[W],Y=ve=T[W+1],R[Re]=k.x,R[Pe]=Z.x,R[je]=ve.x,R[Re+1]=k.y,R[Pe+1]=Z.y,R[je+1]=ve.y,R[Re+2]=k.z,R[Pe+2]=Z.z,R[je+2]=ve.z,R[Pe]=Z.x,R[Ae]=Y.x,R[je]=ve.x,R[Pe+1]=Z.y,R[Ae+1]=Y.y,R[je+1]=ve.y,R[Pe+2]=Z.z,R[Ae+2]=Y.z,R[je+2]=ve.z,R[Oe]=Z.x,R[Ne]=Y.x,R[Oe+1]=Z.y,R[Ne+1]=Y.y,R[Oe+2]=Z.z,R[Ne+2]=Y.z,B[de]=me,B[de+1]=De,B[de+2]=ze,B[de+3]=De,B[de+4]=Fe,B[de+5]=ze,B[de+6]=me,B[de+7]=ze,B[de+8]=re,B[de+9]=Ie,B[de+10]=Le,B[de+11]=Ue,B[de+12]=Ie,B[de+13]=Me,B[de+14]=Ue,z[ee]=me,z[ee+1]=De,z[ee+2]=me,z[ee+3]=ze,z[ee+4]=Fe,z[ee+5]=ze,z[ee+6]=me,z[ee+7]=ze,z[ee+8]=Ie,z[ee+9]=De,z[ee+10]=Ie,z[ee+11]=Ue,z[ee+12]=Fe,z[ee+13]=Ue,z[ee+14]=Ie,z[ee+15]=Me,z[ee+16]=Ie,z[ee+17]=Ue,z[ee+18]=Me,z[ee+19]=Ue,o.faceidx+=15,o.lineidx+=20}Se=[P+45,P+46,P+1,P,P+47,P+2],de=o.faceidx,ee=o.lineidx,me=Se[0],Re=me*3,De=Se[1],Pe=De*3,Ie=Se[4],Oe=Ie*3,Fe=Se[2],Ae=Fe*3,Ue=Se[5],Ne=Ue*3,ze=Se[3],je=ze*3,k=Z=T[15],Y=ve=T[0],R[Re]=k.x,R[Pe]=Z.x,R[je]=ve.x,R[Re+1]=k.y,R[Pe+1]=Z.y,R[je+1]=ve.y,R[Re+2]=k.z,R[Pe+2]=Z.z,R[je+2]=ve.z,R[Pe]=Z.x,R[Ae]=Y.x,R[je]=ve.x,R[Pe+1]=Z.y,R[Ae+1]=Y.y,R[je+1]=ve.y,R[Pe+2]=Z.z,R[Ae+2]=Y.z,R[je+2]=ve.z,R[Oe]=Z.x,R[Ne]=Y.x,R[Oe+1]=Z.y,R[Ne+1]=Y.y,R[Oe+2]=Z.z,R[Ne+2]=Y.z,v.normalize(),E.normalize(),R[V]=E.x,R[ae]=R[pe]=v.x,R[V+1]=E.y,R[ae+1]=R[pe+1]=v.y,R[V+2]=E.z,R[ae+2]=R[pe+2]=v.z,B[de]=me,B[de+1]=De,B[de+2]=ze,B[de+3]=De,B[de+4]=Fe,B[de+5]=ze,B[de+6]=me,B[de+7]=ze,B[de+8]=re,B[de+9]=Ie,B[de+10]=Le,B[de+11]=Ue,B[de+12]=Ie,B[de+13]=Me,B[de+14]=Ue,z[ee]=me,z[ee+1]=De,z[ee+2]=me,z[ee+3]=ze,z[ee+4]=Fe,z[ee+5]=ze,z[ee+6]=me,z[ee+7]=ze,z[ee+8]=Ie,z[ee+9]=De,z[ee+10]=Ie,z[ee+11]=Ue,z[ee+12]=Fe,z[ee+13]=Ue,z[ee+14]=Ie,z[ee+15]=Me,z[ee+16]=Ie,z[ee+17]=Ue,z[ee+18]=Me,z[ee+19]=Ue,o.faceidx+=15,o.lineidx+=20}static updateBoundingFromPoints(r,e,i,s){r.center.set(0,0,0);let a=1/0,h=1/0,t=1/0,n=-1/0,f=-1/0,o=-1/0;r.box&&(a=r.box.min.x,n=r.box.max.x,h=r.box.min.y,f=r.box.max.y,t=r.box.min.z,o=r.box.max.z);for(let S=0,T=s;S<T;S++){var v=i[S*3],m=i[S*3+1],E=i[S*3+2];v<a&&(a=v),m<h&&(h=m),E<t&&(t=E),v>n&&(n=v),m>f&&(f=m),E>o&&(o=E)}r.center.set((n+a)/2,(f+h)/2,(o+t)/2),r.radius=r.center.distanceTo({x:n,y:f,z:o}),r.box={min:{x:a,y:h,z:t},max:{x:n,y:f,z:o}}}static addCustomGeo(r,e,i,s,a){var h=e.addGeoGroup(),t=i.vertexArr,n=i.normalArr,f=i.faceArr;h.vertices=t.length,h.faceidx=f.length;var o,v,m,E,S,T,P,I,B,R=h.vertexArray,z=h.colorArray;for(s.constructor!==Array&&(I=s.r,B=s.g,E=s.b),T=0,P=h.vertices;T<P;++T)o=T*3,v=t[T],R[o]=v.x,R[o+1]=v.y,R[o+2]=v.z,s.constructor===Array&&(S=s[T],I=S.r,B=S.g,E=S.b),z[o]=I,z[o+1]=B,z[o+2]=E;if(a)for(T=0,P=h.faceidx/3;T<P;++T){o=T*3,m=f[o],E=f[o+1],S=f[o+2];var U=new w.Vector3,W=new w.Vector3,F=new w.Vector3;r.intersectionShape.triangle.push(new L.Triangle(U.copy(t[m]),W.copy(t[E]),F.copy(t[S])))}if(a){var N=new w.Vector3(0,0,0),q=0;for(let le=0;le<e.geometryGroups.length;le++)N.add(e.geometryGroups[le].getCentroid()),q++;N.divideScalar(q),b.updateBoundingFromPoints(r.boundingSphere,{centroid:N},R,h.vertices)}if(h.faceArray=new Uint16Array(f),h.truncateArrayBuffers(!0,!0),n.length<h.vertices)h.setNormals();else{var J=h.normalArray=new Float32Array(h.vertices*3),oe;for(T=0,P=h.vertices;T<P;++T)o=T*3,oe=n[T],J[o]=oe.x,J[o+1]=oe.y,J[o+2]=oe.z}h.setLineIndices(),h.lineidx=h.lineArray.length}static updateFromStyle(r,e){typeof e.color<"u"?(r.color=e.color||new O.Color,e.color instanceof O.Color||(r.color=O.CC.color(e.color))):r.color=O.CC.color(0),r.wireframe=!!e.wireframe,r.opacity=e.alpha?(0,w.clamp)(e.alpha,0,1):1,typeof e.opacity<"u"&&(r.opacity=(0,w.clamp)(e.opacity,0,1)),r.side=e.side!==void 0?e.side:M.DoubleSide,r.linewidth=typeof e.linewidth>"u"?1:e.linewidth,r.clickable=!!e.clickable,r.callback=(0,y.makeFunction)(e.callback),r.hoverable=!!e.hoverable,r.hover_callback=(0,y.makeFunction)(e.hover_callback),r.unhover_callback=(0,y.makeFunction)(e.unhover_callback),r.contextMenuEnabled=!!e.contextMenuEnabled,r.hidden=e.hidden,r.frame=e.frame}constructor(r){this.color=16777215,this.hidden=!1,this.wireframe=!1,this.opacity=1,this.linewidth=1,this.clickable=!1,this.hoverable=!1,this.contextMenuEnabled=!1,this.side=M.DoubleSide,this.stylespec=r||{},this.boundingSphere=new L.Sphere,this.intersectionShape={sphere:[],cylinder:[],line:[],triangle:[]},b.updateFromStyle(this,this.stylespec),this.components=[],this.shapeObj=null,this.renderedShapeObj=null,this.geo=new M.Geometry(!0),this.linegeo=new M.Geometry(!0)}updateStyle(r){for(var e in r)this.stylespec[e]=r[e];if(b.updateFromStyle(this,this.stylespec),r.voldata&&r.volscheme){(0,y.adjustVolumeStyle)(r);const i=r.volscheme,s=r.voldata,a=O.CC,h=i.range()||[-1,1];this.geo.setColors(function(t,n,f){let o=s.getVal(t,n,f);return a.color(i.valueToHex(o,h))}),delete this.color}}addCustom(r){r.vertexArr=r.vertexArr||[],r.faceArr=r.faceArr||[],r.normalArr=r.normalArr||[],b.drawCustom(this,this.geo,r)}addSphere(r){r.center||(r.center=new w.Vector3(0,0,0)),r.radius=r.radius?(0,w.clamp)(r.radius,0,1/0):1.5,r.color=O.CC.color(r.color),this.intersectionShape.sphere.push(new L.Sphere(r.center,r.radius)),A.GLDraw.drawSphere(this.geo,r.center,r.radius,r.color,r.quality),this.components.push({centroid:new w.Vector3(r.center.x,r.center.y,r.center.z)});var e=this.geo.updateGeoGroup(0);b.updateBoundingFromPoints(this.boundingSphere,this.components,e.vertexArray,e.vertices)}addBox(r){var e=r.dimensions||{w:1,h:1,d:1},i;typeof e.w=="number"?i={x:e.w,y:0,z:0}:i=e.w;var s;typeof e.h=="number"?s={x:0,y:e.h,z:0}:s=e.h;var a;typeof e.d=="number"?a={x:0,y:0,z:e.d}:a=e.d;var h=r.corner;h==null&&(r.center!==void 0?h={x:r.center.x-.5*(i.x+s.x+a.x),y:r.center.y-.5*(i.y+s.y+a.y),z:r.center.z-.5*(i.z+s.z+a.z)}:h={x:0,y:0,z:0});var t=[{x:h.x,y:h.y,z:h.z},{x:h.x+i.x,y:h.y+i.y,z:h.z+i.z},{x:h.x+s.x,y:h.y+s.y,z:h.z+s.z},{x:h.x+i.x+s.x,y:h.y+i.y+s.y,z:h.z+i.z+s.z},{x:h.x+a.x,y:h.y+a.y,z:h.z+a.z},{x:h.x+i.x+a.x,y:h.y+i.y+a.y,z:h.z+i.z+a.z},{x:h.x+s.x+a.x,y:h.y+s.y+a.y,z:h.z+s.z+a.z},{x:h.x+i.x+s.x+a.x,y:h.y+i.y+s.y+a.y,z:h.z+i.z+s.z+a.z}],n=[],f=[];n.splice(n.length,0,t[0],t[1],t[2],t[3]),f.splice(f.length,0,0,2,1,1,2,3);var o=4;n.splice(n.length,0,t[2],t[3],t[6],t[7]),f.splice(f.length,0,o+0,o+2,o+1,o+1,o+2,o+3),o+=4,n.splice(n.length,0,t[4],t[5],t[0],t[1]),f.splice(f.length,0,o+0,o+2,o+1,o+1,o+2,o+3),o+=4,n.splice(n.length,0,t[6],t[7],t[4],t[5]),f.splice(f.length,0,o+0,o+2,o+1,o+1,o+2,o+3),o+=4,n.splice(n.length,0,t[3],t[1],t[7],t[5]),f.splice(f.length,0,o+0,o+2,o+1,o+1,o+2,o+3),o+=4,n.splice(n.length,0,t[2],t[6],t[0],t[4]),f.splice(f.length,0,o+0,o+2,o+1,o+1,o+2,o+3),o+=4;var v=(0,y.extend)({},r);v.vertexArr=n,v.faceArr=f,v.normalArr=[],b.drawCustom(this,this.geo,v);var m=new w.Vector3;this.components.push({centroid:m.addVectors(t[0],t[7]).multiplyScalar(.5)});var E=this.geo.updateGeoGroup(0);b.updateBoundingFromPoints(this.boundingSphere,this.components,E.vertexArray,E.vertices)}addCylinder(r){var e,i;r.start?e=new w.Vector3(r.start.x||0,r.start.y||0,r.start.z||0):e=new w.Vector3(0,0,0),r.end?(i=new w.Vector3(r.end.x,r.end.y||0,r.end.z||0),typeof i.x>"u"&&(i.x=3)):i=new w.Vector3(0,0,0);var s=r.radius||.1,a=O.CC.color(r.color);this.intersectionShape.cylinder.push(new L.Cylinder(e,i,s)),A.GLDraw.drawCylinder(this.geo,e,i,s,a,r.fromCap,r.toCap);var h=new w.Vector3;this.components.push({centroid:h.addVectors(e,i).multiplyScalar(.5)});var t=this.geo.updateGeoGroup(0);b.updateBoundingFromPoints(this.boundingSphere,this.components,t.vertexArray,t.vertices)}addDashedCylinder(r){r.dashLength=r.dashLength||.25,r.gapLength=r.gapLength||.25;var e;r.start?e=new w.Vector3(r.start.x||0,r.start.y||0,r.start.z||0):e=new w.Vector3(0,0,0);var i;r.end?(i=new w.Vector3(r.end.x,r.end.y||0,r.end.z||0),typeof i.x>"u"&&(i.x=3)):i=new w.Vector3(3,0,0);for(var s=r.radius||.1,a=O.CC.color(r.color),h=Math.sqrt(Math.pow(e.x-i.x,2)+Math.pow(e.y-i.y,2)+Math.pow(e.z-i.z,2)),t=h/(r.gapLength+r.dashLength),n=new w.Vector3(r.start.x||0,r.start.y||0,r.start.z||0),f=new w.Vector3(r.end.x,r.end.y||0,r.end.z||0),o=new w.Vector3((i.x-e.x)/(h/r.gapLength),(i.y-e.y)/(h/r.gapLength),(i.z-e.z)/(h/r.gapLength)),v=new w.Vector3((i.x-e.x)/(h/r.dashLength),(i.y-e.y)/(h/r.dashLength),(i.z-e.z)/(h/r.dashLength)),m=0;m<t;m++)f=new w.Vector3(n.x+v.x,n.y+v.y,n.z+v.z),this.intersectionShape.cylinder.push(new L.Cylinder(n,f,s)),A.GLDraw.drawCylinder(this.geo,n,f,s,a,r.fromCap,r.toCap),n=new w.Vector3(f.x+o.x,f.y+o.y,f.z+o.z);var E=new w.Vector3;this.components.push({centroid:E.addVectors(e,i).multiplyScalar(.5)});var S=this.geo.updateGeoGroup(0);b.updateBoundingFromPoints(this.boundingSphere,this.components,S.vertexArray,S.vertices)}addCurve(r){r.points=r.points||[],r.smooth=r.smooth||10,typeof r.fromCap>"u"&&(r.fromCap=2),typeof r.toCap>"u"&&(r.toCap=2);var e=(0,c.subdivide_spline)(r.points,r.smooth);if(e.length<3){console.log("Too few points in addCurve");return}var i=r.radius||.1,s=O.CC.color(r.color),a=0,h=e.length-1,t=e[0].distanceTo(e[1]),n=Math.ceil(2*i/t);if(r.toArrow){h-=n;let m={start:e[h],end:e[e.length-1],radius:i,color:s,mid:1e-4};this.addArrow(m)}if(r.fromArrow){a+=n;let m={start:e[a],end:e[0],radius:i,color:s,mid:1e-4};this.addArrow(m)}for(var f=Math.ceil(e.length/2),o={radius:i,color:s,fromCap:2,toCap:2},v=a;v<h;v++)o.start=e[v],o.end=e[v+1],o.fromCap=2,o.toCap=2,v<f?(o.fromCap=2,o.toCap=0):v>f?(o.fromCap=0,o.toCap=2):(o.fromCap=2,o.toCap=2),this.addCylinder(o)}addLine(r){var e,i;r.start?e=new w.Vector3(r.start.x||0,r.start.y||0,r.start.z||0):e=new w.Vector3(0,0,0),r.end?(i=new w.Vector3(r.end.x,r.end.y||0,r.end.z||0),typeof i.x>"u"&&(i.x=3)):i=new w.Vector3(3,0,0);var s=this.geo.updateGeoGroup(2),a=s.vertices,h=a*3,t=s.vertexArray;t[h]=e.x,t[h+1]=e.y,t[h+2]=e.z,t[h+3]=i.x,t[h+4]=i.y,t[h+5]=i.z,s.vertices+=2;var n=s.lineArray,f=s.lineidx;n[f]=a,n[f+1]=a+1,s.lineidx+=2;var o=new w.Vector3;this.components.push({centroid:o.addVectors(e,i).multiplyScalar(.5)}),s=this.geo.updateGeoGroup(0),b.updateBoundingFromPoints(this.boundingSphere,this.components,s.vertexArray,s.vertices)}addArrow(r){if(r.start?r.start=new w.Vector3(r.start.x||0,r.start.y||0,r.start.z||0):r.start=new w.Vector3(0,0,0),r.dir instanceof w.Vector3&&typeof r.length=="number"){var e=r.dir.clone().multiplyScalar(r.length).add(r.start);r.end=e}else r.end?(r.end=new w.Vector3(r.end.x,r.end.y||0,r.end.z||0),typeof r.end.x>"u"&&(r.end.x=3)):r.end=new w.Vector3(3,0,0);r.radius=r.radius||.1,r.radiusRatio=r.radiusRatio||1.618034,r.mid=0<r.mid&&r.mid<1?r.mid:.618034,b.drawArrow(this,this.geo,r);var i=new w.Vector3;this.components.push({centroid:i.addVectors(r.start,r.end).multiplyScalar(.5)});var s=this.geo.updateGeoGroup(0);b.updateBoundingFromPoints(this.boundingSphere,this.components,s.vertexArray,s.vertices)}static distance_from(r,e){return Math.sqrt(Math.pow(r.x-e.x,2)+Math.pow(r.y-e.y,2)+Math.pow(r.z-e.z,2))}static inSelectedRegion(r,e,i){for(var s=0;s<e.length;s++)if(b.distance_from(e[s],r)<=i)return!0;return!1}addIsosurface(r,e,i,s){var a=e.isoval!==void 0&&typeof e.isoval=="number"?e.isoval:0,h=!!e.voxel,t=e.smoothness===void 0?1:e.smoothness,n=r.size.x,f=r.size.y,o=r.size.z,v=new Int16Array(n*f*o),m=r.data,E,S;for(E=0,S=v.length;E<S;++E)v[E]=-1;var T=new Uint8Array(n*f*o);for(E=0,S=m.length;E<S;++E){var P=a>=0?m[E]-a:a-m[E];P>0&&(T[E]|=b.ISDONE)}var I=[],B=[];g.MarchingCube.march(T,I,B,{fulltable:!0,voxel:h,unitCube:r.unit,origin:r.origin,matrix:r.matrix,nX:n,nY:f,nZ:o}),!h&&t>0&&g.MarchingCube.laplacianSmooth(t,I,B);var R=[],z=[],U=[];if(e.selectedRegion&&e.coords===void 0&&(e.coords=e.selectedRegion),e.coords===void 0&&e.selection!==void 0&&(s?e.coords=s.selectedAtoms(e.selection):console.log("addIsosurface needs viewer is selection provided.")),e.coords!==void 0){var W=e.coords[0].x,F=e.coords[0].y,N=e.coords[0].z,q=e.coords[0].x,J=e.coords[0].y,oe=e.coords[0].z;for(let ee=0;ee<e.coords.length;ee++)e.coords[ee].x>W?W=e.coords[ee].x:e.coords[ee].x<q&&(q=e.coords[ee].x),e.coords[ee].y>F?F=e.coords[ee].y:e.coords[ee].y<J&&(J=e.coords[ee].y),e.coords[ee].z>N?N=e.coords[ee].z:e.coords[ee].z<oe&&(oe=e.coords[ee].z);var le=2;e.radius!==void 0&&(le=e.radius),e.selectedOffset!==void 0&&(le=e.selectedOffset),e.seldist!==void 0&&(le=e.seldist),q-=le,W+=le,J-=le,F+=le,oe-=le,N+=le;for(let ee=0;ee<I.length;ee++)I[ee].x>q&&I[ee].x<W&&I[ee].y>J&&I[ee].y<F&&I[ee].z>oe&&I[ee].z<N&&b.inSelectedRegion(I[ee],e.coords,le)?(R.push(z.length),z.push(I[ee])):R.push(-1);for(let ee=0;ee+2<B.length;ee+=3)R[B[ee]]!==-1&&R[B[ee+1]]!==-1&&R[B[ee+2]]!==-1&&(U.push(B[ee]-(B[ee]-R[B[ee]])),U.push(B[ee+1]-(B[ee+1]-R[B[ee+1]])),U.push(B[ee+2]-(B[ee+2]-R[B[ee+2]])));I=z,B=U}b.drawCustom(this,this.geo,{vertexArr:I,faceArr:B,normalArr:[],clickable:e.clickable,hoverable:e.hoverable}),this.updateStyle(e);var fe=new w.Vector3(r.origin.x,r.origin.y,r.origin.z),ie=new w.Vector3(r.size.x*r.unit.x,r.size.y*r.unit.y,r.size.z*r.unit.z),ne=new w.Vector3(0,0,0),we=fe.clone(),Ee=fe.clone().add(ie);for(let ee=0;ee<I.length;ee++)ne.add(I[ee]),we.max(I[ee]),Ee.min(I[ee]);ne.divideScalar(I.length);var Se=ne.distanceTo(Ee),de=ne.distanceTo(we);this.boundingSphere.center=ne,this.boundingSphere.radius=Math.max(Se,de),typeof i=="function"&&i()}addVolumetricData(r,e,i){r=new _.VolumeData(r,e),this.addIsosurface(r,i)}finalize(){return b.finalizeGeo(this.geo),this.geo.initTypedArrays(),this.geo}globj(r){if(this.renderedShapeObj&&(r.remove(this.renderedShapeObj),this.renderedShapeObj=null),!this.hidden){b.finalizeGeo(this.geo),this.geo.initTypedArrays(),this.wireframe&&this.geo.setUpWireframe(),typeof this.color<"u"&&b.updateColor(this.geo,this.color),this.shapeObj=new M.Object3D;var e=null;this.side==M.DoubleSide?e=new M.MeshDoubleLambertMaterial({wireframe:this.wireframe,side:this.side,transparent:this.opacity<1,opacity:this.opacity,wireframeLinewidth:this.linewidth,vertexColors:M.Coloring.VertexColors}):e=new M.MeshLambertMaterial({wireframe:this.wireframe,side:this.side,transparent:this.opacity<1,opacity:this.opacity,wireframeLinewidth:this.linewidth,vertexColors:M.Coloring.VertexColors});var i=new M.Mesh(this.geo,e);if(this.shapeObj.add(i),this.linegeo&&this.linegeo.vertices>0){var s=new M.LineBasicMaterial({linewidth:this.linewidth,color:this.color}),a=new M.Line(this.linegeo,s,M.LineStyle.LinePieces);this.shapeObj.add(a)}this.renderedShapeObj=this.shapeObj.clone(),r.add(this.renderedShapeObj)}}removegl(r){this.renderedShapeObj&&(this.renderedShapeObj.geometry!==void 0&&this.renderedShapeObj.geometry.dispose(),this.renderedShapeObj.material!==void 0&&this.renderedShapeObj.material.dispose(),r.remove(this.renderedShapeObj),this.renderedShapeObj=null),this.shapeObj=null}get position(){return this.boundingSphere.center}get x(){return this.boundingSphere.center.x}get y(){return this.boundingSphere.center.y}get z(){return this.boundingSphere.center.z}}b.ISDONE=2,b.drawCustom=function(p,r,e){var i=e,s=i.vertexArr,a=i.faceArr;(s.length===0||a.length===0)&&console.warn("Error adding custom shape component: No vertices and/or face indices supplied!");var h=e.color;typeof h>"u"&&(h=p.color),h=O.CC.color(h);for(var t=u(i),n=0,f=t.length;n<f;n++)b.addCustomGeo(p,r,t[n],t[n].colorArr?t[n].colorArr:h,e.clickable)};function u(p){var r=64e3;if(p.vertexArr.length<r)return[p];var e=[{vertexArr:[],normalArr:[],faceArr:[]}];p.colorArr&&(e.colorArr=[]);var i=[],s=[],a=0,h=p.faceArr;for(let n=0,f=h.length;n<f;n+=3){let o=e[a];for(let v=0;v<3;v++){var t=h[n+v];i[t]!==a&&(i[t]=a,s[t]=o.vertexArr.length,o.vertexArr.push(p.vertexArr[t]),p.normalArr&&p.normalArr[t]&&o.normalArr.push(p.normalArr[t]),p.colorArr&&p.colorArr[t]&&o.colorArr.push(p.colorArr[t])),o.faceArr.push(s[t])}o.vertexArr.length>=r&&(e.push({vertexArr:[],normalArr:[],faceArr:[]}),p.colorArr&&(e.colorArr=[]),a++)}return e}},"./src/GLViewer.ts":(K,C,d)=>{d.r(C),d.d(C,{CONTEXTS_PER_VIEWPORT:()=>r,GLViewer:()=>e,createStereoViewer:()=>a,createViewer:()=>i,createViewerGrid:()=>s});var M=d("./src/WebGL/index.ts"),L=d("./src/WebGL/math/index.ts"),w=d("./src/colors.ts"),O=d("./src/utilities.ts"),g=d("./src/Gradient.ts"),_=d("./src/GLModel.ts"),A=d("./src/Label.ts"),c=d("./src/GLShape.ts"),y=d("./src/VolumeData.ts"),b=d("./src/ProteinSurface4.ts"),u=d("./src/VolumetricRender.ts"),p=d("./node_modules/upng-js/UPNG.js");const r=16;class e{getWidth(){let t=this.container,n=t.offsetWidth;if(n==0&&t.style.display==="none"){let f=t.style.position,o=t.style.visibility;t.style.display="block",t.style.visibility="hidden",t.style.position="absolute",n=t.offsetWidth,t.style.display="none",t.style.visibility=o,t.style.position=f}return n}getHeight(){let t=this.container,n=t.offsetHeight;if(n==0&&t.style.display==="none"){let f=t.style.position,o=t.style.visibility;t.style.display="block",t.style.visibility="hidden",t.style.position="absolute",n=t.offsetHeight,t.style.display="none",t.style.visibility=o,t.style.position=f}return n}setupRenderer(){this.renderer=new M.Renderer({antialias:this.config.antialias,preserveDrawingBuffer:!0,premultipliedAlpha:!1,id:this.config.id,row:this.config.row,col:this.config.col,rows:this.config.rows,cols:this.config.cols,canvas:this.config.canvas,containerWidth:this.WIDTH,containerHeight:this.HEIGHT,ambientOcclusion:this.config.ambientOcclusion,outline:this.config.outline}),this.renderer.domElement.style.width="100%",this.renderer.domElement.style.height="100%",this.renderer.domElement.style.padding="0",this.renderer.domElement.style.position="absolute",this.renderer.domElement.style.top="0px",this.renderer.domElement.style.left="0px",this.renderer.domElement.style.zIndex="0"}initializeScene(){this.scene=new M.Scene,this.scene.fog=new M.Fog(this.bgColor,100,200),this.modelGroup=new M.Object3D,this.rotationGroup=new M.Object3D,this.rotationGroup.useQuaternion=!0,this.rotationGroup.quaternion=new L.Quaternion(0,0,0,1),this.rotationGroup.add(this.modelGroup),this.scene.add(this.rotationGroup);var t=new M.Light(16777215);t.position=new L.Vector3(.2,.2,1).normalize(),t.intensity=1,this.scene.add(t)}_handleLostContext(t){const n=function(f){const o=f.getBoundingClientRect();return!(o.right<0||o.bottom<0||o.top>(window.innerHeight||document.documentElement.clientHeight)||o.left>(window.innerWidth||document.documentElement.clientWidth))};if(n(this.container)){let f=0;for(let o of document.getElementsByTagName("canvas"))if(n(o)&&o._3dmol_viewer!=null&&(o._3dmol_viewer.resize(),f+=1,f>=r))break}}initContainer(t){this.container=t,this.WIDTH=this.getWidth(),this.HEIGHT=this.getHeight(),this.ASPECT=this.renderer.getAspect(this.WIDTH,this.HEIGHT),this.renderer.setSize(this.WIDTH,this.HEIGHT),this.container.append(this.renderer.domElement),this.glDOM=this.renderer.domElement,this.glDOM._3dmol_viewer=this,this.glDOM.addEventListener("webglcontextlost",this._handleLostContext.bind(this)),this.nomouse||(this.glDOM.addEventListener("mousedown",this._handleMouseDown.bind(this),{passive:!1}),this.glDOM.addEventListener("touchstart",this._handleMouseDown.bind(this),{passive:!1}),this.glDOM.addEventListener("wheel",this._handleMouseScroll.bind(this),{passive:!1}),this.glDOM.addEventListener("mousemove",this._handleMouseMove.bind(this),{passive:!1}),this.glDOM.addEventListener("touchmove",this._handleMouseMove.bind(this),{passive:!1}),this.glDOM.addEventListener("contextmenu",this._handleContextMenu.bind(this),{passive:!1}))}decAnim(){this.animated--,this.animated<0&&(this.animated=0)}incAnim(){this.animated++}nextSurfID(){var t=0;for(let f in this.surfaces)if(this.surfaces.hasOwnProperty(f)){var n=parseInt(f);isNaN(n)||n>t&&(t=n)}return t+1}setSlabAndFog(){let t=this.camera.position.z-this.rotationGroup.position.z;t<1&&(t=1),this.camera.near=t+this.slabNear,!this.camera.ortho&&this.camera.near<1&&(this.camera.near=1),this.camera.far=t+this.slabFar,this.camera.near+1>this.camera.far&&(this.camera.far=this.camera.near+1),this.camera.fov=this.fov,this.camera.right=t*Math.tan(Math.PI/180*this.fov),this.camera.left=-this.camera.right,this.camera.top=this.camera.right/this.ASPECT,this.camera.bottom=-this.camera.top,this.camera.updateProjectionMatrix(),this.scene.fog.near=this.camera.near+this.fogStart*(this.camera.far-this.camera.near),this.scene.fog.far=this.camera.far,this.config.disableFog&&(this.scene.fog.near=this.scene.fog.far)}show(t){if(this.renderer.setViewport(),!!this.scene&&(this.setSlabAndFog(),this.renderer.render(this.scene,this.camera),this.viewChangeCallback&&this.viewChangeCallback(this._viewer.getView()),!t&&this.linkedViewers.length>0))for(var n=this._viewer.getView(),f=0;f<this.linkedViewers.length;f++){var o=this.linkedViewers[f];o.setView(n,!0)}}updateClickables(){this.clickables.splice(0,this.clickables.length),this.hoverables.splice(0,this.hoverables.length),this.contextMenuEnabledObjects.splice(0,this.contextMenuEnabledObjects.length);for(let t=0,n=this.models.length;t<n;t++){let f=this.models[t];if(f){let o=f.selectedAtoms({clickable:!0}),v=f.selectedAtoms({hoverable:!0}),m=f.selectedAtoms({contextMenuEnabled:!0});for(let E=0;E<v.length;E++)this.hoverables.push(v[E]);for(let E=0;E<o.length;E++)this.clickables.push(o[E]);for(let E=0;E<m.length;E++)this.contextMenuEnabledObjects.push(m[E])}}for(let t=0,n=this.shapes.length;t<n;t++){let f=this.shapes[t];f&&f.clickable&&this.clickables.push(f),f&&f.hoverable&&this.hoverables.push(f),f&&f.contextMenuEnabled&&this.contextMenuEnabledObjects.push(f)}}handleClickSelection(t,n,f){let o=this.targetedObjects(t,n,this.clickables);if(o.length){var v=o[0].clickable;v.callback!==void 0&&(typeof v.callback!="function"&&(v.callback=(0,O.makeFunction)(v.callback)),typeof v.callback=="function"&&(this.mouseButton===3&&this.contextMenuEnabledObjects.includes(v)&&this.userContextMenuHandler||v.callback(v,this._viewer,f,this.container,o)))}}canvasOffset(){let t=this.glDOM,n=t.getBoundingClientRect(),f=t.ownerDocument,o=f.documentElement,v=f.defaultView;return{top:n.top+v.pageYOffset-o.clientTop,left:n.left+v.pageXOffset-o.clientLeft}}setHover(t,n,f){this.current_hover!=t&&(this.current_hover&&(typeof this.current_hover.unhover_callback!="function"&&(this.current_hover.unhover_callback=(0,O.makeFunction)(this.current_hover.unhover_callback)),this.current_hover.unhover_callback(this.current_hover,this._viewer,n,this.container,f)),this.current_hover=t,t&&t.hover_callback!==void 0&&(typeof t.hover_callback!="function"&&(t.hover_callback=(0,O.makeFunction)(t.hover_callback)),typeof t.hover_callback=="function"&&t.hover_callback(t,this._viewer,n,this.container,f)))}handleHoverSelection(t,n,f){if(this.hoverables.length==0)return;let o=this.targetedObjects(t,n,this.hoverables);if(o.length){var v=o[0].clickable;this.setHover(v,f,o),this.current_hover=v}else this.setHover(null)}handleHoverContinue(t,n){let f=this.targetedObjects(t,n,this.hoverables);(f.length==0||f[0]===void 0)&&this.setHover(null),f[0]!==void 0&&f[0].clickable!==this.current_hover&&this.setHover(null)}closeEnoughForClick(t,{allowTolerance:n=t.targetTouches,tolerance:f=5}={}){const o=this.getX(t),v=this.getY(t);if(n){const m=Math.abs(o-this.mouseStartX),E=Math.abs(v-this.mouseStartY);return m<=f&&E<=f}else return o===this.mouseStartX&&v===this.mouseStartY}calcTouchDistance(t){var n=t.targetTouches[0].pageX-t.targetTouches[1].pageX,f=t.targetTouches[0].pageY-t.targetTouches[1].pageY;return Math.hypot(n,f)}getX(t){var n=t.pageX;return n==null&&(n=t.pageX),t.targetTouches&&t.targetTouches[0]?n=t.targetTouches[0].pageX:t.changedTouches&&t.changedTouches[0]&&(n=t.changedTouches[0].pageX),n}getY(t){var n=t.pageY;return n==null&&(n=t.pageY),t.targetTouches&&t.targetTouches[0]?n=t.targetTouches[0].pageY:t.changedTouches&&t.changedTouches[0]&&(n=t.changedTouches[0].pageY),n}isInViewer(t,n){if(this.viewers!=null){var f=this.WIDTH/this.cols,o=this.HEIGHT/this.rows,v=this.canvasOffset(),m=t-v.left,E=n-v.top,S=this.rows-Math.floor(E/o)-1,T=Math.floor(m/f);if(S!=this.row||T!=this.col)return!1}return!0}adjustZoomToLimits(t){if(this.config.lowerZoomLimit&&this.config.lowerZoomLimit>0){let n=this.CAMERA_Z-this.config.lowerZoomLimit;t>n&&(t=n)}if(this.config.upperZoomLimit&&this.config.upperZoomLimit>0){let n=this.CAMERA_Z-this.config.upperZoomLimit;t<n&&(t=n)}return t>this.CAMERA_Z-1&&(t=this.CAMERA_Z-1),t}static slerp(t,n,f){if(f==1)return n.clone();if(f==0)return t.clone();let o=t.x*n.x+t.y*n.y+t.z*n.z+t.w*n.w;if(o>.9995){let I=new L.Quaternion(t.x+f*(n.x-t.x),t.y+f*(n.y-t.y),t.z+f*(n.z-t.z),t.w+f*(n.w-t.w));return I.normalize(),I}o<0&&(n=n.clone().multiplyScalar(-1),o=-o),o>1?o=1:o<-1&&(o=-1);var v=Math.acos(o),m=v*f,E=n.clone();E.sub(t.clone().multiplyScalar(o)),E.normalize();var S=Math.cos(m),T=Math.sin(m),P=new L.Quaternion(t.x*S+E.x*T,t.y*S+E.y*T,t.z*S+E.z*T,t.w*S+E.w*T);return P.normalize(),P}constructor(t,n={}){if(this.nomouse=!1,this.glDOM=null,this.models=[],this.surfaces={},this.shapes=[],this.labels=[],this.clickables=[],this.hoverables=[],this.contextMenuEnabledObjects=[],this.current_hover=null,this.hoverDuration=500,this.longTouchDuration=1e3,this.viewer_frame=0,this.viewChangeCallback=null,this.stateChangeCallback=null,this.NEAR=1,this.FAR=800,this.CAMERA_Z=150,this.fov=20,this.linkedViewers=[],this.renderer=null,this.control_all=!1,this.scene=null,this.rotationGroup=null,this.modelGroup=null,this.fogStart=.4,this.slabNear=-50,this.slabFar=50,this.cq=new L.Quaternion(0,0,0,1),this.dq=new L.Quaternion(0,0,0,1),this.animated=0,this.animationTimers=new Set,this.isDragging=!1,this.mouseStartX=0,this.mouseStartY=0,this.touchDistanceStart=0,this.touchHold=!1,this.currentModelPos=0,this.cz=0,this.cslabNear=0,this.cslabFar=0,this.userContextMenuHandler=null,this.config=n,this.callback=this.config.callback,this.defaultcolors=this.config.defaultcolors,this.defaultcolors||(this.defaultcolors=w.elementColors.defaultColors),this.nomouse=!!this.config.nomouse,this.bgColor=0,this.config.backgroundColor=this.config.backgroundColor||"#ffffff",typeof this.config.backgroundColor<"u"&&(this.bgColor=w.CC.color(this.config.backgroundColor).getHex()),this.config.backgroundAlpha=this.config.backgroundAlpha==null?1:this.config.backgroundAlpha,this.camerax=0,typeof this.config.camerax<"u"&&(this.camerax=typeof this.config.camerax=="string"?parseFloat(this.config.camerax):this.config.camerax),this._viewer=this,this.container=t,this.config.hoverDuration!=null&&(this.hoverDuration=this.config.hoverDuration),this.config.antialias===void 0&&(this.config.antialias=!0),this.config.cartoonQuality===void 0&&(this.config.cartoonQuality=10),this.WIDTH=this.getWidth(),this.HEIGHT=this.getHeight(),this.setupRenderer(),this.row=this.config.row==null?0:this.config.row,this.col=this.config.col==null?0:this.config.col,this.cols=this.config.cols,this.rows=this.config.rows,this.viewers=this.config.viewers,this.control_all=this.config.control_all,this.ASPECT=this.renderer.getAspect(this.WIDTH,this.HEIGHT),this.camera=new M.Camera(this.fov,this.ASPECT,this.NEAR,this.FAR,this.config.orthographic),this.camera.position=new L.Vector3(this.camerax,0,this.CAMERA_Z),this.lookingAt=new L.Vector3,this.camera.lookAt(this.lookingAt),this.raycaster=new M.Raycaster(new L.Vector3(0,0,0),new L.Vector3(0,0,0)),this.projector=new M.Projector,this.initializeScene(),this.renderer.setClearColorHex(this.bgColor,this.config.backgroundAlpha),this.scene.fog.color=w.CC.color(this.bgColor),document.body.addEventListener("mouseup",this._handleMouseUp.bind(this)),document.body.addEventListener("touchend",this._handleMouseUp.bind(this)),this.initContainer(this.container),this.config.style&&this.setViewStyle(this.config),window.addEventListener("resize",this.resize.bind(this)),typeof window.ResizeObserver<"u"&&(this.divwatcher=new window.ResizeObserver(this.resize.bind(this)),this.divwatcher.observe(this.container)),typeof window.IntersectionObserver<"u"){let f=(o,v)=>{o.forEach(m=>{m.isIntersecting&&this.resize()})};this.intwatcher=new window.IntersectionObserver(f),this.intwatcher.observe(this.container)}try{typeof this.callback=="function"&&this.callback(this)}catch(f){console.log("error with glviewer callback: "+f)}}targetedObjects(t,n,f){var o={x:t,y:n,z:-1};return Array.isArray(f)||(f=this.selectedAtoms(f)),f.length==0?[]:(this.raycaster.setFromCamera(o,this.camera),this.raycaster.intersectObjects(this.modelGroup,f))}modelToScreen(t){let n=!1;Array.isArray(t)||(t=[t],n=!0);let f=this.renderer.getXRatio(),o=this.renderer.getYRatio(),v=this.col,m=this.row,E=v*(this.WIDTH/f),S=(o-m-1)*(this.HEIGHT/o),T=[],P=this.canvasOffset();return t.forEach(I=>{let B=new L.Vector3(I.x,I.y,I.z);B.applyMatrix4(this.modelGroup.matrixWorld),this.projector.projectVector(B,this.camera);let R=this.WIDTH/f*(B.x+1)/2+P.left+E,z=-(this.HEIGHT/o)*(B.y-1)/2+P.top+S;T.push({x:R,y:z})}),n&&(T=T[0]),T}screenOffsetToModel(t,n,f){var o=t/this.WIDTH,v=n/this.HEIGHT,m=f===void 0?this.rotationGroup.position.z:f,E=this.rotationGroup.quaternion,S=new L.Vector3(0,0,m);return this.projector.projectVector(S,this.camera),S.x+=o*2,S.y-=v*2,this.projector.unprojectVector(S,this.camera),S.z=0,S.applyQuaternion(E),S}screenToModelDistance(t,n){let f=this.canvasOffset(),o=new L.Vector3(n.x,n.y,n.z);o.applyMatrix4(this.modelGroup.matrixWorld);let v=o.clone();this.projector.projectVector(o,this.camera);let m=new L.Vector3((t.x-f.left)*2/this.WIDTH-1,(t.y-f.top)*2/-this.HEIGHT+1,o.z);return this.projector.unprojectVector(m,this.camera),m.distanceTo(v)}setViewChangeCallback(t){(typeof t=="function"||t==null)&&(this.viewChangeCallback=t)}setStateChangeCallback(t){(typeof t=="function"||t==null)&&(this.stateChangeCallback=t)}getConfig(){return this.config}setConfig(t){this.config=t,t.ambientOcclusion&&this.renderer.enableAmbientOcclusion(t.ambientOcclusion)}getInternalState(){var t={models:[],surfaces:[],shapes:[],labels:[]};for(let n=0;n<this.models.length;n++)this.models[n]&&(t.models[n]=this.models[n].getInternalState());return t}setInternalState(t){this.clear();var n=t.models;for(let f=0;f<n.length;f++)n[f]&&(this.models[f]=new _.GLModel(f),this.models[f].setInternalState(n[f]));this.render()}setZoomLimits(t,n){typeof t<"u"&&(this.config.lowerZoomLimit=t),n&&(this.config.upperZoomLimit=n),this.rotationGroup.position.z=this.adjustZoomToLimits(this.rotationGroup.position.z),this.show()}setCameraParameters(t){t.fov!==void 0&&(this.fov=t.fov,this.camera.fov=this.fov),t.z!==void 0&&(this.CAMERA_Z=t.z,this.camera.z=this.CAMERA_Z),t.orthographic!==void 0&&(this.camera.ortho=t.orthographic),this.setSlabAndFog()}_handleMouseDown(t){if(t.preventDefault(),!this.scene)return;var n=this.getX(t),f=this.getY(t);if(n===void 0)return;this.isDragging=!0,this.mouseButton=t.which,this.mouseStartX=n,this.mouseStartY=f,this.touchHold=!0,this.touchDistanceStart=0,t.targetTouches&&t.targetTouches.length==2&&(this.touchDistanceStart=this.calcTouchDistance(t)),this.cq=this.rotationGroup.quaternion.clone(),this.cz=this.rotationGroup.position.z,this.currentModelPos=this.modelGroup.position.clone(),this.cslabNear=this.slabNear,this.cslabFar=this.slabFar;let o=this;t.targetTouches&&t.targetTouches.length===1&&(this.longTouchTimeout=setTimeout(function(){if(o.touchHold==!0){o.glDOM=o.renderer.domElement;const v=t.targetTouches[0],m=new PointerEvent("contextmenu",Object.assign(Object.assign({},t),{pageX:v.pageX,pageY:v.pageY,screenX:v.screenX,screenY:v.screenY,clientX:v.clientX,clientY:v.clientY}));o.glDOM.dispatchEvent(m)}},this.longTouchDuration))}_handleMouseUp(t){if(this.touchHold=!1,this.isDragging&&this.scene){var n=this.getX(t),f=this.getY(t);if(this.closeEnoughForClick(t)&&this.isInViewer(n,f)){let o=this.mouseXY(n,f);this.handleClickSelection(o.x,o.y,t)}}this.isDragging=!1}_handleMouseScroll(t){if(t.preventDefault(),!!this.scene){var n=this.getX(t),f=this.getY(t);if(n!==void 0&&!(!this.control_all&&!this.isInViewer(n,f))){var o=(this.CAMERA_Z-this.rotationGroup.position.z)*.85,v=1;if(t.ctrlKey&&(v=-1),t.detail)this.rotationGroup.position.z+=v*o*t.detail/10;else if(t.wheelDelta){let m=t.wheelDelta*600/(t.wheelDelta+600);this.rotationGroup.position.z-=v*o*m/400}this.rotationGroup.position.z=this.adjustZoomToLimits(this.rotationGroup.position.z),this.show()}}}pngURI(){return this.getCanvas().toDataURL("image/png")}apngURI(t){let n=this;return t=t||1,new Promise(function(f){let o=0,v=n.viewChangeCallback,m=[],E=[],S=Date.now();n.viewChangeCallback=function(){E.push(Date.now()-S),S=Date.now(),m.push(new Promise(T=>{n.getCanvas().toBlob(function(P){P.arrayBuffer().then(T)},"image/png")})),o+=1,o==t&&(n.viewChangeCallback=v,Promise.all(m).then(T=>{let P=[];for(let W=0;W<T.length;W++){let F=(0,p.decode)(T[W]);P.push((0,p.toRGBA8)(F)[0])}let I=n.getCanvas().width,B=n.getCanvas().height,R=(0,p.encode)(P,I,B,0,E),z=new Blob([R],{type:"image/png"}),U=new FileReader;U.onload=function(W){f(W.target.result)},U.readAsDataURL(z)}))}})}getCanvas(){return this.glDOM}getRenderer(){return this.renderer}setHoverDuration(t){this.hoverDuration=t}mouseXY(t,n){let f=this.canvasOffset(),o=this.renderer.getXRatio(),v=this.renderer.getYRatio(),m=this.col,E=this.row,S=m*(this.WIDTH/o),T=(v-E-1)*(this.HEIGHT/v),P=(t-f.left-S)/(this.WIDTH/o)*2-1,I=-((n-f.top-T)/(this.HEIGHT/v))*2+1;return{x:P,y:I}}_handleMouseMove(t){clearTimeout(this.hoverTimeout),t.preventDefault();let n=this.getX(t),f=this.getY(t);if(n===void 0)return;let o=this.renderer.getXRatio(),v=this.renderer.getYRatio(),m=this.mouseXY(n,f),E=this;this.current_hover!==null&&this.handleHoverContinue(m.x,m.y);var S=0;if(!(!this.control_all&&!this.isInViewer(n,f))&&this.scene&&(this.hoverables.length>0&&(this.hoverTimeout=setTimeout(function(){E.handleHoverSelection(m.x,m.y,t)},this.hoverDuration)),!!this.isDragging)){t.targetTouches&&(t.targetTouches.length>1||t.targetTouches.length===1&&!this.closeEnoughForClick(t))&&clearTimeout(this.longTouchTimeout);var T=(n-this.mouseStartX)/this.WIDTH,P=(f-this.mouseStartY)/this.HEIGHT;if(this.touchDistanceStart!=0&&t.targetTouches&&t.targetTouches.length==2){var I=this.calcTouchDistance(t);S=2,P=(I-this.touchDistanceStart)*2/(this.WIDTH+this.HEIGHT)}else t.targetTouches&&t.targetTouches.length==3&&(S=1);T*=o,P*=v;var B=Math.hypot(T,P),R;if(S==3||this.mouseButton==3&&t.ctrlKey)this.slabNear=this.cslabNear+T*100,this.slabFar=this.cslabFar-P*100;else if(S==2||this.mouseButton==3||t.shiftKey)R=(this.CAMERA_Z-this.rotationGroup.position.z)*.85,R<80&&(R=80),this.rotationGroup.position.z=this.cz+P*R,this.rotationGroup.position.z=this.adjustZoomToLimits(this.rotationGroup.position.z);else if(S==1||this.mouseButton==2||t.ctrlKey){var z=this.screenOffsetToModel(o*(n-this.mouseStartX),v*(f-this.mouseStartY));this.modelGroup.position.addVectors(this.currentModelPos,z)}else if((S===0||this.mouseButton==1)&&B!==0){var U=Math.sin(B*Math.PI)/B;this.dq.x=Math.cos(B*Math.PI),this.dq.y=0,this.dq.z=U*T,this.dq.w=-U*P,this.rotationGroup.quaternion.set(1,0,0,0),this.rotationGroup.quaternion.multiply(this.dq),this.rotationGroup.quaternion.multiply(this.cq)}this.show()}}_handleContextMenu(t){if(t.preventDefault(),this.closeEnoughForClick(t)){var o=this.mouseStartX,v=this.mouseStartY,f=this.canvasOffset();let m=this.mouseXY(o,v),E=m.x,S=m.y,T=this.targetedObjects(E,S,this.contextMenuEnabledObjects);var n=null;T.length&&(n=T[0].clickable);var f=this.canvasOffset(),o=this.mouseStartX-f.left,v=this.mouseStartY-f.top;this.userContextMenuHandler&&(this.userContextMenuHandler(n,o,v,T,t),this.isDragging=!1)}}setContainer(t){let n=(0,O.getElement)(t)||this.container;return this.initContainer(n),this}setBackgroundColor(t,n){(typeof n>"u"||n<0||n>1)&&(n=1);var f=w.CC.color(t);return this.scene.fog.color=f,this.bgColor=f.getHex(),this.renderer.setClearColorHex(f.getHex(),n),this.show(),this}setProjection(t){this.camera.ortho=t==="orthographic",this.setSlabAndFog()}setViewStyle(t){if(t=t||{},t.style=t.style||"",t.style.includes("outline")?this.renderer.enableOutline(t):this.renderer.disableOutline(),t.style.includes("ambientOcclusion")){var n={};t.strength&&(n.strength=t.strength),t.radius&&(n.radius=t.radius),this.renderer.enableAmbientOcclusion(n)}else this.renderer.disableAmbientOcclusion();return this}updateSize(){this.renderer.setSize(this.WIDTH,this.HEIGHT),this.ASPECT=this.renderer.getAspect(this.WIDTH,this.HEIGHT),this.renderer.setSize(this.WIDTH,this.HEIGHT),this.camera.aspect=this.ASPECT,this.camera.updateProjectionMatrix()}setWidth(t){return this.WIDTH=t||this.WIDTH,this.updateSize(),this}setHeight(t){return this.HEIGHT=t||this.HEIGHT,this.updateSize(),this}resize(){this.WIDTH=this.getWidth(),this.HEIGHT=this.getHeight();let t=!1;if(this.renderer.isLost()&&this.WIDTH>0&&this.HEIGHT>0){let n=!1,f=this.container.querySelector("canvas");f&&f!=this.renderer.getCanvas()?this.config.canvas=f:(f.remove(),this.config&&this.config.canvas!=null&&(delete this.config.canvas,n=!0)),this.setupRenderer(),this.initContainer(this.container),this.renderer.setClearColorHex(this.bgColor,this.config.backgroundAlpha),t=!0,n&&(this.config.canvas=this.renderer.getCanvas())}if(this.WIDTH==0||this.HEIGHT==0?this.animated&&this._viewer.pauseAnimate():this.animated&&this._viewer.resumeAnimate(),this.updateSize(),t){let n=this.renderer.supportedExtensions();if(n.regen=!0,this.viewers)for(let f=0,o=this.viewers.length;f<o;f++)for(let v=0,m=this.viewers[f].length;v<m;v++)this.viewers[f][v].render(null,n);this._viewer.render(null,n)}else this.show();return this}getModel(t){return t===void 0?this.models.length==0?null:this.models[this.models.length-1]:t instanceof _.GLModel?t:t in this.models?this.models[t]:this.models.length==0?null:this.models[this.models.length-1]}spin(t,n=1,f=!1){if(clearInterval(this.spinInterval),typeof t>"u"&&(t="y"),typeof t=="boolean")if(t)t="y";else return;Array.isArray(t)&&(t={x:t[0],y:t[1],z:t[2]});var o=this;this.spinInterval=setInterval(function(){!o.getCanvas().isConnected&&o.renderer.isLost()&&clearInterval(o.spinInterval),(!f||o.container.checkVisibility&&o.container.checkVisibility())&&o.rotate(1*n,t)},25)}animateMotion(t,n,f,o,v,m){var E=20,S=Math.ceil(t/E);S<1&&(S=1),this.incAnim();var T={mpos:this.modelGroup.position.clone(),rz:this.rotationGroup.position.z,rot:this.rotationGroup.quaternion.clone(),cam:this.lookingAt.clone()};if(n){let B=new Array(S);for(let W=0;W<S;W++){let F=(W+1)/S,N={mpos:T.mpos,rz:T.rz,rot:T.rot};N.mpos=f.clone().sub(T.mpos).multiplyScalar(F).add(T.mpos),N.rz=T.rz+F*(o-T.rz),N.rot=e.slerp(T.rot,v,F),N.cam=m.clone().sub(T.cam).multiplyScalar(F).add(T.cam),B[W]=N}let R=0,z=this,U=function(){var W=B[R];R+=1,z.modelGroup.position=W.mpos,z.rotationGroup.position.z=W.rz,z.rotationGroup.quaternion=W.rot,z.camera.lookAt(W.cam),R<B.length?setTimeout(U,E):z.decAnim(),z.show()};setTimeout(U,E)}else{var P={};let B=1/S;if(f&&(P.mpos=f.clone().sub(T.mpos).multiplyScalar(B)),typeof o<"u"&&o!=null&&(P.rz=B*(o-T.rz)),v){var I=e.slerp(T.rot,v,B);P.rot=T.rot.clone().inverse().multiply(I)}m&&(P.cam=m.clone().sub(T.cam).multiplyScalar(B));let R=0,z=this,U=function(){R+=1,P.mpos&&z.modelGroup.position.add(P.mpos),P.rz&&(z.rotationGroup.position.z+=P.rz),P.rot&&z.rotationGroup.quaternion.multiply(P.rot),P.cam&&(z.lookingAt.add(P.cam),z.camera.lookAt(z.lookingAt)),R<S?setTimeout(U,E):z.decAnim(),z.show()};setTimeout(U,E)}}rotate(t,n="y",f=0,o=!1){if(n=="x"?n={x:1,y:0,z:0}:n=="y"?n={x:0,y:1,z:0}:n=="z"&&(n={x:0,y:0,z:1}),n=="vx"?n={vx:1,vy:0,vz:0}:n=="vy"?n={vx:0,vy:1,vz:0}:n=="vz"&&(n={vx:0,vy:0,vz:1}),typeof n.vx<"u"){var v=new L.Vector3(n.vx,n.vy,n.vz);v.applyQuaternion(this.rotationGroup.quaternion),n={x:v.x,y:v.y,z:v.z}}var m=function(P){var I=Math.sin(P/2),B=Math.cos(P/2),R=0,z=0,U=0;return R=n.x*I,z=n.y*I,U=n.z*I,new L.Quaternion(R,z,U,B).normalize()},E=Math.PI*t/180,S=m(E);if(f){var T=new L.Quaternion().copy(this.rotationGroup.quaternion).multiply(S);this.animateMotion(f,o,this.modelGroup.position,this.rotationGroup.position.z,T,this.lookingAt)}else this.rotationGroup.quaternion.multiply(S),this.show();return this}surfacesFinished(){for(var t in this.surfaces)if(!this.surfaces[t][0].done)return!1;return!0}getView(){if(!this.modelGroup)return[0,0,0,0,0,0,0,1];var t=this.modelGroup.position,n=this.rotationGroup.quaternion;return[t.x,t.y,t.z,this.rotationGroup.position.z,n.x,n.y,n.z,n.w]}setView(t,n){return t===void 0||!(t instanceof Array||t.length!==8)?this:!this.modelGroup||!this.rotationGroup?this:(this.modelGroup.position.x=t[0],this.modelGroup.position.y=t[1],this.modelGroup.position.z=t[2],this.rotationGroup.position.z=t[3],this.rotationGroup.quaternion.x=t[4],this.rotationGroup.quaternion.y=t[5],this.rotationGroup.quaternion.z=t[6],this.rotationGroup.quaternion.w=t[7],typeof t[8]<"u"&&(this.rotationGroup.position.x=t[8],this.rotationGroup.position.y=t[9]),this.show(n),this)}render(t,n){this.renderer.setViewport(),this.updateClickables();var f=this.getView();this.stateChangeCallback&&this.stateChangeCallback(this.getInternalState());var o,v;for(n||(n=this.renderer.supportedExtensions()),o=0;o<this.models.length;o++)this.models[o]&&this.models[o].globj(this.modelGroup,n);for(o=0;o<this.shapes.length;o++)this.shapes[o]&&(typeof this.shapes[o].frame>"u"||this.viewer_frame<0||this.shapes[o].frame<0||this.shapes[o].frame==this.viewer_frame?this.shapes[o].globj(this.modelGroup,n):this.shapes[o].removegl(this.modelGroup));for(o=0;o<this.labels.length;o++)n.regen&&(this.labels[o].dispose(),this.modelGroup.remove(this.labels[o].sprite),this.labels[o].setContext(),this.modelGroup.add(this.labels[o].sprite)),this.labels[o]&&typeof this.labels[o].frame<"u"&&this.labels[o].frame>=0&&(this.modelGroup.remove(this.labels[o].sprite),(this.viewer_frame<0||this.labels[o].frame==this.viewer_frame)&&this.modelGroup.add(this.labels[o].sprite));for(o in this.surfaces)if(this.surfaces.hasOwnProperty(o)){var m=this.surfaces[o];for(v=0;v<m.length;v++)if(m.hasOwnProperty(v)){var E=m[v].geo;if(!m[v].finished||n.regen){E.verticesNeedUpdate=!0,E.elementsNeedUpdate=!0,E.normalsNeedUpdate=!0,E.colorsNeedUpdate=!0,E.buffersNeedUpdate=!0,m[v].mat.needsUpdate=!0,m[v].done&&(m[v].finished=!0),m[v].lastGL&&this.modelGroup.remove(m[v].lastGL);var S=null;if(m[v].mat instanceof M.LineBasicMaterial?S=new M.Line(E,m[v].mat):S=new M.Mesh(E,m[v].mat),m[v].mat.transparent&&m[v].mat.opacity==0?S.visible=!1:S.visible=!0,m[v].symmetries.length>1||m[v].symmetries.length==1&&!m[v].symmetries[v].isIdentity()){var T,P=new M.Object3D;for(T=0;T<m[v].symmetries.length;T++){var I=S.clone();I.matrix=m[v].symmetries[T],I.matrixAutoUpdate=!1,P.add(I)}m[v].lastGL=P,this.modelGroup.add(P)}else m[v].lastGL=S,this.modelGroup.add(S)}}}return this.setView(f),typeof t=="function"&&t(this),this}getModelList(t){let n=[];if(typeof t>"u"||typeof t.model>"u")for(let o=0;o<this.models.length;o++)this.models[o]&&n.push(this.models[o]);else{let o=t.model;Array.isArray(o)||(o=[o]);for(let v=0;v<o.length;v++)if(typeof o[v]=="number"){var f=o[v];f<0&&(f+=this.models.length),n.push(this.models[f])}else n.push(o[v])}return n}getAtomsFromSel(t){var n=[];typeof t>"u"&&(t={});var f=this.getModelList(t);for(let o=0;o<f.length;o++)n=n.concat(f[o].selectedAtoms(t));return n}atomIsSelected(t,n){typeof n>"u"&&(n={});for(var f=this.getModelList(n),o=0;o<f.length;o++)if(f[o].atomIsSelected(t,n))return!0;return!1}selectedAtoms(t){return this.getAtomsFromSel(t)}getUniqueValues(t,n){typeof n>"u"&&(n={});var f=this.getAtomsFromSel(n),o={};for(var v in f)if(f[v].hasOwnProperty(t)){var m=f[v][t];o[m]=!0}return Object.keys(o)}pdbData(t){for(var n=this.getAtomsFromSel(t),f="",o=0,v=n.length;o<v;++o)f+=n[o].pdbline+`
`;return f}zoom(t=2,n=0,f=!1){var o=(this.CAMERA_Z-this.rotationGroup.position.z)/t,v=this.CAMERA_Z-o;return n>0?this.animateMotion(n,f,this.modelGroup.position,this.adjustZoomToLimits(v),this.rotationGroup.quaternion,this.lookingAt):(this.rotationGroup.position.z=this.adjustZoomToLimits(v),this.show()),this}translate(t,n,f=0,o=!1){var v=t/this.WIDTH,m=n/this.HEIGHT,E=new L.Vector3(0,0,-this.CAMERA_Z);this.projector.projectVector(E,this.camera),E.x-=v,E.y-=m,this.projector.unprojectVector(E,this.camera),E.z=0;var S=this.lookingAt.clone().add(E);return f>0?this.animateMotion(f,o,this.modelGroup.position,this.rotationGroup.position.z,this.rotationGroup.quaternion,S):(this.lookingAt=S,this.camera.lookAt(this.lookingAt),this.show()),this}translateScene(t,n,f=0,o=!1){var v=this.screenOffsetToModel(t,n),m=this.modelGroup.position.clone().add(v);return f>0?this.animateMotion(f,o,this.modelGroup.position,this.rotationGroup.position.z,this.rotationGroup.quaternion,this.lookingAt):(this.modelGroup.position=m,this.show()),this}fitSlab(t){t=t||{};var n=this.getAtomsFromSel(t),f=(0,O.getExtent)(n),o=f[1][0]-f[0][0],v=f[1][1]-f[0][1],m=f[1][2]-f[0][2],E=Math.hypot(o,v,m);return E<5&&(E=5),this.slabNear=-E/1.9,this.slabFar=E/2,this}center(t={},n=0,f=!1){var o,v,m=this.getAtomsFromSel(t),E=(0,O.getExtent)(m);(0,O.isEmptyObject)(t)?(this.shapes.forEach(F=>{if(F&&F.boundingSphere&&F.boundingSphere.center){var N=F.boundingSphere.center,q=F.boundingSphere.radius;q>0?(m.push(new L.Vector3(N.x+q,N.y,N.z)),m.push(new L.Vector3(N.x-q,N.y,N.z)),m.push(new L.Vector3(N.x,N.y+q,N.z)),m.push(new L.Vector3(N.x,N.y-q,N.z)),m.push(new L.Vector3(N.x,N.y,N.z+q)),m.push(new L.Vector3(N.x,N.y,N.z-q))):m.push(N)}}),E=(0,O.getExtent)(m),o=m,v=E):(o=this.getAtomsFromSel({}),v=(0,O.getExtent)(o));var S=new L.Vector3(E[2][0],E[2][1],E[2][2]),T=v[1][0]-v[0][0],P=v[1][1]-v[0][1],I=v[1][2]-v[0][2],B=Math.hypot(T,P,I);B<5&&(B=5),this.slabNear=-B/1.9,this.slabFar=B/2,T=E[1][0]-E[0][0],P=E[1][1]-E[0][1],I=E[1][2]-E[0][2],B=Math.hypot(T,P,I),B<5&&(B=5);for(var R=25,z=0;z<m.length;z++)if(m[z]){var U=S.distanceToSquared(m[z]);U>R&&(R=U)}B=Math.sqrt(R)*2;var W=S.clone().multiplyScalar(-1);return n>0?this.animateMotion(n,f,W,this.rotationGroup.position.z,this.rotationGroup.quaternion,this.lookingAt):(this.modelGroup.position=W,this.show()),this}zoomTo(t={},n=0,f=!1){let o=this.getAtomsFromSel(t),v=(0,O.getExtent)(o),m=v;if((0,O.isEmptyObject)(t)){let N=o&&o.length;if(this.shapes.forEach(q=>{if(q&&q.boundingSphere){if(q.boundingSphere.box){let le=q.boundingSphere.box;o.push(new L.Vector3(le.min.x,le.min.y,le.min.z)),o.push(new L.Vector3(le.max.x,le.max.y,le.max.z))}else if(q.boundingSphere.center){var J=q.boundingSphere.center,oe=q.boundingSphere.radius;oe>0?(o.push(new L.Vector3(J.x+oe,J.y,J.z)),o.push(new L.Vector3(J.x-oe,J.y,J.z)),o.push(new L.Vector3(J.x,J.y+oe,J.z)),o.push(new L.Vector3(J.x,J.y-oe,J.z)),o.push(new L.Vector3(J.x,J.y,J.z+oe)),o.push(new L.Vector3(J.x,J.y,J.z-oe))):o.push(J)}}}),m=(0,O.getExtent)(o),!N)for(let q=0;q<3;q++)v[2][q]=(m[0][q]+m[1][q])/2}else{let N=this.getAtomsFromSel({});m=(0,O.getExtent)(N)}var E=new L.Vector3(v[2][0],v[2][1],v[2][2]),S=m[1][0]-m[0][0],T=m[1][1]-m[0][1],P=m[1][2]-m[0][2],I=Math.hypot(S,T,P);I<5&&(I=5),this.slabNear=-I/1.9,this.slabFar=I/2,Object.keys(t).length===0&&(this.slabNear=Math.min(-I*2,-50),this.slabFar=Math.max(I*2,50));var B=this.config.minimumZoomToDistance||5;S=v[1][0]-v[0][0],T=v[1][1]-v[0][1],P=v[1][2]-v[0][2],I=Math.hypot(S,T,P),I<B&&(I=B);for(var R=B*B,z=0;z<o.length;z++)if(o[z]){var U=E.distanceToSquared(o[z]);U>R&&(R=U)}I=Math.sqrt(R)*2;var W=E.clone().multiplyScalar(-1),F=-(I*.5/Math.tan(Math.PI/180*this.camera.fov/2)-this.CAMERA_Z);return F=this.adjustZoomToLimits(F),n>0?this.animateMotion(n,f,W,F,this.rotationGroup.quaternion,this.lookingAt):(this.modelGroup.position=W,this.rotationGroup.position.z=F,this.show()),this}setSlab(t,n){this.slabNear=t,this.slabFar=n}getSlab(){return{near:this.slabNear,far:this.slabFar}}addLabel(t,n={},f,o=!1){if(f){var v=(0,O.getExtent)(this.getAtomsFromSel(f));n.position={x:v[2][0],y:v[2][1],z:v[2][2]}}var m=new A.Label(t,n);return m.setContext(),this.modelGroup.add(m.sprite),this.labels.push(m),o||this.show(),m}addResLabels(t,n,f=!1){let o=this.labels.length;return this.applyToModels("addResLabels",t,this,n,f),this.show(),this.labels.slice(o)}addPropertyLabels(t,n,f){return this.applyToModels("addPropertyLabels",t,n,this,f),this.show(),this}removeLabel(t){for(var n=0;n<this.labels.length;n++)if(this.labels[n]==t){this.labels.splice(n,1),t.dispose(),this.modelGroup.remove(t.sprite);break}return this.show(),this}removeAllLabels(){for(var t=0;t<this.labels.length;t++)this.labels[t]&&this.labels[t].sprite&&this.modelGroup.remove(this.labels[t].sprite);return this.labels.splice(0,this.labels.length),this.show(),this}hideAllLabels(){for(var t=0;t<this.labels.length;t++)this.labels[t]&&this.labels[t].hide();return this.show(),this}showAllLabels(){for(var t=0;t<this.labels.length;t++)this.labels[t]&&this.labels[t].show();return this.show(),this}setLabelStyle(t,n){return this.modelGroup.remove(t.sprite),t.dispose(),t.stylespec=n,t.setContext(),this.modelGroup.add(t.sprite),this.show(),t}setLabelText(t,n){return this.modelGroup.remove(t.sprite),t.dispose(),t.text=n,t.setContext(),this.modelGroup.add(t.sprite),this.show(),t}addShape(t){t=t||{};var n=new c.GLShape(t);return n.shapePosition=this.shapes.length,this.shapes.push(n),n}removeShape(t){if(!t)return this;for(t.removegl(this.modelGroup),delete this.shapes[t.shapePosition];this.shapes.length>0&&typeof this.shapes[this.shapes.length-1]>"u";)this.shapes.pop();return this}removeAllShapes(){for(var t=0;t<this.shapes.length;t++){var n=this.shapes[t];n&&n.removegl(this.modelGroup)}return this.shapes.splice(0,this.shapes.length),this}getSelectionCenter(t){if(t.hasOwnProperty("x")&&t.hasOwnProperty("y")&&t.hasOwnProperty("z"))return t;var n=this.getAtomsFromSel(t);if(n.length==0)return{x:0,y:0,z:0};var f=(0,O.getExtent)(n);return{x:f[0][0]+(f[1][0]-f[0][0])/2,y:f[0][1]+(f[1][1]-f[0][1])/2,z:f[0][2]+(f[1][2]-f[0][2])/2}}addSphere(t){t=t||{},t.center=this.getSelectionCenter(t.center);var n=new c.GLShape(t);return n.shapePosition=this.shapes.length,n.addSphere(t),this.shapes.push(n),n.finalize(),n}addBox(t={}){t.corner!=null&&(t.corner=this.getSelectionCenter(t.corner)),t.center!=null&&(t.center=this.getSelectionCenter(t.center));var n=new c.GLShape(t);return n.shapePosition=this.shapes.length,n.addBox(t),this.shapes.push(n),n.finalize(),n}addArrow(t={}){t.start=this.getSelectionCenter(t.start),t.end=this.getSelectionCenter(t.end);var n=new c.GLShape(t);return n.shapePosition=this.shapes.length,n.addArrow(t),this.shapes.push(n),n.finalize(),n}addCylinder(t={}){t.start=this.getSelectionCenter(t.start),t.end=this.getSelectionCenter(t.end);var n=new c.GLShape(t);return n.shapePosition=this.shapes.length,t.dashed?n.addDashedCylinder(t):n.addCylinder(t),this.shapes.push(n),n.finalize(),n}addCurve(t={}){var n=new c.GLShape(t);return n.shapePosition=this.shapes.length,n.addCurve(t),this.shapes.push(n),n.finalize(),n}addLine(t={}){t.start=this.getSelectionCenter(t.start),t.end=this.getSelectionCenter(t.end),t.wireframe=!0;var n=new c.GLShape(t);return n.shapePosition=this.shapes.length,t.dashed?n=this.addLineDashed(t,n):n.addLine(t),this.shapes.push(n),n.finalize(),n}addUnitCell(t,n){t=this.getModel(t),n=n||{alabel:"a",blabel:"b",clabel:"c"},n.box=n.box||{},n.astyle=n.astyle||{color:"red",radius:.1,midpos:-1},n.bstyle=n.bstyle||{color:"green",radius:.1,midpos:-1},n.cstyle=n.cstyle||{color:"blue",radius:.1,midpos:-1},n.alabelstyle=n.alabelstyle||{fontColor:"red",showBackground:!1,alignment:"center",inFront:!1},n.blabelstyle=n.blabelstyle||{fontColor:"green",showBackground:!1,alignment:"center",inFront:!1},n.clabelstyle=n.clabelstyle||{fontColor:"blue",showBackground:!1,alignment:"center",inFront:!1},t.unitCellObjects&&this.removeUnitCell(t),t.unitCellObjects={shapes:[],labels:[]};var f=t.getCrystData(),o=null;if(f){if(f.matrix)o=f.matrix;else{var v=f.a,m=f.b,E=f.c,S=f.alpha,T=f.beta,P=f.gamma;S=S*Math.PI/180,T=T*Math.PI/180,P=P*Math.PI/180;var I,B,R;I=Math.cos(T),B=(Math.cos(S)-Math.cos(T)*Math.cos(P))/Math.sin(P),R=Math.sqrt(Math.max(0,1-I*I-B*B)),o=new L.Matrix3(v,m*Math.cos(P),E*I,0,m*Math.sin(P),E*B,0,0,E*R)}var z=[new L.Vector3(0,0,0),new L.Vector3(1,0,0),new L.Vector3(0,1,0),new L.Vector3(0,0,1),new L.Vector3(1,1,0),new L.Vector3(0,1,1),new L.Vector3(1,0,1),new L.Vector3(1,1,1)];if(f.matrix4)for(let W=0;W<z.length;W++)f.size&&z[W].multiplyVectors(z[W],f.size),z[W]=z[W].applyMatrix4(f.matrix4);else for(let W=0;W<z.length;W++)z[W]=z[W].applyMatrix3(o);if(n.box&&!n.box.hidden){n.box.wireframe=!0;var U=new c.GLShape(n.box);U.shapePosition=this.shapes.length,U.addLine({start:z[0],end:z[1]}),U.addLine({start:z[0],end:z[2]}),U.addLine({start:z[1],end:z[4]}),U.addLine({start:z[2],end:z[4]}),U.addLine({start:z[0],end:z[3]}),U.addLine({start:z[3],end:z[5]}),U.addLine({start:z[2],end:z[5]}),U.addLine({start:z[1],end:z[6]}),U.addLine({start:z[4],end:z[7]}),U.addLine({start:z[6],end:z[7]}),U.addLine({start:z[3],end:z[6]}),U.addLine({start:z[5],end:z[7]}),this.shapes.push(U),t.unitCellObjects.shapes.push(U),U.finalize()}if(!n.astyle.hidden){n.astyle.start=z[0],n.astyle.end=z[1];let W=this.addArrow(n.astyle);t.unitCellObjects.shapes.push(W)}if(!n.bstyle.hidden){n.bstyle.start=z[0],n.bstyle.end=z[2];let W=this.addArrow(n.bstyle);t.unitCellObjects.shapes.push(W)}if(!n.cstyle.hidden){n.cstyle.start=z[0],n.cstyle.end=z[3];let W=this.addArrow(n.cstyle);t.unitCellObjects.shapes.push(W)}if(n.alabel){n.alabelstyle.position=z[1];let W=this.addLabel(n.alabel,n.alabelstyle);t.unitCellObjects.labels.push(W)}if(n.blabel){n.blabelstyle.position=z[2];let W=this.addLabel(n.blabel,n.blabelstyle);t.unitCellObjects.labels.push(W)}if(n.clabel){n.clabelstyle.position=z[3];let W=this.addLabel(n.clabel,n.clabelstyle);t.unitCellObjects.labels.push(W)}}}removeUnitCell(t){if(t=this.getModel(t),t.unitCellObjects){let n=this;t.unitCellObjects.shapes.forEach(function(f){n.removeShape(f)}),t.unitCellObjects.labels.forEach(function(f){n.removeLabel(f)})}delete t.unitCellObjects}replicateUnitCell(t=3,n=t,f=n,o,v,m){o=this.getModel(o);let E=o.getCrystData();if(E){const S=o.selectedAtoms({}),T=E.matrix;let P=function(B){return B%2==0?-B/2:Math.ceil(B/2)};t<=1&&n<=1&&f<=1&&(m=!0,t=n=f=3);let I=function(B,R,z){return!1};if(m){const B=new L.Matrix3().getInverse3(T);I=function(R,z,U){let W=new L.Vector3(R,z,U).applyMatrix3(B);return!(W.x>-1e-4&&W.x<1.0001&&W.y>-1e-4&&W.y<1.0001&&W.z>-1e-4&&W.z<1.0001)}}for(let B=0;B<t;B++)for(let R=0;R<n;R++)for(let z=0;z<f;z++){if(B==0&&R==0&&z==0)continue;let U=new L.Vector3(P(B),P(R),P(z));U.applyMatrix3(T);let W=[];for(let F=0;F<S.length;F++){let N=S[F].x+U.x,q=S[F].y+U.y,J=S[F].z+U.z;if(I(N,q,J))continue;let oe={};for(let le in S[F])oe[le]=S[F][le];oe.x=N,oe.y=q,oe.z=J,W.push(oe)}o.addAtoms(W)}v&&o.assignBonds()}}addLineDashed(t,n){t.dashLength=t.dashLength||.5,t.gapLength=t.gapLength||.5;var f;t.start?f=new L.Vector3(t.start.x||0,t.start.y||0,t.start.z||0):f=new L.Vector3(0,0,0);var o;t.end?o=new L.Vector3(t.end.x,t.end.y||0,t.end.z||0):o=new L.Vector3(0,0,0);var v=new L.Vector3,m=new L.Vector3,E=new L.Vector3,S,T,P,I=f.clone(),B=0;for(v.subVectors(o,f),S=v.length(),v.normalize(),m=v.clone(),E=v.clone(),m.multiplyScalar(t.dashLength),E.multiplyScalar(t.gapLength),T=m.length(),P=E.length();B<S;){if(B+T>S){t.start=f,t.end=o,n.addLine(t);break}I.addVectors(f,m),t.start=f,t.end=I,n.addLine(t),f=I.clone(),B+=T,I.addVectors(f,E),f=I.clone(),B+=P}return n.finalize(),n}addCustom(t){t=t||{};var n=new c.GLShape(t);return n.shapePosition=this.shapes.length,n.addCustom(t),this.shapes.push(n),n.finalize(),n}addVolumetricData(t,n,f={}){var o=new y.VolumeData(t,n);return f.hasOwnProperty("transferfn")?this.addVolumetricRender(o,f):this.addIsosurface(o,f)}addIsosurface(t,n={},f){var o=new c.GLShape(n);return o.shapePosition=this.shapes.length,o.addIsosurface(t,n,f,this),this.shapes.push(o),o}addVolumetricRender(t,n){n=n||{};var f=new u.GLVolumetricRender(t,n,this);return f.shapePosition=this.shapes.length,this.shapes.push(f),f}hasVolumetricRender(){return this.renderer.supportsVolumetric()}enableFog(t){t?this.scene.fog=new M.Fog(this.bgColor,100,200):(this.config.disableFog=!0,this.show())}setFrame(t){this.viewer_frame=t;let n=this;return new Promise(function(f){var o=n.models.map(function(v){return v.setFrame(t,n)});Promise.all(o).then(function(){f()})})}getFrame(){return this.viewer_frame}getNumFrames(){var t=0;for(let n=0;n<this.models.length;n++)this.models[n].getNumFrames()>t&&(t=this.models[n].getNumFrames());for(let n=0;n<this.shapes.length;n++)this.shapes[n].frame&&this.shapes[n].frame>=t&&(t=this.shapes[n].frame+1);for(let n=0;n<this.labels.length;n++)this.labels[n].frame&&this.labels[n].frame>=t&&(t=this.labels[n].frame+1);return t}animate(t){this.incAnim();var n=100,f="forward",o=1/0;t=t||{},t.interval&&(n=t.interval),t.loop&&(f=t.loop),t.reps&&(o=t.reps);var v=this.getNumFrames(),m=this,E=0;t.startFrame&&(E=t.startFrame%v);var S=1;t.step&&(S=t.step,o/=S);var T=0,P=v*o,I=new Date,B,R,z=function(U){I=new Date,U=="forward"?m.setFrame(E).then(function(){E=(E+S)%v,B()}):U=="backward"?m.setFrame(v-1-E).then(function(){E=(E+S)%v,B()}):m.setFrame(E).then(function(){E+=S,S*=E%(v-1)==0?-1:1,B()})};return B=function(){if(m.render(),!m.getCanvas().isConnected)m.stopAnimate();else if(++T>=P||!m.isAnimated())R.cancel(),m.animationTimers.delete(R),m.decAnim();else{var U=n-(new Date().getTime()-I.getTime());U=U>0?U:0,m.animationTimers.delete(R),R=new O.PausableTimer(z,U,f),m.animationTimers.add(R)}},R=new O.PausableTimer(z,0,f),this.animationTimers.add(R),this}stopAnimate(){return this.animated=0,this.animationTimers.forEach(function(t){t.cancel()}),this.animationTimers=new Set,this}pauseAnimate(){return this.animationTimers.forEach(function(t){t.pause()}),this}resumeAnimate(){return this.animationTimers.forEach(function(t){t.resume()}),this}isAnimated(){return this.animated>0}getModelOpt(t){return t&&!t.defaultcolors?(t.defaultcolors=this.defaultcolors,t.cartoonQuality=t.cartoonQuality||this.config.cartoonQuality):typeof t>"u"&&(t={defaultcolors:this.defaultcolors,cartoonQuality:this.config.cartoonQuality}),t}addModel(t,n="",f){f=this.getModelOpt(f);var o=new _.GLModel(this.models.length,f);return o.addMolData(t,n,f),this.models.push(o),o}addModels(t,n,f){f=this.getModelOpt(f),f.multimodel=!0,f.frames=!0;for(var o=_.GLModel.parseMolData(t,n,f),v=0;v<o.length;v++){var m=new _.GLModel(this.models.length,f);m.setAtomDefaults(o[v]),m.addFrame(o[v]),m.setFrame(0),o.modelData&&m.setModelData(o.modelData[v]),m.setDontDuplicateAtoms(!f.duplicateAssemblyAtoms),this.models.push(m)}return this.models}addModelsAsFrames(t,n,f){f=this.getModelOpt(f),f.multimodel=!0,f.frames=!0;var o=new _.GLModel(this.models.length,f);return o.addMolData(t,n,f),this.models.push(o),o}addAsOneMolecule(t,n,f){f=this.getModelOpt(f),f.multimodel=!0,f.onemol=!0;var o=new _.GLModel(this.models.length,f);return o.addMolData(t,n,f),this.models.push(o),o}removeModel(t){if(t=this.getModel(t),!!t){for(t.removegl(this.modelGroup),delete this.models[t.getID()];this.models.length>0&&typeof this.models[this.models.length-1]>"u";)this.models.pop();return this}}removeAllModels(){for(var t=0;t<this.models.length;t++){var n=this.models[t];n&&n.removegl(this.modelGroup)}return this.models.splice(0,this.models.length),this}exportJSON(t,n){var f={};return n===void 0?f.m=this.models.map(function(o){return o.toCDObject(t)}):f.m=[this.models[n].toCDObject()],JSON.stringify(f)}exportVRML(){var t=this.modelGroup;this.applyToModels("removegl",this.modelGroup),this.modelGroup=new M.Object3D,this.render(null,{supportsImposters:!1,supportsAIA:!1,regen:!0});var n=`#VRML V2.0 utf8
`+this.modelGroup.vrml()+`
`;return this.applyToModels("removegl",this.modelGroup),this.modelGroup=t,n}createModelFrom(t,n=!1){for(var f=new _.GLModel(this.models.length,this.defaultcolors),o=0;o<this.models.length;o++)if(this.models[o]){var v=this.models[o].selectedAtoms(t);f.addAtoms(v),n&&this.models[o].removeAtoms(v)}return this.models.push(f),f}applyToModels(t,n,f,o,v,m,E){for(var S=this.getModelList(n),T=0;T<S.length;T++)S[T][t](n,f,o,v,m,E)}setStyle(t,n){return typeof n>"u"&&(n=t,t={}),this.applyToModels("setStyle",t,n,!1),this}addStyle(t,n){return typeof n>"u"&&(n=t,t={}),this.applyToModels("setStyle",t,n,!0),this}setClickable(t,n,f){return this.applyToModels("setClickable",t,n,f),this}setHoverable(t,n,f,o){return this.applyToModels("setHoverable",t,n,f,o),this}enableContextMenu(t,n){return this.applyToModels("enableContextMenu",t,n),this}vibrate(t,n,f,o){return this.applyToModels("vibrate",t,n,f,this,o),this}setColorByProperty(t,n,f,o){return this.applyToModels("setColorByProperty",t,n,f,o),this}setColorByElement(t,n){return this.applyToModels("setColorByElement",t,n),this}static getAtomsWithin(t,n){var f=[];for(let v=0;v<t.length;v++){var o=t[v];typeof o>"u"||o.x<n[0][0]||o.x>n[1][0]||o.y<n[0][1]||o.y>n[1][1]||o.z<n[0][2]||o.z>n[1][2]||f.push(o)}return f}static volume(t){var n=t[1][0]-t[0][0],f=t[1][1]-t[0][1],o=t[1][2]-t[0][2];return n*f*o}carveUpExtent(t,n,f){let o=[],v={};for(let I=0,B=n.length;I<B;I++)v[n[I].index]=I;let m=function(I){let B=[];for(let R=0,z=I.length;R<z;R++)I[R].index in v&&B.push(v[I[R].index]);return B},E=function(I){let B=[];return B[0]=[I[0][0],I[0][1],I[0][2]],B[1]=[I[1][0],I[1][1],I[1][2]],B},S=function(I){if(e.volume(I)<e.maxVolume)return[I];var B=I[1][0]-I[0][0],R=I[1][1]-I[0][1],z=I[1][2]-I[0][2],U;B>R&&B>z?U=0:R>B&&R>z?U=1:U=2;var W=E(I),F=E(I),N=(I[1][U]-I[0][U])/2+I[0][U];W[1][U]=N,F[0][U]=N;var q=S(W),J=S(F);return q.concat(J)},T=S(t),P=6;for(let I=0,B=T.length;I<B;I++){let R=E(T[I]);R[0][0]-=P,R[0][1]-=P,R[0][2]-=P,R[1][0]+=P,R[1][1]+=P,R[1][2]+=P;let z=e.getAtomsWithin(n,R),U=e.getAtomsWithin(f,T[I]);o.push({extent:T[I],atoms:m(z),toshow:m(U)})}return o}static generateSurfaceMesh(t,n,f){var o=new M.Geometry(!0),v=o.updateGeoGroup(0),m=[];for(let de=0,ee=t.length;de<ee;de++){var E=t[de];E&&(typeof E.surfaceColor<"u"?m[de]=E.surfaceColor:E.color&&(m[de]=w.CC.color(E.color)))}var S=v.vertexArray,T=n.vertices;for(let de=0,ee=T.length;de<ee;de++){let me=v.vertices*3;S[me]=T[de].x,S[me+1]=T[de].y,S[me+2]=T[de].z,v.vertices++}var P=v.colorArray;let I=v.atomArray;if(f.voldata&&f.volscheme){var B=f.volscheme,R=f.voldata,z=B.range()||[-1,1];for(let de=0,ee=T.length;de<ee;de++){let me=T[de].atomid,De=R.getVal(T[de].x,T[de].y,T[de].z),Ie=w.CC.color(B.valueToHex(De,z)),Fe=de*3;P[Fe]=Ie.r,P[Fe+1]=Ie.g,P[Fe+2]=Ie.b,I[de]=t[me]}}else if(m.length>0)for(let de=0,ee=T.length;de<ee;de++){let me=T[de].atomid,De=de*3;P[De]=m[me].r,P[De+1]=m[me].g,P[De+2]=m[me].b,I[de]=t[me]}var U=n.faces;v.faceidx=U.length,o.initTypedArrays();var W=v.vertexArray,F=v.normalArray,N,q,J,oe;for(let de=0,ee=U.length;de<ee;de+=3){var le=U[de],fe=U[de+1],ie=U[de+2],ne=le*3,we=fe*3,Ee=ie*3;N=new L.Vector3(W[ne],W[ne+1],W[ne+2]),q=new L.Vector3(W[we],W[we+1],W[we+2]),J=new L.Vector3(W[Ee],W[Ee+1],W[Ee+2]),J.subVectors(J,q),N.subVectors(N,q),J.cross(N),oe=J,oe.normalize(),F[ne]+=oe.x,F[we]+=oe.x,F[Ee]+=oe.x,F[ne+1]+=oe.y,F[we+1]+=oe.y,F[Ee+1]+=oe.y,F[ne+2]+=oe.z,F[we+2]+=oe.z,F[Ee+2]+=oe.z}v.faceArray=new Uint16Array(U);var Se=new M.Mesh(o,f);return Se}static generateMeshSyncHelper(t,n,f,o,v,m){var E=new b.ProteinSurface;return E.initparm(n,t!==1,m),E.fillvoxels(v,f),E.buildboundary(),(t==b.SurfaceType.SES||t==b.SurfaceType.MS)&&(E.fastdistancemap(),E.boundingatom(!1),E.fillvoxelswaals(v,f)),E.marchingcube(t),E.getFacesAndVertices(o)}static getMatWithStyle(t){let n=null;t.onesided?n=new M.MeshLambertMaterial:n=new M.MeshDoubleLambertMaterial,n.vertexColors=M.Coloring.VertexColors;for(var f in t)f==="color"||f==="map"||t.hasOwnProperty(f)&&(n[f]=t[f]);return t.opacity!==void 0&&(t.opacity===1?n.transparent=!1:n.transparent=!0),n}addMesh(t){var n={geo:t.geometry,mat:t.material,done:!0,finished:!1},f=this.nextSurfID();return this.surfaces[f]=[n],f}static shallowCopy(t){var n=[];let f=t.length;for(let o=0;o<f;o++)n[o]=(0,O.extend)({},t[o]);return n}addSurface(t,n={},f={},o,v,m){let E=this.nextSurfID(),S=null,T=this,P=b.SurfaceType.VDW;typeof t=="string"?e.surfaceTypeMap[t.toUpperCase()]!==void 0?P=e.surfaceTypeMap[t]:console.log("Surface type : "+t+" is not recognized"):typeof t=="number"&&(P=t);var I=null,B=null,R=e.shallowCopy(this.getAtomsFromSel(f));o?I=e.shallowCopy(this.getAtomsFromSel(o)):I=R,(0,O.adjustVolumeStyle)(n);var z=!1,U;for(U=0;U<this.models.length;U++)if(this.models[U]){var W=this.models[U].getSymmetries();if(W.length>1||W.length==1&&!W[0].isIdentity()){z=!0;break}}var F=function(ie,ne,we){v?B=e.shallowCopy(T.getAtomsFromSel(v)):B=we;var Ee,Se=(0,O.getExtent)(we,!0);if(n.map&&n.map.prop){var de=n.map.prop;let Ae=(0,g.getGradient)(n.map.scheme||n.map.gradient||new g.Gradient.RWB),Ne=Ae.range();Ne||(Ne=(0,O.getPropertyRange)(we,de)),n.colorscheme={prop:de,gradient:Ae}}for(let Ae=0,Ne=ne.length;Ae<Ne;Ae++)Ee=ne[Ae],Ee.surfaceColor=(0,O.getColorFromStyle)(Ee,n);var ee=e.volume(Se),me=T.carveUpExtent(Se,ne,we);if(B&&B.length&&B.length>0){var De=(0,O.getExtent)(B,!0),Ie=function(Ae,Ne){var je=function(Y,ve){var re=Y.extent,Le=re[1][0]-re[0][0],Me=re[1][1]-re[0][1],V=re[1][2]-re[0][2],ae=Le-ve[2][0];ae*=ae;var pe=Me-ve[2][1];pe*=pe;var Te=V-ve[2][2];return Te*=Te,ae+pe+Te},k=je(Ae,De),Z=je(Ne,De);return k-Z};me.sort(Ie)}var Fe=[];for(let Ae=0,Ne=ne.length;Ae<Ne;Ae++)Ee=ne[Ae],Fe[Ae]={x:Ee.x,y:Ee.y,z:Ee.z,serial:Ae,elem:Ee.elem};var Ue=!!b.syncSurface;if(Ue){var ze=function(Ne){return new Promise(function(je){for(var k=e.generateMeshSyncHelper(P,me[Ne].extent,me[Ne].atoms,me[Ne].toshow,Fe,ee),Z=(0,c.splitMesh)({vertexArr:k.vertices,faceArr:k.faces}),Y=0,ve=Z.length;Y<ve;Y++){k={vertices:Z[Y].vertexArr,faces:Z[Y].faceArr};var re=e.generateSurfaceMesh(ne,k,S);(0,O.mergeGeos)(ie.geo,re)}T.render(),je()})},Re=[];for(let Ae=0;Ae<me.length;Ae++)Re.push(ze(Ae));return Promise.all(Re).then(function(){return ie.done=!0,Promise.resolve(E)})}else{var Pe=[];P<0&&(P=0);for(let Ae=0,Ne=e.numWorkers;Ae<Ne;Ae++){var Oe=new Worker($3Dmol.SurfaceWorker);Pe.push(Oe),Oe.postMessage({type:-1,atoms:Fe,volume:ee})}return new Promise(function(Ae,Ne){var je=0,k=function(){!Pe||!Pe.length||Pe.forEach(function(re){re&&re.terminate&&re.terminate()})},Z=function(re){for(var Le=(0,c.splitMesh)({vertexArr:re.data.vertices,faceArr:re.data.faces}),Me=0,V=Le.length;Me<V;Me++){var ae={vertices:Le[Me].vertexArr,faces:Le[Me].faceArr},pe=e.generateSurfaceMesh(ne,ae,S);(0,O.mergeGeos)(ie.geo,pe)}T.render(),je++,je==me.length&&(ie.done=!0,k(),Ae(E))},Y=function(re){k(),console.log(re.message+" ("+re.filename+":"+re.lineno+")"),Ne(re)};for(let re=0;re<me.length;re++){var ve=Pe[re%Pe.length];ve.onmessage=Z,ve.onerror=Y,ve.postMessage({type:P,expandedExtent:me[re].extent,extendedAtoms:me[re].atoms,atomsToShow:me[re].toshow})}})}};n=n||{},S=e.getMatWithStyle(n);var N=[];N.style=n,N.atomsel=f,N.allsel=o,N.focus=v;var q=null;if(z){var J={},oe={};for(U=0;U<this.models.length;U++)J[U]=[],oe[U]=[];for(U=0;U<I.length;U++)J[I[U].model].push(I[U]);for(U=0;U<R.length;U++)oe[R[U].model].push(R[U]);var le=[];for(U=0;U<this.models.length;U++)oe[U].length>0&&(N.push({geo:new M.Geometry(!0),mat:S,done:!1,finished:!1,symmetries:this.models[U].getSymmetries()}),le.push(F(N[N.length-1],J[U],oe[U])));q=Promise.all(le)}else N.push({geo:new M.Geometry(!0),mat:S,done:!1,finished:!1,symmetries:[new L.Matrix4]}),q=F(N[N.length-1],I,R);return this.surfaces[E]=N,q.surfid=E,m&&typeof m=="function"?(q.then(function(fe){m(fe)}),E):q}setSurfaceMaterialStyle(t,n){if((0,O.adjustVolumeStyle)(n),this.surfaces[t]){var f=this.surfaces[t];for(let v=0;v<f.length;v++){var o=f[v].mat=e.getMatWithStyle(n);if(f[v].mat.side=M.FrontSide,n.color){f[v].mat.color=w.CC.color(n.color),f[v].geo.colorsNeedUpdate=!0;const m=w.CC.color(n.color);f[v].geo.setColor(m)}else if(o.voldata&&o.volscheme){const m=o.volscheme,E=o.voldata,S=w.CC,T=m.range()||[-1,1];f[v].geo.setColors(function(P,I,B){let R=E.getVal(P,I,B);return S.color(m.valueToHex(R,T))})}else{f[v].geo.colorsNeedUpdate=!0;for(let m of f[v].geo.geometryGroups)for(let E=0;E<m.vertices;E++){let S=(0,O.getColorFromStyle)(m.atomArray[E],n),T=3*E;m.colorArray[T]=S.r,m.colorArray[T+1]=S.g,m.colorArray[T+2]=S.b}}f[v].finished=!1}}return this}getSurface(t){return this.surfaces[t]}removeSurface(t){for(var n=this.surfaces[t],f=0;f<n.length;f++)n[f]&&n[f].lastGL&&(n[f].geo!==void 0&&n[f].geo.dispose(),n[f].mat!==void 0&&n[f].mat.dispose(),this.modelGroup.remove(n[f].lastGL));return delete this.surfaces[t],this.show(),this}removeAllSurfaces(){for(var t in this.surfaces)if(this.surfaces.hasOwnProperty(t)){for(var n=this.surfaces[t],f=0;f<n.length;f++)n[f]&&n[f].lastGL&&(n[f].geo!==void 0&&n[f].geo.dispose(),n[f].mat!==void 0&&n[f].mat.dispose(),this.modelGroup.remove(n[f].lastGL));delete this.surfaces[t]}return this.show(),this}jmolMoveTo(){var t=this.modelGroup.position,n="center { "+-t.x+" "+-t.y+" "+-t.z+" }; ",f=this.rotationGroup.quaternion;return n+="moveto .5 quaternion { "+f.x+" "+f.y+" "+f.z+" "+f.w+" };",n}clear(){return this.removeAllSurfaces(),this.removeAllModels(),this.removeAllLabels(),this.removeAllShapes(),this.show(),this}mapAtomProperties(t,n){n=n||{};var f=this.getAtomsFromSel(n);if(typeof t=="function")for(let m=0,E=f.length;m<E;m++){let S=f[m];t(S)}else for(let m=0,E=f.length;m<E;m++){var o=f[m];for(let S=0,T=t.length;S<T;S++){let P=t[S];if(P.props)for(var v in P.props)P.props.hasOwnProperty(v)&&this.atomIsSelected(o,P)&&(o.properties||(o.properties={}),o.properties[v]=P.props[v])}}return this}linkViewer(t){return this.linkedViewers.push(t),this}getPerceivedDistance(){return this.CAMERA_Z-this.rotationGroup.position.z}setPerceivedDistance(t){this.rotationGroup.position.z=this.CAMERA_Z-t}setAutoEyeSeparation(t,n){var f=this.getPerceivedDistance();return n||(n=5),t||this.camera.position.x>0?this.camera.position.x=f*Math.tan(Math.PI/180*n):this.camera.position.x=-f*Math.tan(Math.PI/180*n),this.camera.lookAt(new L.Vector3(0,0,this.rotationGroup.position.z)),this.camera.position.x}setDefaultCartoonQuality(t){this.config.cartoonQuality=t}}e.numWorkers=4,e.maxVolume=64e3,e.surfaceTypeMap={VDW:b.SurfaceType.VDW,MS:b.SurfaceType.MS,SAS:b.SurfaceType.SAS,SES:b.SurfaceType.SES};function i(h,t){if(h=(0,O.getElement)(h),!!h){t=t||{};try{var n=new e(h,t);return n}catch(f){throw"error creating viewer: "+f}}}function s(h,t={},n={}){if(h=(0,O.getElement)(h),!!h){var f=[],o=document.createElement("canvas");n.rows=t.rows,n.cols=t.cols,n.control_all=t.control_all!=null?t.control_all:!1,h.appendChild(o);try{for(var v=0;v<t.rows;v++){for(var m=[],E=0;E<t.cols;E++){n.row=v,n.col=E,n.canvas=o,n.viewers=f,n.control_all=t.control_all;var S=i(h,(0,O.extend)({},n));m.push(S)}f.unshift(m)}}catch(T){throw"error creating viewer grid: "+T}return f}}function a(h){var t=this;if(h=(0,O.getElement)(h),!!h){var n=s(h,{rows:1,cols:2,control_all:!0});this.glviewer1=n[0][0],this.glviewer2=n[0][1],this.glviewer1.setAutoEyeSeparation(!1),this.glviewer2.setAutoEyeSeparation(!0),this.glviewer1.linkViewer(this.glviewer2),this.glviewer2.linkViewer(this.glviewer1);for(var f=Object.getOwnPropertyNames(this.glviewer1.__proto__).filter(function(v){return typeof t.glviewer1[v]=="function"}),o=0;o<f.length;o++)this[f[o]]=function(v){return function(){var m=this.glviewer1[v].apply(this.glviewer1,arguments),E=this.glviewer2[v].apply(this.glviewer2,arguments);return[m,E]}}(f[o]);this.setCoordinates=function(v,m,E){for(var S=0;S<v.length;S++)v[S].setCoordinates(m,E)},this.surfacesFinished=function(){return this.glviewer1.surfacesFinished()&&this.glviewer2.surfacesFinished()},this.isAnimated=function(){return this.glviewer1.isAnimated()||this.glviewer2.isAnimated()},this.render=function(v){this.glviewer1.render(),this.glviewer2.render(),v&&v(this)},this.getCanvas=function(){return this.glviewer1.getCanvas()}}}},"./src/Gradient.ts":(K,C,d)=>{d.r(C),d.d(C,{CustomLinear:()=>c,Gradient:()=>b,GradientType:()=>L,ROYGB:()=>_,RWB:()=>g,Sinebow:()=>A,builtinGradients:()=>y,getGradient:()=>O,normalizeValue:()=>w});var M=d("./src/colors.ts");class L{}function w(u,p,r){return p>=u?(r<u&&(r=u),r>p&&(r=p),{lo:u,hi:p,val:r}):(r>u&&(r=u),r<p&&(r=p),r=u-r+p,{lo:p,hi:u,val:r})}function O(u){if(u instanceof L)return u;if(u.gradient!==void 0&&y[u.gradient]){let p=u.min===void 0?-1:u.min,r=u.max===void 0?1:u.max;return u.mid===void 0?u.colors===void 0?new y[u.gradient](p,r):new y[u.gradient](p,r,u.colors):new y[u.gradient](p,r,u.mid)}else if(typeof u.gradient=="string"&&u.gradient.startsWith("linear_")){let p=u.gradient.split("_");p.shift();let r=u.min===void 0?-1:u.min,e=u.max===void 0?1:u.max;return new c(r,e,p)}return u}class g extends L{constructor(p,r,e){super(),this.gradient="RWB",this.mult=1,this.mid=e,this.min=p,this.max=r,typeof r>"u"&&Array.isArray(p)&&p.length>=2?(this.max=p[1],this.min=p[0]):p&&r&&!Array.isArray(p)&&(this.min=p,this.max=r)}range(){return typeof this.min<"u"&&typeof this.max<"u"?[this.min,this.max]:null}valueToHex(p,r){var e,i;if(p=this.mult*p,r?(e=r[0],i=r[1]):(e=this.min,i=this.max),p===void 0)return 16777215;var s=w(e,i,p);e=s.lo,i=s.hi,p=s.val;var a=(i+e)/2;r&&typeof r[2]<"u"?a=r[2]:typeof this.mid<"u"?a=this.mid:a=(e+i)/2;var h,t;return p<a?(h=Math.floor(255*Math.sqrt((p-e)/(a-e))),t=16711680+256*h+h,t):p>a?(h=Math.floor(255*Math.sqrt(1-(p-a)/(i-a))),t=65536*h+256*h+255,t):16777215}}class _ extends L{constructor(p,r){super(),this.gradient="ROYGB",this.mult=1,this.min=p,this.max=r,typeof r>"u"&&Array.isArray(p)&&p.length>=2?(this.max=p[1],this.min=p[0]):p&&r&&!Array.isArray(p)&&(this.min=p,this.max=r)}valueToHex(p,r){var e,i;if(p=this.mult*p,r?(e=r[0],i=r[1]):(e=this.min,i=this.max),typeof p>"u")return 16777215;var s=w(e,i,p);e=s.lo,i=s.hi,p=s.val;var a=(e+i)/2,h=(e+a)/2,t=(a+i)/2,n,f;return p<h?(n=Math.floor(255*Math.sqrt((p-e)/(h-e))),f=16711680+256*n+0,f):p<a?(n=Math.floor(255*Math.sqrt(1-(p-h)/(a-h))),f=65536*n+65280+0,f):p<t?(n=Math.floor(255*Math.sqrt((p-a)/(t-a))),f=65280+1*n,f):(n=Math.floor(255*Math.sqrt(1-(p-t)/(i-t))),f=0+256*n+255,f)}range(){return typeof this.min<"u"&&typeof this.max<"u"?[this.min,this.max]:null}}class A extends L{constructor(p,r){super(),this.gradient="Sinebow",this.mult=1,this.min=p,this.max=r,typeof r>"u"&&Array.isArray(p)&&p.length>=2&&(this.max=p[1],this.min=p[0]),r<p&&(this.mult=-1,this.min*=-1,this.max*=-1)}valueToHex(p,r){var e,i;if(p=this.mult*p,r?(e=r[0],i=r[1]):(e=this.min,i=this.max),typeof p>"u")return 16777215;var s=b.normalizeValue(e,i,p);e=s.lo,i=s.hi,p=s.val;var a=(p-e)/(i-e),h=5*a/6+.5,t=Math.sin(Math.PI*h);t*=t*255;var n=Math.sin(Math.PI*(h+1/3));n*=n*255;var f=Math.sin(Math.PI*(h+2/3));return f*=f*255,65536*Math.floor(t)+256*Math.floor(f)+1*Math.floor(n)}range(){return typeof this.min<"u"&&typeof this.max<"u"?[this.min,this.max]:null}}class c extends L{constructor(p,r,e){super(),this.gradient="linear",this.colors=new Array;var i;if(Array.isArray(p)&&p.length>=2?(this.max=p[1],this.min=p[0],i=r):(this.min=p,this.max=r,i=e),i)for(let s of i)this.colors.push(M.CC.color(s));else this.colors.push(M.CC.color(0))}range(){return typeof this.min<"u"&&typeof this.max<"u"?[this.min,this.max]:null}valueToHex(p,r){var e,i;if(r?(e=r[0],i=r[1]):(e=this.min,i=this.max),p===void 0)return 16777215;var s=w(e,i,p);e=s.lo,i=s.hi,p=s.val;let a=this.colors.length,h=(i-e)/a,t=Math.min(Math.floor((p-e)/h),a-1),n=Math.min(t+1,a-1),f=(p-e-t*h)/h,o=this.colors[t],v=this.colors[n];return new M.Color(o.r+f*(v.r-o.r),o.g+f*(v.g-o.g),o.b+f*(v.b-o.b)).getHex()}}const y={rwb:g,RWB:g,roygb:_,ROYGB:_,sinebow:A,linear:c};class b extends L{valueToHex(p,r){return 0}range(){return null}}b.RWB=g,b.ROYGB=_,b.Sinebow=A,b.CustomLinear=c,b.builtinGradients=y,b.normalizeValue=w,b.getGradient=O},"./src/Label.ts":(K,C,d)=>{d.r(C),d.d(C,{Label:()=>A,LabelCount:()=>O});var M=d("./src/WebGL/index.ts"),L=d("./src/Gradient.ts"),w=d("./src/colors.ts");let O=0;function g(c,y,b,u,p,r,e){c.beginPath(),c.moveTo(y+r,b),c.lineTo(y+u-r,b),c.quadraticCurveTo(y+u,b,y+u,b+r),c.lineTo(y+u,b+p-r),c.quadraticCurveTo(y+u,b+p,y+u-r,b+p),c.lineTo(y+r,b+p),c.quadraticCurveTo(y,b+p,y,b+p-r),c.lineTo(y,b+r),c.quadraticCurveTo(y,b,y+r,b),c.closePath(),c.fill(),e&&c.stroke()}function _(c,y,b){var u=b;return typeof c<"u"&&(c instanceof w.Color?u=c.scaled():(u=w.CC.color(c),typeof u.scaled<"u"&&(u=u.scaled()))),typeof y<"u"&&(u.a=parseFloat(y)),u}class A{constructor(y,b){this.id=O++,this.stylespec=b||{},this.canvas=document.createElement("canvas"),this.canvas.width=134,this.canvas.height=35,this.context=this.canvas.getContext("2d"),this.sprite=new M.Sprite,this.text=y,this.frame=this.stylespec.frame}getStyle(){return this.stylespec}hide(){this.sprite&&(this.sprite.visible=!1)}show(){this.sprite&&(this.sprite.visible=!0)}setContext(){var y=this.stylespec,b=typeof y.useScreen>"u"?!1:y.useScreen,u=y.showBackground;(u==="0"||u==="false")&&(u=!1),typeof u>"u"&&(u=!0);var p=y.font?y.font:"sans-serif",r=parseInt(y.fontSize)?parseInt(y.fontSize):18,e=_(y.fontColor,y.fontOpacity,{r:255,g:255,b:255,a:1}),i=y.padding?y.padding:4,s=y.borderThickness?y.borderThickness:0,a=_(y.backgroundColor,y.backgroundOpacity,{r:0,g:0,b:0,a:1}),h=_(y.borderColor,y.borderOpacity,a),t=y.position?y.position:{x:-10,y:1,z:1},n=y.inFront!==void 0?y.inFront:!0;(n==="false"||n==="0")&&(n=!1);var f=y.alignment||M.SpriteAlignment.topLeft;typeof f=="string"&&f in M.SpriteAlignment&&(f=M.SpriteAlignment[f]);var o="";y.bold&&(o="bold "),this.context.font=o+r+"px  "+p;var v=this.context.measureText(this.text),m=v.width;u||(s=0);var E=m+2.5*s+2*i,S=r*1.25+2*s+2*i;if(y.backgroundImage){var T=y.backgroundImage,P=y.backgroundWidth?y.backgroundWidth:T.width,I=y.backgroundHeight?y.backgroundHeight:T.height;P>E&&(E=P),I>S&&(S=I)}if(this.canvas.width=E,this.canvas.height=S,this.context.clearRect(0,0,this.canvas.width,this.canvas.height),o="",y.bold&&(o="bold "),this.context.font=o+r+"px  "+p,this.context.fillStyle="rgba("+a.r+","+a.g+","+a.b+","+a.a+")",this.context.strokeStyle="rgba("+h.r+","+h.g+","+h.b+","+h.a+")",y.backgroundGradient){let R=this.context.createLinearGradient(0,S/2,E,S/2),z=L.Gradient.getGradient(y.backgroundGradient),U=z.range(),W=-1,F=1;U&&(W=U[0],F=U[1]);let N=F-W;for(let q=0;q<1.01;q+=.1){let J=_(z.valueToHex(W+N*q)),oe="rgba("+J.r+","+J.g+","+J.b+","+J.a+")";R.addColorStop(q,oe)}this.context.fillStyle=R}this.context.lineWidth=s,u&&g(this.context,s,s,E-2*s,S-2*s,6,s>0),y.backgroundImage&&this.context.drawImage(T,0,0,E,S),this.context.fillStyle="rgba("+e.r+","+e.g+","+e.b+","+e.a+")",this.context.fillText(this.text,s+i,r+s+i,m);var B=new M.Texture(this.canvas);B.needsUpdate=!0,this.sprite.material=new M.SpriteMaterial({map:B,useScreenCoordinates:b,alignment:f,depthTest:!n,screenOffset:y.screenOffset||null}),this.sprite.scale.set(1,1,1),this.sprite.position.set(t.x,t.y,t.z)}dispose(){this.sprite.material.map!==void 0&&this.sprite.material.map.dispose(),this.sprite.material!==void 0&&this.sprite.material.dispose()}}},"./src/ProteinSurface4.ts":(K,C,d)=>{d.r(C),d.d(C,{MarchingCube:()=>_,MarchingCubeInitializer:()=>g,PointGrid:()=>A,ProteinSurface:()=>c,SurfaceType:()=>L,setSyncSurface:()=>O,syncSurface:()=>w});var M=d("./src/WebGL/math/index.ts"),L;(function(y){y[y.VDW=1]="VDW",y[y.MS=2]="MS",y[y.SAS=3]="SAS",y[y.SES=4]="SES"})(L||(L={}));var w=!1;function O(y){w=y}(window.navigator.userAgent.indexOf("MSIE ")>=0||window.navigator.userAgent.indexOf("Trident/")>=0)&&(w=!0);class g{constructor(){this.ISDONE=2,this.edgeTable=new Uint32Array([0,0,0,0,0,0,0,2816,0,0,0,1792,0,3328,3584,3840,0,0,0,138,0,21,0,134,0,0,0,652,0,2067,3865,3600,0,0,0,42,0,0,0,294,0,0,21,28,0,3875,1049,3360,0,168,162,170,0,645,2475,2210,0,687,293,172,4010,3747,3497,3232,0,0,0,0,0,69,0,900,0,0,0,1792,138,131,1608,1920,0,81,0,2074,84,85,84,86,0,81,0,3676,330,1105,1881,1616,0,0,0,42,0,69,0,502,0,0,21,3580,138,2035,1273,1520,2816,104,2337,106,840,581,367,102,2816,3695,3429,3180,1898,1635,1385,1120,0,0,0,0,0,0,0,3910,0,0,69,588,42,2083,41,2880,0,0,0,1722,0,2293,4095,3830,0,255,757,764,2538,2291,3065,2800,0,0,81,338,0,3925,1119,3414,84,855,85,340,2130,2899,89,2384,1792,712,194,1162,4036,3781,3535,3270,708,719,197,204,3018,2755,2505,2240,0,0,0,0,168,420,168,1958,162,162,676,2988,170,163,680,928,3328,3096,3328,3642,52,53,1855,1590,2340,2111,2869,2620,298,51,825,560,3584,3584,3090,3482,1668,1941,1183,1430,146,2975,2069,2460,154,915,153,400,3840,3592,3329,3082,1796,1541,1295,1030,2818,2575,2309,2060,778,515,265,0]),this.triTable=[[],[],[],[],[],[],[],[11,9,8],[],[],[],[8,10,9],[],[10,8,11],[9,11,10],[8,10,9,8,11,10],[],[],[],[1,7,3],[],[4,2,0],[],[2,1,7],[],[],[],[2,7,3,2,9,7],[],[1,4,11,1,0,4],[3,8,0,11,9,4,11,10,9],[4,11,9,11,10,9],[],[],[],[5,3,1],[],[],[],[2,5,8,2,1,5],[],[],[2,4,0],[3,2,4],[],[0,9,1,8,10,5,8,11,10],[3,4,0,3,10,4],[5,8,10,8,11,10],[],[3,5,7],[7,1,5],[1,7,3,1,5,7],[],[9,2,0,9,7,2],[0,3,8,1,7,11,1,5,7],[11,1,7,1,5,7],[],[9,1,0,5,3,2,5,7,3],[8,2,5,8,0,2],[2,5,3,5,7,3],[3,9,1,3,8,9,7,11,10,7,10,5],[9,1,0,10,7,11,10,5,7],[3,8,0,7,10,5,7,11,10],[11,5,7,11,10,5],[],[],[],[],[],[0,6,2],[],[7,2,9,7,9,8],[],[],[],[8,10,9],[7,1,3],[7,1,0],[6,9,3,6,10,9],[7,10,8,10,9,8],[],[6,0,4],[],[11,1,4,11,3,1],[2,4,6],[2,0,4,2,4,6],[2,4,6],[1,4,2,4,6,2],[],[6,0,4],[],[2,11,3,6,9,4,6,10,9],[8,6,1,8,1,3],[10,0,6,0,4,6],[8,0,3,9,6,10,9,4,6],[10,4,6,10,9,4],[],[],[],[5,3,1],[],[0,6,2],[],[7,4,8,5,2,1,5,6,2],[],[],[2,4,0],[7,4,8,2,11,3,10,5,6],[7,1,3],[5,6,10,0,9,1,8,7,4],[5,6,10,7,0,3,7,4,0],[10,5,6,4,8,7],[9,11,8],[3,5,6],[0,5,11,0,11,8],[6,3,5,3,1,5],[3,9,6,3,8,9],[9,6,0,6,2,0],[0,3,8,2,5,6,2,1,5],[1,6,2,1,5,6],[9,11,8],[1,0,9,6,10,5,11,3,2],[6,10,5,2,8,0,2,11,8],[3,2,11,10,5,6],[10,5,6,9,3,8,9,1,3],[0,9,1,5,6,10],[8,0,3,10,5,6],[10,5,6],[],[],[],[],[],[],[],[1,10,2,9,11,6,9,8,11],[],[],[6,0,2],[3,6,9,3,2,6],[3,5,1],[0,5,1,0,11,5],[0,3,5],[6,9,11,9,8,11],[],[],[],[4,5,9,7,1,10,7,3,1],[],[11,6,7,2,4,5,2,0,4],[11,6,7,8,0,3,1,10,2,9,4,5],[6,7,11,1,10,2,9,4,5],[],[4,1,0,4,5,1,6,7,3,6,3,2],[9,4,5,0,6,7,0,2,6],[4,5,9,6,3,2,6,7,3],[6,7,11,5,3,8,5,1,3],[6,7,11,4,1,0,4,5,1],[4,5,9,3,8,0,11,6,7],[9,4,5,7,11,6],[],[],[0,6,4],[8,6,4,8,1,6],[],[0,10,2,0,9,10,4,8,11,4,11,6],[10,2,1,6,0,3,6,4,0],[10,2,1,11,4,8,11,6,4],[4,2,6],[1,0,9,2,4,8,2,6,4],[2,4,0,2,6,4],[8,2,4,2,6,4],[11,4,1,11,6,4],[0,9,1,4,11,6,4,8,11],[3,6,0,6,4,0],[8,6,4,8,11,6],[10,8,9],[6,3,9,6,7,3],[6,7,1],[10,7,1,7,3,1],[7,11,6,8,10,2,8,9,10],[11,6,7,10,0,9,10,2,0],[2,1,10,7,11,6,8,0,3],[1,10,2,6,7,11],[7,2,6,7,9,2],[1,0,9,3,6,7,3,2,6],[7,0,6,0,2,6],[2,7,3,2,6,7],[7,11,6,3,9,1,3,8,9],[9,1,0,11,6,7],[0,3,8,11,6,7],[11,6,7],[],[],[],[],[5,3,7],[8,5,2,8,7,5],[5,3,7],[1,10,2,5,8,7,5,9,8],[1,7,5],[1,7,5],[9,2,7,9,7,5],[11,3,2,8,5,9,8,7,5],[1,3,7,1,7,5],[0,7,1,7,5,1],[9,3,5,3,7,5],[9,7,5,9,8,7],[8,10,11],[3,4,10,3,10,11],[8,10,11],[5,9,4,1,11,3,1,10,11],[2,4,5],[5,2,4,2,0,4],[0,3,8,5,9,4,10,2,1],[2,1,10,9,4,5],[2,8,5,2,11,8],[3,2,11,1,4,5,1,0,4],[9,4,5,8,2,11,8,0,2],[11,3,2,9,4,5],[8,5,3,5,1,3],[5,0,4,5,1,0],[3,8,0,4,5,9],[9,4,5],[11,9,10],[11,9,10],[1,11,4,1,10,11],[8,7,4,11,1,10,11,3,1],[2,7,9,2,9,10],[4,8,7,0,10,2,0,9,10],[2,1,10,0,7,4,0,3,7],[10,2,1,8,7,4],[1,7,4],[3,2,11,4,8,7,9,1,0],[11,4,2,4,0,2],[2,11,3,7,4,8],[4,1,7,1,3,7],[1,0,9,8,7,4],[3,4,0,3,7,4],[8,7,4],[8,9,10,8,10,11],[3,9,11,9,10,11],[0,10,8,10,11,8],[10,3,1,10,11,3],[2,8,10,8,9,10],[9,2,0,9,10,2],[8,0,3,1,10,2],[10,2,1],[1,11,9,11,8,9],[11,3,2,0,9,1],[11,0,2,11,8,0],[11,3,2],[8,1,3,8,9,1],[9,1,0],[8,0,3],[]],this.edgeTable2=[0,265,515,778,2060,2309,2575,2822,1030,1295,1541,1804,3082,3331,3593,3840,400,153,915,666,2460,2197,2975,2710,1430,1183,1941,1692,3482,3219,3993,3728,560,825,51,314,2620,2869,2111,2358,1590,1855,1077,1340,3642,3891,3129,3376,928,681,419,170,2988,2725,2479,2214,1958,1711,1445,1196,4010,3747,3497,3232,2240,2505,2755,3018,204,453,719,966,3270,3535,3781,4044,1226,1475,1737,1984,2384,2137,2899,2650,348,85,863,598,3414,3167,3925,3676,1370,1107,1881,1616,2800,3065,2291,2554,764,1013,255,502,3830,4095,3317,3580,1786,2035,1273,1520,2912,2665,2403,2154,876,613,367,102,3942,3695,3429,3180,1898,1635,1385,1120,1120,1385,1635,1898,3180,3429,3695,3942,102,367,613,876,2154,2403,2665,2912,1520,1273,2035,1786,3580,3317,4095,3830,502,255,1013,764,2554,2291,3065,2800,1616,1881,1107,1370,3676,3925,3167,3414,598,863,85,348,2650,2899,2137,2384,1984,1737,1475,1226,4044,3781,3535,3270,966,719,453,204,3018,2755,2505,2240,3232,3497,3747,4010,1196,1445,1711,1958,2214,2479,2725,2988,170,419,681,928,3376,3129,3891,3642,1340,1077,1855,1590,2358,2111,2869,2620,314,51,825,560,3728,3993,3219,3482,1692,1941,1183,1430,2710,2975,2197,2460,666,915,153,400,3840,3593,3331,3082,1804,1541,1295,1030,2822,2575,2309,2060,778,515,265,0],this.triTable2=[[],[8,3,0],[9,0,1],[8,3,1,8,1,9],[11,2,3],[11,2,0,11,0,8],[11,2,3,0,1,9],[2,1,11,1,9,11,11,9,8],[10,1,2],[8,3,0,1,2,10],[9,0,2,9,2,10],[3,2,8,2,10,8,8,10,9],[10,1,3,10,3,11],[1,0,10,0,8,10,10,8,11],[0,3,9,3,11,9,9,11,10],[8,10,9,8,11,10],[8,4,7],[3,0,4,3,4,7],[1,9,0,8,4,7],[9,4,1,4,7,1,1,7,3],[2,3,11,7,8,4],[7,11,4,11,2,4,4,2,0],[3,11,2,4,7,8,9,0,1],[2,7,11,2,1,7,1,4,7,1,9,4],[10,1,2,8,4,7],[2,10,1,0,4,7,0,7,3],[4,7,8,0,2,10,0,10,9],[2,7,3,2,9,7,7,9,4,2,10,9],[8,4,7,11,10,1,11,1,3],[11,4,7,1,4,11,1,11,10,1,0,4],[3,8,0,7,11,4,11,9,4,11,10,9],[7,11,4,4,11,9,11,10,9],[9,5,4],[3,0,8,4,9,5],[5,4,0,5,0,1],[4,8,5,8,3,5,5,3,1],[11,2,3,9,5,4],[9,5,4,8,11,2,8,2,0],[3,11,2,1,5,4,1,4,0],[8,5,4,2,5,8,2,8,11,2,1,5],[2,10,1,9,5,4],[0,8,3,5,4,9,10,1,2],[10,5,2,5,4,2,2,4,0],[3,4,8,3,2,4,2,5,4,2,10,5],[5,4,9,1,3,11,1,11,10],[0,9,1,4,8,5,8,10,5,8,11,10],[3,4,0,3,10,4,4,10,5,3,11,10],[4,8,5,5,8,10,8,11,10],[9,5,7,9,7,8],[0,9,3,9,5,3,3,5,7],[8,0,7,0,1,7,7,1,5],[1,7,3,1,5,7],[11,2,3,8,9,5,8,5,7],[9,2,0,9,7,2,2,7,11,9,5,7],[0,3,8,2,1,11,1,7,11,1,5,7],[2,1,11,11,1,7,1,5,7],[1,2,10,5,7,8,5,8,9],[9,1,0,10,5,2,5,3,2,5,7,3],[5,2,10,8,2,5,8,5,7,8,0,2],[10,5,2,2,5,3,5,7,3],[3,9,1,3,8,9,7,11,10,7,10,5],[9,1,0,10,7,11,10,5,7],[3,8,0,7,10,5,7,11,10],[11,5,7,11,10,5],[11,7,6],[0,8,3,11,7,6],[9,0,1,11,7,6],[7,6,11,3,1,9,3,9,8],[2,3,7,2,7,6],[8,7,0,7,6,0,0,6,2],[1,9,0,3,7,6,3,6,2],[7,6,2,7,2,9,2,1,9,7,9,8],[1,2,10,6,11,7],[2,10,1,7,6,11,8,3,0],[11,7,6,10,9,0,10,0,2],[7,6,11,3,2,8,8,2,10,8,10,9],[6,10,7,10,1,7,7,1,3],[6,10,1,6,1,7,7,1,0,7,0,8],[9,0,3,6,9,3,6,10,9,6,3,7],[6,10,7,7,10,8,10,9,8],[8,4,6,8,6,11],[11,3,6,3,0,6,6,0,4],[0,1,9,4,6,11,4,11,8],[1,9,4,11,1,4,11,3,1,11,4,6],[3,8,2,8,4,2,2,4,6],[2,0,4,2,4,6],[1,9,0,3,8,2,2,8,4,2,4,6],[9,4,1,1,4,2,4,6,2],[10,1,2,11,8,4,11,4,6],[10,1,2,11,3,6,6,3,0,6,0,4],[0,2,10,0,10,9,4,11,8,4,6,11],[2,11,3,6,9,4,6,10,9],[8,4,6,8,6,1,6,10,1,8,1,3],[1,0,10,10,0,6,0,4,6],[8,0,3,9,6,10,9,4,6],[10,4,6,10,9,4],[9,5,4,7,6,11],[4,9,5,3,0,8,11,7,6],[6,11,7,4,0,1,4,1,5],[6,11,7,4,8,5,5,8,3,5,3,1],[4,9,5,6,2,3,6,3,7],[9,5,4,8,7,0,0,7,6,0,6,2],[4,0,1,4,1,5,6,3,7,6,2,3],[7,4,8,5,2,1,5,6,2],[6,11,7,1,2,10,9,5,4],[11,7,6,8,3,0,1,2,10,9,5,4],[11,7,6,10,5,2,2,5,4,2,4,0],[7,4,8,2,11,3,10,5,6],[4,9,5,6,10,7,7,10,1,7,1,3],[5,6,10,0,9,1,8,7,4],[5,6,10,7,0,3,7,4,0],[10,5,6,4,8,7],[5,6,9,6,11,9,9,11,8],[0,9,5,0,5,3,3,5,6,3,6,11],[0,1,5,0,5,11,5,6,11,0,11,8],[11,3,6,6,3,5,3,1,5],[9,5,6,3,9,6,3,8,9,3,6,2],[5,6,9,9,6,0,6,2,0],[0,3,8,2,5,6,2,1,5],[1,6,2,1,5,6],[1,2,10,5,6,9,9,6,11,9,11,8],[1,0,9,6,10,5,11,3,2],[6,10,5,2,8,0,2,11,8],[3,2,11,10,5,6],[10,5,6,9,3,8,9,1,3],[0,9,1,5,6,10],[8,0,3,10,5,6],[10,5,6],[10,6,5],[8,3,0,10,6,5],[0,1,9,5,10,6],[10,6,5,9,8,3,9,3,1],[3,11,2,10,6,5],[6,5,10,2,0,8,2,8,11],[1,9,0,6,5,10,11,2,3],[1,10,2,5,9,6,9,11,6,9,8,11],[1,2,6,1,6,5],[0,8,3,2,6,5,2,5,1],[5,9,6,9,0,6,6,0,2],[9,6,5,3,6,9,3,9,8,3,2,6],[11,6,3,6,5,3,3,5,1],[0,5,1,0,11,5,5,11,6,0,8,11],[0,5,9,0,3,5,3,6,5,3,11,6],[5,9,6,6,9,11,9,8,11],[10,6,5,4,7,8],[5,10,6,7,3,0,7,0,4],[5,10,6,0,1,9,8,4,7],[4,5,9,6,7,10,7,1,10,7,3,1],[7,8,4,2,3,11,10,6,5],[11,6,7,10,2,5,2,4,5,2,0,4],[11,6,7,8,0,3,1,10,2,9,4,5],[6,7,11,1,10,2,9,4,5],[7,8,4,5,1,2,5,2,6],[4,1,0,4,5,1,6,7,3,6,3,2],[9,4,5,8,0,7,0,6,7,0,2,6],[4,5,9,6,3,2,6,7,3],[6,7,11,4,5,8,5,3,8,5,1,3],[6,7,11,4,1,0,4,5,1],[4,5,9,3,8,0,11,6,7],[9,4,5,7,11,6],[10,6,4,10,4,9],[8,3,0,9,10,6,9,6,4],[1,10,0,10,6,0,0,6,4],[8,6,4,8,1,6,6,1,10,8,3,1],[2,3,11,6,4,9,6,9,10],[0,10,2,0,9,10,4,8,11,4,11,6],[10,2,1,11,6,3,6,0,3,6,4,0],[10,2,1,11,4,8,11,6,4],[9,1,4,1,2,4,4,2,6],[1,0,9,3,2,8,2,4,8,2,6,4],[2,4,0,2,6,4],[3,2,8,8,2,4,2,6,4],[1,4,9,11,4,1,11,1,3,11,6,4],[0,9,1,4,11,6,4,8,11],[11,6,3,3,6,0,6,4,0],[8,6,4,8,11,6],[6,7,10,7,8,10,10,8,9],[9,3,0,6,3,9,6,9,10,6,7,3],[6,1,10,6,7,1,7,0,1,7,8,0],[6,7,10,10,7,1,7,3,1],[7,11,6,3,8,2,8,10,2,8,9,10],[11,6,7,10,0,9,10,2,0],[2,1,10,7,11,6,8,0,3],[1,10,2,6,7,11],[7,2,6,7,9,2,2,9,1,7,8,9],[1,0,9,3,6,7,3,2,6],[8,0,7,7,0,6,0,2,6],[2,7,3,2,6,7],[7,11,6,3,9,1,3,8,9],[9,1,0,11,6,7],[0,3,8,11,6,7],[11,6,7],[11,7,5,11,5,10],[3,0,8,7,5,10,7,10,11],[9,0,1,10,11,7,10,7,5],[3,1,9,3,9,8,7,10,11,7,5,10],[10,2,5,2,3,5,5,3,7],[5,10,2,8,5,2,8,7,5,8,2,0],[9,0,1,10,2,5,5,2,3,5,3,7],[1,10,2,5,8,7,5,9,8],[2,11,1,11,7,1,1,7,5],[0,8,3,2,11,1,1,11,7,1,7,5],[9,0,2,9,2,7,2,11,7,9,7,5],[11,3,2,8,5,9,8,7,5],[1,3,7,1,7,5],[8,7,0,0,7,1,7,5,1],[0,3,9,9,3,5,3,7,5],[9,7,5,9,8,7],[4,5,8,5,10,8,8,10,11],[3,0,4,3,4,10,4,5,10,3,10,11],[0,1,9,4,5,8,8,5,10,8,10,11],[5,9,4,1,11,3,1,10,11],[3,8,4,3,4,2,2,4,5,2,5,10],[10,2,5,5,2,4,2,0,4],[0,3,8,5,9,4,10,2,1],[2,1,10,9,4,5],[8,4,5,2,8,5,2,11,8,2,5,1],[3,2,11,1,4,5,1,0,4],[9,4,5,8,2,11,8,0,2],[11,3,2,9,4,5],[4,5,8,8,5,3,5,1,3],[5,0,4,5,1,0],[3,8,0,4,5,9],[9,4,5],[7,4,11,4,9,11,11,9,10],[3,0,8,7,4,11,11,4,9,11,9,10],[11,7,4,1,11,4,1,10,11,1,4,0],[8,7,4,11,1,10,11,3,1],[2,3,7,2,7,9,7,4,9,2,9,10],[4,8,7,0,10,2,0,9,10],[2,1,10,0,7,4,0,3,7],[10,2,1,8,7,4],[2,11,7,2,7,1,1,7,4,1,4,9],[3,2,11,4,8,7,9,1,0],[7,4,11,11,4,2,4,0,2],[2,11,3,7,4,8],[9,1,4,4,1,7,1,3,7],[1,0,9,8,7,4],[3,4,0,3,7,4],[8,7,4],[8,9,10,8,10,11],[0,9,3,3,9,11,9,10,11],[1,10,0,0,10,8,10,11,8],[10,3,1,10,11,3],[3,8,2,2,8,10,8,9,10],[9,2,0,9,10,2],[8,0,3,1,10,2],[10,2,1],[2,11,1,1,11,9,11,8,9],[11,3,2,0,9,1],[11,0,2,11,8,0],[11,3,2],[8,1,3,8,9,1],[9,1,0],[8,0,3],[]]}march(b,u,p,r){let e=!!r.fulltable,i=r.hasOwnProperty("origin")&&r.origin.hasOwnProperty("x")?r.origin:{x:0,y:0,z:0},s=!!r.voxel,a=r.matrix,h=r.nX||0,t=r.nY||0,n=r.nZ||0,f=r.scale||1,o=null;r.unitCube?o=r.unitCube:o={x:f,y:f,z:f};let v=new Int32Array(h*t*n),m,E;for(m=0,E=v.length;m<E;++m)v[m]=-1;let S=function(B,R,z,U,W,F){let N={x:0,y:0,z:0},q=!!(U&1<<W),J=!!(U&1<<F),oe=W;if(!q&&J&&(oe=F),oe&1&&z++,oe&2&&R++,oe&4&&B++,a){let fe=new M.Vector3(B,R,z);fe=fe.applyMatrix4(a),N={x:fe.x,y:fe.y,z:fe.z}}else N.x=i.x+o.x*B,N.y=i.y+o.y*R,N.z=i.z+o.z*z;let le=(t*B+R)*n+z;return s?(u.push(N),u.length-1):(v[le]<0&&(v[le]=u.length,u.push(N)),v[le])},T=new Int32Array(12),P=e?this.edgeTable2:this.edgeTable,I=e?this.triTable2:this.triTable;for(m=0;m<h-1;++m)for(let B=0;B<t-1;++B)for(let R=0;R<n-1;++R){let z=0;for(let F=0;F<8;++F){let N=(t*(m+((F&4)>>2))+B+((F&2)>>1))*n+R+(F&1),q=!!(b[N]&this.ISDONE);z|=q<<F}if(z===0||z===255)continue;let U=P[z];if(U===0)continue;let W=I[z];U&1&&(T[0]=S(m,B,R,z,0,1)),U&2&&(T[1]=S(m,B,R,z,1,3)),U&4&&(T[2]=S(m,B,R,z,3,2)),U&8&&(T[3]=S(m,B,R,z,2,0)),U&16&&(T[4]=S(m,B,R,z,4,5)),U&32&&(T[5]=S(m,B,R,z,5,7)),U&64&&(T[6]=S(m,B,R,z,7,6)),U&128&&(T[7]=S(m,B,R,z,6,4)),U&256&&(T[8]=S(m,B,R,z,0,4)),U&512&&(T[9]=S(m,B,R,z,1,5)),U&1024&&(T[10]=S(m,B,R,z,3,7)),U&2048&&(T[11]=S(m,B,R,z,2,6));for(let F=0;F<W.length;F+=3){let N=T[W[F]],q=T[W[F+1]],J=T[W[F+2]];s&&F>=3&&(u.push(u[N]),N=u.length-1,u.push(u[q]),q=u.length-1,u.push(u[J]),J=u.length-1),p.push(N),p.push(q),p.push(J)}}}laplacianSmooth(b,u,p){let r=new Array(u.length),e,i,s,a,h;for(e=0,i=u.length;e<i;e++)r[e]={x:0,y:0,z:0};let t=new Array(20),n;for(e=0;e<20;e++)t[e]=new Array(u.length);for(e=0,i=u.length;e<i;e++)t[0][e]=0;for(e=0,i=p.length/3;e<i;e++){let v=e*3,m=e*3+1,E=e*3+2;for(n=!0,s=0,a=t[0][p[v]];s<a;s++)if(p[m]==t[s+1][p[v]]){n=!1;break}for(n&&(t[0][p[v]]++,t[t[0][p[v]]][p[v]]=p[m]),n=!0,s=0,a=t[0][p[v]];s<a;s++)if(p[E]==t[s+1][p[v]]){n=!1;break}for(n&&(t[0][p[v]]++,t[t[0][p[v]]][p[v]]=p[E]),n=!0,s=0,a=t[0][p[m]];s<a;s++)if(p[v]==t[s+1][p[m]]){n=!1;break}for(n&&(t[0][p[m]]++,t[t[0][p[m]]][p[m]]=p[v]),n=!0,s=0,a=t[0][p[m]];s<a;s++)if(p[E]==t[s+1][p[m]]){n=!1;break}for(n&&(t[0][p[m]]++,t[t[0][p[m]]][p[m]]=p[E]),n=!0,s=0;s<t[0][p[E]];s++)if(p[v]==t[s+1][p[E]]){n=!1;break}for(n&&(t[0][p[E]]++,t[t[0][p[E]]][p[E]]=p[v]),n=!0,s=0,a=t[0][p[E]];s<a;s++)if(p[m]==t[s+1][p[E]]){n=!1;break}n&&(t[0][p[E]]++,t[t[0][p[E]]][p[E]]=p[m])}let f=1,o=.5;for(h=0;h<b;h++){for(e=0,i=u.length;e<i;e++)if(t[0][e]<3)r[e].x=u[e].x,r[e].y=u[e].y,r[e].z=u[e].z;else if(t[0][e]==3||t[0][e]==4){for(r[e].x=0,r[e].y=0,r[e].z=0,s=0,a=t[0][e];s<a;s++)r[e].x+=u[t[s+1][e]].x,r[e].y+=u[t[s+1][e]].y,r[e].z+=u[t[s+1][e]].z;r[e].x+=o*u[e].x,r[e].y+=o*u[e].y,r[e].z+=o*u[e].z,r[e].x/=o+t[0][e],r[e].y/=o+t[0][e],r[e].z/=o+t[0][e]}else{for(r[e].x=0,r[e].y=0,r[e].z=0,s=0,a=t[0][e];s<a;s++)r[e].x+=u[t[s+1][e]].x,r[e].y+=u[t[s+1][e]].y,r[e].z+=u[t[s+1][e]].z;r[e].x+=f*u[e].x,r[e].y+=f*u[e].y,r[e].z+=f*u[e].z,r[e].x/=f+t[0][e],r[e].y/=f+t[0][e],r[e].z/=f+t[0][e]}for(e=0,i=u.length;e<i;e++)u[e].x=r[e].x,u[e].y=r[e].y,u[e].z=r[e].z}}}let _=new g;class A{constructor(b,u,p){this.data=new Int32Array(b*u*p*3),this.width=u,this.height=p}set(b,u,p,r){let e=((b*this.width+u)*this.height+p)*3;this.data[e]=r.ix,this.data[e+1]=r.iy,this.data[e+2]=r.iz}get(b,u,p){let r=((b*this.width+u)*this.height+p)*3;return{ix:this.data[r],iy:this.data[r+1],iz:this.data[r+2]}}}class c{constructor(){this.INOUT=1,this.ISDONE=2,this.ISBOUND=4,this.ptranx=0,this.ptrany=0,this.ptranz=0,this.probeRadius=1.4,this.defaultScaleFactor=2,this.scaleFactor=this.defaultScaleFactor,this.pHeight=0,this.pWidth=0,this.pLength=0,this.cutRadius=0,this.vpBits=null,this.vpDistance=null,this.vpAtomID=null,this.pminx=0,this.pminy=0,this.pminz=0,this.pmaxx=0,this.pmaxy=0,this.pmaxz=0,this.depty={},this.widxz={},this.faces=[],this.verts=[],this.vdwRadii={H:1.2,Li:1.82,Na:2.27,K:2.75,C:1.7,N:1.55,O:1.52,F:1.47,P:1.8,S:1.8,CL:1.75,BR:1.85,SE:1.9,ZN:1.39,CU:1.4,NI:1.63,X:2},this.nb=[new Int32Array([1,0,0]),new Int32Array([-1,0,0]),new Int32Array([0,1,0]),new Int32Array([0,-1,0]),new Int32Array([0,0,1]),new Int32Array([0,0,-1]),new Int32Array([1,1,0]),new Int32Array([1,-1,0]),new Int32Array([-1,1,0]),new Int32Array([-1,-1,0]),new Int32Array([1,0,1]),new Int32Array([1,0,-1]),new Int32Array([-1,0,1]),new Int32Array([-1,0,-1]),new Int32Array([0,1,1]),new Int32Array([0,1,-1]),new Int32Array([0,-1,1]),new Int32Array([0,-1,-1]),new Int32Array([1,1,1]),new Int32Array([1,1,-1]),new Int32Array([1,-1,1]),new Int32Array([-1,1,1]),new Int32Array([1,-1,-1]),new Int32Array([-1,-1,1]),new Int32Array([-1,1,-1]),new Int32Array([-1,-1,-1])],c.MarchingCube||(c.MarchingCube=new g)}getVDWIndex(b){return!b.elem||typeof this.vdwRadii[b.elem]>"u"?"X":b.elem}getFacesAndVertices(b){let u={};for(let e=0,i=b.length;e<i;e++)u[b[e]]=!0;let p=this.verts;for(let e=0,i=p.length;e<i;e++)p[e].x=p[e].x/this.scaleFactor-this.ptranx,p[e].y=p[e].y/this.scaleFactor-this.ptrany,p[e].z=p[e].z/this.scaleFactor-this.ptranz;let r=[];for(let e=0,i=this.faces.length;e<i;e+=3){let s=this.faces[e],a=this.faces[e+1],h=this.faces[e+2],t=p[s].atomid,n=p[a].atomid,f=p[h].atomid,o=t;n<o&&(o=n),f<o&&(o=f),u[o]&&s!==a&&a!==h&&s!==h&&(r.push(s),r.push(a),r.push(h))}return this.vpBits=null,this.vpDistance=null,this.vpAtomID=null,{vertices:p,faces:r}}initparm(b,u,p){p>1e6&&(this.scaleFactor=this.defaultScaleFactor/2);let r=1/this.scaleFactor*5.5;this.pminx=b[0][0],this.pmaxx=b[1][0],this.pminy=b[0][1],this.pmaxy=b[1][1],this.pminz=b[0][2],this.pmaxz=b[1][2],u?(this.pminx-=this.probeRadius+r,this.pminy-=this.probeRadius+r,this.pminz-=this.probeRadius+r,this.pmaxx+=this.probeRadius+r,this.pmaxy+=this.probeRadius+r,this.pmaxz+=this.probeRadius+r):(this.pminx-=r,this.pminy-=r,this.pminz-=r,this.pmaxx+=r,this.pmaxy+=r,this.pmaxz+=r),this.pminx=Math.floor(this.pminx*this.scaleFactor)/this.scaleFactor,this.pminy=Math.floor(this.pminy*this.scaleFactor)/this.scaleFactor,this.pminz=Math.floor(this.pminz*this.scaleFactor)/this.scaleFactor,this.pmaxx=Math.ceil(this.pmaxx*this.scaleFactor)/this.scaleFactor,this.pmaxy=Math.ceil(this.pmaxy*this.scaleFactor)/this.scaleFactor,this.pmaxz=Math.ceil(this.pmaxz*this.scaleFactor)/this.scaleFactor,this.ptranx=-this.pminx,this.ptrany=-this.pminy,this.ptranz=-this.pminz,this.pLength=Math.ceil(this.scaleFactor*(this.pmaxx-this.pminx))+1,this.pWidth=Math.ceil(this.scaleFactor*(this.pmaxy-this.pminy))+1,this.pHeight=Math.ceil(this.scaleFactor*(this.pmaxz-this.pminz))+1,this.boundingatom(u),this.cutRadius=this.probeRadius*this.scaleFactor,this.vpBits=new Uint8Array(this.pLength*this.pWidth*this.pHeight),this.vpDistance=new Float64Array(this.pLength*this.pWidth*this.pHeight),this.vpAtomID=new Int32Array(this.pLength*this.pWidth*this.pHeight)}boundingatom(b){let u={};for(const p in this.vdwRadii){let r=this.vdwRadii[p];b?u[p]=(r+this.probeRadius)*this.scaleFactor+.5:u[p]=r*this.scaleFactor+.5;let e=u[p]*u[p];this.widxz[p]=Math.floor(u[p])+1,this.depty[p]=new Int32Array(this.widxz[p]*this.widxz[p]);let i=0;for(let s=0;s<this.widxz[p];s++)for(let a=0;a<this.widxz[p];a++){let h=s*s+a*a;if(h>e)this.depty[p][i]=-1;else{let t=Math.sqrt(e-h);this.depty[p][i]=Math.floor(t)}i++}}}fillvoxels(b,u){for(let p=0,r=this.vpBits.length;p<r;p++)this.vpBits[p]=0,this.vpDistance[p]=-1,this.vpAtomID[p]=-1;for(let p in u){let r=b[u[p]];r!==void 0&&this.fillAtom(r,b)}for(let p=0,r=this.vpBits.length;p<r;p++)this.vpBits[p]&this.INOUT&&(this.vpBits[p]|=this.ISDONE)}fillAtom(b,u){let p=Math.floor(.5+this.scaleFactor*(b.x+this.ptranx)),r=Math.floor(.5+this.scaleFactor*(b.y+this.ptrany)),e=Math.floor(.5+this.scaleFactor*(b.z+this.ptranz)),i=this.getVDWIndex(b),s=0,a=this.pWidth*this.pHeight;for(let h=0,t=this.widxz[i];h<t;h++)for(let n=0;n<t;n++){if(this.depty[i][s]!=-1){for(let f=-1;f<2;f++)for(let o=-1;o<2;o++)for(let v=-1;v<2;v++)if(f!==0&&o!==0&&v!==0){let m=f*h,E=v*n;for(let S=0;S<=this.depty[i][s];S++){let T=S*o,P=p+m,I=r+T,B=e+E;if(P<0||I<0||B<0||P>=this.pLength||I>=this.pWidth||B>=this.pHeight)continue;let R=P*a+I*this.pHeight+B;if(!(this.vpBits[R]&this.INOUT))this.vpBits[R]|=this.INOUT,this.vpAtomID[R]=b.serial;else{let z=u[this.vpAtomID[R]];if(z.serial!=b.serial){let U=p+m-Math.floor(.5+this.scaleFactor*(z.x+this.ptranx)),W=r+T-Math.floor(.5+this.scaleFactor*(z.y+this.ptrany)),F=e+E-Math.floor(.5+this.scaleFactor*(z.z+this.ptranz));m*m+T*T+E*E<U*U+W*W+F*F&&(this.vpAtomID[R]=b.serial)}}}}}s++}}fillvoxelswaals(b,u){for(let p=0,r=this.vpBits.length;p<r;p++)this.vpBits[p]&=~this.ISDONE;for(let p in u){let r=b[u[p]];r!==void 0&&this.fillAtomWaals(r,b)}}fillAtomWaals(b,u){let p=0,r=Math.floor(.5+this.scaleFactor*(b.x+this.ptranx)),e=Math.floor(.5+this.scaleFactor*(b.y+this.ptrany)),i=Math.floor(.5+this.scaleFactor*(b.z+this.ptranz)),s=this.getVDWIndex(b),a=this.pWidth*this.pHeight;for(let h=0,t=this.widxz[s];h<t;h++)for(let n=0;n<t;n++){if(this.depty[s][p]!=-1){for(let f=-1;f<2;f++)for(let o=-1;o<2;o++)for(let v=-1;v<2;v++)if(f!==0&&o!==0&&v!==0){let m=f*h,E=v*n;for(let S=0;S<=this.depty[s][p];S++){let T=S*o,P=r+m,I=e+T,B=i+E;if(P<0||I<0||B<0||P>=this.pLength||I>=this.pWidth||B>=this.pHeight)continue;let R=P*a+I*this.pHeight+B;if(!(this.vpBits[R]&this.ISDONE))this.vpBits[R]|=this.ISDONE,this.vpAtomID[R]=b.serial;else{let z=u[this.vpAtomID[R]];if(z.serial!=b.serial){let U=r+m-Math.floor(.5+this.scaleFactor*(z.x+this.ptranx)),W=e+T-Math.floor(.5+this.scaleFactor*(z.y+this.ptrany)),F=i+E-Math.floor(.5+this.scaleFactor*(z.z+this.ptranz));m*m+T*T+E*E<U*U+W*W+F*F&&(this.vpAtomID[R]=b.serial)}}}}}p++}}buildboundary(){let b=this.pWidth*this.pHeight;for(let u=0;u<this.pLength;u++)for(let p=0;p<this.pHeight;p++)for(let r=0;r<this.pWidth;r++){let e=u*b+r*this.pHeight+p;if(this.vpBits[e]&this.INOUT){let i=0;for(;i<26;){let s=u+this.nb[i][0],a=p+this.nb[i][2],h=r+this.nb[i][1];if(s>-1&&s<this.pLength&&h>-1&&h<this.pWidth&&a>-1&&a<this.pHeight&&!(this.vpBits[s*b+h*this.pHeight+a]&this.INOUT)){this.vpBits[e]|=this.ISBOUND;break}else i++}}}}fastdistancemap(){let b=new A(this.pLength,this.pWidth,this.pHeight),u=this.pWidth*this.pHeight,p=this.cutRadius*this.cutRadius,r=[],e=[],i;for(let h=0;h<this.pLength;h++)for(let t=0;t<this.pWidth;t++)for(let n=0;n<this.pHeight;n++)if(i=h*u+t*this.pHeight+n,this.vpBits[i]&=~this.ISDONE,this.vpBits[i]&this.INOUT&&this.vpBits[i]&this.ISBOUND){let f={ix:h,iy:t,iz:n};b.set(h,t,n,f),r.push(f),this.vpDistance[i]=0,this.vpBits[i]|=this.ISDONE,this.vpBits[i]&=~this.ISBOUND}do{e=this.fastoneshell(r,b),r=[];for(let h=0,t=e.length;h<t;h++)i=u*e[h].ix+this.pHeight*e[h].iy+e[h].iz,this.vpBits[i]&=~this.ISBOUND,this.vpDistance[i]<=1.0404*p&&r.push({ix:e[h].ix,iy:e[h].iy,iz:e[h].iz})}while(r.length!==0);r=[],e=[],b=null;let s=this.scaleFactor-.5;s<0&&(s=0);let a=p-.5/(.1+s);for(let h=0;h<this.pLength;h++)for(let t=0;t<this.pWidth;t++)for(let n=0;n<this.pHeight;n++)i=h*u+t*this.pHeight+n,this.vpBits[i]&=~this.ISBOUND,this.vpBits[i]&this.INOUT&&(!(this.vpBits[i]&this.ISDONE)||this.vpBits[i]&this.ISDONE&&this.vpDistance[i]>=a)&&(this.vpBits[i]|=this.ISBOUND)}fastoneshell(b,u){let p,r,e,i,s,a,h,t,n,f=[];if(b.length===0)return f;let o={ix:-1,iy:-1,iz:-1},v=this.pWidth*this.pHeight;for(let m=0,E=b.length;m<E;m++){p=b[m].ix,r=b[m].iy,e=b[m].iz,t=u.get(p,r,e);for(let S=0;S<6;S++)o.ix=p+this.nb[S][0],o.iy=r+this.nb[S][1],o.iz=e+this.nb[S][2],o.ix<this.pLength&&o.ix>-1&&o.iy<this.pWidth&&o.iy>-1&&o.iz<this.pHeight&&o.iz>-1&&(n=o.ix*v+this.pHeight*o.iy+o.iz,this.vpBits[n]&this.INOUT&&!(this.vpBits[n]&this.ISDONE)?(u.set(o.ix,o.iy,e+this.nb[S][2],t),i=o.ix-t.ix,s=o.iy-t.iy,a=o.iz-t.iz,h=i*i+s*s+a*a,this.vpDistance[n]=h,this.vpBits[n]|=this.ISDONE,this.vpBits[n]|=this.ISBOUND,f.push({ix:o.ix,iy:o.iy,iz:o.iz})):this.vpBits[n]&this.INOUT&&this.vpBits[n]&this.ISDONE&&(i=o.ix-t.ix,s=o.iy-t.iy,a=o.iz-t.iz,h=i*i+s*s+a*a,h<this.vpDistance[n]&&(u.set(o.ix,o.iy,o.iz,t),this.vpDistance[n]=h,this.vpBits[n]&this.ISBOUND||(this.vpBits[n]|=this.ISBOUND,f.push({ix:o.ix,iy:o.iy,iz:o.iz})))))}for(let m=0,E=b.length;m<E;m++){p=b[m].ix,r=b[m].iy,e=b[m].iz,t=u.get(p,r,e);for(let S=6;S<18;S++)o.ix=p+this.nb[S][0],o.iy=r+this.nb[S][1],o.iz=e+this.nb[S][2],o.ix<this.pLength&&o.ix>-1&&o.iy<this.pWidth&&o.iy>-1&&o.iz<this.pHeight&&o.iz>-1&&(n=o.ix*v+this.pHeight*o.iy+o.iz,this.vpBits[n]&this.INOUT&&!(this.vpBits[n]&this.ISDONE)?(u.set(o.ix,o.iy,e+this.nb[S][2],t),i=o.ix-t.ix,s=o.iy-t.iy,a=o.iz-t.iz,h=i*i+s*s+a*a,this.vpDistance[n]=h,this.vpBits[n]|=this.ISDONE,this.vpBits[n]|=this.ISBOUND,f.push({ix:o.ix,iy:o.iy,iz:o.iz})):this.vpBits[n]&this.INOUT&&this.vpBits[n]&this.ISDONE&&(i=o.ix-t.ix,s=o.iy-t.iy,a=o.iz-t.iz,h=i*i+s*s+a*a,h<this.vpDistance[n]&&(u.set(o.ix,o.iy,o.iz,t),this.vpDistance[n]=h,this.vpBits[n]&this.ISBOUND||(this.vpBits[n]|=this.ISBOUND,f.push({ix:o.ix,iy:o.iy,iz:o.iz})))))}for(let m=0,E=b.length;m<E;m++){p=b[m].ix,r=b[m].iy,e=b[m].iz,t=u.get(p,r,e);for(let S=18;S<26;S++)o.ix=p+this.nb[S][0],o.iy=r+this.nb[S][1],o.iz=e+this.nb[S][2],o.ix<this.pLength&&o.ix>-1&&o.iy<this.pWidth&&o.iy>-1&&o.iz<this.pHeight&&o.iz>-1&&(n=o.ix*v+this.pHeight*o.iy+o.iz,this.vpBits[n]&this.INOUT&&!(this.vpBits[n]&this.ISDONE)?(u.set(o.ix,o.iy,e+this.nb[S][2],t),i=o.ix-t.ix,s=o.iy-t.iy,a=o.iz-t.iz,h=i*i+s*s+a*a,this.vpDistance[n]=h,this.vpBits[n]|=this.ISDONE,this.vpBits[n]|=this.ISBOUND,f.push({ix:o.ix,iy:o.iy,iz:o.iz})):this.vpBits[n]&this.INOUT&&this.vpBits[n]&this.ISDONE&&(i=o.ix-t.ix,s=o.iy-t.iy,a=o.iz-t.iz,h=i*i+s*s+a*a,h<this.vpDistance[n]&&(u.set(o.ix,o.iy,o.iz,t),this.vpDistance[n]=h,this.vpBits[n]&this.ISBOUND||(this.vpBits[n]|=this.ISBOUND,f.push({ix:o.ix,iy:o.iy,iz:o.iz})))))}return f}marchingcubeinit(b){for(let u=0,p=this.vpBits.length;u<p;u++)b==1?this.vpBits[u]&=~this.ISBOUND:b==4?(this.vpBits[u]&=~this.ISDONE,this.vpBits[u]&this.ISBOUND&&(this.vpBits[u]|=this.ISDONE),this.vpBits[u]&=~this.ISBOUND):b==2?this.vpBits[u]&this.ISBOUND&&this.vpBits[u]&this.ISDONE?this.vpBits[u]&=~this.ISBOUND:this.vpBits[u]&this.ISBOUND&&!(this.vpBits[u]&this.ISDONE)&&(this.vpBits[u]|=this.ISDONE):b==3&&(this.vpBits[u]&=~this.ISBOUND)}marchingcube(b){this.marchingcubeinit(b),this.verts=[],this.faces=[],c.MarchingCube.march(this.vpBits,this.verts,this.faces,{smooth:1,nX:this.pLength,nY:this.pWidth,nZ:this.pHeight});let u=this.pWidth*this.pHeight;for(let p=0,r=this.verts.length;p<r;p++)this.verts[p].atomid=this.vpAtomID[this.verts[p].x*u+this.pHeight*this.verts[p].y+this.verts[p].z];c.MarchingCube.laplacianSmooth(1,this.verts,this.faces)}}c.MarchingCube=new g},"./src/VolumeData.ts":(K,C,d)=>{d.r(C),d.d(C,{VolumeData:()=>_});var M=d("./src/utilities.ts"),L=d("./src/WebGL/math/index.ts"),w=d("./src/parsers/VASP.ts"),O=d("./src/parsers/CUBE.ts"),g=d("./node_modules/pako/dist/pako.esm.mjs");class _{constructor(c,y,b){if(this.unit={x:1,y:1,z:1},this.origin={x:0,y:0,z:0},this.size={x:0,y:0,z:0},this.data=new Float32Array([]),this.matrix=null,this.inversematrix=null,this.isbinary=new Set(["ccp4","CCP4"]),this.getCoordinates=function(i){var s=i/(this.size.y*this.size.z),a=i%(this.size.y*this.size.z),h=i%this.size.z;return s*=this.unit.x,a*=this.unit.y,h*=this.unit.z,s+=this.origin.x,a+=this.origin.y,h+=this.origin.z,{x:s,y:a,z:h}},this.vasp=function(i){var s=i.replace(/^\s+/,"").split(/[\n\r]/),a=(0,w.VASP)(i)[0],h=a.length;if(h==0){console.warn("No good formating of CHG or CHGCAR file, not atomic information provided in the file."),this.data=[];return}var t=1.889725992,n=.036749309,f=parseFloat(s[1]),o;o=s[2].replace(/^\s+/,"").split(/\s+/);var v=new L.Vector3(parseFloat(o[0]),parseFloat(o[1]),parseFloat(o[2])).multiplyScalar(f*t);o=s[3].replace(/^\s+/,"").split(/\s+/);var m=new L.Vector3(parseFloat(o[0]),parseFloat(o[1]),parseFloat(o[2])).multiplyScalar(f*t);o=s[4].replace(/^\s+/,"").split(/\s+/);var E=new L.Vector3(parseFloat(o[0]),parseFloat(o[1]),parseFloat(o[2])).multiplyScalar(f*t),S=v.x*(m.y*E.z-E.y*m.z)-m.x*(v.y*E.z-E.y*v.z)+E.x*(v.y*m.z-m.y*v.z);S=Math.abs(S)/Math.pow(t,3);var T=1/S;s.splice(0,8+h+1);var P=s[0].replace(/^\s+/,"").replace(/\s+/g," ").split(" "),I=Math.abs(parseFloat(P[0])),B=Math.abs(parseFloat(P[1])),R=Math.abs(parseFloat(P[2])),z=this.origin=new L.Vector3(0,0,0);this.size={x:I,y:B,z:R},this.unit=new L.Vector3(v.x,m.y,E.z),v=v.multiplyScalar(1/(t*I)),m=m.multiplyScalar(1/(t*B)),E=E.multiplyScalar(1/(t*R)),(v.y!=0||v.z!=0||m.x!=0||m.z!=0||E.x!=0||E.y!=0)&&(this.matrix=new L.Matrix4(v.x,m.x,E.x,0,v.y,m.y,E.y,0,v.z,m.z,E.z,0,0,0,0,1),this.matrix=this.matrix.multiplyMatrices(this.matrix,new L.Matrix4().makeTranslation(z.x,z.y,z.z)),this.origin=new L.Vector3(0,0,0),this.unit=new L.Vector3(1,1,1)),s.splice(0,1);var U=s.join(" ");U=U.replace(/^\s+/,"");var W=U.split(/[\s\r]+/);W.splice(I*B*R+1);for(var F=Float32Array.from(W,parseFloat),N=0;N<F.length;N++)F[N]=F[N]*T*n;this.data=F},this.dx=function(i){var s=i.split(/[\n\r]+/),a,h=/gridpositions\s+counts\s+(\d+)\s+(\d+)\s+(\d+)/,t=/^origin\s+(\S+)\s+(\S+)\s+(\S+)/,n=/^delta\s+(\S+)\s+(\S+)\s+(\S+)/,f=/data follows/,o=0;for(o=0;o<s.length;o++){var v=s[o];if(a=h.exec(v)){var m=parseInt(a[1]),E=parseInt(a[2]),S=parseInt(a[3]);this.size={x:m,y:E,z:S}}else if(a=n.exec(v)){var T=parseFloat(a[1]);if((parseFloat(a[2])!=0||parseFloat(a[3])!=0)&&console.warn("Non-orthogonal delta matrix not currently supported in dx format"),o+=1,v=s[o],a=n.exec(v),a==null){console.error("Parse error in dx delta matrix");return}var P=parseFloat(a[2]);if((parseFloat(a[1])!=0||parseFloat(a[3])!=0)&&console.warn("Non-orthogonal delta matrix not currently supported in dx format"),o+=1,v=s[o],a=n.exec(v),a==null){console.error("Parse error in dx delta matrix");return}var I=parseFloat(a[3]);(parseFloat(a[1])!=0||parseFloat(a[2])!=0)&&console.warn("Non-orthogonal delta matrix not currently supported in dx format"),this.unit=new L.Vector3(T,P,I)}else if(a=t.exec(v)){var B=parseFloat(a[1]),R=parseFloat(a[2]),z=parseFloat(a[3]);this.origin=new L.Vector3(B,R,z)}else if(a=f.exec(v))break}if(o+=1,!this.size||!this.origin||!this.unit||!this.size){console.error("Error parsing dx format");return}var U=s.splice(o).join(" "),W=U.split(/[\s\r]+/);this.data=Float32Array.from(W,parseFloat)},y=y.toLowerCase(),/\.gz$/.test(y)){y=y.replace(/\.gz$/,"");try{this[y]&&this.isbinary.has(y)?(typeof c=="string"&&(c=(0,M.base64ToArray)(c)),c=(0,g.inflate)(c)):c=new TextDecoder("utf-8").decode((0,g.inflate)(c))}catch(i){console.error(i)}}if(this[y]&&(this.isbinary.has(y)&&typeof c=="string"&&(c=(0,M.base64ToArray)(c)),this[y](c)),b){if(b.negate)for(let i=0,s=this.data.length;i<s;i++)this.data[i]=-this.data[i];if(b.normalize){var u=0;for(let i=0,s=this.data.length;i<s;i++)u+=this.data[i];var p=u/this.data.length;u=0;for(let i=0,s=this.data.length;i<s;i++){var r=this.data[i]-p;u+=r*r}var e=u/this.data.length;for(let i=0,s=this.data.length;i<s;i++)this.data[i]=(this.data[i]-p)/e}}}getIndex(c,y,b){if(this.matrix){this.inversematrix==null&&(this.inversematrix=new L.Matrix4().getInverse(this.matrix));var u=new L.Vector3(c,y,b);u=u.applyMatrix4(this.inversematrix),c=u.x,y=u.y,b=u.z}else c-=this.origin.x,y-=this.origin.y,b-=this.origin.z,c/=this.unit.x,y/=this.unit.y,b/=this.unit.z;return c=Math.round(c),y=Math.round(y),b=Math.round(b),c<0||c>=this.size.x||y<0||y>=this.size.y||b<0||b>=this.size.z?-1:c*this.size.y*this.size.z+y*this.size.z+b}getVal(c,y,b){let u=this.getIndex(c,y,b);return u<0?0:this.data[u]}cube(c){var y=c.split(/\r?\n/);if(!(y.length<6)){var b=(0,O.CUBE)(c,{}).modelData[0].cryst,u=y[2].replace(/^\s+/,"").replace(/\s+/g," ").split(" "),p=parseFloat(u[0]),r=Math.abs(p);this.origin=b.origin,this.size=b.size,this.unit=b.unit,this.matrix=b.matrix4;var e=6;p<0&&e++;var i=y.splice(r+e).join(" ");i=i.replace(/^\s+/,"");var s=i.split(/[\s\r]+/);this.data=Float32Array.from(s,parseFloat)}}ccp4(c){var y={};c=new Int8Array(c);var b=new Int32Array(c.buffer,0,56),u=new Float32Array(c.buffer,0,56),p=new DataView(c.buffer);if(y.MAP=String.fromCharCode(p.getUint8(208),p.getUint8(209),p.getUint8(210),p.getUint8(211)),y.MACHST=[p.getUint8(212),p.getUint8(213)],y.MACHST[0]===17&&y.MACHST[1]===17)for(var r=c.byteLength,e=0;e<r;e+=4)p.setFloat32(e,p.getFloat32(e),!0);y.NX=b[0],y.NY=b[1],y.NZ=b[2],y.MODE=b[3],y.NXSTART=b[4],y.NYSTART=b[5],y.NZSTART=b[6],y.MX=b[7],y.MY=b[8],y.MZ=b[9],y.xlen=u[10],y.ylen=u[11],y.zlen=u[12],y.alpha=u[13],y.beta=u[14],y.gamma=u[15],y.MAPC=b[16],y.MAPR=b[17],y.MAPS=b[18],y.DMIN=u[19],y.DMAX=u[20],y.DMEAN=u[21],y.ISPG=b[22],y.NSYMBT=b[23],y.LSKFLG=b[24],y.originX=u[49],y.originY=u[50],y.originZ=u[51],y.ARMS=u[54];var i=y,s=[i.xlen,0,0],a=[i.ylen*Math.cos(Math.PI/180*i.gamma),i.ylen*Math.sin(Math.PI/180*i.gamma),0],h=[i.zlen*Math.cos(Math.PI/180*i.beta),i.zlen*(Math.cos(Math.PI/180*i.alpha)-Math.cos(Math.PI/180*i.gamma)*Math.cos(Math.PI/180*i.beta))/Math.sin(Math.PI/180*i.gamma),0];h[2]=Math.sqrt(i.zlen*i.zlen*Math.sin(Math.PI/180*i.beta)*Math.sin(Math.PI/180*i.beta)-h[1]*h[1]);var t=[0,s,a,h],n=[0,i.MX,i.MY,i.MZ],f=[0,i.MAPC,i.MAPR,i.MAPS];this.matrix=new L.Matrix4,this.matrix.set(t[f[1]][0]/n[f[1]],t[f[2]][0]/n[f[2]],t[f[3]][0]/n[f[3]],0,t[f[1]][1]/n[f[1]],t[f[2]][1]/n[f[2]],t[f[3]][1]/n[f[3]],0,t[f[1]][2]/n[f[1]],t[f[2]][2]/n[f[2]],t[f[3]][2]/n[f[3]],0,0,0,0,1),this.matrix=this.matrix.multiplyMatrices(this.matrix,new L.Matrix4().makeTranslation(i.NXSTART+i.originX,i.NYSTART+i.originY,i.NZSTART+i.originZ)),this.origin=new L.Vector3(0,0,0),this.unit=new L.Vector3(1,1,1),this.size={x:y.NX,y:y.NY,z:y.NZ},this.dimensionorder=[y.MAPC,y.MAPR,y.MAPS];var o=new Float32Array(c.buffer,1024+y.NSYMBT),v=y.NX,m=y.NY,E=y.NZ;this.data=new Float32Array(v*m*E);for(let S=0;S<v;S++)for(let T=0;T<m;T++)for(let P=0;P<E;P++)this.data[(S*m+T)*E+P]=o[(P*m+T)*v+S]}}},"./src/VolumetricRender.ts":(K,C,d)=>{d.r(C),d.d(C,{GLVolumetricRender:()=>_});var M=d("./src/WebGL/shapes/index.ts"),L=d("./src/WebGL/math/index.ts"),w=d("./src/WebGL/index.ts"),O=d("./src/colors.ts"),g=d("./src/GLShape.ts");class _{static interpolateArray(c,y){function b(h,t,n){return h+(t-h)*n}var u=[],p=(c.length-1)/(y-1);u[0]=c[0];for(var r=1;r<y-1;r++){var e=r*p,i=Math.floor(e),s=Math.ceil(e),a=e-i;u[r]=b(c[i],c[s],a)}return u[y-1]=c[c.length-1],u}constructor(c,y,b){this.hidden=!1,this.boundingSphere=new M.Sphere,this.renderedShapeObj=null,this.shapeObj=null,this.subsamples=5,this.data=null,this.transferfunctionbuffer=[],this.min=0,this.max=0,y=y||{};var u=Object.assign([],y.transferfn);this.subsamples=y.subsamples||5;let p=256;u.forEach(function(m){m.value=parseFloat(m.value)}),u.sort(function(m,E){return m.value-E.value}),this.min=u[0].value,u.length==0&&u.push(u[0]),this.max=u[u.length-1].value;var r,e,i,s,a,h,t,n,f,o;for(let m=0;m<u.length-1;m++)if(i=O.CC.color(u[m].color),s=O.CC.color(u[m+1].color),f=u[m].opacity,o=u[m+1].opacity,r=Math.floor((u[m].value-this.min)*p/(this.max-this.min)),e=Math.floor((u[m+1].value-this.min)*p/(this.max-this.min)),r!=e){a=_.interpolateArray([i.r*255,s.r*255],e-r),h=_.interpolateArray([i.g*255,s.g*255],e-r),t=_.interpolateArray([i.b*255,s.b*255],e-r),n=_.interpolateArray([f*255,o*255],e-r);for(let E=0;E<a.length;E++)this.transferfunctionbuffer.push(a[E]),this.transferfunctionbuffer.push(h[E]),this.transferfunctionbuffer.push(t[E]),this.transferfunctionbuffer.push(n[E])}if(this.transferfunctionbuffer=new Uint8ClampedArray(this.transferfunctionbuffer),c.matrix){let m=new L.Vector3(0,0,0),E=new L.Vector3(c.size.x,c.size.y,c.size.z),S=new L.Vector3(1,1,1);m.applyMatrix4(c.matrix),E.applyMatrix4(c.matrix),S.applyMatrix4(c.matrix).sub(m),this.extent=[[m.x,m.y,m.z],[E.x,E.y,E.z]];for(let B=1;B<7;B++)E.x=B&1?c.size.x:0,E.y=B&2?c.size.y:0,E.z=B&4?c.size.z:0,E.applyMatrix4(c.matrix),this.extent[0][0]=Math.min(this.extent[0][0],E.x),this.extent[0][1]=Math.min(this.extent[0][1],E.y),this.extent[0][2]=Math.min(this.extent[0][2],E.z),this.extent[1][0]=Math.max(this.extent[1][0],E.x),this.extent[1][1]=Math.max(this.extent[1][1],E.y),this.extent[1][2]=Math.max(this.extent[1][2],E.z);let T=E.x-m.x,P=E.y-m.y,I=E.z-m.z;this.maxdepth=Math.sqrt(T*T+P*P+I*I),this.minunit=Math.min(Math.min(S.x,S.y),S.z),this.texmatrix=new L.Matrix4().identity().scale({x:c.size.x,y:c.size.y,z:c.size.z}),this.texmatrix=this.texmatrix.multiplyMatrices(c.matrix,this.texmatrix),this.texmatrix=this.texmatrix.getInverse(this.texmatrix)}else{this.texmatrix=new L.Matrix4().identity();let m=c.unit.x*c.size.x,E=c.unit.y*c.size.y,S=c.unit.z*c.size.z;this.texmatrix.makeTranslation(-c.origin.x/m,-c.origin.y/E,-c.origin.z/S),this.texmatrix.scale({x:1/m,y:1/E,z:1/S}),this.minunit=Math.min(Math.min(c.unit.x,c.unit.y),c.unit.z),this.extent=[[c.origin.x,c.origin.y,c.origin.z],[c.origin.x+m,c.origin.y+E,c.origin.z+S]],this.maxdepth=Math.sqrt(m*m+E*E+S*S)}var v=new g.GLShape({});if(v.addBox({corner:{x:this.extent[0][0],y:this.extent[0][1],z:this.extent[0][2]},dimensions:{w:this.extent[1][0]-this.extent[0][0],h:this.extent[1][1]-this.extent[0][1],d:this.extent[1][2]-this.extent[0][2]}}),this.geo=v.finalize(),this.boundingSphere.center=new L.Vector3((this.extent[0][0]+this.extent[1][0])/2,(this.extent[0][1]+this.extent[1][1])/2,(this.extent[0][2]+this.extent[1][2])/2),this.boundingSphere.radius=this.maxdepth/2,y.coords===void 0&&y.selection!==void 0&&(b?y.coords=b.selectedAtoms(y.selection):console.log("Need to provide viewer to volumetric renderer if selection specified.")),y.coords!==void 0&&y.seldist!==void 0){let m=new Uint8Array(c.data.length),E=y.seldist,S=E*E;for(let T=0,P=y.coords.length;T<P;T++){let I=y.coords[T],B=I.x-E,R=I.y-E,z=I.z-E,U=I.x+E,W=I.y+E,F=I.z+E;if(c.getIndex(B,R,z)>=0||c.getIndex(U,W,F)>=0)for(let N=B;N<U;N+=this.minunit)for(let q=R;q<W;q+=this.minunit)for(let J=z;J<F;J+=this.minunit){let oe=c.getIndex(N,q,J);oe>=0&&!m[oe]&&(N-I.x)*(N-I.x)+(q-I.y)*(q-I.y)+(J-I.z)*(J-I.z)<S&&(m[oe]=1)}}for(let T=0,P=c.data.length;T<P;T++)m[T]==0&&(c.data[T]=1/0)}this.data=c}globj(c){if(this.renderedShapeObj&&(c.remove(this.renderedShapeObj),this.renderedShapeObj=null),!this.hidden){this.shapeObj=new w.Object3D;var y=null,b=new w.Texture(this.data,!0),u=new w.Texture(this.transferfunctionbuffer,!1);b.needsUpdate=!0,u.needsUpdate=!0,u.flipY=!1,y=new w.VolumetricMaterial({transferfn:u,transfermin:this.min,transfermax:this.max,map:b,extent:this.extent,maxdepth:this.maxdepth,texmatrix:this.texmatrix,unit:this.minunit,subsamples:this.subsamples});var p=new w.Mesh(this.geo,y);this.shapeObj.add(p),this.renderedShapeObj=this.shapeObj.clone(),c.add(this.renderedShapeObj)}}removegl(c){this.renderedShapeObj&&(this.renderedShapeObj.geometry!==void 0&&this.renderedShapeObj.geometry.dispose(),this.renderedShapeObj.material!==void 0&&this.renderedShapeObj.material.dispose(),c.remove(this.renderedShapeObj),this.renderedShapeObj=null),this.shapeObj=null}get position(){return this.boundingSphere.center}get x(){return this.boundingSphere.center.x}get y(){return this.boundingSphere.center.y}get z(){return this.boundingSphere.center.z}}},"./src/WebGL/Camera.ts":(K,C,d)=>{d.r(C),d.d(C,{Camera:()=>w});var M=d("./src/WebGL/core/index.ts"),L=d("./src/WebGL/math/index.ts");class w extends M.Object3D{constructor(g=50,_=1,A=.1,c=2e3,y=!1){super(),this.projectionMatrix=new L.Matrix4,this.projectionMatrixInverse=new L.Matrix4,this.matrixWorldInverse=new L.Matrix4,this.fov=g,this.aspect=_,this.near=A,this.far=c;var b=this.position.z;this.right=b*Math.tan(Math.PI/180*g),this.left=-this.right,this.top=this.right/this.aspect,this.bottom=-this.top,this.ortho=!!y,this.updateProjectionMatrix()}lookAt(g){this.matrix.lookAt(this.position,g,this.up),this.rotationAutoUpdate&&(this.useQuaternion===!1&&this.rotation instanceof L.Vector3?this.rotation.setEulerFromRotationMatrix(this.matrix,this.eulerOrder):console.error("Unimplemented math operation."))}updateProjectionMatrix(){this.ortho?this.projectionMatrix.makeOrthographic(this.left,this.right,this.top,this.bottom,this.near,this.far):this.projectionMatrix.makePerspective(this.fov,this.aspect,this.near,this.far),this.projectionMatrixInverse.getInverse(this.projectionMatrix)}}},"./src/WebGL/Fog.ts":(K,C,d)=>{d.r(C),d.d(C,{Fog:()=>L});var M=d("./src/colors.ts");class L{constructor(O,g=1,_=1e3){this.name="",this.color=new M.Color(O),this.near=g,this.far=_}clone(){return new L(this.color.getHex(),this.near,this.far)}}},"./src/WebGL/Renderer.ts":(K,C,d)=>{d.r(C),d.d(C,{Renderer:()=>r});var M=d("./src/WebGL/Camera.ts"),L=d("./src/WebGL/constants/Sides.ts"),w=d("./src/WebGL/constants/TextureConstants.ts"),O=d("./src/WebGL/core/index.ts"),g=d("./src/colors.ts"),_=d("./src/WebGL/materials/index.ts"),A=d("./src/WebGL/math/index.ts"),c=d("./src/WebGL/objects/index.ts"),y=d("./src/WebGL/shaders/index.ts"),b=d("./src/WebGL/SpritePlugin.ts"),u=null,p=null;class r{constructor(i){this.context=null,this.devicePixelRatio=1,this.sortObjects=!0,this.autoUpdateObjects=!0,this.autoUpdateScene=!0,this.info={memory:{programs:0,geometries:0,textures:0},render:{calls:0,vertices:0,faces:0,points:0}},this._offscreen=null,this._bitmap=null,this._programs=[],this._programs_counter=0,this._webglversion=1,this._currentProgram=null,this._currentMaterialId=-1,this._currentGeometryGroupHash=null,this._currentCamera=null,this._geometryGroupCounter=0,this._oldDoubleSided=-1,this._oldFlipSided=-1,this._oldDepthTest=-1,this._oldDepthWrite=-1,this._oldPolygonOffset=null,this._oldLineWidth=null,this._viewportWidth=0,this._viewportHeight=0,this._currentWidth=0,this._currentHeight=0,this._enabledAttributes={},this._vector3=new A.Vector3,this._worldInverse=new A.Matrix4,this._projInverse=new A.Matrix4,this._textureMatrix=new A.Matrix4,this._fullProjModelMatrix=new A.Matrix4,this._fullProjModelMatrixInv=new A.Matrix4,this._direction=new A.Vector3,this._lightsNeedUpdate=!0,this._lights={ambient:[0,0,0],directional:{length:0,colors:[],positions:[]},point:{length:0,colors:[],positions:[],distances:[]},spot:{length:0,colors:[],positions:[],distances:[],directions:[],anglesCos:[],exponents:[]},hemi:{length:0,skyColors:[],groundColors:[],positions:[]}},this.sprites=new b.SpritePlugin,this._screenshader=null,this._AOshader=null,this._blurshader=null,this._vertexattribpos=null,this._aovertexattribpos=null,this._blurvertexattribpos=null,this._screenQuadVBO=null,this._fb=null,this._targetTexture=null,this._depthTexture=null,this._shadingTexture=null,this._scratchTexture=null,this._AOstrength=1,this._AOradius=5,this.SHADE_TEXTURE=3,i=i||{},this.row=i.row,this.col=i.col,this.rows=i.rows,this.cols=i.cols,this._canvas=i.canvas!==void 0?i.canvas:document.createElement("canvas"),this._precision=i.precision!==void 0?i.precision:"highp",this._alpha=i.alpha!==void 0?i.alpha:!0,this._premultipliedAlpha=i.premultipliedAlpha!==void 0?i.premultipliedAlpha:!0,this._antialias=i.antialias!==void 0?i.antialias:!1,this._preserveDrawingBuffer=i.preserveDrawingBuffer!==void 0?i.preserveDrawingBuffer:!1,this._clearColor=i.clearColor!==void 0?new g.Color(i.clearColor):new g.Color(0),this._clearAlpha=i.clearAlpha!==void 0?i.clearAlpha:0,this._outlineMaterial=new _.MeshOutlineMaterial(i.outline),this._outlineSphereImposterMaterial=new _.SphereImposterOutlineMaterial(i.outline),this._outlineStickImposterMaterial=new _.StickImposterOutlineMaterial(i.outline),this._outlineEnabled=!!i.outline,this._AOEnabled=!!i.ambientOcclusion,i.ambientOcclusion&&typeof i.ambientOcclusion.strength<"u"&&(this._AOstrength=parseFloat(i.ambientOcclusion.strength)),this._AOstrength==0&&(this._AOEnabled=!1),i.ambientOcclusion&&typeof i.ambientOcclusion.radius<"u"&&(this._AOradius=parseFloat(i.ambientOcclusion.radius)),this.domElement=this._canvas,this._canvas.id=i.id,!(i.containerWidth==0||i.containerHeight==0)&&(this.initGL(),this.setDefaultGLState(),this.context=this._gl,this.isWebGL1()?this._extInstanced=this._gl.getExtension("ANGLE_instanced_arrays"):this._extInstanced={vertexAttribDivisorANGLE:this._gl.vertexAttribDivisor.bind(this._gl),drawElementsInstancedANGLE:this._gl.drawElementsInstanced.bind(this._gl)},this._extFragDepth=this._gl.getExtension("EXT_frag_depth"),this._extFloatLinear=this._gl.getExtension("OES_texture_float_linear"),this._extColorBufferFloat=this._gl.getExtension("EXT_color_buffer_float"),this.sprites.init(this))}supportedExtensions(){return{supportsAIA:!!this._extInstanced,supportsImposters:!!this._extFragDepth||!this.isWebGL1(),regen:!1}}getContext(){return this._gl}getCanvas(){return this._canvas}isLost(){return this._gl==null||this._gl.isContextLost()}getPrecision(){return this._precision}setClearColorHex(i,s){this._clearColor.setHex(i),this._clearAlpha=s,this.isLost()||this._gl.clearColor(this._clearColor.r,this._clearColor.g,this._clearColor.b,this._clearAlpha)}enableOutline(i){this._outlineMaterial=new _.MeshOutlineMaterial(i),this._outlineSphereImposterMaterial=new _.SphereImposterOutlineMaterial(i),this._outlineStickImposterMaterial=new _.StickImposterOutlineMaterial(i),this._outlineEnabled=!0}disableOutline(){this._outlineEnabled=!1}enableAmbientOcclusion(i){i&&(i.strength&&(this._AOstrength=i.strength),i.scale&&(this._AOradius=i.scale)),this._AOEnabled=this._AOstrength>0}disableAmbientOcclusion(){this._AOEnabled=!1}setViewport(){if(this._offscreen&&(this._offscreen.width=this._canvas.width,this._offscreen.height=this._canvas.height),this.rows!=null&&this.cols!=null&&this.row!=null&&this.col!=null){var i=this._canvas.width/this.cols,s=this._canvas.height/this.rows;this._viewportWidth=i,this._viewportHeight=s,this.isLost()||(this._gl.enable(this._gl.SCISSOR_TEST),this._gl.scissor(i*this.col,s*this.row,i,s),this._gl.viewport(i*this.col,s*this.row,i,s))}}setSize(i,s){if(this.devicePixelRatio=window.devicePixelRatio!==void 0?window.devicePixelRatio:1,this._antialias&&this.devicePixelRatio<2&&(this.devicePixelRatio*=2),this.rows!=null&&this.cols!=null&&this.row!=null&&this.col!=null){var a=i/this.cols,h=s/this.rows;this._canvas.width=i*this.devicePixelRatio,this._canvas.height=s*this.devicePixelRatio,this._viewportWidth=a*this.devicePixelRatio,this._viewportHeight=h*this.devicePixelRatio,this._canvas.style.width=i+"px",this._canvas.style.height=s+"px",this.setViewport()}else this._viewportWidth=this._canvas.width=i*this.devicePixelRatio,this._viewportHeight=this._canvas.height=s*this.devicePixelRatio,this._canvas.style.width=i+"px",this._canvas.style.height=s+"px",this.isLost()||this._gl.viewport(0,0,this._gl.drawingBufferWidth,this._gl.drawingBufferHeight);this.initFrameBuffer()}clear(i,s,a){var h=0;(i===void 0||i)&&(h|=this._gl.COLOR_BUFFER_BIT),(s===void 0||s)&&(h|=this._gl.DEPTH_BUFFER_BIT),(a===void 0||a)&&(h|=this._gl.STENCIL_BUFFER_BIT),this._gl.clear(h)}setMaterialFaces(i,s){var a=i.side===L.DoubleSide,h=i.side===L.BackSide;i.imposter||(h=s?!h:h),this._oldDoubleSided!==a&&(a?this._gl.disable(this._gl.CULL_FACE):this._gl.enable(this._gl.CULL_FACE),this._oldDoubleSided=a),this._oldFlipSided!==h&&(h?this._gl.frontFace(this._gl.CW):this._gl.frontFace(this._gl.CCW),this._oldFlipSided=h),this._gl.cullFace(this._gl.BACK)}setDepthTest(i){this._oldDepthTest!==i&&(i?this._gl.enable(this._gl.DEPTH_TEST):this._gl.disable(this._gl.DEPTH_TEST),this._oldDepthTest=i)}setDepthWrite(i){this._oldDepthWrite!==i&&(this._gl.depthMask(i),this._oldDepthWrite=i)}setBlending(i){i?(this._gl.enable(this._gl.BLEND),this._gl.blendEquationSeparate(this._gl.FUNC_ADD,this._gl.FUNC_ADD),this._gl.blendFuncSeparate(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA)):this._gl.disable(this._gl.BLEND)}initMaterial(i,s,a,h){i.addEventListener("dispose",this.onMaterialDispose.bind(this));var t,n;if(n=i.shaderID,n){var f=y.ShaderLib[n];i.vertexShader=f.vertexShader,i.fragmentShader=f.fragmentShader,i.uniforms=y.ShaderUtils.clone(f.uniforms),i.shaded&&i.makeShaded(this.SHADE_TEXTURE)}t={wireframe:i.wireframe,fragdepth:i.imposter,volumetric:i.volumetric,shaded:i.shaded},i.program=this.buildProgram(i.fragmentShader,i.vertexShader,i.uniforms,t)}renderBuffer(i,s,a,h,t,n){if(h.visible){var f,o;if(f=this.setProgram(i,s,a,h,n,this),!!f){o=f.attributes;var v=!1,m=h.wireframe?1:0,E=t.id*16777215+f.id*2+m;E!==this._currentGeometryGroupHash&&(this._currentGeometryGroupHash=E,v=!0),v&&(this.disableAttributes(),o.position>=0&&(this._gl.bindBuffer(this._gl.ARRAY_BUFFER,t.__webglVertexBuffer),this.enableAttribute(o.position),this._gl.vertexAttribPointer(o.position,3,this._gl.FLOAT,!1,0,0)),o.color>=0&&(this._gl.bindBuffer(this._gl.ARRAY_BUFFER,t.__webglColorBuffer),this.enableAttribute(o.color),this._gl.vertexAttribPointer(o.color,3,this._gl.FLOAT,!1,0,0)),o.normal>=0&&(this._gl.bindBuffer(this._gl.ARRAY_BUFFER,t.__webglNormalBuffer),this.enableAttribute(o.normal),this._gl.vertexAttribPointer(o.normal,3,this._gl.FLOAT,!1,0,0)),o.offset>=0&&(this._gl.bindBuffer(this._gl.ARRAY_BUFFER,t.__webglOffsetBuffer),this.enableAttribute(o.offset),this._gl.vertexAttribPointer(o.offset,3,this._gl.FLOAT,!1,0,0)),o.radius>=0&&(this._gl.bindBuffer(this._gl.ARRAY_BUFFER,t.__webglRadiusBuffer),this.enableAttribute(o.radius),this._gl.vertexAttribPointer(o.radius,1,this._gl.FLOAT,!1,0,0)));var S,T;if(n instanceof c.Mesh){if(h.shaderID==="instanced"){var P=h.sphere.geometryGroups[0];v&&(this._gl.bindBuffer(this._gl.ARRAY_BUFFER,t.__webglVertexBuffer),this._gl.bufferData(this._gl.ARRAY_BUFFER,P.vertexArray,this._gl.STATIC_DRAW),this._gl.bindBuffer(this._gl.ARRAY_BUFFER,t.__webglNormalBuffer),this._gl.bufferData(this._gl.ARRAY_BUFFER,P.normalArray,this._gl.STATIC_DRAW),this._gl.bindBuffer(this._gl.ELEMENT_ARRAY_BUFFER,t.__webglFaceBuffer),this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER,P.faceArray,this._gl.STATIC_DRAW)),S=P.faceidx,this._extInstanced.vertexAttribDivisorANGLE(o.offset,1),this._extInstanced.vertexAttribDivisorANGLE(o.radius,1),this._extInstanced.vertexAttribDivisorANGLE(o.color,1),this._extInstanced.drawElementsInstancedANGLE(this._gl.TRIANGLES,S,this._gl.UNSIGNED_SHORT,0,t.radiusArray.length),this._extInstanced.vertexAttribDivisorANGLE(o.offset,0),this._extInstanced.vertexAttribDivisorANGLE(o.radius,0),this._extInstanced.vertexAttribDivisorANGLE(o.color,0)}else h.wireframe?(T=t.lineidx,this.setLineWidth(h.wireframeLinewidth),v&&this._gl.bindBuffer(this._gl.ELEMENT_ARRAY_BUFFER,t.__webglLineBuffer),this._gl.drawElements(this._gl.LINES,T,this._gl.UNSIGNED_SHORT,0)):(S=t.faceidx,v&&this._gl.bindBuffer(this._gl.ELEMENT_ARRAY_BUFFER,t.__webglFaceBuffer),this._gl.drawElements(this._gl.TRIANGLES,S,this._gl.UNSIGNED_SHORT,0));this.info.render.calls++,this.info.render.vertices+=S,this.info.render.faces+=S/3}else n instanceof c.Line&&(T=t.vertices,this.setLineWidth(h.linewidth),this._gl.drawArrays(this._gl.LINES,0,T),this.info.render.calls++)}}}clearShading(){this._gl.framebufferTexture2D(this._gl.FRAMEBUFFER,this._gl.DEPTH_ATTACHMENT,this._gl.TEXTURE_2D,this._shadingTexture,0),this.clear(!1,!0,!1),this._gl.framebufferTexture2D(this._gl.FRAMEBUFFER,this._gl.DEPTH_ATTACHMENT,this._gl.TEXTURE_2D,this._depthTexture,0)}setShading(i,s,a){let h=i.__lights,t=i.fog,n=[];for(let v=0,m=i.__webglObjects.length;v<m;v++){let E=i.__webglObjects[v];E.render&&E[a]&&n.push(E)}if(n.length==0)return;this._gl.framebufferTexture2D(this._gl.FRAMEBUFFER,this._gl.DEPTH_ATTACHMENT,this._gl.TEXTURE_2D,this._shadingTexture,0),this._gl.framebufferTexture2D(this._gl.FRAMEBUFFER,this._gl.COLOR_ATTACHMENT0,this._gl.TEXTURE_2D,null,0),this.renderObjects(i.__webglObjects,!0,a+"Depth",s,h,t,!1),this._gl.framebufferTexture2D(this._gl.FRAMEBUFFER,this._gl.DEPTH_ATTACHMENT,this._gl.TEXTURE_2D,this._scratchTexture,0),this.clear(!1,!0,!1),this._gl.useProgram(this._AOshader),this._currentProgram=this._AOshader,this.setDepthTest(-1),this.setDepthWrite(-1);let f=this._AOshader.uniforms;this._gl.uniform1f(f.total_strength,this._AOstrength),this._gl.uniform1f(f.radius,this._AOradius),this._fullProjModelMatrix=new A.Matrix4,this._fullProjModelMatrixInv=new A.Matrix4;let o=n[0].object;this._fullProjModelMatrix.multiplyMatrices(s.projectionMatrix,o._modelViewMatrix),this._fullProjModelMatrixInv.getInverse(this._fullProjModelMatrix),this._gl.uniformMatrix4fv(f.projectionMatrix,!1,this._fullProjModelMatrix.elements),this._gl.uniformMatrix4fv(f.projinv,!1,this._fullProjModelMatrixInv.elements),this._gl.bindBuffer(this._gl.ARRAY_BUFFER,this._screenQuadVBO),this._gl.enableVertexAttribArray(this._aovertexattribpos),this._gl.vertexAttribPointer(this._aovertexattribpos,2,this._gl.FLOAT,!1,0,0),this._gl.activeTexture(this._gl.TEXTURE0),this._gl.bindTexture(this._gl.TEXTURE_2D,this._shadingTexture),this._gl.drawArrays(this._gl.TRIANGLES,0,6),this._gl.framebufferTexture2D(this._gl.FRAMEBUFFER,this._gl.DEPTH_ATTACHMENT,this._gl.TEXTURE_2D,this._shadingTexture,0),this.clear(!1,!0,!1),this._gl.useProgram(this._blurshader),this._currentProgram=this._blurshader,this.setDepthTest(-1),this.setDepthWrite(-1),this._gl.bindBuffer(this._gl.ARRAY_BUFFER,this._screenQuadVBO),this._gl.enableVertexAttribArray(this._blurvertexattribpos),this._gl.vertexAttribPointer(this._blurvertexattribpos,2,this._gl.FLOAT,!1,0,0),this._gl.activeTexture(this._gl.TEXTURE0),this._gl.bindTexture(this._gl.TEXTURE_2D,this._scratchTexture),this._gl.drawArrays(this._gl.TRIANGLES,0,6),this._gl.framebufferTexture2D(this._gl.FRAMEBUFFER,this._gl.COLOR_ATTACHMENT0,this._gl.TEXTURE_2D,this._targetTexture,0),this._gl.framebufferTexture2D(this._gl.FRAMEBUFFER,this._gl.DEPTH_ATTACHMENT,this._gl.TEXTURE_2D,this._depthTexture,0)}render(i,s){if(!(s instanceof M.Camera)){console.error("Renderer.render: camera is not an instance of Camera.");return}var a,h,t,n,f,o=i.__lights,v=i.fog;if(this._currentMaterialId=-1,this._lightsNeedUpdate=!0,this.autoUpdateScene&&i.updateMatrixWorld(),s.parent===void 0&&s.updateMatrixWorld(),s.matrixWorldInverse.getInverse(s.matrixWorld),this.isLost())return;this.autoUpdateObjects&&this.initWebGLObjects(i),this.info.render.calls=0,this.info.render.vertices=0,this.info.render.faces=0,this.info.render.points=0,this._currentWidth=this._viewportWidth,this._currentHeight=this._viewportHeight,this.setViewport(),this.setFrameBuffer(),this._gl.clearColor(this._clearColor.r,this._clearColor.g,this._clearColor.b,this._clearAlpha),this.clear(!0,!0,!0),f=i.__webglObjects;let m=!1,E=this._AOEnabled;for(a=0,h=f.length;a<h;a++)t=f[a],n=t.object,t.render=!1,n.visible&&(this.setupMatrices(n,s),this.unrollBufferMaterial(t),t.render=!0,t.volumetric&&(m=!0),t.hasAO&&(E=!0));if(this.setBlending(!1),E&&this.setShading(i,s,"opaque"),this.renderObjects(i.__webglObjects,!0,"opaque",s,o,v,!1),E&&this.clearShading(),this.renderSprites(i,s,!1),this.renderObjects(i.__webglObjects,!0,"transparentDepth",s,o,v,!0),this.renderObjects(i.__webglObjects,!1,"transparent",s,o,v,!0),m&&this._fb&&(this._gl.framebufferTexture2D(this._gl.FRAMEBUFFER,this._gl.DEPTH_ATTACHMENT,this._gl.TEXTURE_2D,null,0),this.renderObjects(i.__webglObjects,!1,"volumetric",s,o,v,!0)),this.renderFrameBuffertoScreen(),this.setDepthTest(!0),this.setDepthWrite(!0),this.renderSprites(i,s,!0),this._bitmap){const S=this._offscreen.transferToImageBitmap();this._bitmap.transferFromImageBitmap(S),S.close()}}setFrameBuffer(){if(this.isWebGL1()||!this._fb)return;let i=this._viewportWidth,s=this._viewportHeight;this._gl.enable(this._gl.SCISSOR_TEST),this._gl.scissor(0,0,i,s),this._gl.viewport(0,0,i,s),this._gl.bindTexture(this._gl.TEXTURE_2D,this._targetTexture),this._gl.texImage2D(this._gl.TEXTURE_2D,0,this._gl.RGBA,i,s,0,this._gl.RGBA,this._gl.UNSIGNED_BYTE,null),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MIN_FILTER,this._gl.LINEAR),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MAG_FILTER,this._gl.LINEAR),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_S,this._gl.CLAMP_TO_EDGE),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_T,this._gl.CLAMP_TO_EDGE),this._gl.bindTexture(this._gl.TEXTURE_2D,this._depthTexture),this._gl.texImage2D(this._gl.TEXTURE_2D,0,this._gl.DEPTH_COMPONENT32F,i,s,0,this._gl.DEPTH_COMPONENT,this._gl.FLOAT,null),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MIN_FILTER,this._gl.NEAREST),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MAG_FILTER,this._gl.NEAREST),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_S,this._gl.CLAMP_TO_EDGE),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_T,this._gl.CLAMP_TO_EDGE),this._shadingTexture&&(this._gl.deleteTexture(this._shadingTexture),this._shadingTexture=this._gl.createTexture(),this._gl.bindTexture(this._gl.TEXTURE_2D,this._shadingTexture),this._gl.texImage2D(this._gl.TEXTURE_2D,0,this._gl.DEPTH_COMPONENT32F,i,s,0,this._gl.DEPTH_COMPONENT,this._gl.FLOAT,null),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MIN_FILTER,this._gl.NEAREST),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MAG_FILTER,this._gl.NEAREST),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_S,this._gl.CLAMP_TO_EDGE),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_T,this._gl.CLAMP_TO_EDGE),this._gl.deleteTexture(this._scratchTexture),this._scratchTexture=this._gl.createTexture(),this._gl.bindTexture(this._gl.TEXTURE_2D,this._scratchTexture),this._gl.texImage2D(this._gl.TEXTURE_2D,0,this._gl.DEPTH_COMPONENT32F,i,s,0,this._gl.DEPTH_COMPONENT,this._gl.FLOAT,null),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MIN_FILTER,this._gl.NEAREST),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MAG_FILTER,this._gl.NEAREST),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_S,this._gl.CLAMP_TO_EDGE),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_T,this._gl.CLAMP_TO_EDGE)),this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,this._fb),this._gl.framebufferTexture2D(this._gl.FRAMEBUFFER,this._gl.COLOR_ATTACHMENT0,this._gl.TEXTURE_2D,this._targetTexture,0),this._gl.framebufferTexture2D(this._gl.FRAMEBUFFER,this._gl.DEPTH_ATTACHMENT,this._gl.TEXTURE_2D,this._shadingTexture,0),this._gl.clearDepth(1),this._gl.clear(this._gl.DEPTH_BUFFER_BIT),this._gl.framebufferTexture2D(this._gl.FRAMEBUFFER,this._gl.DEPTH_ATTACHMENT,this._gl.TEXTURE_2D,this._depthTexture,0)}initFrameBuffer(){if(this.isWebGL1())return;let i=this._viewportWidth,s=this._viewportHeight;this._gl.enable(this._gl.SCISSOR_TEST),this._gl.scissor(0,0,i,s),this._gl.viewport(0,0,i,s),this._targetTexture=this._gl.createTexture(),this._depthTexture=this._gl.createTexture(),this._shadingTexture=this._gl.createTexture(),this._scratchTexture=this._gl.createTexture(),this._fb=this._gl.createFramebuffer();var a=this._antialias?y.ShaderLib.screenaa:y.ShaderLib.screen;this._screenshader=this.buildProgram(a.fragmentShader,a.vertexShader,a.uniforms,{}),this._vertexattribpos=this._gl.getAttribLocation(this._screenshader,"vertexPosition");var h=[1,1,-1,1,-1,-1,-1,-1,1,-1,1,1];this._screenQuadVBO=this._gl.createBuffer(),this._gl.bindBuffer(this._gl.ARRAY_BUFFER,this._screenQuadVBO),this._gl.bufferData(this._gl.ARRAY_BUFFER,new Float32Array(h),this._gl.STATIC_DRAW);let t=y.ShaderLib.ssao;this._AOshader=this.buildProgram(t.fragmentShader,t.vertexShader,t.uniforms,{}),this._aovertexattribpos=this._gl.getAttribLocation(this._AOshader,"vertexPosition");let n=y.ShaderLib.blur;this._blurshader=this.buildProgram(n.fragmentShader,n.vertexShader,n.uniforms,{}),this._blurvertexattribpos=this._gl.getAttribLocation(this._blurshader,"vertexPosition")}renderFrameBuffertoScreen(){this.isWebGL1()||this._fb===null||(this.setViewport(),this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,null),this._gl.clear(this._gl.COLOR_BUFFER_BIT|this._gl.DEPTH_BUFFER_BIT),this._gl.frontFace(this._gl.CCW),this._gl.cullFace(this._gl.BACK),this._gl.useProgram(this._screenshader),this._currentProgram=this._screenshader,this.setDepthTest(-1),this.setDepthWrite(-1),this._gl.bindBuffer(this._gl.ARRAY_BUFFER,this._screenQuadVBO),this._gl.enableVertexAttribArray(this._vertexattribpos),this._gl.vertexAttribPointer(this._vertexattribpos,2,this._gl.FLOAT,!1,0,0),this._gl.activeTexture(this._gl.TEXTURE0),this._gl.bindTexture(this._gl.TEXTURE_2D,this._targetTexture),this._gl.drawArrays(this._gl.TRIANGLES,0,6))}initWebGLObjects(i){if(i.__webglObjects||(i.__webglObjects=[],i.__webglObjectsImmediate=[],i.__webglSprites=[],i.__webglFlares=[]),i.__objectsAdded.length){for(;i.__objectsAdded.length;)this.addObject(i.__objectsAdded[0],i),i.__objectsAdded.splice(0,1);this._currentGeometryGroupHash=-1}for(;i.__objectsRemoved.length;)this.removeObject(i.__objectsRemoved[0],i),i.__objectsRemoved.splice(0,1);for(var s=0,a=i.__webglObjects.length;s<a;s++)this.updateObject(i.__webglObjects[s].object)}getYRatio(){return this.rows!==void 0&&this.row!==void 0?this.rows:1}getXRatio(){return this.cols!==void 0&&this.col!==void 0?this.cols:1}getAspect(i,s){(i==null||s==null)&&(i=this._canvas.width,s=this._canvas.height);var a=i/s;if(this.rows!=null&&this.cols!=null&&this.row!=null&&this.col!=null){var h=i/this.cols,t=s/this.rows;a=h/t}return a}setTexture(i,s,a){if(i.needsUpdate){i.__webglInit||(i.__webglInit=!0,i.addEventListener("dispose",this.onTextureDispose.bind(this)),i.__webglTexture=this._gl.createTexture(),this.info.memory.textures++),this._gl.activeTexture(this._gl.TEXTURE0+s);var h=a?this._gl.TEXTURE_3D:this._gl.TEXTURE_2D;this._gl.bindTexture(h,i.__webglTexture),this._gl.pixelStorei(this._gl.UNPACK_FLIP_Y_WEBGL,i.flipY),this._gl.pixelStorei(this._gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,i.premultiplyAlpha),this._gl.pixelStorei(this._gl.UNPACK_ALIGNMENT,i.unpackAlignment),this._gl.pixelStorei(this._gl.PACK_ALIGNMENT,i.unpackAlignment);var t=this.paramToGL(i.format),n=this.paramToGL(i.type);if(a)this.setTextureParameters(this._gl.TEXTURE_3D,i),this._gl.texImage3D(this._gl.TEXTURE_3D,0,this._gl.R32F,i.image.size.z,i.image.size.y,i.image.size.x,0,this._gl.RED,this._gl.FLOAT,i.image.data);else{var f=i.image,o=f.width,v=f.height;typeof o>"u"&&(o=f.length,t==this._gl.RGBA&&(o/=4),v=1),this.setTextureParameters(this._gl.TEXTURE_2D,i),this.isWebGL1()?this._gl.texImage2D(this._gl.TEXTURE_2D,0,t,t,n,i.image):this._gl.texImage2D(this._gl.TEXTURE_2D,0,t,o,v,0,t,n,i.image)}i.needsUpdate=!1,i.onUpdate&&i.onUpdate()}else this._gl.activeTexture(this._gl.TEXTURE0+s),a?this._gl.bindTexture(this._gl.TEXTURE_3D,i.__webglTexture):this._gl.bindTexture(this._gl.TEXTURE_2D,i.__webglTexture)}supportsVolumetric(){return!this.isWebGL1()}enableAttribute(i){this._enabledAttributes[i]||(this._gl.enableVertexAttribArray(i),this._enabledAttributes[i]=!0)}disableAttributes(){for(let i in this._enabledAttributes)this._enabledAttributes[i]&&(this._gl.disableVertexAttribArray(i),this._enabledAttributes[i]=!1)}setPolygonOffset(i,s,a){this._oldPolygonOffset!==i&&(i?this._gl.enable(this._gl.POLYGON_OFFSET_FILL):this._gl.disable(this._gl.POLYGON_OFFSET_FILL))}setLineWidth(i){i!==this._oldLineWidth&&(this._gl.lineWidth(i),this._oldLineWidth=i)}deallocateGeometry(i){if(i.__webglInit=void 0,i.__webglVertexBuffer!==void 0&&this._gl.deleteBuffer(i.__webglVertexBuffer),i.__webglColorBuffer!==void 0&&this._gl.deleteBuffer(i.__webglColorBuffer),i.geometryGroups!==void 0)for(var s=0,a=i.groups;s<a;s++){var h=i.geometryGroups[s];h.__webglVertexBuffer!==void 0&&this._gl.deleteBuffer(h.__webglVertexBuffer),h.__webglColorBuffer!==void 0&&this._gl.deleteBuffer(h.__webglColorBuffer),h.__webglNormalBuffer!==void 0&&this._gl.deleteBuffer(h.__webglNormalBuffer),h.__webglFaceBuffer!==void 0&&this._gl.deleteBuffer(h.__webglFaceBuffer),h.__webglLineBuffer!==void 0&&this._gl.deleteBuffer(h.__webglLineBuffer)}}deallocateMaterial(i){var s=i.program;if(s!==void 0){i.program=void 0;var a,h,t,n=!1;for(a=0,h=this._programs.length;a<h;a++)if(t=this._programs[a],t.program===s){t.usedTimes--,t.usedTimes===0&&(n=!0);break}if(n===!0){var f=[];for(a=0,h=this._programs.length;a<h;a++)t=this._programs[a],t.program!==s&&f.push(t);this._programs=f,this._gl.deleteProgram(s),this.info.memory.programs--}}}deallocateTexture(i){if(i.image&&i.image.__webglTextureCube)this._gl.deleteTexture(i.image.__webglTextureCube);else{if(!i.__webglInit)return;i.__webglInit=!1,this._gl.deleteTexture(i.__webglTexture)}}onGeometryDispose(i){var s=i.target;s.removeEventListener("dispose",this.onGeometryDispose),this.deallocateGeometry(s),this.info.memory.geometries--}onTextureDispose(i){var s=i.target;s.removeEventListener("dispose",this.onTextureDispose),this.deallocateTexture(s),this.info.memory.textures--}onMaterialDispose(i){var s=i.target;s.removeEventListener("dispose",this.onMaterialDispose),this.deallocateMaterial(s)}getShader(i,s){var a;return!this.isWebGL1()&&!s.startsWith("#version")&&(s=s.replace(/gl_FragDepthEXT/g,"gl_FragDepth"),i=="fragment"?s=s.replace(/varying/g,"in"):s=s.replace(/varying/g,"out"),s=s.replace(/attribute/g,"in"),s=s.replace(/texture2D/g,"texture"),s=s.replace(/\/\/DEFINEFRAGCOLOR/g,"out vec4 glFragColor;"),s=s.replace(/gl_FragColor/g,"glFragColor"),s=`#version 300 es
`+s),i==="fragment"?a=this._gl.createShader(this._gl.FRAGMENT_SHADER):i==="vertex"&&(a=this._gl.createShader(this._gl.VERTEX_SHADER)),a==null?null:(this._gl.shaderSource(a,s),this._gl.compileShader(a),this._gl.getShaderParameter(a,this._gl.COMPILE_STATUS)?a:(console.error(this._gl.getShaderInfoLog(a)),console.error("could not initialize shader"),null))}buildProgram(i,s,a,h){var t,n,f,o,v=[];v.push(i),v.push(s);for(t in h)v.push(t),v.push(h[t]);for(o=v.join(),t=0,n=this._programs.length;t<n;t++){var m=this._programs[t];if(m.code===o)return m.usedTimes++,m.program}if(this.isWebGL1()&&h.volumetric)throw new Error("Volumetric rendering requires webgl2 which is not supported by your hardware.");if(f=this._gl.createProgram(),f==null)return null;var E=this._precision,S="precision "+E+" float;",T=[h.volumetric?"#version 300 es":"",S].join(`
`),P=[h.volumetric?"#version 300 es":"",h.fragdepth&&this.isWebGL1()?"#extension GL_EXT_frag_depth: enable":"",h.shaded?"#define SHADED 1":"",h.wireframe?"#define WIREFRAME 1":"",S].join(`
`),I=this.getShader("fragment",P+i),B=this.getShader("vertex",T+s);B!=null&&this._gl.attachShader(f,B),I!=null&&this._gl.attachShader(f,I),this._gl.linkProgram(f),this._gl.getProgramParameter(f,this._gl.LINK_STATUS)||console.error("Could not initialize shader"),f.uniforms={},f.attributes={};var R,z,U;R=["viewMatrix","modelViewMatrix","projectionMatrix","normalMatrix","vWidth","vHeight"];for(z in a)R.push(z);for(U=0;U<R.length;U++){var W=R[U];f.uniforms[W]=this._gl.getUniformLocation(f,W)}for(R=["position","normal","color","lineDistance","offset","radius"],U=0;U<R.length;U++){var F=R[U];f.attributes[F]=this._gl.getAttribLocation(f,F)}return f.id=this._programs_counter++,this._programs.push({program:f,code:o,usedTimes:1}),this.info.memory.programs=this._programs.length,f}setProgram(i,s,a,h,t,n){if(h.needsUpdate&&(h.program&&this.deallocateMaterial(h),this.initMaterial(h,s,a,t),h.needsUpdate=!1),h.program==null)return null;var f=!1,o=h.program,v=o.uniforms,m=h.uniforms;if(o!=this._currentProgram&&(this._gl.useProgram(o),this._currentProgram=o,f=!0),h.id!=this._currentMaterialId&&(this._currentMaterialId=h.id,f=!0),i!=this._currentCamera&&(this._currentCamera=i,f=!0),v.projectionMatrix&&this._gl.uniformMatrix4fv(v.projectionMatrix,!1,i.projectionMatrix.elements),v.modelViewMatrix&&this._gl.uniformMatrix4fv(v.modelViewMatrix,!1,t._modelViewMatrix.elements),v.normalMatrix&&this._gl.uniformMatrix3fv(v.normalMatrix,!1,t._normalMatrix.elements),v.projinv&&(this._projInverse.getInverse(i.projectionMatrix),this._gl.uniformMatrix4fv(v.projinv,!1,this._projInverse.elements)),v.viewMatrix&&this._gl.uniformMatrix4fv(v.viewMatrix,!1,i.matrixWorldInverse.elements),v.vWidth&&this._gl.uniform1f(v.vWidth,this._viewportWidth),v.vHeight&&this._gl.uniform1f(v.vHeight,this._viewportHeight),f){if(m.fogColor.value=a.color,m.fogNear.value=a.near,m.fogFar.value=a.far,h.shaderID.startsWith("lambert")||h.shaderID==="instanced"||h.shaderID.endsWith("imposter"))this._lightsNeedUpdate&&(this.setupLights(o,s),this._lightsNeedUpdate=!1),m.directionalLightColor.value=this._lights.directional.colors,m.directionalLightDirection.value=this._lights.directional.positions;else if(h.shaderID.endsWith("outline"))m.outlineColor.value=h.outlineColor,m.outlineWidth.value=h.outlineWidth,m.outlinePushback.value=h.outlinePushback,m.outlineMaxPixels.value=h.outlineMaxPixels*this.devicePixelRatio;else if(h.shaderID==="volumetric"){t._modelViewMatrix.getScale(this._direction),this._worldInverse.getInverse(t._modelViewMatrix),this._projInverse.getInverse(i.projectionMatrix),this._textureMatrix.multiplyMatrices(t.material.texmatrix,this._worldInverse),this._gl.uniformMatrix4fv(v.textmat,!1,this._textureMatrix.elements),this._gl.uniformMatrix4fv(v.projinv,!1,this._projInverse.elements);let E=Math.min(Math.min(this._direction.x,this._direction.y),this._direction.z);m.step.value=t.material.unit*E,m.maxdepth.value=t.material.maxdepth*E,m.transfermax.value=t.material.transfermax,m.transfermin.value=t.material.transfermin,m.subsamples.value=t.material.subsamples,n.setTexture(t.material.transferfn,4,!1),n.setTexture(t.material.map,3,!0),this._gl.activeTexture(this._gl.TEXTURE5),this._gl.bindTexture(this._gl.TEXTURE_2D,this._depthTexture)}m.opacity.value=h.opacity,this.loadMaterialUniforms(v,m)}return m.shading&&(m.shading.value==3?(this._gl.activeTexture(this._gl.TEXTURE0+this.SHADE_TEXTURE),this._gl.bindTexture(this._gl.TEXTURE_2D,this._shadingTexture)):console.error("Invalid shading textures.")),o}loadMaterialUniforms(i,s){var a,h,t,n;for(a in s)i[a]&&(h=s[a].type,t=s[a].value,n=i[a],h==="f"?this._gl.uniform1f(n,t):h==="i"?this._gl.uniform1i(n,t):h==="fv"?this._gl.uniform3fv(n,t):h==="c"?this._gl.uniform3f(n,t.r,t.g,t.b):h==="f4"&&this._gl.uniform4f(n,t[0],t[1],t[2],t[3]))}addObject(i,s){var a,h,t,n;if(!i.__webglInit&&(i.__webglInit=!0,i._modelViewMatrix=new A.Matrix4,i._normalMatrix=new A.Matrix3,i.geometry!==void 0&&i.geometry.__webglInit===void 0&&(i.geometry.__webglInit=!0,i.geometry.addEventListener("dispose",this.onGeometryDispose.bind(this))),i instanceof c.Mesh||i instanceof c.Line))for(t=i.geometry,a=0,h=t.geometryGroups.length;a<h;a++)n=t.geometryGroups[a],n.id=this._geometryGroupCounter++,n.__webglVertexBuffer||(i instanceof c.Mesh?(this.createMeshBuffers(n),t.elementsNeedUpdate=!0,t.normalsNeedUpdate=!0):i instanceof c.Line&&this.createLineBuffers(n),t.verticesNeedUpdate=!0,t.colorsNeedUpdate=!0);if(!i.__webglActive){if(i instanceof c.Mesh||i instanceof c.Line)for(t=i.geometry,a=0,h=t.geometryGroups.length;a<h;a++)n=t.geometryGroups[a],this.addBuffer(s.__webglObjects,n,i);else i instanceof c.Sprite&&s.__webglSprites.push(i);i.__webglActive=!0}}updateObject(i){var s=i.geometry,a;if(i instanceof c.Mesh||i instanceof c.Line){for(var h=0,t=s.geometryGroups.length;h<t;h++)a=s.geometryGroups[h],(s.verticesNeedUpdate||s.elementsNeedUpdate||s.colorsNeedUpdate||s.normalsNeedUpdate)&&this.setBuffers(a,this._gl.STATIC_DRAW);s.verticesNeedUpdate=!1,s.elementsNeedUpdate=!1,s.normalsNeedUpdate=!1,s.colorsNeedUpdate=!1,s.buffersNeedUpdate=!1}}removeObject(i,s){i instanceof c.Mesh||i instanceof c.Line?this.removeInstances(s.__webglObjects,i):i instanceof c.Sprite&&this.removeInstancesDirect(s.__webglSprites,i),i.__webglActive=!1}removeInstances(i,s){for(var a=i.length-1;a>=0;--a)i[a].object===s&&i.splice(a,1)}removeInstancesDirect(i,s){for(var a=i.length-1;a>=0;--a)i[a]===s&&i.splice(a,1)}unrollBufferMaterial(i){var s=i.object,a=s.material;if(a.volumetric)i.opaque=null,i.transparent=null,i.volumetric=a;else if(a.transparent){if(i.opaque=null,i.volumetric=null,i.transparent=a,!a.wireframe){let h=a.clone();h.opacity=0,i.transparentDepth=h}}else{if(i.opaque=a,i.transparent=null,i.volumetric=null,!a.wireframe){let h=a.clone();h.opacity=0,i.opaqueDepth=h}a.hasAO&&(i.hasAO=!0),(this._AOEnabled||i.hasAO)&&(i.opaqueShaded=a.clone(),i.opaqueShaded.shaded=!0)}}setBuffers(i,s){var a=i.vertexArray,h=i.colorArray;if(i.__webglOffsetBuffer!==void 0?(this._gl.bindBuffer(this._gl.ARRAY_BUFFER,i.__webglOffsetBuffer),this._gl.bufferData(this._gl.ARRAY_BUFFER,a,s)):(this._gl.bindBuffer(this._gl.ARRAY_BUFFER,i.__webglVertexBuffer),this._gl.bufferData(this._gl.ARRAY_BUFFER,a,s)),this._gl.bindBuffer(this._gl.ARRAY_BUFFER,i.__webglColorBuffer),this._gl.bufferData(this._gl.ARRAY_BUFFER,h,s),i.normalArray&&i.__webglNormalBuffer!==void 0){var t=i.normalArray;this._gl.bindBuffer(this._gl.ARRAY_BUFFER,i.__webglNormalBuffer),this._gl.bufferData(this._gl.ARRAY_BUFFER,t,s)}if(i.radiusArray&&i.__webglRadiusBuffer!==void 0&&(this._gl.bindBuffer(this._gl.ARRAY_BUFFER,i.__webglRadiusBuffer),this._gl.bufferData(this._gl.ARRAY_BUFFER,i.radiusArray,s)),i.faceArray&&i.__webglFaceBuffer!==void 0){var n=i.faceArray;this._gl.bindBuffer(this._gl.ELEMENT_ARRAY_BUFFER,i.__webglFaceBuffer),this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER,n,s)}if(i.lineArray&&i.__webglLineBuffer!==void 0){var f=i.lineArray;this._gl.bindBuffer(this._gl.ELEMENT_ARRAY_BUFFER,i.__webglLineBuffer),this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER,f,s)}}createMeshBuffers(i){i.radiusArray&&(i.__webglRadiusBuffer=this._gl.createBuffer()),i.useOffset&&(i.__webglOffsetBuffer=this._gl.createBuffer()),i.__webglVertexBuffer=this._gl.createBuffer(),i.__webglNormalBuffer=this._gl.createBuffer(),i.__webglColorBuffer=this._gl.createBuffer(),i.__webglFaceBuffer=this._gl.createBuffer(),i.__webglLineBuffer=this._gl.createBuffer(),this.info.memory.geometries++}createLineBuffers(i){i.__webglVertexBuffer=this._gl.createBuffer(),i.__webglColorBuffer=this._gl.createBuffer(),this.info.memory.geometries++}addBuffer(i,s,a){i.push({buffer:s,object:a,opaque:null,transparent:null})}setupMatrices(i,s){i._modelViewMatrix.multiplyMatrices(s.matrixWorldInverse,i.matrixWorld),i._normalMatrix.getInverse(i._modelViewMatrix),i._normalMatrix.transpose()}filterFallback(i){return this._gl.LINEAR}setTextureParameters(i,s){i==this._gl.TEXTURE_2D?(this._gl.texParameteri(i,this._gl.TEXTURE_WRAP_S,this._gl.CLAMP_TO_EDGE),this._gl.texParameteri(i,this._gl.TEXTURE_WRAP_T,this._gl.CLAMP_TO_EDGE),this._gl.texParameteri(i,this._gl.TEXTURE_MAG_FILTER,this.filterFallback(s.magFilter)),this._gl.texParameteri(i,this._gl.TEXTURE_MIN_FILTER,this.filterFallback(s.minFilter))):(this._gl.texParameteri(i,this._gl.TEXTURE_WRAP_S,this._gl.CLAMP_TO_EDGE),this._gl.texParameteri(i,this._gl.TEXTURE_WRAP_T,this._gl.CLAMP_TO_EDGE),this._gl.texParameteri(i,this._gl.TEXTURE_WRAP_R,this._gl.CLAMP_TO_EDGE),this._extColorBufferFloat&&this._extFloatLinear?(this._gl.texParameteri(i,this._gl.TEXTURE_MAG_FILTER,this._gl.LINEAR),this._gl.texParameteri(i,this._gl.TEXTURE_MIN_FILTER,this._gl.LINEAR)):(this._gl.texParameteri(i,this._gl.TEXTURE_MAG_FILTER,this._gl.NEAREST),this._gl.texParameteri(i,this._gl.TEXTURE_MIN_FILTER,this._gl.NEAREST)))}paramToGL(i){return i===w.UnsignedByteType?this._gl.UNSIGNED_BYTE:i===w.RGBAFormat?this._gl.RGBA:i===w.NearestFilter?this._gl.NEAREST:0}setupLights(i,s){var a,h,t,n=0,f=0,o=0,v,m,E=this._lights,S=E.directional.colors,T=E.directional.positions,P=0,I=0;for(a=0,h=s.length;a<h;a++)if(t=s[a],v=t.color,m=t.intensity,t instanceof O.Light){if(this._direction.getPositionFromMatrix(t.matrixWorld),this._vector3.getPositionFromMatrix(t.target.matrixWorld),this._direction.sub(this._vector3),this._direction.normalize(),this._direction.x===0&&this._direction.y===0&&this._direction.z===0)continue;T[I]=this._direction.x,T[I+1]=this._direction.y,T[I+2]=this._direction.z,S[I]=v.r*m,S[I+1]=v.g*m,S[I+2]=v.b*m,I+=3,P++}E.ambient[0]=n,E.ambient[1]=f,E.ambient[2]=o,E.directional.length=P}initGL(){try{if(OffscreenCanvas&&!(this.rows!=null&&this.cols!=null&&this.row!=null&&this.col!=null))(p==null||p.isContextLost())&&(u=new OffscreenCanvas(this._canvas.width,this._canvas.height),p=u.getContext("webgl2",{alpha:!0,premultipliedAlpha:this._premultipliedAlpha,antialias:this._antialias,preserveDrawingBuffer:this._preserveDrawingBuffer})),this._offscreen=u,this._gl=p,this._bitmap=this._canvas.getContext("bitmaprenderer",{alpha:!0});else if(!(this._gl=this._canvas.getContext("webgl2",{alpha:this._alpha,premultipliedAlpha:this._premultipliedAlpha,antialias:this._antialias,preserveDrawingBuffer:this._preserveDrawingBuffer}))&&!(this._gl=this._canvas.getContext("experimental-webgl",{alpha:this._alpha,premultipliedAlpha:this._premultipliedAlpha,antialias:this._antialias,preserveDrawingBuffer:this._preserveDrawingBuffer}))&&!(this._gl=this._canvas.getContext("webgl",{alpha:this._alpha,premultipliedAlpha:this._premultipliedAlpha,antialias:this._antialias,preserveDrawingBuffer:this._preserveDrawingBuffer})))throw"Error creating WebGL context.";var i=this._gl.getParameter(this._gl.VERSION);this._webglversion=parseInt(i[6])}catch(s){console.error(s)}}isWebGL1(){return this._webglversion==1}setDefaultGLState(){this._gl.clearDepth(1),this._gl.clearStencil(0),this._gl.enable(this._gl.DEPTH_TEST),this._gl.depthFunc(this._gl.LEQUAL),this._gl.frontFace(this._gl.CCW),this._gl.cullFace(this._gl.BACK),this._gl.enable(this._gl.CULL_FACE),this._gl.enable(this._gl.BLEND),this._gl.blendEquation(this._gl.FUNC_ADD),this._gl.blendFunc(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA),this._gl.clearColor(this._clearColor.r,this._clearColor.g,this._clearColor.b,this._clearAlpha)}renderObjects(i,s,a,h,t,n,f){var o,v,m,E,S,T,P;s?(S=i.length-1,T=-1,P=-1):(S=0,T=i.length,P=1);for(var I=S;I!==T;I+=P)if(o=i[I],o.render){if(v=o.object,m=o.buffer,E=o[a],(o.hasAO||this._AOEnabled)&&o[a+"Shaded"]&&(E=o[a+"Shaded"]),!E)continue;this.setBlending(f),this.setDepthTest(E.depthTest),this.setDepthWrite(E.depthWrite),this.setPolygonOffset(E.polygonOffset,E.polygonOffsetFactor,E.polygonOffsetUnits);var B=v._modelViewMatrix.isReflected();if(this.setMaterialFaces(E,B),this.renderBuffer(h,t,n,E,m,v),(this._outlineEnabled||E.outline)&&!E.wireframe&&E.shaderID!=="basic"&&E.opacity!==0){let R=this._outlineMaterial;E.shaderID=="sphereimposter"?R=this._outlineSphereImposterMaterial:E.shaderID=="stickimposter"&&(R=this._outlineStickImposterMaterial),this.renderBuffer(h,t,n,R,m,v)}}}renderSprites(i,s,a){this._currentGeometryGroupHash=-1,this._currentProgram=null,this._currentCamera=null,this._oldDepthWrite=-1,this._oldDepthTest=-1,this._oldDoubleSided=-1,this._currentMaterialId=-1,this._oldFlipSided=-1,this._lightsNeedUpdate=!0,this.sprites.render(i,s,this._currentWidth,this._currentHeight,a),this._currentGeometryGroupHash=-1,this._currentProgram=null,this._currentCamera=null,this._oldDepthWrite=-1,this._oldDepthTest=-1,this._oldDoubleSided=-1,this._currentMaterialId=-1,this._oldFlipSided=-1}}},"./src/WebGL/SpritePlugin.ts":(K,C,d)=>{d.r(C),d.d(C,{SpritePlugin:()=>L});var M=d("./src/WebGL/shaders/index.ts");class L{constructor(){this.sprite={vertices:null,faces:null,vertexBuffer:null,elementBuffer:null,program:null,attributes:{},uniforms:null}}init(g){this.gl=g.context,this.renderer=g,this.precision=g.getPrecision(),this.sprite.vertices=new Float32Array(16),this.sprite.faces=new Uint16Array(6);var _=0;this.sprite.vertices[_++]=-1,this.sprite.vertices[_++]=-1,this.sprite.vertices[_++]=0,this.sprite.vertices[_++]=0,this.sprite.vertices[_++]=1,this.sprite.vertices[_++]=-1,this.sprite.vertices[_++]=1,this.sprite.vertices[_++]=0,this.sprite.vertices[_++]=1,this.sprite.vertices[_++]=1,this.sprite.vertices[_++]=1,this.sprite.vertices[_++]=1,this.sprite.vertices[_++]=-1,this.sprite.vertices[_++]=1,this.sprite.vertices[_++]=0,this.sprite.vertices[_++]=1,_=0,this.sprite.faces[_++]=0,this.sprite.faces[_++]=1,this.sprite.faces[_++]=2,this.sprite.faces[_++]=0,this.sprite.faces[_++]=2,this.sprite.faces[_++]=3,this.sprite.vertexBuffer=this.gl.createBuffer(),this.sprite.elementBuffer=this.gl.createBuffer(),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.sprite.vertexBuffer),this.gl.bufferData(this.gl.ARRAY_BUFFER,this.sprite.vertices,this.gl.STATIC_DRAW),this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.sprite.elementBuffer),this.gl.bufferData(this.gl.ELEMENT_ARRAY_BUFFER,this.sprite.faces,this.gl.STATIC_DRAW),this.sprite.program=this.createProgram(M.ShaderLib.sprite,this.precision||1),this.sprite.attributes={};const A={};this.sprite.attributes.position=this.gl.getAttribLocation(this.sprite.program,"position"),this.sprite.attributes.uv=this.gl.getAttribLocation(this.sprite.program,"uv"),A.uvOffset=this.gl.getUniformLocation(this.sprite.program,"uvOffset"),A.uvScale=this.gl.getUniformLocation(this.sprite.program,"uvScale"),A.rotation=this.gl.getUniformLocation(this.sprite.program,"rotation"),A.scale=this.gl.getUniformLocation(this.sprite.program,"scale"),A.alignment=this.gl.getUniformLocation(this.sprite.program,"alignment"),A.color=this.gl.getUniformLocation(this.sprite.program,"color"),A.map=this.gl.getUniformLocation(this.sprite.program,"map"),A.opacity=this.gl.getUniformLocation(this.sprite.program,"opacity"),A.useScreenCoordinates=this.gl.getUniformLocation(this.sprite.program,"useScreenCoordinates"),A.screenPosition=this.gl.getUniformLocation(this.sprite.program,"screenPosition"),A.modelViewMatrix=this.gl.getUniformLocation(this.sprite.program,"modelViewMatrix"),A.projectionMatrix=this.gl.getUniformLocation(this.sprite.program,"projectionMatrix"),A.fogType=this.gl.getUniformLocation(this.sprite.program,"fogType"),A.fogDensity=this.gl.getUniformLocation(this.sprite.program,"fogDensity"),A.fogNear=this.gl.getUniformLocation(this.sprite.program,"fogNear"),A.fogFar=this.gl.getUniformLocation(this.sprite.program,"fogFar"),A.fogColor=this.gl.getUniformLocation(this.sprite.program,"fogColor"),A.alphaTest=this.gl.getUniformLocation(this.sprite.program,"alphaTest"),this.sprite.uniforms=A}render(g,_,A,c,y){var b,u,p,r,e,i,s,a,h,t;if(!this.gl)throw new Error("WebGLRenderer not initialized");let n=[];(b=g==null?void 0:g.__webglSprites)===null||b===void 0||b.forEach(q=>{(y&&q.material.depthTest==!1||!y&&q.material.depthTest)&&n.push(q)});let f=n.length;if(!f)return;const o=this.sprite.attributes,v=this.sprite.uniforms;if(!v)throw new Error("Uniforms not defined");var m=A*.5,E=c*.5;this.gl.useProgram(this.sprite.program),this.gl.enableVertexAttribArray(o.position),this.gl.enableVertexAttribArray(o.uv),this.gl.disable(this.gl.CULL_FACE),this.gl.enable(this.gl.BLEND),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.sprite.vertexBuffer),this.gl.vertexAttribPointer(o.position,2,this.gl.FLOAT,!1,16,0),this.gl.vertexAttribPointer(o.uv,2,this.gl.FLOAT,!1,16,8),this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.sprite.elementBuffer),this.gl.uniformMatrix4fv(v.projectionMatrix,!1,_.projectionMatrix.elements),this.gl.activeTexture(this.gl.TEXTURE0),this.gl.uniform1i(v.map,0);var S=0,T=0,P=g.fog;P?(this.gl.uniform3f(v.fogColor,P.color.r,P.color.g,P.color.b),this.gl.uniform1f(v.fogNear,P.near),this.gl.uniform1f(v.fogFar,P.far),this.gl.uniform1i(v.fogType,1),S=1,T=1):(this.gl.uniform1i(v.fogType,0),S=0,T=0);var I;let B,R,z,U,W=[];for(I=0;I<f;I++)B=n[I],R=B.material,R&&(R.depthTest==!1&&!y||!B.visible||R.opacity===0||(R.useScreenCoordinates?B.z=-B.position.z:(B._modelViewMatrix.multiplyMatrices(_.matrixWorldInverse,B.matrixWorld),B.z=-B._modelViewMatrix.elements[14])));for(n.sort(w),I=0;I<f;I++)if(B=n[I],R=B.material,!!R&&!(!B.visible||R.opacity===0)&&R.map&&R.map.image&&R.map.image.width){this.gl.uniform1f((v==null?void 0:v.alphaTest)||null,R.alphaTest);var F=R.map.image.width,N=R.map.image.height;W[0]=F*this.renderer.devicePixelRatio/A,W[1]=N*this.renderer.devicePixelRatio/c,R.useScreenCoordinates===!0?(this.gl.uniform1i(v.useScreenCoordinates,1),this.gl.uniform3f(v.screenPosition,(B.position.x*this.renderer.devicePixelRatio-m)/m,(E-B.position.y*this.renderer.devicePixelRatio)/E,Math.max(0,Math.min(1,B.position.z)))):(this.gl.uniform1i(v.useScreenCoordinates,0),this.gl.uniformMatrix4fv(v.modelViewMatrix,!1,B._modelViewMatrix.elements)),g.fog&&R.fog?U=T:U=0,S!==U&&(this.gl.uniform1i(v.fogType,U),S=U),z=1/(R.scaleByViewport?c:1),W[0]*=z*B.scale.x,W[1]*=z*B.scale.y;let q=(u=R==null?void 0:R.alignment)===null||u===void 0?void 0:u.x,J=(p=R==null?void 0:R.alignment)===null||p===void 0?void 0:p.y;R.screenOffset&&(q=(q||0)+2*R.screenOffset.x/F,J=(J||0)+2*R.screenOffset.y/N),this.gl.uniform2f(v.uvScale,((r=R==null?void 0:R.uvScale)===null||r===void 0?void 0:r.x)||1,((e=R==null?void 0:R.uvScale)===null||e===void 0?void 0:e.y)||1),this.gl.uniform2f(v.uvOffset,((i=R==null?void 0:R.uvOffset)===null||i===void 0?void 0:i.x)||0,((s=R==null?void 0:R.uvOffset)===null||s===void 0?void 0:s.y)||0),this.gl.uniform2f(v.alignment,q||0,J||0),this.gl.uniform1f(v.opacity,R.opacity),this.gl.uniform3f(v.color,((a=R==null?void 0:R.color)===null||a===void 0?void 0:a.r)||0,((h=R==null?void 0:R.color)===null||h===void 0?void 0:h.g)||0,((t=R==null?void 0:R.color)===null||t===void 0?void 0:t.b)||0),this.gl.uniform1f(v.rotation,B.rotation),this.gl.uniform2fv(v.scale,W),this.renderer.setDepthTest(R.depthTest),this.renderer.setDepthWrite(R.depthWrite),this.renderer.setTexture(R.map,0),this.gl.drawElements(this.gl.TRIANGLES,6,this.gl.UNSIGNED_SHORT,0)}this.gl.enable(this.gl.CULL_FACE)}createProgram(g,_){if(!this.gl)throw new Error("WebGL Rendering context not found");var A=this.gl.createProgram();if(!A)throw new Error("Error creating webgl program");var c=this.gl.createShader(this.gl.FRAGMENT_SHADER),y=this.gl.createShader(this.gl.VERTEX_SHADER);if(!c)throw new Error("Unable to create fragment shader SpritePlugin.createProgram");if(!y)throw new Error("Unable to create vertex shader SpritePlugin.createProgram");var b="precision "+_+` float;
`;if(this.gl.shaderSource(c,b+g.fragmentShader),this.gl.shaderSource(y,b+g.vertexShader),this.gl.compileShader(c),this.gl.compileShader(y),!this.gl.getShaderParameter(c,this.gl.COMPILE_STATUS)||!this.gl.getShaderParameter(y,this.gl.COMPILE_STATUS))throw new Error(`Error compiling shader: 
      ${this.gl.getShaderInfoLog(c)} 
      ${this.gl.getShaderInfoLog(y)}`);return this.gl.attachShader(A,c),this.gl.attachShader(A,y),this.gl.linkProgram(A),this.gl.getProgramParameter(A,this.gl.LINK_STATUS)||console.error("Could not initialize shader"),A}}function w(O,g){return O.z!==g.z?g.z-O.z:g.id-O.id}},"./src/WebGL/constants/Coloring.ts":(K,C,d)=>{d.r(C),d.d(C,{Coloring:()=>M});var M;(function(L){L[L.NoColors=0]="NoColors",L[L.FaceColors=1]="FaceColors",L[L.VertexColors=2]="VertexColors"})(M||(M={}))},"./src/WebGL/constants/Shading.ts":(K,C,d)=>{d.r(C),d.d(C,{Shading:()=>M});var M;(function(L){L[L.NoShading=0]="NoShading",L[L.FlatShading=1]="FlatShading",L[L.SmoothShading=2]="SmoothShading"})(M||(M={}))},"./src/WebGL/constants/Sides.ts":(K,C,d)=>{d.r(C),d.d(C,{BackSide:()=>L,DoubleSide:()=>w,FrontSide:()=>M});const M=0,L=1,w=2},"./src/WebGL/constants/SpriteAlignment.ts":(K,C,d)=>{d.r(C),d.d(C,{SpriteAlignment:()=>L});var M=d("./src/WebGL/math/index.ts");const L={topLeft:new M.Vector2(1,-1),topCenter:new M.Vector2(0,-1),topRight:new M.Vector2(-1,-1),centerLeft:new M.Vector2(1,0),center:new M.Vector2(0,0),centerRight:new M.Vector2(-1,0),bottomLeft:new M.Vector2(1,1),bottomCenter:new M.Vector2(0,1),bottomRight:new M.Vector2(-1,1)}},"./src/WebGL/constants/TextureConstants.ts":(K,C,d)=>{d.r(C),d.d(C,{ClampToEdgeWrapping:()=>M,FloatType:()=>_,LinearFilter:()=>L,LinearMipMapLinearFilter:()=>O,NearestFilter:()=>w,R32Format:()=>y,RFormat:()=>c,RGBAFormat:()=>A,UnsignedByteType:()=>g});const M=1001,L=1006,w=1007,O=1008,g=1009,_=1010,A=1021,c=1022,y=1023},"./src/WebGL/constants/TextureOperations.ts":(K,C,d)=>{d.r(C),d.d(C,{TextureOperations:()=>M});var M;(function(L){L[L.MultiplyOperation=0]="MultiplyOperation",L[L.MixOperation=1]="MixOperation",L[L.AddOperation=2]="AddOperation"})(M||(M={}))},"./src/WebGL/constants/index.ts":(K,C,d)=>{d.r(C),d.d(C,{BackSide:()=>L.BackSide,ClampToEdgeWrapping:()=>g.ClampToEdgeWrapping,Coloring:()=>M.Coloring,DoubleSide:()=>L.DoubleSide,FloatType:()=>g.FloatType,FrontSide:()=>L.FrontSide,LinearFilter:()=>g.LinearFilter,LinearMipMapLinearFilter:()=>g.LinearMipMapLinearFilter,NearestFilter:()=>g.NearestFilter,R32Format:()=>g.R32Format,RFormat:()=>g.RFormat,RGBAFormat:()=>g.RGBAFormat,Shading:()=>w.Shading,SpriteAlignment:()=>O.SpriteAlignment,TextureOperations:()=>_.TextureOperations,UnsignedByteType:()=>g.UnsignedByteType});var M=d("./src/WebGL/constants/Coloring.ts"),L=d("./src/WebGL/constants/Sides.ts"),w=d("./src/WebGL/constants/Shading.ts"),O=d("./src/WebGL/constants/SpriteAlignment.ts"),g=d("./src/WebGL/constants/TextureConstants.ts"),_=d("./src/WebGL/constants/TextureOperations.ts")},"./src/WebGL/core/EventDispatcher.ts":(K,C,d)=>{d.r(C),d.d(C,{EventDispatcher:()=>M});class M{constructor(){this.listeners={}}dispatchEvent(w){var O=this.listeners[w.type];if(O!==void 0){w.target=this;for(var g=0,_=O.length;g<_;g++)O[g].call(this,w)}}removeEventListener(w,O){if(!O)this.listeners[w]=[];else{var g=this.listeners[w].indexOf(O);g!==-1&&this.listeners[w].splice(g,1)}}addEventListener(w,O){this.listeners[w]===void 0&&(this.listeners[w]=[]),this.listeners[w].indexOf(O)===-1&&this.listeners[w].push(O)}}},"./src/WebGL/core/Geometry.ts":(K,C,d)=>{d.r(C),d.d(C,{Geometry:()=>A,GeometryGroup:()=>_,GeometryIDCount:()=>c});var M=d("./src/WebGL/materials/LineBasicMaterial.ts"),L=d("./src/WebGL/core/EventDispatcher.ts"),w=d("./src/WebGL/math/index.ts"),O=d("./src/colors.ts");const g=65535;class _{constructor(b=0){this.vertexArray=null,this.colorArray=null,this.normalArray=null,this.radiusArray=null,this.faceArray=null,this.lineArray=null,this.atomArray=Array(),this.vertices=0,this.faceidx=0,this.lineidx=0,this.__inittedArrays=!1,this.id=b}setColor(b){var u=this.vertexArray,p=this.colorArray;if(!u)throw new Error("vertex array not initialized");if(!p)throw new Error("color array not initialized");let r=O.CC.color(b);for(var e=0;e<u.length;e+=3)p[e]=r.r,p[e+1]=r.g,p[e+2]=r.b}setColors(b){var u=this.vertexArray,p=this.colorArray;if(!u)throw new Error("vertex array not initialized");if(!p)throw new Error("color array not initialized");if(u.length!=p.length){console.log("Cannot re-color geometry group due to mismatched lengths.");return}for(var r=0;r<u.length;r+=3){var e=b(u[r],u[r+1],u[r+2]);e instanceof O.Color||(e=O.CC.color(e)),p[r]=e.r,p[r+1]=e.g,p[r+2]=e.b}}getNumVertices(){return this.vertices}getVertices(){return this.vertexArray}getCentroid(){if(!this.vertexArray)throw new Error("vertex array not initialized");for(var b=new w.Vector3,u,p,r,e,i=0;i<this.vertices;++i)u=i*3,p=this.vertexArray[u],r=this.vertexArray[u+1],e=this.vertexArray[u+2],b.x+=p,b.y+=r,b.z+=e;return b.divideScalar(this.vertices),b}setNormals(){var b=this.faceArray,u=this.vertexArray,p=this.normalArray;if(!(!this.vertices||!this.faceidx)){if(!b)throw new Error("face array not initialized");if(!u)throw new Error("vertex array not initialized");if(!p)throw new Error("normal array not initialized");for(var r,e,i,s,a,h,t,n=0;n<b.length/3;++n)r=b[n*3]*3,e=b[n*3+1]*3,i=b[n*3+2]*3,s=new w.Vector3(u[r],u[r+1],u[r+2]),a=new w.Vector3(u[e],u[e+1],u[e+2]),h=new w.Vector3(u[i],u[i+1],u[i+2]),s.subVectors(s,a),h.subVectors(h,a),h.cross(s),t=h,t.normalize(),p[r]+=t.x,p[e]+=t.x,p[i]+=t.x,p[r+1]+=t.y,p[e+1]+=t.y,p[i+1]+=t.y,p[r+2]+=t.z,p[e+2]+=t.z,p[i+2]+=t.z}}setLineIndices(){if(this.faceidx&&!(this.lineArray&&this.lineArray.length==this.faceidx*2&&this.lineidx==this.faceidx*2)){var b=this.faceArray,u=this.lineArray=new Uint16Array(this.faceidx*2);if(this.lineidx=this.faceidx*2,!b)throw new Error("face array not initialized");for(var p=0;p<this.faceidx/3;++p){var r=p*3,e=r*2,i=b[r],s=b[r+1],a=b[r+2];u[e]=i,u[e+1]=s,u[e+2]=i,u[e+3]=a,u[e+4]=s,u[e+5]=a}}}vrml(b,u){var p,r,e,i,s,a,h,t,n,f,o,v,m,E,S,T,P,I,B="";if(B+=b+`Shape {
`+b+` appearance Appearance {
`+b+`  material Material {
`+b+"   diffuseColor "+((p=u==null?void 0:u.color)===null||p===void 0?void 0:p.r)+" "+((r=u==null?void 0:u.color)===null||r===void 0?void 0:r.g)+" "+((e=u==null?void 0:u.color)===null||e===void 0?void 0:e.b)+`
`,u.wireframe&&this.colorArray){let z=this.colorArray;B+=b+"    emissiveColor "+z[0]+" "+z[1]+" "+z[2]+`
`}u!=null&&u.transparent&&(B+=b+"   transparency "+(1-u.opacity)+`
`),B+=b+`  }
`,B+=b+` }
`;var R=b;if(b+=" ",u instanceof M.LineBasicMaterial||u.wireframe){B+=b+`geometry IndexedLineSet {
`+b+` colorPerVertex TRUE
`+b+` coord Coordinate {
`+b+`  point [
`;let z,U,W;for(let F=0;F<this.vertices;++F){let N=F*3;z=(i=this.vertexArray)===null||i===void 0?void 0:i[N],U=(s=this.vertexArray)===null||s===void 0?void 0:s[N+1],W=(a=this.vertexArray)===null||a===void 0?void 0:a[N+2],B+=b+"   "+z+" "+U+" "+W+`,
`}if(B+=b+`  ]
`,B+=b+` }
`,this.colorArray&&!u.wireframe){B+=b+` color Color {
`+b+`  color [
`;for(let F=0;F<this.vertices;++F){let N=F*3;z=this.colorArray[N],U=this.colorArray[N+1],W=this.colorArray[N+2],B+=b+"   "+z+" "+U+" "+W+`,
`}B+=b+`  ]
`,B+=b+` }
`}if(B+=b+` coordIndex [
`,u.wireframe&&this.faceArray)for(let F=0;F<this.faceidx;F+=3)z=(h=this.faceArray)===null||h===void 0?void 0:h[F],U=(t=this.faceArray)===null||t===void 0?void 0:t[F+1],W=(n=this.faceArray)===null||n===void 0?void 0:n[F+2],B+=b+"  "+z+", "+U+", "+W+`, -1,
`;else for(let F=0;F<this.vertices-1;F+=2)B+=b+"  "+F+", "+(F+1)+`, -1,
`;B+=b+` ]
`,B+=b+`}
`}else{B+=b+`geometry IndexedFaceSet {
`+b+` colorPerVertex TRUE
`+b+` normalPerVertex TRUE
`+b+` solid FALSE
`,B+=b+` coord Coordinate {
`+b+`  point [
`;let z,U,W;for(let F=0;F<this.vertices;++F){let N=F*3;z=(f=this.vertexArray)===null||f===void 0?void 0:f[N],U=(o=this.vertexArray)===null||o===void 0?void 0:o[N+1],W=(v=this.vertexArray)===null||v===void 0?void 0:v[N+2],B+=b+"   "+z+" "+U+" "+W+`,
`}B+=b+`  ]
`,B+=b+` }
`,B+=b+` normal Normal {
`+b+`  vector [
`;for(let F=0;F<this.vertices;++F){let N=F*3;z=(m=this.normalArray)===null||m===void 0?void 0:m[N],U=(E=this.normalArray)===null||E===void 0?void 0:E[N+1],W=(S=this.normalArray)===null||S===void 0?void 0:S[N+2],B+=b+"   "+z+" "+U+" "+W+`,
`}if(B+=b+`  ]
`,B+=b+` }
`,this.colorArray){B+=b+` color Color {
`+b+`  color [
`;for(let F=0;F<this.vertices;++F){let N=F*3;z=this.colorArray[N],U=this.colorArray[N+1],W=this.colorArray[N+2],B+=b+"   "+z+" "+U+" "+W+`,
`}B+=b+`  ]
`,B+=b+` }
`}B+=b+` coordIndex [
`;for(let F=0;F<this.faceidx;F+=3)z=(T=this.faceArray)===null||T===void 0?void 0:T[F],U=(P=this.faceArray)===null||P===void 0?void 0:P[F+1],W=(I=this.faceArray)===null||I===void 0?void 0:I[F+2],B+=b+"  "+z+", "+U+", "+W+`, -1,
`;B+=b+` ]
`,B+=b+`}
`}return B+=R+"}",B}truncateArrayBuffers(b=!0,u=!1){var p=this.vertexArray,r=this.colorArray,e=this.normalArray,i=this.faceArray,s=this.lineArray,a=this.radiusArray;this.vertexArray=(p==null?void 0:p.subarray(0,this.vertices*3))||null,this.colorArray=(r==null?void 0:r.subarray(0,this.vertices*3))||null,b?(this.normalArray=(e==null?void 0:e.subarray(0,this.vertices*3))||null,this.faceArray=(i==null?void 0:i.subarray(0,this.faceidx))||null,this.lineidx>0?this.lineArray=(s==null?void 0:s.subarray(0,this.lineidx))||null:this.lineArray=new Uint16Array(0)):(this.normalArray=new Float32Array(0),this.faceArray=new Uint16Array(0),this.lineArray=new Uint16Array(0)),a&&(this.radiusArray=a.subarray(0,this.vertices)),u&&(this.normalArray&&(this.normalArray=new Float32Array(this.normalArray)),this.faceArray&&(this.faceArray=new Uint16Array(this.faceArray)),this.lineArray&&(this.lineArray=new Uint16Array(this.lineArray)),this.vertexArray&&(this.vertexArray=new Float32Array(this.vertexArray)),this.colorArray&&(this.colorArray=new Float32Array(this.colorArray)),this.radiusArray&&(this.radiusArray=new Float32Array(this.radiusArray))),this.__inittedArrays=!0}}class A extends L.EventDispatcher{constructor(b=!1,u=!1,p=!1){super(),this.name="",this.hasTangents=!1,this.dynamic=!0,this.verticesNeedUpdate=!1,this.elementsNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.buffersNeedUpdate=!1,this.imposter=!1,this.instanced=!1,this.geometryGroups=[],this.groups=0,this.id=c++,this.mesh=b,this.radii=u,this.offset=p}updateGeoGroup(b=0){var u,p=this.groups>0?this.geometryGroups[this.groups-1]:null;return(!p||p.vertices+b>(((u=p==null?void 0:p.vertexArray)===null||u===void 0?void 0:u.length)||0)/3)&&(p=this.addGeoGroup()),p}vrml(b,u){for(var p="",r=this.geometryGroups.length,e=0;e<r;e++){var i=this.geometryGroups[e];p+=i.vrml(b,u)+`,
`}return p}addGeoGroup(){var b=new _(this.geometryGroups.length);return this.geometryGroups.push(b),this.groups=this.geometryGroups.length,b.vertexArray=new Float32Array(g*3),b.colorArray=new Float32Array(g*3),this.mesh&&(b.normalArray=new Float32Array(g*3),b.faceArray=new Uint16Array(g*6),b.lineArray=new Uint16Array(g*6)),this.radii&&(b.radiusArray=new Float32Array(g)),b.useOffset=this.offset,b}setUpNormals(...b){for(var u=0;u<this.groups;u++){var p=this.geometryGroups[u];p.setNormals(...b)}}setColors(...b){for(var u=this.geometryGroups.length,p=0;p<u;p++){var r=this.geometryGroups[p];r.setColors(...b)}}setColor(...b){for(var u=this.geometryGroups.length,p=0;p<u;p++){var r=this.geometryGroups[p];r.setColor(...b)}}setUpWireframe(...b){for(var u=0;u<this.groups;u++){var p=this.geometryGroups[u];p.setLineIndices(...b)}}initTypedArrays(){for(var b=0;b<this.groups;b++){var u=this.geometryGroups[b];u.__inittedArrays!==!0&&u.truncateArrayBuffers(this.mesh,!1)}}dispose(){this.dispatchEvent({type:"dispose"})}get vertices(){for(var b=0,u=0;u<this.groups;u++)b+=this.geometryGroups[u].vertices;return b}}let c=0},"./src/WebGL/core/Object3D.ts":(K,C,d)=>{d.r(C),d.d(C,{Light:()=>_,Object3D:()=>O,Object3DIDCount:()=>w,Scene:()=>g});var M=d("./src/WebGL/math/index.ts"),L=d("./src/colors.ts");let w=0;class O{constructor(){this.id=w++,this.name="",this.children=[],this.position=new M.Vector3,this.rotation=new M.Vector3,this.matrix=new M.Matrix4,this.matrixWorld=new M.Matrix4,this.quaternion=new M.Quaternion,this.eulerOrder="XYZ",this.up=new M.Vector3(0,1,0),this.scale=new M.Vector3(1,1,1),this.matrixAutoUpdate=!0,this.matrixWorldNeedsUpdate=!0,this.rotationAutoUpdate=!0,this.useQuaternion=!1,this.visible=!0}lookAt(c){this.matrix.lookAt(c,this.position,this.up),this.rotationAutoUpdate&&(this.useQuaternion===!0?console.error("Unimplemented math operation."):this.rotation instanceof M.Vector3&&this.rotation.setEulerFromRotationMatrix(this.matrix,this.eulerOrder))}add(c){if(c===this){console.error("Can't add $3Dmol.Object3D to itself");return}c.parent=this,this.children.push(c);for(var y=this;y.parent!==void 0;)y=y.parent;y!==void 0&&y instanceof g&&y.__addObject(c)}remove(c){var y=this.children.indexOf(c);if(y!==-1){c.parent=void 0,this.children.splice(y,1);for(var b=this;b.parent!==void 0;)b=b.parent;b!==void 0&&b instanceof g&&b.__removeObject(c)}}vrml(c){c||(c=" ");var y=2*Math.atan2(this.quaternion.lengthxyz(),this.quaternion.w),b=0,u=0,p=0;if(y!=0){let i=Math.sin(y/2);b=this.quaternion.x/i,u=this.quaternion.y/i,p=this.quaternion.z/i}var r=c+`Transform {
`+c+" center "+this.position.x+" "+this.position.y+" "+this.position.z+`
`+c+" rotation "+b+" "+u+" "+p+" "+y+`
`+c+` children [
`;this.geometry&&(r+=this.geometry.vrml(c,this.material));for(var e=0;e<this.children.length;e++)r+=this.children[e].vrml(c+" ")+`,
`;return r+=` ]
`,r+="}",r}updateMatrix(){this.matrix.setPosition(this.position),this.useQuaternion===!1&&this.rotation instanceof M.Vector3?this.matrix.setRotationFromEuler(this.rotation,this.eulerOrder):this.matrix.setRotationFromQuaternion(this.quaternion),(this.scale.x!==1||this.scale.y!==1||this.scale.z!==1)&&this.matrix.scale(this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(c){this.matrixAutoUpdate===!0&&this.updateMatrix(),(this.matrixWorldNeedsUpdate===!0||c===!0)&&(this.parent===void 0?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1;for(var y=0;y<this.children.length;y++)this.children[y].updateMatrixWorld(!0)}clone(c){c===void 0&&(c=new O),c.name=this.name,c.up.copy(this.up),c.position.copy(this.position),c.rotation instanceof M.Vector3&&this.rotation instanceof M.Vector3?c.rotation.copy(this.rotation):c.rotation=this.rotation,c.eulerOrder=this.eulerOrder,c.scale.copy(this.scale),c.rotationAutoUpdate=this.rotationAutoUpdate,c.matrix.copy(this.matrix),c.matrixWorld.copy(this.matrixWorld),c.quaternion.copy(this.quaternion),c.matrixAutoUpdate=this.matrixAutoUpdate,c.matrixWorldNeedsUpdate=this.matrixWorldNeedsUpdate,c.useQuaternion=this.useQuaternion,c.visible=this.visible;for(var y=0;y<this.children.length;y++){var b=this.children[y];c.add(b.clone())}return c}setVisible(c){this.visible=c;for(var y=0;y<this.children.length;y++){var b=this.children[y];b.setVisible(c)}}}class g extends O{constructor(){super(...arguments),this.fog=null,this.overrideMaterial=null,this.matrixAutoUpdate=!1,this.__objects=[],this.__lights=[],this.__objectsAdded=[],this.__objectsRemoved=[]}__addObject(c){if(c instanceof _)this.__lights.indexOf(c)===-1&&this.__lights.push(c),c.target&&c.target.parent===void 0&&this.add(c.target);else if(this.__objects.indexOf(c)===-1){this.__objects.push(c),this.__objectsAdded.push(c);var y=this.__objectsRemoved.indexOf(c);y!==-1&&this.__objectsRemoved.splice(y,1)}for(var b=0;b<c.children.length;b++)this.__addObject(c.children[b])}__removeObject(c){var y;if(c instanceof _)y=this.__lights.indexOf(c),y!==-1&&this.__lights.splice(y,1);else if(y=this.__objects.indexOf(c),y!==-1){this.__objects.splice(y,1),this.__objectsRemoved.push(c);var b=this.__objectsAdded.indexOf(c);b!==-1&&this.__objectsAdded.splice(y,1)}for(var u=0;u<c.children.length;u++)this.__removeObject(c.children[u])}}class _ extends O{constructor(c,y=1){super(),this.position=new M.Vector3(0,1,0),this.target=new O,this.castShadow=!1,this.onlyShadow=!1,this.color=new L.Color(c),this.intensity=y}}},"./src/WebGL/core/Projector.ts":(K,C,d)=>{d.r(C),d.d(C,{Projector:()=>w});var M=d("./src/WebGL/math/index.ts");const L=new M.Matrix4;class w{static unprojectVector(g,_){return _.projectionMatrixInverse.getInverse(_.projectionMatrix),L.multiplyMatrices(_.matrixWorld,_.projectionMatrixInverse),g.applyProjection(L)}static projectVector(g,_){return _.matrixWorldInverse.getInverse(_.matrixWorld),L.multiplyMatrices(_.projectionMatrix,_.matrixWorldInverse),g.applyProjection(L)}projectVector(g,_){return w.projectVector(g,_)}unprojectVector(g,_){return w.unprojectVector(g,_)}}},"./src/WebGL/core/Raycaster.ts":(K,C,d)=>{d.r(C),d.d(C,{Raycaster:()=>g,intersectObject:()=>i});var M=d("./src/WebGL/math/index.ts"),L=d("./src/WebGL/shapes/index.ts");const w=(s,a)=>s.distance-a.distance,O=new M.Matrix4;class g{constructor(a,h,t,n){this.precision=1e-4,this.linePrecision=.2,this.ray=new M.Ray(a,h),this.ray.direction.lengthSq()>0&&this.ray.direction.normalize(),this.near=n||0,this.far=t||1/0}set(a,h){this.ray.set(a,h)}setFromCamera(a,h){h.ortho?(this.ray.origin.set(a.x,a.y,(h.near+h.far)/(h.near-h.far)).unproject(h),this.ray.direction.set(0,0,-1).transformDirection(h.matrixWorld)):(this.ray.origin.setFromMatrixPosition(h.matrixWorld),this.ray.direction.set(a.x,a.y,a.z),h.projectionMatrixInverse.getInverse(h.projectionMatrix),O.multiplyMatrices(h.matrixWorld,h.projectionMatrixInverse),this.ray.direction.applyProjection(O),this.ray.direction.sub(this.ray.origin).normalize())}intersectObjects(a,h){for(var t=[],n=0,f=h.length;n<f;n++)i(a,h[n],this,t);return t.sort(w),t}}const _=s=>Math.min(Math.max(s,-1),1);var A=new L.Sphere,c=new L.Cylinder,y=new L.Triangle,b=new M.Vector3,u=new M.Vector3,p=new M.Vector3,r=new M.Vector3,e=new M.Vector3;function i(s,a,h,t){if(e.getPositionFromMatrix(s.matrixWorld),a.intersectionShape===void 0)return t;var n=a.intersectionShape,f=h.linePrecision;f*=s.matrixWorld.getMaxScaleOnAxis();var o=f*f;if(a.boundingSphere!==void 0&&a.boundingSphere instanceof L.Sphere&&(A.copy(a.boundingSphere),A.applyMatrix4(s.matrixWorld),!h.ray.isIntersectionSphere(A)))return t;var v,m,E,S,T,P,I,B,R,z,U,W,F,N;for(v=0,m=n.triangle.length;v<m;v++)if(n.triangle[v]instanceof L.Triangle){if(y.copy(n.triangle[v]),y.applyMatrix4(s.matrixWorld),E=y.getNormal(),S=h.ray.direction.dot(E),S>=0||(b.subVectors(y.a,h.ray.origin),I=E.dot(b)/S,I<0))continue;u.copy(h.ray.direction).multiplyScalar(I).add(h.ray.origin),u.sub(y.a),p.copy(y.b).sub(y.a),r.copy(y.c).sub(y.a);var q=p.dot(r),J=p.lengthSq(),oe=r.lengthSq();if(W=(J*u.dot(r)-q*u.dot(p))/(J*oe-q*q),W<0||W>1||(U=(u.dot(p)-W*q)/J,U<0||U>1||U+W>1))continue;t.push({clickable:a,distance:I})}for(v=0,m=n.cylinder.length;v<m;v++)if(n.cylinder[v]instanceof L.Cylinder){if(c.copy(n.cylinder[v]),c.applyMatrix4(s.matrixWorld),b.subVectors(c.c1,h.ray.origin),T=b.dot(c.direction),P=b.dot(h.ray.direction),S=_(h.ray.direction.dot(c.direction)),R=1-S*S,R===0)continue;F=(S*P-T)/R,N=(P-S*T)/R,u.copy(c.direction).multiplyScalar(F).add(c.c1),p.copy(h.ray.direction).multiplyScalar(N).add(h.ray.origin),B=r.subVectors(u,p).lengthSq();var le=c.radius*c.radius;if(B<=le){if(z=(S*T-P)*(S*T-P)-R*(b.lengthSq()-T*T-le),z<=0?W=I=Math.sqrt(B):W=I=(P-S*T-Math.sqrt(z))/R,U=S*W-T,U<0||U*U>c.lengthSq()||W<0)continue;t.push({clickable:a,distance:I})}}for(v=0,m=n.line.length;v<m;v+=2){u.copy(n.line[v]),u.applyMatrix4(s.matrixWorld),p.copy(n.line[v+1]),p.applyMatrix4(s.matrixWorld),r.subVectors(p,u);var fe=r.lengthSq();r.normalize(),b.subVectors(u,h.ray.origin);var ie=b.dot(r);P=b.dot(h.ray.direction),S=_(h.ray.direction.dot(r)),R=1-S*S,R!==0&&(F=(S*P-ie)/R,N=(P-S*ie)/R,u.add(r.multiplyScalar(F)),p.copy(h.ray.direction).multiplyScalar(N).add(h.ray.origin),B=r.subVectors(p,u).lengthSq(),B<o&&F*F<fe&&t.push({clickable:a,distance:N}))}for(v=0,m=n.sphere.length;v<m;v++)if(n.sphere[v]instanceof L.Sphere&&(A.copy(n.sphere[v]),A.applyMatrix4(s.matrixWorld),h.ray.isIntersectionSphere(A))){u.subVectors(A.center,h.ray.origin);var ne=u.dot(h.ray.direction);if(z=ne*ne-(u.lengthSq()-A.radius*A.radius),ne<0)return t;z<=0?I=ne:I=ne-Math.sqrt(z),t.push({clickable:a,distance:I})}return t}},"./src/WebGL/core/Texture.ts":(K,C,d)=>{d.r(C),d.d(C,{Texture:()=>g,TextureIdCount:()=>_});var M=d("./src/WebGL/constants/TextureConstants.ts"),L=d("./src/WebGL/math/index.ts"),w=d("./src/WebGL/core/EventDispatcher.ts"),O=d("./src/WebGL/core/UVMapping.ts");class g extends w.EventDispatcher{constructor(c,y){super(),this.id=_++,this.name="",this.image=c,this.mapping=new O.UVMapping,this.wrapS=M.ClampToEdgeWrapping,this.wrapT=M.ClampToEdgeWrapping,this.anisotropy=1,y?(this.format=M.RFormat,this.type=M.FloatType,this.premultiplyAlpha=!1,this.flipY=!1,this.unpackAlignment=1,this.magFilter=M.NearestFilter,this.minFilter=M.NearestFilter):(this.format=M.RGBAFormat,this.type=M.UnsignedByteType,this.offset=new L.Vector2(0,0),this.repeat=new L.Vector2(1,1),this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.magFilter=M.LinearFilter,this.minFilter=M.LinearMipMapLinearFilter),this.needsUpdate=!1,this.onUpdate=null}clone(c=new g){return c.image=this.image,c.mapping=this.mapping,c.wrapS=this.wrapS,c.wrapT=this.wrapT,c.magFilter=this.magFilter,c.minFilter=this.minFilter,c.anisotropy=this.anisotropy,c.format=this.format,c.type=this.type,c.offset.copy(this.offset),c.repeat.copy(this.repeat),c.premultiplyAlpha=this.premultiplyAlpha,c.flipY=this.flipY,c.unpackAlignment=this.unpackAlignment,c}dispose(){this.dispatchEvent({type:"dispose"})}}let _=0},"./src/WebGL/core/UVMapping.ts":(K,C,d)=>{d.r(C),d.d(C,{UVMapping:()=>M});class M{}},"./src/WebGL/core/index.ts":(K,C,d)=>{d.r(C),d.d(C,{EventDispatcher:()=>M.EventDispatcher,Geometry:()=>L.Geometry,GeometryGroup:()=>L.GeometryGroup,GeometryIDCount:()=>L.GeometryIDCount,Light:()=>w.Light,Object3D:()=>w.Object3D,Object3DIDCount:()=>w.Object3DIDCount,Projector:()=>O.Projector,Raycaster:()=>g.Raycaster,Scene:()=>w.Scene,Texture:()=>_.Texture,TextureIdCount:()=>_.TextureIdCount,UVMapping:()=>A.UVMapping,intersectObject:()=>g.intersectObject});var M=d("./src/WebGL/core/EventDispatcher.ts"),L=d("./src/WebGL/core/Geometry.ts"),w=d("./src/WebGL/core/Object3D.ts"),O=d("./src/WebGL/core/Projector.ts"),g=d("./src/WebGL/core/Raycaster.ts"),_=d("./src/WebGL/core/Texture.ts"),A=d("./src/WebGL/core/UVMapping.ts")},"./src/WebGL/index.ts":(K,C,d)=>{d.r(C),d.d(C,{BackSide:()=>M.BackSide,Camera:()=>c.Camera,ClampToEdgeWrapping:()=>M.ClampToEdgeWrapping,Coloring:()=>M.Coloring,Cylinder:()=>A.Cylinder,DoubleSide:()=>M.DoubleSide,EventDispatcher:()=>L.EventDispatcher,FloatType:()=>M.FloatType,Fog:()=>y.Fog,FrontSide:()=>M.FrontSide,Geometry:()=>L.Geometry,GeometryGroup:()=>L.GeometryGroup,GeometryIDCount:()=>L.GeometryIDCount,ImposterMaterial:()=>w.ImposterMaterial,InstancedMaterial:()=>w.InstancedMaterial,Light:()=>L.Light,Line:()=>g.Line,LineBasicMaterial:()=>w.LineBasicMaterial,LineStyle:()=>g.LineStyle,LinearFilter:()=>M.LinearFilter,LinearMipMapLinearFilter:()=>M.LinearMipMapLinearFilter,Material:()=>w.Material,MaterialIdCount:()=>w.MaterialIdCount,Matrix3:()=>O.Matrix3,Matrix4:()=>O.Matrix4,Mesh:()=>g.Mesh,MeshDoubleLambertMaterial:()=>w.MeshDoubleLambertMaterial,MeshLambertMaterial:()=>w.MeshLambertMaterial,MeshOutlineMaterial:()=>w.MeshOutlineMaterial,NearestFilter:()=>M.NearestFilter,Object3D:()=>L.Object3D,Object3DIDCount:()=>L.Object3DIDCount,Projector:()=>L.Projector,Quaternion:()=>O.Quaternion,R32Format:()=>M.R32Format,RFormat:()=>M.RFormat,RGBAFormat:()=>M.RGBAFormat,Ray:()=>O.Ray,Raycaster:()=>L.Raycaster,Renderer:()=>b.Renderer,Scene:()=>L.Scene,ShaderLib:()=>_.ShaderLib,ShaderUtils:()=>_.ShaderUtils,Shading:()=>M.Shading,Sphere:()=>A.Sphere,SphereImposterMaterial:()=>w.SphereImposterMaterial,SphereImposterOutlineMaterial:()=>w.SphereImposterOutlineMaterial,Sprite:()=>g.Sprite,SpriteAlignment:()=>M.SpriteAlignment,SpriteMaterial:()=>w.SpriteMaterial,SpritePlugin:()=>u.SpritePlugin,StickImposterMaterial:()=>w.StickImposterMaterial,StickImposterOutlineMaterial:()=>w.StickImposterOutlineMaterial,Texture:()=>L.Texture,TextureIdCount:()=>L.TextureIdCount,TextureOperations:()=>M.TextureOperations,Triangle:()=>A.Triangle,UVMapping:()=>L.UVMapping,UnsignedByteType:()=>M.UnsignedByteType,Vector2:()=>O.Vector2,Vector3:()=>O.Vector3,VolumetricMaterial:()=>w.VolumetricMaterial,basic:()=>_.basic,clamp:()=>O.clamp,clone:()=>_.clone,conversionMatrix3:()=>O.conversionMatrix3,degToRad:()=>O.degToRad,instanced:()=>_.instanced,intersectObject:()=>L.intersectObject,lambert:()=>_.lambert,lambertdouble:()=>_.lambertdouble,outline:()=>_.outline,screen:()=>_.screen,screenaa:()=>_.screenaa,sphereimposter:()=>_.sphereimposter,sphereimposteroutline:()=>_.sphereimposteroutline,sprite:()=>_.sprite,stickimposter:()=>_.stickimposter,stickimposteroutline:()=>_.stickimposteroutline,volumetric:()=>_.volumetric});var M=d("./src/WebGL/constants/index.ts"),L=d("./src/WebGL/core/index.ts"),w=d("./src/WebGL/materials/index.ts"),O=d("./src/WebGL/math/index.ts"),g=d("./src/WebGL/objects/index.ts"),_=d("./src/WebGL/shaders/index.ts"),A=d("./src/WebGL/shapes/index.ts"),c=d("./src/WebGL/Camera.ts"),y=d("./src/WebGL/Fog.ts"),b=d("./src/WebGL/Renderer.ts"),u=d("./src/WebGL/SpritePlugin.ts")},"./src/WebGL/materials/ImposterMaterial.ts":(K,C,d)=>{d.r(C),d.d(C,{ImposterMaterial:()=>_});var M=d("./src/WebGL/constants/Coloring.ts"),L=d("./src/WebGL/constants/Shading.ts"),w=d("./src/colors.ts"),O=d("./src/WebGL/math/index.ts"),g=d("./src/WebGL/materials/Material.ts");class _ extends g.Material{constructor(c){super(),this.color=new w.Color(16777215),this.ambient=new w.Color(1048575),this.emissive=new w.Color(0),this.imposter=!0,this.wrapAround=!1,this.wrapRGB=new O.Vector3(1,1,1),this.map=void 0,this.lightMap=null,this.specularMap=null,this.envMap=null,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.shading=L.Shading.SmoothShading,this.shaderID=null,this.vertexColors=M.Coloring.NoColors,this.skinning=!1,this.setValues(c)}clone(c=new _){return super.clone.call(this,c),c.color.copy(this.color),c.ambient.copy(this.ambient),c.emissive.copy(this.emissive),c.wrapAround=this.wrapAround,c.wrapRGB.copy(this.wrapRGB),c.map=this.map,c.lightMap=this.lightMap,c.specularMap=this.specularMap,c.envMap=this.envMap,c.combine=this.combine,c.reflectivity=this.reflectivity,c.refractionRatio=this.refractionRatio,c.fog=this.fog,c.shading=this.shading,c.shaderID=this.shaderID,c.vertexColors=this.vertexColors,c.skinning=this.skinning,c.morphTargets=this.morphTargets,c.morphNormals=this.morphNormals,c}}},"./src/WebGL/materials/InstancedMaterial.ts":(K,C,d)=>{d.r(C),d.d(C,{InstancedMaterial:()=>_});var M=d("./src/WebGL/constants/Coloring.ts"),L=d("./src/WebGL/constants/Shading.ts"),w=d("./src/colors.ts"),O=d("./src/WebGL/math/index.ts"),g=d("./src/WebGL/materials/Material.ts");class _ extends g.Material{constructor(c){super(),this.color=new w.Color(16777215),this.ambient=new w.Color(1048575),this.emissive=new w.Color(0),this.wrapAround=!1,this.wrapRGB=new O.Vector3(1,1,1),this.map=void 0,this.lightMap=null,this.specularMap=null,this.envMap=null,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.shading=L.Shading.SmoothShading,this.shaderID="instanced",this.vertexColors=M.Coloring.NoColors,this.skinning=!1,this.sphere=null,this.setValues(c)}clone(c=new _){return super.clone.call(this,c),c.color.copy(this.color),c.ambient.copy(this.ambient),c.emissive.copy(this.emissive),c.wrapAround=this.wrapAround,c.wrapRGB.copy(this.wrapRGB),c.map=this.map,c.lightMap=this.lightMap,c.specularMap=this.specularMap,c.envMap=this.envMap,c.combine=this.combine,c.reflectivity=this.reflectivity,c.refractionRatio=this.refractionRatio,c.fog=this.fog,c.shading=this.shading,c.shaderID=this.shaderID,c.vertexColors=this.vertexColors,c.skinning=this.skinning,c.morphTargets=this.morphTargets,c.morphNormals=this.morphNormals,c.sphere=this.sphere,c}}},"./src/WebGL/materials/LineBasicMaterial.ts":(K,C,d)=>{d.r(C),d.d(C,{LineBasicMaterial:()=>w});var M=d("./src/colors.ts"),L=d("./src/WebGL/materials/Material.ts");class w extends L.Material{constructor(g){super(),this.color=new M.Color(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.vertexColors=!1,this.fog=!0,this.shaderID="basic",this.setValues(g)}clone(g=new w){return super.clone.call(this,g),g.color.copy(this.color),g}}},"./src/WebGL/materials/Material.ts":(K,C,d)=>{d.r(C),d.d(C,{Material:()=>g,MaterialIdCount:()=>_});var M=d("./src/WebGL/constants/Sides.ts"),L=d("./src/WebGL/core/index.ts"),w=d("./src/WebGL/math/index.ts"),O=d("./src/colors.ts");class g extends L.EventDispatcher{constructor(){super(...arguments),this.id=_++,this.name="",this.side=M.FrontSide,this.opacity=1,this.transparent=!1,this.depthTest=!0,this.depthWrite=!0,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.alphaTest=0,this.visible=!0,this.needsUpdate=!0,this.outline=!1,this.wireframe=!1,this.shaded=!1}setValues(c={}){if(c!==void 0)for(var y in c){var b=c[y];if(b===void 0){console.warn("$3Dmol.Material: '"+y+"' parameter is undefined.");continue}if(y in this){var u=this[y];u instanceof O.Color&&b instanceof O.Color?u.copy(b):u instanceof O.Color?u.set(b):u instanceof w.Vector3&&b instanceof w.Vector3?u.copy(b):this[y]=b}}}clone(c=new g){return c.name=this.name,c.side=this.side,c.opacity=this.opacity,c.transparent=this.transparent,c.depthTest=this.depthTest,c.depthWrite=this.depthWrite,c.polygonOffset=this.polygonOffset,c.polygonOffsetFactor=this.polygonOffsetFactor,c.polygonOffsetUnits=this.polygonOffsetUnits,c.alphaTest=this.alphaTest,c.overdraw=this.overdraw,c.visible=this.visible,c}makeShaded(c){this.shaded=!0,this.uniforms&&(this.uniforms.shading={type:"i",value:c},this.uniforms.vWidth={type:"f",value:1},this.uniforms.vHeight={type:"f",value:1})}dispose(){this.dispatchEvent({type:"dispose"})}}let _=0},"./src/WebGL/materials/MeshDoubleLambertMaterial.ts":(K,C,d)=>{d.r(C),d.d(C,{MeshDoubleLambertMaterial:()=>w});var M=d("./src/WebGL/constants/Sides.ts"),L=d("./src/WebGL/materials/MeshLambertMaterial.ts");class w extends L.MeshLambertMaterial{constructor(g){super(g),this.shaderID="lambertdouble",this.side=M.DoubleSide,this.outline=!1}clone(g=new w){return super.clone.call(this,g),g}}},"./src/WebGL/materials/MeshLambertMaterial.ts":(K,C,d)=>{d.r(C),d.d(C,{MeshLambertMaterial:()=>_});var M=d("./src/WebGL/constants/Coloring.ts"),L=d("./src/WebGL/constants/Shading.ts"),w=d("./src/WebGL/materials/Material.ts"),O=d("./src/colors.ts"),g=d("./src/WebGL/math/index.ts");class _ extends w.Material{constructor(c){super(),this.color=new O.Color(16777215),this.ambient=new O.Color(1048575),this.emissive=new O.Color(0),this.wrapAround=!1,this.wrapRGB=new g.Vector3(1,1,1),this.map=void 0,this.lightMap=null,this.specularMap=null,this.envMap=null,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.shading=L.Shading.SmoothShading,this.shaderID="lambert",this.vertexColors=M.Coloring.NoColors,this.skinning=!1,this.setValues(c)}clone(c=new _){return super.clone.call(this,c),c.color.copy(this.color),c.ambient.copy(this.ambient),c.emissive.copy(this.emissive),c.wrapAround=this.wrapAround,c.wrapRGB.copy(this.wrapRGB),c.map=this.map,c.lightMap=this.lightMap,c.specularMap=this.specularMap,c.envMap=this.envMap,c.combine=this.combine,c.reflectivity=this.reflectivity,c.refractionRatio=this.refractionRatio,c.fog=this.fog,c.shading=this.shading,c.shaderID=this.shaderID,c.vertexColors=this.vertexColors,c.skinning=this.skinning,c.morphTargets=this.morphTargets,c.morphNormals=this.morphNormals,c}}},"./src/WebGL/materials/MeshOutlineMaterial.ts":(K,C,d)=>{d.r(C),d.d(C,{MeshOutlineMaterial:()=>w});var M=d("./src/colors.ts"),L=d("./src/WebGL/materials/Material.ts");class w extends L.Material{constructor(g){super(),g=g||{},this.fog=!0,this.shaderID="outline",this.wireframe=!1,this.outlineColor=M.CC.color(g.color||new M.Color(0,0,0)),this.outlineWidth=g.width||.1,this.outlinePushback=g.pushback||1,this.outlineMaxPixels=g.maxpixels||0}clone(g=new w){return super.clone.call(this,g),g.fog=this.fog,g.shaderID=this.shaderID,g.wireframe=this.wireframe,g.outlineColor=this.outlineColor,g.outlineWidth=this.outlineWidth,g.outlinePushback=this.outlinePushback,g.outlineMaxPixels=this.outlineMaxPixels,g}}},"./src/WebGL/materials/SphereImposterMaterial.ts":(K,C,d)=>{d.r(C),d.d(C,{SphereImposterMaterial:()=>L});var M=d("./src/WebGL/materials/ImposterMaterial.ts");class L extends M.ImposterMaterial{constructor(O){super(O),this.shaderID="sphereimposter",this.setValues(O)}clone(O=new L){return super.clone.call(this,O),O}}},"./src/WebGL/materials/SphereImposterOutlineMaterial.ts":(K,C,d)=>{d.r(C),d.d(C,{SphereImposterOutlineMaterial:()=>w});var M=d("./src/colors.ts"),L=d("./src/WebGL/materials/ImposterMaterial.ts");class w extends L.ImposterMaterial{constructor(g){super(g),g=g||{},this.shaderID="sphereimposteroutline",this.outlineColor=M.CC.color(g.color||new M.Color(0,0,0)),this.outlineWidth=g.width||.1,this.outlinePushback=g.pushback||1,this.outlineMaxPixels=g.maxpixels||0,this.setValues(g)}clone(g=new w){return super.clone.call(this,g),g.outlineColor=this.outlineColor,g.outlineWidth=this.outlineWidth,g.outlinePushback=this.outlinePushback,g.outlineMaxPixels=this.outlineMaxPixels,g}}},"./src/WebGL/materials/SpriteMaterial.ts":(K,C,d)=>{d.r(C),d.d(C,{SpriteMaterial:()=>_});var M=d("./src/WebGL/constants/SpriteAlignment.ts"),L=d("./src/WebGL/core/Texture.ts"),w=d("./src/colors.ts"),O=d("./src/WebGL/math/index.ts"),g=d("./src/WebGL/materials/Material.ts");class _ extends g.Material{constructor(c){super(),this.color=new w.Color(16777215),this.map=new L.Texture,this.useScreenCoordinates=!0,this.fog=!1,this.uvOffset=new O.Vector2(0,0),this.uvScale=new O.Vector2(1,1),this.depthTest=!this.useScreenCoordinates,this.sizeAttenuation=!this.useScreenCoordinates,this.screenOffset=this.screenOffset,this.scaleByViewPort=!this.sizeAttenuation,this.alignment=M.SpriteAlignment.center.clone(),this.setValues(c),c=c||{},c.depthTest===void 0&&(this.depthTest=!this.useScreenCoordinates),c.sizeAttenuation===void 0&&(this.sizeAttenuation=!this.useScreenCoordinates),c.scaleByViewPort===void 0&&(this.scaleByViewPort=!this.sizeAttenuation)}clone(c=new _){return super.clone.call(this,c),c.color.copy(this.color),c.map=this.map,c.useScreenCoordinates=this.useScreenCoordinates,c.screenOffset=this.screenOffset,c.sizeAttenuation=this.sizeAttenuation,c.scaleByViewport=this.scaleByViewPort,c.alignment.copy(this.alignment),c.uvOffset.copy(this.uvOffset),c}}},"./src/WebGL/materials/StickImposterMaterial.ts":(K,C,d)=>{d.r(C),d.d(C,{StickImposterMaterial:()=>L});var M=d("./src/WebGL/materials/ImposterMaterial.ts");class L extends M.ImposterMaterial{constructor(O){super(O),this.shaderID="stickimposter",this.setValues(O)}clone(O=new L){return super.clone.call(this,O),O}}},"./src/WebGL/materials/StickImposterOutlineMaterial.ts":(K,C,d)=>{d.r(C),d.d(C,{StickImposterOutlineMaterial:()=>w});var M=d("./src/colors.ts"),L=d("./src/WebGL/materials/ImposterMaterial.ts");class w extends L.ImposterMaterial{constructor(g={}){super(g),this.shaderID="stickimposteroutline",this.outlineColor=new M.Color(0,0,0),this.outlineWidth=.1,this.outlinePushback=1,this.outlineMaxPixels=0,g.color&&(this.outlineColor=M.CC.color(g.color)),g.width&&(this.outlineWidth=g.width),g.pushback&&(this.outlinePushback=g.pushback),g.maxpixels&&(this.outlineMaxPixels=g.maxpixels),this.setValues(g)}clone(g=new w){return super.clone.call(this,g),g.outlineColor=this.outlineColor,g.outlineWidth=this.outlineWidth,g.outlinePushback=this.outlinePushback,g.outlineMaxPixels=this.outlineMaxPixels,g}}},"./src/WebGL/materials/VolumetricMaterial.ts":(K,C,d)=>{d.r(C),d.d(C,{VolumetricMaterial:()=>O});var M=d("./src/WebGL/constants/Sides.ts"),L=d("./src/colors.ts"),w=d("./src/WebGL/materials/Material.ts");class O extends w.Material{constructor(_){super(),this.transparent=!1,this.volumetric=!0,this.color=new L.Color(16777215),this.transferfn=null,this.map=void 0,this.extent=[],this.maxdepth=100,this.unit=0,this.texmatrix=null,this.transfermin=-1,this.transfermax=1,this.subsamples=5,this.shaderID="volumetric",this.side=M.FrontSide,this.setValues(_)}clone(_=new O){return super.clone.call(this,_),_.transparent=this.transparent,_.volumetric=this.volumetric,_.color=this.color,_.transferfn=this.transferfn,_.map=this.map,_.extent=this.extent,_.maxdepth=this.maxdepth,_.unit=this.unit,_.texmatrix=this.texmatrix,_.transfermin=this.transfermin,_.transfermax=this.transfermax,_.subsamples=this.subsamples,_.shaderID=this.shaderID,_.side=this.side,_}}},"./src/WebGL/materials/index.ts":(K,C,d)=>{d.r(C),d.d(C,{ImposterMaterial:()=>M.ImposterMaterial,InstancedMaterial:()=>L.InstancedMaterial,LineBasicMaterial:()=>w.LineBasicMaterial,Material:()=>O.Material,MaterialIdCount:()=>O.MaterialIdCount,MeshDoubleLambertMaterial:()=>g.MeshDoubleLambertMaterial,MeshLambertMaterial:()=>_.MeshLambertMaterial,MeshOutlineMaterial:()=>A.MeshOutlineMaterial,SphereImposterMaterial:()=>c.SphereImposterMaterial,SphereImposterOutlineMaterial:()=>y.SphereImposterOutlineMaterial,SpriteMaterial:()=>b.SpriteMaterial,StickImposterMaterial:()=>u.StickImposterMaterial,StickImposterOutlineMaterial:()=>p.StickImposterOutlineMaterial,VolumetricMaterial:()=>r.VolumetricMaterial});var M=d("./src/WebGL/materials/ImposterMaterial.ts"),L=d("./src/WebGL/materials/InstancedMaterial.ts"),w=d("./src/WebGL/materials/LineBasicMaterial.ts"),O=d("./src/WebGL/materials/Material.ts"),g=d("./src/WebGL/materials/MeshDoubleLambertMaterial.ts"),_=d("./src/WebGL/materials/MeshLambertMaterial.ts"),A=d("./src/WebGL/materials/MeshOutlineMaterial.ts"),c=d("./src/WebGL/materials/SphereImposterMaterial.ts"),y=d("./src/WebGL/materials/SphereImposterOutlineMaterial.ts"),b=d("./src/WebGL/materials/SpriteMaterial.ts"),u=d("./src/WebGL/materials/StickImposterMaterial.ts"),p=d("./src/WebGL/materials/StickImposterOutlineMaterial.ts"),r=d("./src/WebGL/materials/VolumetricMaterial.ts")},"./src/WebGL/math/Quaternion.ts":(K,C,d)=>{d.r(C),d.d(C,{Quaternion:()=>M});class M{constructor(w,O,g,_){this.x=w||0,this.y=O||0,this.z=g||0,this.w=_!==void 0?_:1}set(w,O,g,_){return this.x=w,this.y=O,this.z=g,this.w=_,this}copy(w){return this.x=w.x,this.y=w.y,this.z=w.z,this.w=w.w,this}conjugate(){return this.x*=-1,this.y*=-1,this.z*=-1,this}inverse(){return this.conjugate().normalize()}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}lengthxyz(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}normalize(){let w=this.length();return w===0?(this.x=0,this.y=0,this.z=0,this.w=1):(w=1/w,this.x*=w,this.y*=w,this.z*=w,this.w*=w),this}multiply(w){return this.multiplyQuaternions(this,w)}multiplyScalar(w){return this.x*=w,this.y*=w,this.z*=w,this.w*=w,this}multiplyQuaternions(w,O){const g=w.x,_=w.y,A=w.z,c=w.w,y=O.x,b=O.y,u=O.z,p=O.w;return this.x=g*p+c*y+_*u-A*b,this.y=_*p+c*b+A*y-g*u,this.z=A*p+c*u+g*b-_*y,this.w=c*p-g*y-_*b-A*u,this}sub(w){return this.x-=w.x,this.y-=w.y,this.z-=w.z,this.w-=w.w,this}clone(){return new M(this.x,this.y,this.z,this.w)}setFromEuler(w){const O=Math.cos(w.x/2),g=Math.cos(w.y/2),_=Math.cos(w.z/2),A=Math.sin(w.x/2),c=Math.sin(w.y/2),y=Math.sin(w.z/2);return this.x=A*g*_+O*c*y,this.y=O*c*_-A*g*y,this.z=O*g*y+A*c*_,this.w=O*g*_-A*c*y,this}}},"./src/WebGL/math/Vector2.ts":(K,C,d)=>{d.r(C),d.d(C,{Vector2:()=>M});class M{constructor(w,O){this.x=w||0,this.y=O||0}set(w,O){return this.x=w,this.y=O,this}subVectors(w,O){return this.x=w.x-O.x,this.y=w.y-O.y,this}copy(w){return this.x=w.x,this.y=w.y,this}clone(){return new M(this.x,this.y)}}},"./src/WebGL/math/index.ts":(K,C,d)=>{d.r(C),d.d(C,{Matrix3:()=>_.Matrix3,Matrix4:()=>_.Matrix4,Quaternion:()=>M.Quaternion,Ray:()=>_.Ray,Vector2:()=>L.Vector2,Vector3:()=>_.Vector3,clamp:()=>w.clamp,conversionMatrix3:()=>O.conversionMatrix3,degToRad:()=>g.degToRad});var M=d("./src/WebGL/math/Quaternion.ts"),L=d("./src/WebGL/math/Vector2.ts"),w=d("./src/WebGL/math/utils/clamp.ts"),O=d("./src/WebGL/math/utils/conversionMatrix3.ts"),g=d("./src/WebGL/math/utils/degToRad.ts"),_=d("./src/WebGL/math/math.ts")},"./src/WebGL/math/math.ts":(K,C,d)=>{d.r(C),d.d(C,{Matrix3:()=>b,Matrix4:()=>c,Ray:()=>u,Vector3:()=>y});var M=d("./src/WebGL/math/utils/degToRad.ts"),L=d("./src/WebGL/math/utils/clamp.ts"),w,O,g,_,A;class c{constructor(r=1,e=0,i=0,s=0,a=0,h=1,t=0,n=0,f=0,o=0,v=1,m=0,E=0,S=0,T=0,P=1){typeof r<"u"&&typeof r!="number"?this.elements=new Float32Array(r):(this.elements=new Float32Array(16),this.elements[0]=r,this.elements[4]=e,this.elements[8]=i,this.elements[12]=s,this.elements[1]=a,this.elements[5]=h,this.elements[9]=t,this.elements[13]=n,this.elements[2]=f,this.elements[6]=o,this.elements[10]=v,this.elements[14]=m,this.elements[3]=E,this.elements[7]=S,this.elements[11]=T,this.elements[15]=P)}makeScale(r,e,i){throw new Error("Method not implemented.")}set(r,e,i,s,a,h,t,n,f,o,v,m,E,S,T,P){const I=this.elements;return I[0]=r,I[4]=e,I[8]=i,I[12]=s,I[1]=a,I[5]=h,I[9]=t,I[13]=n,I[2]=f,I[6]=o,I[10]=v,I[14]=m,I[3]=E,I[7]=S,I[11]=T,I[15]=P,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}copy(r){const e=r.elements;return this.set(e[0],e[4],e[8],e[12],e[1],e[5],e[9],e[13],e[2],e[6],e[10],e[14],e[3],e[7],e[11],e[15]),this}matrix3FromTopLeft(){const r=this.elements;return new b(r[0],r[4],r[8],r[1],r[5],r[9],r[2],r[6],r[10])}setRotationFromEuler(r,e){const i=this.elements,{x:s,y:a,z:h}=r,t=Math.cos(s),n=Math.sin(s),f=Math.cos(a),o=Math.sin(a),v=Math.cos(h),m=Math.sin(h);if(e===void 0||e==="XYZ"){const E=t*v,S=t*m,T=n*v,P=n*m;i[0]=f*v,i[4]=-f*m,i[8]=o,i[1]=S+T*o,i[5]=E-P*o,i[9]=-n*f,i[2]=P-E*o,i[6]=T+S*o,i[10]=t*f}else console.error(`Error with matrix4 setRotationFromEuler. Order: ${e}`);return this}setRotationFromQuaternion(r){const e=this.elements,{x:i,y:s,z:a,w:h}=r,t=i+i,n=s+s,f=a+a,o=i*t,v=i*n,m=i*f,E=s*n,S=s*f,T=a*f,P=h*t,I=h*n,B=h*f;return e[0]=1-(E+T),e[4]=v-B,e[8]=m+I,e[1]=v+B,e[5]=1-(o+T),e[9]=S-P,e[2]=m-I,e[6]=S+P,e[10]=1-(o+E),this}multiplyMatrices(r,e){const i=r.elements,s=e.elements,a=this.elements,h=i[0],t=i[4],n=i[8],f=i[12],o=i[1],v=i[5],m=i[9],E=i[13],S=i[2],T=i[6],P=i[10],I=i[14],B=i[3],R=i[7],z=i[11],U=i[15],W=s[0],F=s[4],N=s[8],q=s[12],J=s[1],oe=s[5],le=s[9],fe=s[13],ie=s[2],ne=s[6],we=s[10],Ee=s[14],Se=s[3],de=s[7],ee=s[11],me=s[15];return a[0]=h*W+t*J+n*ie+f*Se,a[4]=h*F+t*oe+n*ne+f*de,a[8]=h*N+t*le+n*we+f*ee,a[12]=h*q+t*fe+n*Ee+f*me,a[1]=o*W+v*J+m*ie+E*Se,a[5]=o*F+v*oe+m*ne+E*de,a[9]=o*N+v*le+m*we+E*ee,a[13]=o*q+v*fe+m*Ee+E*me,a[2]=S*W+T*J+P*ie+I*Se,a[6]=S*F+T*oe+P*ne+I*de,a[10]=S*N+T*le+P*we+I*ee,a[14]=S*q+T*fe+P*Ee+I*me,a[3]=B*W+R*J+z*ie+U*Se,a[7]=B*F+R*oe+z*ne+U*de,a[11]=B*N+R*le+z*we+U*ee,a[15]=B*q+R*fe+z*Ee+U*me,this}multiplyScalar(r){const e=this.elements;return e[0]*=r,e[4]*=r,e[8]*=r,e[12]*=r,e[1]*=r,e[5]*=r,e[9]*=r,e[13]*=r,e[2]*=r,e[6]*=r,e[10]*=r,e[14]*=r,e[3]*=r,e[7]*=r,e[11]*=r,e[15]*=r,this}makeTranslation(r,e,i){return this.set(1,0,0,r,0,1,0,e,0,0,1,i,0,0,0,1),this}snap(r){const e=Math.pow(10,4),i=this.elements;for(let s=0;s<16;s++){const a=Math.round(i[s]);a===Math.round(i[s]*e)/e&&(i[s]=a)}return this}transpose(){const r=this.elements;let e;return e=r[1],r[1]=r[4],r[4]=e,e=r[2],r[2]=r[8],r[8]=e,e=r[6],r[6]=r[9],r[9]=e,e=r[3],r[3]=r[12],r[12]=e,e=r[7],r[7]=r[13],r[13]=e,e=r[11],r[11]=r[14],r[14]=e,this}setPosition(r){const e=this.elements;return e[12]=r.x,e[13]=r.y,e[14]=r.z,this}translate(r){const e=this.elements;return e[12]+=r.x,e[13]+=r.y,e[14]+=r.z,this}getInverse(r,e){const i=this.elements,s=r.elements,a=s[0],h=s[4],t=s[8],n=s[12],f=s[1],o=s[5],v=s[9],m=s[13],E=s[2],S=s[6],T=s[10],P=s[14],I=s[3],B=s[7],R=s[11],z=s[15];i[0]=v*P*B-m*T*B+m*S*R-o*P*R-v*S*z+o*T*z,i[4]=n*T*B-t*P*B-n*S*R+h*P*R+t*S*z-h*T*z,i[8]=t*m*B-n*v*B+n*o*R-h*m*R-t*o*z+h*v*z,i[12]=n*v*S-t*m*S-n*o*T+h*m*T+t*o*P-h*v*P,i[1]=m*T*I-v*P*I-m*E*R+f*P*R+v*E*z-f*T*z,i[5]=t*P*I-n*T*I+n*E*R-a*P*R-t*E*z+a*T*z,i[9]=n*v*I-t*m*I-n*f*R+a*m*R+t*f*z-a*v*z,i[13]=t*m*E-n*v*E+n*f*T-a*m*T-t*f*P+a*v*P,i[2]=o*P*I-m*S*I+m*E*B-f*P*B-o*E*z+f*S*z,i[6]=n*S*I-h*P*I-n*E*B+a*P*B+h*E*z-a*S*z,i[10]=h*m*I-n*o*I+n*f*B-a*m*B-h*f*z+a*o*z,i[14]=n*o*E-h*m*E-n*f*S+a*m*S+h*f*P-a*o*P,i[3]=v*S*I-o*T*I-v*E*B+f*T*B+o*E*R-f*S*R,i[7]=h*T*I-t*S*I+t*E*B-a*T*B-h*E*R+a*S*R,i[11]=t*o*I-h*v*I-t*f*B+a*v*B+h*f*R-a*o*R,i[15]=h*v*E-t*o*E+t*f*S-a*v*S-h*f*T+a*o*T;const U=a*i[0]+f*i[4]+E*i[8]+I*i[12];if(U===0){const W="Matrix4.getInverse(): can't invert matrix, determinant is 0";if(e)throw new Error(W);return console.warn(W),this.identity(),this}return this.multiplyScalar(1/U),this}isReflected(){const r=this.elements,e=r[0],i=r[4],s=r[8],a=r[1],h=r[5],t=r[9],n=r[2],f=r[6],o=r[10];return e*h*o+a*f*s+n*i*t-n*h*s-a*i*o-e*f*t<0}scale(r){const e=this.elements,{x:i}=r,{y:s}=r,{z:a}=r;return e[0]*=i,e[4]*=s,e[8]*=a,e[1]*=i,e[5]*=s,e[9]*=a,e[2]*=i,e[6]*=s,e[10]*=a,e[3]*=i,e[7]*=s,e[11]*=a,this}getMaxScaleOnAxis(){const r=this.elements,e=r[0]*r[0]+r[1]*r[1]+r[2]*r[2],i=r[4]*r[4]+r[5]*r[5]+r[6]*r[6],s=r[8]*r[8]+r[9]*r[9]+r[10]*r[10];return Math.sqrt(Math.max(e,Math.max(i,s)))}makeFrustum(r,e,i,s,a,h){const t=this.elements,n=2*a/(e-r),f=2*a/(s-i),o=(e+r)/(e-r),v=(s+i)/(s-i),m=-(h+a)/(h-a),E=-2*h*a/(h-a);return t[0]=n,t[4]=0,t[8]=o,t[12]=0,t[1]=0,t[5]=f,t[9]=v,t[13]=0,t[2]=0,t[6]=0,t[10]=m,t[14]=E,t[3]=0,t[7]=0,t[11]=-1,t[15]=0,this}makePerspective(r,e,i,s){const a=i*Math.tan((0,M.degToRad)(r*.5)),h=-a,t=h*e,n=a*e;return this.makeFrustum(t,n,h,a,i,s)}makeOrthographic(r,e,i,s,a,h){const t=this.elements,n=1/(e-r),f=1/(i-s),o=1/(h-a),v=(e+r)*n,m=(i+s)*f,E=(h+a)*o;return t[0]=2*n,t[4]=0,t[8]=0,t[12]=-v,t[1]=0,t[5]=2*f,t[9]=0,t[13]=-m,t[2]=0,t[6]=0,t[10]=-2*o,t[14]=-E,t[3]=0,t[7]=0,t[11]=0,t[15]=1,this}isEqual(r){const e=r.elements,i=this.elements;return i[0]===e[0]&&i[4]===e[4]&&i[8]===e[8]&&i[12]===e[12]&&i[1]===e[1]&&i[5]===e[5]&&i[9]===e[9]&&i[13]===e[13]&&i[2]===e[2]&&i[6]===e[6]&&i[10]===e[10]&&i[14]===e[14]&&i[3]===e[3]&&i[7]===e[7]&&i[11]===e[11]&&i[15]===e[15]}clone(){const r=this.elements;return new c(r[0],r[4],r[8],r[12],r[1],r[5],r[9],r[13],r[2],r[6],r[10],r[14],r[3],r[7],r[11],r[15])}isIdentity(){const r=this.elements;return r[0]===1&&r[4]===0&&r[8]===0&&r[12]===0&&r[1]===0&&r[5]===1&&r[9]===0&&r[13]===0&&r[2]===0&&r[6]===0&&r[10]===1&&r[14]===0&&r[3]===0&&r[7]===0&&r[11]===0&&r[15]===1}isNearlyIdentity(r){return this.clone().snap(r).isIdentity()}getScale(r){const e=this.elements;return r=r||new y,g.set(e[0],e[1],e[2]),_.set(e[4],e[5],e[6]),A.set(e[8],e[9],e[10]),r.x=g.length(),r.y=_.length(),r.z=A.length(),r}lookAt(r,e,i){const s=this.elements;return A.subVectors(r,e).normalize(),A.length()===0&&(A.z=1),g.crossVectors(i,A).normalize(),g.length()===0&&(A.x+=1e-4,g.crossVectors(i,A).normalize()),_.crossVectors(A,g),s[0]=g.x,s[4]=_.x,s[8]=A.x,s[1]=g.y,s[5]=_.y,s[9]=A.y,s[2]=g.z,s[6]=_.z,s[10]=A.z,this}compose(r,e,i){const s=this.elements;return w.identity(),w.setRotationFromQuaternion(e),O.makeScale(i.x,i.y,i.z),this.multiplyMatrices(w,O),s[12]=r.x,s[13]=r.y,s[14]=r.z,this}}w=new c,O=new c;class y{constructor(r,e,i){this.x=r||0,this.y=e||0,this.z=i||0,this.atomid=void 0}set(r,e,i){return this.x=r,this.y=e,this.z=i,this}copy(r){return this.x=r.x,this.y=r.y,this.z=r.z,this}add(r){return this.x+=r.x,this.y+=r.y,this.z+=r.z,this}addVectors(r,e){return this.x=r.x+e.x,this.y=r.y+e.y,this.z=r.z+e.z,this}multiplyVectors(r,e){return this.x=r.x*e.x,this.y=r.y*e.y,this.z=r.z*e.z,this}sub(r){return this.x-=r.x,this.y-=r.y,this.z-=r.z,this}subVectors(r,e){return this.x=r.x-e.x,this.y=r.y-e.y,this.z=r.z-e.z,this}multiplyScalar(r){return this.x*=r,this.y*=r,this.z*=r,this}divideScalar(r){return r!==0?(this.x/=r,this.y/=r,this.z/=r):(this.x=0,this.y=0,this.z=0),this}max(r){return this.x=Math.max(this.x,r.x),this.y=Math.max(this.y,r.y),this.z=Math.max(this.z,r.z),this}min(r){return this.x=Math.min(this.x,r.x),this.y=Math.min(this.y,r.y),this.z=Math.min(this.z,r.z),this}distanceTo(r){return Math.sqrt(this.distanceToSquared(r))}distanceToSquared(r){const e=this.x-r.x,i=this.y-r.y,s=this.z-r.z;return e*e+i*i+s*s}applyMatrix3(r){const{x:e}=this,{y:i}=this,{z:s}=this,a=r.elements;return this.x=a[0]*e+a[3]*i+a[6]*s,this.y=a[1]*e+a[4]*i+a[7]*s,this.z=a[2]*e+a[5]*i+a[8]*s,this}applyMatrix4(r){const{x:e}=this,{y:i}=this,{z:s}=this,a=r.elements;return this.x=a[0]*e+a[4]*i+a[8]*s+a[12],this.y=a[1]*e+a[5]*i+a[9]*s+a[13],this.z=a[2]*e+a[6]*i+a[10]*s+a[14],this}applyProjection(r){const{x:e}=this,{y:i}=this,{z:s}=this,a=r.elements,h=a[3]*e+a[7]*i+a[11]*s+a[15];return this.x=(a[0]*e+a[4]*i+a[8]*s+a[12])/h,this.y=(a[1]*e+a[5]*i+a[9]*s+a[13])/h,this.z=(a[2]*e+a[6]*i+a[10]*s+a[14])/h,this}applyQuaternion(r){const{x:e}=this,{y:i}=this,{z:s}=this,a=r.x,h=r.y,t=r.z,n=r.w,f={};f.x=2*(i*t-s*h),f.y=2*(s*a-e*t),f.z=2*(e*h-i*a);const o={};return o.x=f.y*t-f.z*h,o.y=f.z*a-f.x*t,o.z=f.x*h-f.y*a,this.x=e+n*f.x+o.x,this.y=i+n*f.y+o.y,this.z=s+n*f.z+o.z,this}negate(){return this.multiplyScalar(-1)}dot(r){return this.x*r.x+this.y*r.y+this.z*r.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}normalize(){return this.divideScalar(this.length())}cross(r){const{x:e}=this,{y:i}=this,{z:s}=this;return this.x=i*r.z-s*r.y,this.y=s*r.x-e*r.z,this.z=e*r.y-i*r.x,this}crossVectors(r,e){return this.x=r.y*e.z-r.z*e.y,this.y=r.z*e.x-r.x*e.z,this.z=r.x*e.y-r.y*e.x,this}equals(r){return this.x==r.x&&this.y==r.y&&this.z==r.z}getPositionFromMatrix(r){return this.x=r.elements[12],this.y=r.elements[13],this.z=r.elements[14],this}setEulerFromRotationMatrix(r,e){const i=r.elements,s=i[0],a=i[4],h=i[8],t=i[5],n=i[9],f=i[6],o=i[10];return e===void 0||e==="XYZ"?(this.y=Math.asin((0,L.clamp)(h,-1,1)),Math.abs(h)<.99999?(this.x=Math.atan2(-n,o),this.z=Math.atan2(-a,s)):(this.x=Math.atan2(f,t),this.z=0)):console.error(`Error with vector's setEulerFromRotationMatrix: Unknown order: ${e}`),this}rotateAboutVector(r,e){r.normalize();const i=Math.cos(e),s=Math.sin(e),a=this.clone().multiplyScalar(i),h=r.clone().cross(this).multiplyScalar(s),t=r.clone().multiplyScalar(r.clone().dot(this)).multiplyScalar(1-i),n=a.add(h).add(t);return this.x=n.x,this.y=n.y,this.z=n.z,this}setFromMatrixPosition(r){const e=r.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this}transformDirection(r){const{x:e}=this,{y:i}=this,{z:s}=this,a=r.elements;return this.x=a[0]*e+a[4]*i+a[8]*s,this.y=a[1]*e+a[5]*i+a[9]*s,this.z=a[2]*e+a[6]*i+a[10]*s,this.normalize()}clone(){return new y(this.x,this.y,this.z)}unproject(r){const e=w;return e.multiplyMatrices(r.matrixWorld,e.getInverse(r.projectionMatrix)),this.applyMatrix4(e)}}g=new y,_=new y,A=new y;class b{constructor(r=1,e=0,i=0,s=0,a=1,h=0,t=0,n=0,f=1){this.elements=new Float32Array(9),this.set(r,e,i,s,a,h,t,n,f)}set(r,e,i,s,a,h,t,n,f){const o=this.elements;return o[0]=r,o[3]=e,o[6]=i,o[1]=s,o[4]=a,o[7]=h,o[2]=t,o[5]=n,o[8]=f,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(r){const e=r.elements;this.set(e[0],e[3],e[6],e[1],e[4],e[7],e[2],e[5],e[8])}multiplyScalar(r){const e=this.elements;return e[0]*=r,e[3]*=r,e[6]*=r,e[1]*=r,e[4]*=r,e[7]*=r,e[2]*=r,e[5]*=r,e[8]*=r,this}getInverse3(r){const e=r.elements,i=this.elements;i[0]=e[4]*e[8]-e[5]*e[7],i[3]=e[6]*e[5]-e[3]*e[8],i[6]=e[3]*e[7]-e[6]*e[4],i[1]=e[7]*e[2]-e[1]*e[8],i[4]=e[0]*e[8]-e[6]*e[2],i[7]=e[1]*e[6]-e[0]*e[7],i[2]=e[1]*e[5]-e[2]*e[4],i[5]=e[2]*e[3]-e[0]*e[5],i[8]=e[0]*e[4]-e[1]*e[3];const s=e[0]*i[0]+e[3]*i[1]+e[6]*i[2];return this.multiplyScalar(1/s),this}getInverse(r,e){const i=r.elements,s=this.elements;s[0]=i[10]*i[5]-i[6]*i[9],s[1]=-i[10]*i[1]+i[2]*i[9],s[2]=i[6]*i[1]-i[2]*i[5],s[3]=-i[10]*i[4]+i[6]*i[8],s[4]=i[10]*i[0]-i[2]*i[8],s[5]=-i[6]*i[0]+i[2]*i[4],s[6]=i[9]*i[4]-i[5]*i[8],s[7]=-i[9]*i[0]+i[1]*i[8],s[8]=i[5]*i[0]-i[1]*i[4];const a=i[0]*s[0]+i[1]*s[3]+i[2]*s[6];if(a===0){const h="Matrix3.getInverse(): can't invert matrix, determinant is 0";if(e)throw new Error(h);return console.warn(h),this.identity(),this}return this.multiplyScalar(1/a),this}getDeterminant(){const r=this.elements;return r[0]*r[4]*r[8]+r[1]*r[5]*r[6]+r[2]*r[3]*r[7]-r[2]*r[4]*r[6]-r[1]*r[3]*r[8]-r[0]*r[5]*r[7]}transpose(){let r;const e=this.elements;return r=e[1],e[1]=e[3],e[3]=r,r=e[2],e[2]=e[6],e[6]=r,r=e[5],e[5]=e[7],e[7]=r,this}clone(){const r=this.elements;return new b(r[0],r[3],r[6],r[1],r[4],r[7],r[2],r[5],r[8])}getMatrix4(){const r=this.elements;return new c(r[0],r[3],r[6],0,r[1],r[4],r[7],0,r[2],r[5],r[8],0)}}class u{constructor(r,e){this.origin=r!==void 0?r:new y,this.direction=e!==void 0?e:new y}set(r,e){return this.origin.copy(r),this.direction.copy(e),this}copy(r){return this.origin.copy(r.origin),this.direction.copy(r.direction),this}at(r,e){return(e||new y).copy(this.direction).multiplyScalar(r).add(this.origin)}recast(r){const e=g;return this.origin.copy(this.at(r,e)),this}closestPointToPoint(r,e){const i=e||new y;i.subVectors(r,this.origin);const s=i.dot(this.direction);return i.copy(this.direction).multiplyScalar(s).add(this.origin)}distanceToPoint(r){const e=g,i=e.subVectors(r,this.origin).dot(this.direction);return e.copy(this.direction).multiplyScalar(i).add(this.origin),e.distanceTo(r)}isIntersectionCylinder(){}isIntersectionSphere(r){return this.distanceToPoint(r.center)<=r.radius}isIntersectionPlane(r){return r.normal.dot(this.direction)!==0||r.distanceToPoint(this.origin)===0}distanceToPlane(r){const e=r.normal.dot(this.direction);return e===0?r.distanceToPoint(this.origin)===0?0:void 0:-(this.origin.dot(r.normal)+r.constant)/e}intersectPlane(r,e){const i=this.distanceToPlane(r);if(i!==void 0)return this.at(i,e)}applyMatrix4(r){return this.direction.add(this.origin).applyMatrix4(r),this.origin.applyMatrix4(r),this.direction.sub(this.origin),this}clone(){return new u().copy(this)}}},"./src/WebGL/math/utils/clamp.ts":(K,C,d)=>{d.r(C),d.d(C,{clamp:()=>M});function M(L,w,O){return Math.min(Math.max(L,w),O)}},"./src/WebGL/math/utils/conversionMatrix3.ts":(K,C,d)=>{d.r(C),d.d(C,{conversionMatrix3:()=>L});var M=d("./src/WebGL/math/math.ts");function L(w,O,g,_,A,c){_=_*Math.PI/180,A=A*Math.PI/180,c=c*Math.PI/180;const y=i=>i*i,b=Math.cos(_),u=Math.cos(A),p=Math.cos(c),r=Math.sin(c);return new M.Matrix3(w,O*p,g*u,0,O*r,g*(b-u*p)/r,0,0,g*Math.sqrt(1-y(b)-y(u)-y(p)+2*b*u*p)/r)}},"./src/WebGL/math/utils/degToRad.ts":(K,C,d)=>{d.r(C),d.d(C,{degToRad:()=>L});const M=Math.PI/180;function L(w){return w*M}},"./src/WebGL/objects/Line.ts":(K,C,d)=>{d.r(C),d.d(C,{Line:()=>O,LineStyle:()=>w});var M=d("./src/WebGL/materials/index.ts"),L=d("./src/WebGL/core/index.ts"),w;(function(g){g[g.LineStrip=0]="LineStrip",g[g.LinePieces=1]="LinePieces"})(w||(w={}));class O extends L.Object3D{constructor(_,A=new M.LineBasicMaterial({color:Math.random()*16777215}),c=w.LineStrip){super(),this.geometry=_,this.material=A,this.type=c}clone(_=new O(this.geometry,this.material,this.type)){return super.clone.call(this,_),_}}},"./src/WebGL/objects/Mesh.ts":(K,C,d)=>{d.r(C),d.d(C,{Mesh:()=>L});var M=d("./src/WebGL/core/index.ts");class L extends M.Object3D{constructor(O,g){super(),this.geometry=O,this.material=g}clone(O){return O===void 0&&(O=new L(this.geometry,this.material)),super.clone.call(this,O),O}}},"./src/WebGL/objects/Sprite.ts":(K,C,d)=>{d.r(C),d.d(C,{Sprite:()=>w});var M=d("./src/WebGL/materials/index.ts"),L=d("./src/WebGL/core/index.ts");class w extends L.Object3D{constructor(g=new M.SpriteMaterial){super(),this.material=g,this.rotation3d=this.rotation,this.rotation=0}updateMatrix(){this.matrix.setPosition(this.position),this.rotation3d.set(0,0,this.rotation),this.matrix.setRotationFromEuler(this.rotation3d),(this.scale.x!==1||this.scale.y!==1)&&this.matrix.scale(this.scale),this.matrixWorldNeedsUpdate=!0}clone(g=new w(this.material)){return L.Object3D.prototype.clone.call(this,g),g}}},"./src/WebGL/objects/index.ts":(K,C,d)=>{d.r(C),d.d(C,{Line:()=>M.Line,LineStyle:()=>M.LineStyle,Mesh:()=>L.Mesh,Sprite:()=>w.Sprite});var M=d("./src/WebGL/objects/Line.ts"),L=d("./src/WebGL/objects/Mesh.ts"),w=d("./src/WebGL/objects/Sprite.ts")},"./src/WebGL/shaders/ShaderType.ts":(K,C,d)=>{d.r(C)},"./src/WebGL/shaders/index.ts":(K,C,d)=>{d.r(C),d.d(C,{ShaderLib:()=>M.ShaderLib,ShaderUtils:()=>L.ShaderUtils,basic:()=>M.basic,clone:()=>L.clone,instanced:()=>M.instanced,lambert:()=>M.lambert,lambertdouble:()=>M.lambertdouble,outline:()=>M.outline,screen:()=>M.screen,screenaa:()=>M.screenaa,sphereimposter:()=>M.sphereimposter,sphereimposteroutline:()=>M.sphereimposteroutline,sprite:()=>M.sprite,stickimposter:()=>M.stickimposter,stickimposteroutline:()=>M.stickimposteroutline,volumetric:()=>M.volumetric});var M=d("./src/WebGL/shaders/lib/index.ts"),L=d("./src/WebGL/shaders/utils/index.ts");d("./src/WebGL/shaders/ShaderType.ts")},"./src/WebGL/shaders/lib/basic/index.ts":(K,C,d)=>{d.r(C),d.d(C,{basic:()=>O});var M=d("./src/WebGL/shaders/lib/basic/uniforms.ts"),L=d("./src/WebGL/shaders/lib/basic/basic.frag"),w=d("./src/WebGL/shaders/lib/basic/basic.vert");const O={vertexShader:w.default.replace("#define GLSLIFY 1",""),fragmentShader:L.default.replace("#define GLSLIFY 1",""),uniforms:M.uniforms}},"./src/WebGL/shaders/lib/basic/uniforms.ts":(K,C,d)=>{d.r(C),d.d(C,{uniforms:()=>L});var M=d("./src/colors.ts");const L={opacity:{type:"f",value:1},fogColor:{type:"c",value:new M.Color(1,1,1)},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3}}},"./src/WebGL/shaders/lib/blur/index.ts":(K,C,d)=>{d.r(C),d.d(C,{blur:()=>O});var M=d("./src/WebGL/shaders/lib/blur/uniforms.ts"),L=d("./src/WebGL/shaders/lib/blur/blur.frag"),w=d("./src/WebGL/shaders/lib/blur/blur.vert");const O={fragmentShader:L.default,vertexShader:w.default,uniforms:M.uniforms}},"./src/WebGL/shaders/lib/blur/uniforms.ts":(K,C,d)=>{d.r(C),d.d(C,{uniforms:()=>M});const M={}},"./src/WebGL/shaders/lib/index.ts":(K,C,d)=>{d.r(C),d.d(C,{ShaderLib:()=>s,basic:()=>M.basic,instanced:()=>L.instanced,lambert:()=>w.lambert,lambertdouble:()=>O.lambertdouble,outline:()=>g.outline,screen:()=>_.screen,screenaa:()=>A.screenaa,sphereimposter:()=>c.sphereimposter,sphereimposteroutline:()=>y.sphereimposteroutline,sprite:()=>b.sprite,stickimposter:()=>u.stickimposter,stickimposteroutline:()=>p.stickimposteroutline,volumetric:()=>r.volumetric});var M=d("./src/WebGL/shaders/lib/basic/index.ts"),L=d("./src/WebGL/shaders/lib/instanced/index.ts"),w=d("./src/WebGL/shaders/lib/lambert/index.ts"),O=d("./src/WebGL/shaders/lib/lambertdouble/index.ts"),g=d("./src/WebGL/shaders/lib/outline/index.ts"),_=d("./src/WebGL/shaders/lib/screen/index.ts"),A=d("./src/WebGL/shaders/lib/screenaa/index.ts"),c=d("./src/WebGL/shaders/lib/sphereimposter/index.ts"),y=d("./src/WebGL/shaders/lib/sphereimposteroutline/index.ts"),b=d("./src/WebGL/shaders/lib/sprite/index.ts"),u=d("./src/WebGL/shaders/lib/stickimposter/index.ts"),p=d("./src/WebGL/shaders/lib/stickimposteroutline/index.ts"),r=d("./src/WebGL/shaders/lib/volumetric/index.ts"),e=d("./src/WebGL/shaders/lib/ssao/index.ts"),i=d("./src/WebGL/shaders/lib/blur/index.ts");const s={basic:M.basic,blur:i.blur,instanced:L.instanced,lambert:w.lambert,lambertdouble:O.lambertdouble,outline:g.outline,screen:_.screen,screenaa:A.screenaa,ssao:e.ssao,sphereimposter:c.sphereimposter,sphereimposteroutline:y.sphereimposteroutline,sprite:b.sprite,stickimposter:u.stickimposter,stickimposteroutline:p.stickimposteroutline,volumetric:r.volumetric}},"./src/WebGL/shaders/lib/instanced/index.ts":(K,C,d)=>{d.r(C),d.d(C,{instanced:()=>O});var M=d("./src/WebGL/shaders/lib/instanced/uniforms.ts"),L=d("./src/WebGL/shaders/lib/instanced/instanced.frag"),w=d("./src/WebGL/shaders/lib/instanced/instanced.vert");const O={fragmentShader:L.default.replace("#define GLSLIFY 1",""),vertexShader:w.default.replace("#define GLSLIFY 1",""),uniforms:M.uniforms}},"./src/WebGL/shaders/lib/instanced/uniforms.ts":(K,C,d)=>{d.r(C),d.d(C,{uniforms:()=>L});var M=d("./src/colors.ts");const L={opacity:{type:"f",value:1},fogColor:{type:"c",value:new M.Color(1,1,1)},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},directionalLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]}}},"./src/WebGL/shaders/lib/lambert/index.ts":(K,C,d)=>{d.r(C),d.d(C,{lambert:()=>O});var M=d("./src/WebGL/shaders/lib/lambert/uniforms.ts"),L=d("./src/WebGL/shaders/lib/lambert/lambert.frag"),w=d("./src/WebGL/shaders/lib/lambert/lambert.vert");const O={fragmentShader:L.default.replace("#define GLSLIFY 1",""),vertexShader:w.default.replace("#define GLSLIFY 1",""),uniforms:M.uniforms}},"./src/WebGL/shaders/lib/lambert/uniforms.ts":(K,C,d)=>{d.r(C),d.d(C,{uniforms:()=>L});var M=d("./src/colors.ts");const L={opacity:{type:"f",value:1},fogColor:{type:"c",value:new M.Color(1,1,1)},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},directionalLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]}}},"./src/WebGL/shaders/lib/lambertdouble/index.ts":(K,C,d)=>{d.r(C),d.d(C,{lambertdouble:()=>O});var M=d("./src/WebGL/shaders/lib/lambertdouble/uniforms.ts"),L=d("./src/WebGL/shaders/lib/lambertdouble/lambertdouble.frag"),w=d("./src/WebGL/shaders/lib/lambertdouble/lambertdouble.vert");const O={fragmentShader:L.default.replace("#define GLSLIFY 1",""),vertexShader:w.default.replace("#define GLSLIFY 1",""),uniforms:M.uniforms}},"./src/WebGL/shaders/lib/lambertdouble/uniforms.ts":(K,C,d)=>{d.r(C),d.d(C,{uniforms:()=>L});var M=d("./src/colors.ts");const L={opacity:{type:"f",value:1},fogColor:{type:"c",value:new M.Color(1,1,1)},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},directionalLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]}}},"./src/WebGL/shaders/lib/outline/index.ts":(K,C,d)=>{d.r(C),d.d(C,{outline:()=>O});var M=d("./src/WebGL/shaders/lib/outline/uniforms.ts"),L=d("./src/WebGL/shaders/lib/outline/outline.frag"),w=d("./src/WebGL/shaders/lib/outline/outline.vert");const O={fragmentShader:L.default.replace("#define GLSLIFY 1",""),vertexShader:w.default.replace("#define GLSLIFY 1",""),uniforms:M.uniforms}},"./src/WebGL/shaders/lib/outline/uniforms.ts":(K,C,d)=>{d.r(C),d.d(C,{uniforms:()=>L});var M=d("./src/colors.ts");const L={opacity:{type:"f",value:1},outlineColor:{type:"c",value:new M.Color(0,0,0)},fogColor:{type:"c",value:new M.Color(1,1,1)},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},outlineWidth:{type:"f",value:.1},outlinePushback:{type:"f",value:1},outlineMaxPixels:{type:"f",value:0}}},"./src/WebGL/shaders/lib/screen/index.ts":(K,C,d)=>{d.r(C),d.d(C,{screen:()=>O});var M=d("./src/WebGL/shaders/lib/screen/uniforms.ts"),L=d("./src/WebGL/shaders/lib/screen/screen.frag"),w=d("./src/WebGL/shaders/lib/screen/screen.vert");const O={fragmentShader:L.default.replace("#define GLSLIFY 1",""),vertexShader:w.default.replace("#define GLSLIFY 1",""),uniforms:M.uniforms}},"./src/WebGL/shaders/lib/screen/uniforms.ts":(K,C,d)=>{d.r(C),d.d(C,{uniforms:()=>M});const M={}},"./src/WebGL/shaders/lib/screenaa/index.ts":(K,C,d)=>{d.r(C),d.d(C,{screenaa:()=>O});var M=d("./src/WebGL/shaders/lib/screenaa/uniforms.ts"),L=d("./src/WebGL/shaders/lib/screenaa/screenaa.frag"),w=d("./src/WebGL/shaders/lib/screenaa/screenaa.vert");const O={fragmentShader:L.default.replace("#define GLSLIFY 1",""),vertexShader:w.default.replace("#define GLSLIFY 1",""),uniforms:M.uniforms}},"./src/WebGL/shaders/lib/screenaa/uniforms.ts":(K,C,d)=>{d.r(C),d.d(C,{uniforms:()=>M});const M={}},"./src/WebGL/shaders/lib/sphereimposter/index.ts":(K,C,d)=>{d.r(C),d.d(C,{sphereimposter:()=>O});var M=d("./src/WebGL/shaders/lib/sphereimposter/uniforms.ts"),L=d("./src/WebGL/shaders/lib/sphereimposter/sphereimposter.frag"),w=d("./src/WebGL/shaders/lib/sphereimposter/sphereimposter.vert");const O={vertexShader:w.default.replace("#define GLSLIFY 1",""),fragmentShader:L.default.replace("#define GLSLIFY 1",""),uniforms:M.uniforms}},"./src/WebGL/shaders/lib/sphereimposter/uniforms.ts":(K,C,d)=>{d.r(C),d.d(C,{uniforms:()=>L});var M=d("./src/colors.ts");const L={opacity:{type:"f",value:1},fogColor:{type:"c",value:new M.Color(1,1,1)},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},directionalLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]}}},"./src/WebGL/shaders/lib/sphereimposteroutline/index.ts":(K,C,d)=>{d.r(C),d.d(C,{sphereimposteroutline:()=>O});var M=d("./src/WebGL/shaders/lib/sphereimposteroutline/uniforms.ts"),L=d("./src/WebGL/shaders/lib/sphereimposteroutline/sphereimposteroutline.frag"),w=d("./src/WebGL/shaders/lib/sphereimposteroutline/sphereimposteroutline.vert");const O={fragmentShader:L.default.replace("#define GLSLIFY 1",""),vertexShader:w.default.replace("#define GLSLIFY 1",""),uniforms:M.uniforms}},"./src/WebGL/shaders/lib/sphereimposteroutline/uniforms.ts":(K,C,d)=>{d.r(C),d.d(C,{uniforms:()=>L});var M=d("./src/colors.ts");const L={opacity:{type:"f",value:1},outlineColor:{type:"c",value:new M.Color(0,0,0)},fogColor:{type:"c",value:new M.Color(1,1,1)},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},outlineWidth:{type:"f",value:.1},outlinePushback:{type:"f",value:1},outlineMaxPixels:{type:"f",value:0}}},"./src/WebGL/shaders/lib/sprite/index.ts":(K,C,d)=>{d.r(C),d.d(C,{sprite:()=>O});var M=d("./src/WebGL/shaders/lib/sprite/uniforms.ts"),L=d("./src/WebGL/shaders/lib/sprite/sprite.frag"),w=d("./src/WebGL/shaders/lib/sprite/sprite.vert");const O={fragmentShader:L.default.replace("#define GLSLIFY 1",""),vertexShader:w.default.replace("#define GLSLIFY 1",""),uniforms:M.uniforms}},"./src/WebGL/shaders/lib/sprite/uniforms.ts":(K,C,d)=>{d.r(C),d.d(C,{uniforms:()=>M});const M={}},"./src/WebGL/shaders/lib/ssao/index.ts":(K,C,d)=>{d.r(C),d.d(C,{ssao:()=>O});var M=d("./src/WebGL/shaders/lib/ssao/uniforms.ts"),L=d("./src/WebGL/shaders/lib/ssao/ssao.frag"),w=d("./src/WebGL/shaders/lib/ssao/ssao.vert");const O={fragmentShader:L.default,vertexShader:w.default,uniforms:M.uniforms}},"./src/WebGL/shaders/lib/ssao/uniforms.ts":(K,C,d)=>{d.r(C),d.d(C,{uniforms:()=>M});const M={total_strength:{type:"f",value:1},radius:{type:"f",value:5},projinv:{type:"mat4",value:[]}}},"./src/WebGL/shaders/lib/stickimposter/index.ts":(K,C,d)=>{d.r(C),d.d(C,{stickimposter:()=>_});var M=d("./src/WebGL/shaders/lib/stickimposter/uniforms.ts"),L=d("./src/WebGL/shaders/lib/stickimposter/stickimposterFragmentShader.partial.frag"),w=d("./src/WebGL/shaders/lib/stickimposter/stickimposter.partial.frag"),O=d("./src/WebGL/shaders/lib/stickimposter/stickimposter.vert");const _={fragmentShader:[L.default,w.default].join(`
`),vertexShader:O.default,uniforms:M.uniforms}},"./src/WebGL/shaders/lib/stickimposter/uniforms.ts":(K,C,d)=>{d.r(C),d.d(C,{uniforms:()=>L});var M=d("./src/colors.ts");const L={opacity:{type:"f",value:1},fogColor:{type:"c",value:new M.Color(1,1,1)},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},directionalLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]}}},"./src/WebGL/shaders/lib/stickimposteroutline/index.ts":(K,C,d)=>{d.r(C),d.d(C,{stickimposteroutline:()=>g});var M=d("./src/WebGL/shaders/lib/stickimposteroutline/uniforms.ts"),L=d("./src/WebGL/shaders/lib/stickimposter/stickimposterFragmentShader.partial.frag"),w=d("./src/WebGL/shaders/lib/stickimposteroutline/stickimposteroutline.vert");const g={fragmentShader:L.default+"gl_FragColor = vec4(color,1.0);}",vertexShader:w.default,uniforms:M.uniforms}},"./src/WebGL/shaders/lib/stickimposteroutline/uniforms.ts":(K,C,d)=>{d.r(C),d.d(C,{uniforms:()=>L});var M=d("./src/colors.ts");const L={opacity:{type:"f",value:1},fogColor:{type:"c",value:new M.Color(1,1,1)},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},outlineColor:{type:"c",value:new M.Color(0,0,0)},outlineWidth:{type:"f",value:.1},outlinePushback:{type:"f",value:1},outlineMaxPixels:{type:"f",value:0},projinv:{type:"mat4",value:[]}}},"./src/WebGL/shaders/lib/volumetric/index.ts":(K,C,d)=>{d.r(C),d.d(C,{volumetric:()=>O});var M=d("./src/WebGL/shaders/lib/volumetric/uniforms.ts"),L=d("./src/WebGL/shaders/lib/volumetric/volumetric.frag"),w=d("./src/WebGL/shaders/lib/volumetric/volumetric.vert");const O={fragmentShader:L.default.replace("#define GLSLIFY 1",""),vertexShader:w.default.replace("#define GLSLIFY 1",""),uniforms:M.uniforms}},"./src/WebGL/shaders/lib/volumetric/uniforms.ts":(K,C,d)=>{d.r(C),d.d(C,{uniforms:()=>L});var M=d("./src/colors.ts");const L={opacity:{type:"f",value:1},fogColor:{type:"c",value:new M.Color(1,1,1)},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},data:{type:"i",value:3},colormap:{type:"i",value:4},depthmap:{type:"i",value:5},step:{type:"f",value:1},maxdepth:{type:"f",value:100},subsamples:{type:"f",value:5},textmat:{type:"mat4",value:[]},projinv:{type:"mat4",value:[]},transfermin:{type:"f",value:-.2},transfermax:{type:"f",value:.2}}},"./src/WebGL/shaders/utils/clone.ts":(K,C,d)=>{d.r(C),d.d(C,{clone:()=>L});var M=d("./src/colors.ts");function L(w){let O={};for(const _ in w){O[_]={},O[_].type=w[_].type;var g=w[_].value;g instanceof M.Color?O[_].value=g.clone():typeof g=="number"?O[_].value=g:g instanceof Array?O[_].value=[]:console.error("Error copying shader uniforms from ShaderLib: unknown type for uniform")}return O}},"./src/WebGL/shaders/utils/index.ts":(K,C,d)=>{d.r(C),d.d(C,{ShaderUtils:()=>L,clone:()=>M.clone});var M=d("./src/WebGL/shaders/utils/clone.ts");const L={clone:M.clone}},"./src/WebGL/shapes/Cylinder.ts":(K,C,d)=>{d.r(C),d.d(C,{Cylinder:()=>w});var M=d("./src/WebGL/math/index.ts");let L=new M.Vector3;class w{constructor(g=new M.Vector3,_=new M.Vector3,A=0){this.c1=g,this.c2=_,this.radius=A,this.direction=new M.Vector3().subVectors(this.c2,this.c1).normalize()}copy(g){return this.c1.copy(g.c1),this.c2.copy(g.c2),this.direction.copy(g.direction),this.radius=g.radius,this}lengthSq(){return L.subVectors(this.c2,this.c1).lengthSq()}applyMatrix4(g){return this.direction.add(this.c1).applyMatrix4(g),this.c1.applyMatrix4(g),this.c2.applyMatrix4(g),this.direction.sub(this.c1).normalize(),this.radius=this.radius*g.getMaxScaleOnAxis(),this}}},"./src/WebGL/shapes/Sphere.ts":(K,C,d)=>{d.r(C),d.d(C,{Sphere:()=>L});var M=d("./src/WebGL/math/index.ts");class L{constructor(O={x:0,y:0,z:0},g=0){this.center=new M.Vector3(O.x,O.y,O.z),this.radius=g}set(O,g){return this.center.copy(O),this.radius=g,this}copy(O){return this.center.copy(O.center),this.radius=O.radius,this}applyMatrix4(O){return this.center.applyMatrix4(O),this.radius=this.radius*O.getMaxScaleOnAxis(),this}translate(O){return this.center.add(O),this}equals(O){return O.center.equals(this.center)&&O.radius===this.radius}clone(){return new L().copy(this)}}},"./src/WebGL/shapes/Triangle.ts":(K,C,d)=>{d.r(C),d.d(C,{Triangle:()=>w});var M=d("./src/WebGL/math/index.ts");const L=new M.Vector3;class w{constructor(g=new M.Vector3,_=new M.Vector3,A=new M.Vector3){this.a=g,this.b=_,this.c=A}copy(g){return this.a.copy(g.a),this.b.copy(g.b),this.c.copy(g.c),this}applyMatrix4(g){return this.a.applyMatrix4(g),this.b.applyMatrix4(g),this.c.applyMatrix4(g),this}getNormal(){var g=this.a.clone();return g.sub(this.b),L.subVectors(this.c,this.b),g.cross(L),g.normalize(),g}}},"./src/WebGL/shapes/index.ts":(K,C,d)=>{d.r(C),d.d(C,{Cylinder:()=>L.Cylinder,Sphere:()=>M.Sphere,Triangle:()=>w.Triangle});var M=d("./src/WebGL/shapes/Sphere.ts"),L=d("./src/WebGL/shapes/Cylinder.ts"),w=d("./src/WebGL/shapes/Triangle.ts")},"./src/autoload.ts":(K,C,d)=>{d.r(C),d.d(C,{autoinit:()=>g,autoload:()=>c,processing_autoinit:()=>_,viewers:()=>A});var M=d("./src/GLViewer.ts"),L=d("./src/ProteinSurface4.ts"),w=d("./src/utilities.ts"),O=d("./src/colors.ts"),g=!1,_=!1,A={};function c(y,b){var u,p,r;if(document.querySelector(".viewer_3Dmoljs")!=null&&(g=!0),g){_=!0,y=y??null;var e=0;document.querySelectorAll(".viewer_3Dmoljs").forEach(i=>{var s=[],a=[],h="";i.style.position=="static"&&(i.style.position="relative");var t=null;if(r=null,i.dataset.pdb)s.push("https://files.rcsb.org/view/"+i.dataset.pdb+".pdb"),a.push("pdb");else if(i.dataset.cid)a.push("sdf"),s.push("https://pubchem.ncbi.nlm.nih.gov/rest/pug/compound/cid/"+i.dataset.cid+"/SDF?record_type=3d");else if(i.dataset.href||i.dataset.url){if(i.dataset.href?h=i.dataset.href:h=i.dataset.url,s.push(h),r=h.substring(h.lastIndexOf(".")+1),r=="gz"){let de=h.substring(0,h.lastIndexOf(".")).lastIndexOf(".");r=h.substring(de+1)}a.push(r);var n=h.substring(h.lastIndexOf("/")+1,h.lastIndexOf("."));n=="/"&&(n=h.substring(h.lastIndexOf("/")+1)),i.dataset[a[a.length-1]]=n}let f=i.dataset;for(u in f)u.substring(0,3)==="pdb"&&u!=="pdb"?(s.push("https://files.rcsb.org/view/"+f[u]+".pdb"),a.push("pdb")):u.substring(0,4)==="href"&&u!=="href"?(h=f[u],s.push(h),a.push(h.substring(h.lastIndexOf(".")+1))):u.substring(0,3)==="cid"&&u!=="cid"&&(s.push("https://pubchem.ncbi.nlm.nih.gov/rest/pug/compound/cid/"+f[u]+"/SDF?record_type=3d"),a.push("sdf"));var o={};i.dataset.options&&(o=(0,w.specStringToObject)(i.dataset.options));var v=O.CC.color(i.dataset.backgroundcolor),m=i.dataset.backgroundalpha;m=m==null?1:parseFloat(m);var E={line:{}};i.dataset.style&&(E=(0,w.specStringToObject)(i.dataset.style));var S={};i.dataset.select&&(S=(0,w.specStringToObject)(i.dataset.select));var T=[],P=[],I=[],B={},R=null,z=i.dataset,U=/style(.+)/,W=/surface(.*)/,F=/labelres(.*)/,N=[];for(p in z)Object.prototype.hasOwnProperty.call(z,p)&&N.push(p);for(N.sort(),u=0;u<N.length;u++){p=N[u];var q=U.exec(p),J,oe,le;q&&(J="select"+q[1],oe=(0,w.specStringToObject)(z[J]),le=(0,w.specStringToObject)(z[p]),T.push([oe,le])),q=W.exec(p),q&&(J="select"+q[1],oe=(0,w.specStringToObject)(z[J]),le=(0,w.specStringToObject)(z[p]),P.push([oe,le])),q=F.exec(p),q&&(J="select"+q[1],oe=(0,w.specStringToObject)(z[J]),le=(0,w.specStringToObject)(z[p]),I.push([oe,le])),p=="zoomto"&&(B=(0,w.specStringToObject)(z[p])),p=="spin"&&(R=(0,w.specStringToObject)(z[p]))}var fe=function(de){for(de.setStyle(S,E),t&&t.createSelectionAndStyle(S,E),u=0;u<T.length;u++){let ee=T[u][0]||{},me=T[u][1]||{line:{}};de.setStyle(ee,me),t&&t.createSelectionAndStyle(S,E)}for(u=0;u<P.length;u++){let ee=P[u][0]||{},me=P[u][1]||{};t?de.addSurface(L.SurfaceType.VDW,me,ee,ee).then(Ie=>{t.loadSurface("VDW",ee,me,Ie)}):de.addSurface(L.SurfaceType.VDW,me,ee,ee)}for(u=0;u<I.length;u++){let ee=I[u][0]||{},me=I[u][1]||{};de.addResLabels(ee,me)}de.render(),de.zoomTo(B),R&&de.spin(R.axis,R.speed)};let ie=y;try{var ne=(0,w.specStringToObject)(i.dataset.config)||{};ne.backgroundColor===void 0&&(ne.backgroundColor=v),ne.backgroundAlpha===void 0&&(ne.backgroundAlpha=m),ie==null?ie=A[i.id||e++]=(0,M.createViewer)(i,ne):(ie.setBackgroundColor(v,m),ie.setConfig(ne),t&&t.initiateUI()),i.dataset.ui&&$3Dmol.StateManager&&(t=new $3Dmol.StateManager(ie))}catch(de){console.log(de),i.textContent="WebGL appears to be disabled."}if(s.length!=0){let de=0,ee=((me,De)=>function(Ie){h=s[de];var Fe=me.dataset.type||me.dataset.datatype||a[de];if(De.addModel(Ie,Fe,o),t){var Ue=me.dataset[a[de]];t.setModelTitle(Ue)}de+=1,de<s.length?(0,w.get)(s[de]).then(ee):(fe(De),me.dataset.callback&&(0,w.makeFunction)(me.dataset.callback)(De),_=!1,b&&b(De))})(i,ie);r&&r.endsWith("gz")?(0,w.getbin)(s[0]).then(ee):(0,w.get)(s[0]).then(ee)}else{if(i.dataset.element){var we="#"+i.dataset.element,Ee=document.querySelector(we),Se=Ee?Ee.textContent:"";r=i.dataset.type||i.dataset.datatype,ie.addModel(Se,r,o)}fe(ie),i.dataset.callback&&(0,w.makeFunction)(i.dataset.callback)(ie),_=!1,b&&b(ie)}})}}document.onreadystatechange=()=>{document.readyState==="complete"&&c()}},"./src/colors.ts":(K,C,d)=>{d.r(C),d.d(C,{CC:()=>L,Color:()=>M,builtinColorSchemes:()=>y,chains:()=>c,elementColors:()=>_,htmlColors:()=>w,residues:()=>A,ssColors:()=>O});class M{constructor(u,p,r){return this.r=0,this.g=0,this.b=0,arguments.length>1&&typeof u=="number"?(this.r=u||0,this.g=p||0,this.b=r||0,this):this.set(u||0)}set(u){return u instanceof M?u.clone():(typeof u=="number"?this.setHex(u):typeof u=="object"&&(this.r=(u==null?void 0:u.r)||0,this.g=(u==null?void 0:u.g)||0,this.b=(u==null?void 0:u.b)||0),this)}setHex(u){return u=Math.floor(u),this.r=(u>>16&255)/255,this.g=(u>>8&255)/255,this.b=(u&255)/255,this}getHex(){var u=Math.round(this.r*255),p=Math.round(this.g*255),r=Math.round(this.b*255);return u<<16|p<<8|r}clone(){return new M(this.r,this.g,this.b)}copy(u){return this.r=u.r,this.g=u.g,this.b=u.b,this}scaled(){var u={};return u.r=Math.round(this.r*255),u.g=Math.round(this.g*255),u.b=Math.round(this.b*255),u.a=1,u}}class L{static color(u){if(!u)return L.cache[0];if(u instanceof M)return u;if(typeof u=="number"&&typeof L.cache[u]<"u")return L.cache[u];if(u&&Array.isArray(u))return u.map(L.color);let p=L.getHex(u),r=new M(p);return L.cache[p]=r,r}static getHex(u){var p;if(Array.isArray(u))return u.map(L.getHex);if(typeof u=="string"){let r=u;if(!isNaN(parseInt(r)))return parseInt(r);if(r=r.trim(),r.length==4&&r[0]=="#"&&(r="#"+r[1]+r[1]+r[2]+r[2]+r[3]+r[3]),r.length==7&&r[0]=="#")return parseInt(r.substring(1),16);let e=L.rgbRegEx.exec(r);if(e){e[1]!=""&&console.log("WARNING: Opacity value in rgba ignored.  Specify separately as opacity attribute.");let i=0;for(let s=2;s<5;s++){i*=256;let a=e[s].endsWith("%")?255*parseFloat(e[s])/100:parseFloat(e[s]);i+=Math.round(a)}return i}return((p=window==null?void 0:window.$3Dmol)===null||p===void 0?void 0:p.htmlColors[u.toLowerCase()])||0}return u}}L.rgbRegEx=/rgb(a?)\(\s*([^ ,\)\t]+)\s*,\s*([^ ,\)\t]+)\s*,\s*([^ ,\)\t]+)/i,L.cache={0:new M(0)};const w={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgrey:11119017,darkgreen:25600,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,grey:8421504,green:32768,greenyellow:11403055,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgrey:13882323,lightgreen:9498256,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},O={pyMol:{h:16711680,s:16776960,c:65280},Jmol:{h:16711808,s:16762880,c:16777215}},g={H:16777215,He:16761035,HE:16761035,Li:11674146,LI:11674146,B:65280,C:13158600,N:9408511,O:15728640,F:14329120,Na:255,NA:255,Mg:2263842,MG:2263842,Al:8421520,AL:8421520,Si:14329120,SI:14329120,P:16753920,S:16762930,Cl:65280,CL:65280,Ca:8421520,CA:8421520,Ti:8421520,TI:8421520,Cr:8421520,CR:8421520,Mn:8421520,MN:8421520,Fe:16753920,FE:16753920,Ni:10824234,NI:10824234,Cu:10824234,CU:10824234,Zn:10824234,ZN:10824234,Br:10824234,BR:10824234,Ag:8421520,AG:8421520,I:10494192,Ba:16753920,BA:16753920,Au:14329120,AU:14329120},_={defaultColor:16716947,Jmol:{H:16777215,He:14286847,HE:14286847,Li:13402367,LI:13402367,Be:12779264,BE:12779264,B:16758197,C:9474192,N:3166456,O:16715021,F:9494608,Ne:11789301,NE:11789301,Na:11230450,NA:11230450,Mg:9109248,MG:9109248,Al:12560038,AL:12560038,Si:1578e4,SI:1578e4,P:16744448,S:16777008,Cl:2093087,CL:2093087,Ar:8442339,AR:8442339,K:9388244,Ca:4062976,CA:4062976,Sc:15132390,SC:15132390,Ti:12567239,TI:12567239,V:10921643,Cr:9083335,CR:9083335,Mn:10255047,MN:10255047,Fe:14706227,FE:14706227,Co:15765664,CO:15765664,Ni:5296208,NI:5296208,Cu:13140019,CU:13140019,Zn:8224944,ZN:8224944,Ga:12750735,GA:12750735,Ge:6721423,GE:6721423,As:12419299,AS:12419299,Se:16752896,SE:16752896,Br:10889513,BR:10889513,Kr:6076625,KR:6076625,Rb:7351984,RB:7351984,Sr:65280,SR:65280,Y:9764863,Zr:9756896,ZR:9756896,Nb:7586505,NB:7586505,Mo:5551541,MO:5551541,Tc:3907230,TC:3907230,Ru:2396047,RU:2396047,Rh:687500,RH:687500,Pd:27013,PD:27013,Ag:12632256,AG:12632256,Cd:16767375,CD:16767375,In:10909043,IN:10909043,Sn:6717568,SN:6717568,Sb:10380213,SB:10380213,Te:13924864,TE:13924864,I:9699476,Xe:4366e3,XE:4366e3,Cs:5707663,CS:5707663,Ba:51456,BA:51456,La:7394559,LA:7394559,Ce:16777159,CE:16777159,Pr:14286791,PR:14286791,Nd:13107143,ND:13107143,Pm:10747847,PM:10747847,Sm:9437127,SM:9437127,Eu:6422471,EU:6422471,Gd:4587463,GD:4587463,Tb:3211207,TB:3211207,Dy:2097095,DY:2097095,Ho:65436,HO:65436,Er:58997,ER:58997,Tm:54354,TM:54354,Yb:48952,YB:48952,Lu:43812,LU:43812,Hf:5096191,HF:5096191,Ta:5089023,TA:5089023,W:2200790,Re:2522539,RE:2522539,Os:2516630,OS:2516630,Ir:1528967,IR:1528967,Pt:13684960,PT:13684960,Au:16765219,AU:16765219,Hg:12105936,HG:12105936,Tl:10900557,TL:10900557,Pb:5724513,PB:5724513,Bi:10375093,BI:10375093,Po:11230208,PO:11230208,At:7688005,AT:7688005,Rn:4358806,RN:4358806,Fr:4325478,FR:4325478,Ra:32e3,RA:32e3,Ac:7384058,AC:7384058,Th:47871,TH:47871,Pa:41471,PA:41471,U:36863,Np:33023,NP:33023,Pu:27647,PU:27647,Am:5528818,AM:5528818,Cm:7888099,CM:7888099,Bk:9064419,BK:9064419,Cf:10565332,CF:10565332,Es:11739092,ES:11739092,Fm:11739066,FM:11739066,Md:11734438,MD:11734438,No:12389767,NO:12389767,Lr:13041766,LR:13041766,Rf:13369433,RF:13369433,Db:13697103,DB:13697103,Sg:14221381,SG:14221381,Bh:14680120,BH:14680120,Hs:15073326,HS:15073326,Mt:15400998,MT:15400998},rasmol:g,defaultColors:Object.assign({},g),greenCarbon:Object.assign(Object.assign({},g),{C:65280}),cyanCarbon:Object.assign(Object.assign({},g),{C:65535}),magentaCarbon:Object.assign(Object.assign({},g),{C:16711935}),yellowCarbon:Object.assign(Object.assign({},g),{C:16776960}),whiteCarbon:Object.assign(Object.assign({},g),{C:16777215}),orangeCarbon:Object.assign(Object.assign({},g),{C:16753920}),purpleCarbon:Object.assign(Object.assign({},g),{C:8388736}),blueCarbon:Object.assign(Object.assign({},g),{C:255})},A={amino:{ALA:13158600,ARG:1334015,ASN:56540,ASP:15075850,CYS:15132160,GLN:56540,GLU:15075850,GLY:15461355,HIS:8553170,ILE:1016335,LEU:1016335,LYS:1334015,MET:15132160,PHE:3289770,PRO:14456450,SER:16422400,THR:16422400,TRP:11819700,TYR:3289770,VAL:1016335,ASX:16738740,GLX:16738740},shapely:{ALA:9240460,ARG:124,ASN:16743536,ASP:10485826,CYS:16777072,GLN:16731212,GLU:6684672,GLY:16777215,HIS:7368959,ILE:19456,LEU:4546117,LYS:4671416,MET:12099650,PHE:5459026,PRO:5395026,SER:16740418,THR:12078080,TRP:5195264,TYR:9203788,VAL:16747775,ASX:16711935,GLX:16711935},nucleic:{A:10526975,G:16740464,I:8454143,C:16747595,T:10551200,U:16744576}},c={atom:{A:12636415,B:11599792,C:16761032,D:16777088,E:16761087,F:11596016,G:16765040,H:15761536,I:16113331,J:49151,K:13458524,L:6737322,M:10145074,N:15631086,O:52945,P:65407,Q:3978097,R:139,S:12433259,T:25600,U:8388608,V:8421376,W:8388736,X:32896,Y:12092939,Z:11674146},hetatm:{A:9478351,B:8441752,C:13602992,D:13619056,E:13603023,F:8437952,G:13607008,H:12603504,I:12955267,J:42959,K:11881548,L:5682578,M:9090346,N:12481214,O:46753,P:53103,Q:3447649,R:187,S:10854235,T:37888,U:11534336,V:11579392,W:11534512,X:45232,Y:15250963,Z:12726834}},y={ssPyMol:{prop:"ss",map:O.pyMol},ssJmol:{prop:"ss",map:O.Jmol},Jmol:{prop:"elem",map:_.Jmol},amino:{prop:"resn",map:A.amino},shapely:{prop:"resn",map:A.shapely},nucleic:{prop:"resn",map:A.nucleic},chain:{prop:"chain",map:c.atom},rasmol:{prop:"elem",map:_.rasmol},default:{prop:"elem",map:_.defaultColors},greenCarbon:{prop:"elem",map:_.greenCarbon},chainHetatm:{prop:"chain",map:c.hetatm},cyanCarbon:{prop:"elem",map:_.cyanCarbon},magentaCarbon:{prop:"elem",map:_.magentaCarbon},purpleCarbon:{prop:"elem",map:_.purpleCarbon},whiteCarbon:{prop:"elem",map:_.whiteCarbon},orangeCarbon:{prop:"elem",map:_.orangeCarbon},yellowCarbon:{prop:"elem",map:_.yellowCarbon},blueCarbon:{prop:"elem",map:_.blueCarbon}}},"./src/glcartoon.ts":(K,C,d)=>{d.r(C),d.d(C,{drawCartoon:()=>S,subdivide_spline:()=>c});var M=d("./src/WebGL/math/index.ts"),L=d("./src/WebGL/shapes/index.ts"),w=d("./src/WebGL/index.ts"),O=d("./src/Gradient.ts"),g=d("./src/colors.ts"),_=d("./src/GLDraw.ts"),A=d("./src/utilities.ts");function c(T,P){var I=[],B=T;B=[],B.push(T[0]);var R,z,U,W,F,N,q,J,oe;for(R=1,z=T.length-1;R<z;R++)if(F=T[R],N=T[R+1],F.smoothen){var le=new M.Vector3((F.x+N.x)/2,(F.y+N.y)/2,(F.z+N.z)/2);le.atom=F.atom,B.push(le)}else B.push(F);for(B.push(T[T.length-1]),R=-1,U=B.length;R<=U-3;R++)if(W=B[R===-1?0:R],F=B[R+1],N=B[R+2],q=B[R===U-3?U-1:R+3],J=new M.Vector3().subVectors(N,W).multiplyScalar(.5),oe=new M.Vector3().subVectors(q,F).multiplyScalar(.5),!N.skip)for(var fe=0;fe<P;fe++){var ie=1/P*fe,ne=F.x+ie*J.x+ie*ie*(-3*F.x+3*N.x-2*J.x-oe.x)+ie*ie*ie*(2*F.x-2*N.x+J.x+oe.x),we=F.y+ie*J.y+ie*ie*(-3*F.y+3*N.y-2*J.y-oe.y)+ie*ie*ie*(2*F.y-2*N.y+J.y+oe.y),Ee=F.z+ie*J.z+ie*ie*(-3*F.z+3*N.z-2*J.z-oe.z)+ie*ie*ie*(2*F.z-2*N.z+J.z+oe.z),Se=new M.Vector3(ne,we,Ee);fe<P/2?Se.atom=F.atom:Se.atom=N.atom,I.push(Se)}return I.push(B[B.length-1]),I}const y=.5,b=1.3,u=.8,p=.4,r=.4;function e(T,P,I,B){for(var R,z,U,W,F=0,N=P.length;F<N;F++){W=Math.round(F*(B.length-1)/N),U=g.CC.color(B[W]);var q=T.updateGeoGroup(2),J=q.vertexArray,oe=q.colorArray,le=q.faceArray;R=q.vertices,z=R*3,J[z]=P[F].x,J[z+1]=P[F].y,J[z+2]=P[F].z,J[z+3]=I[F].x,J[z+4]=I[F].y,J[z+5]=I[F].z;for(var fe=0;fe<6;++fe)oe[z+3*fe]=U.r,oe[z+1+3*fe]=U.g,oe[z+2+3*fe]=U.b;if(F>0){var ie=[R,R+1,R-1,R-2],ne=q.faceidx;le[ne]=ie[0],le[ne+1]=ie[1],le[ne+2]=ie[3],le[ne+3]=ie[1],le[ne+4]=ie[2],le[ne+5]=ie[3],q.faceidx+=6}q.vertices+=2}}function i(T,P,I,B,R,z,U){var W,F,N,q;if(N=P.length,N<2||P[0].length<2)return;for(W=0;W<N;W++)P[W]=c(P[W],B);if(q=P[0].length,!R)return e(T,P[0],P[N-1],I);var J,oe,le,fe,ie,ne,we=[],Ee=[],Se=[];for(F=0;F<N;F++)we.push(.25+1.5*Math.sqrt((N-1)*F-Math.pow(F,2))/(N-1)),Ee.push(.5),Se.push(2*(Math.pow(F/N,2)-F/N)+.6);var de=[];for(F=0;F<N*2-1;F++)de[F]=[F,F+1,F+1-2*N,F-2*N];de[N*2-1]=[F,F+1-2*N,F+1-4*N,F-2*N];var ee,me,De,Ie,Fe,Ue,ze,Re,Pe,Oe;let Ae=T.updateGeoGroup();for(W=0;W<q;W++){let Z=T.groups,Y=!1;Ae=T.updateGeoGroup(2*N),Z!=T.groups&&W>0&&(W=W-1,Y=!0),Ue=Math.round(W*(I.length-1)/q),Fe=g.CC.color(I[Ue]),ie=le,ne=fe,le=[],fe=[],J=[],P[0][W].atom!==void 0&&(Ie=P[0][W].atom,U==="oval"?oe=we:U==="rectangle"?oe=Ee:U==="parabola"&&(oe=Se)),oe||(oe=Ee);var Ne,je;for(F=0;F<N;F++)W<q-1?Ne=P[F][W+1].clone().sub(P[F][W]):Ne=P[F][W-1].clone().sub(P[F][W]).negate(),F<N-1?je=P[F+1][W].clone().sub(P[F][W]):je=P[F-1][W].clone().sub(P[F][W]).negate(),J[F]=je.cross(Ne).normalize().multiplyScalar(R*oe[F]);for(F=0;F<N;F++)le[F]=P[F][W].clone().add(J[F].clone().negate());for(F=0;F<N;F++)fe[F]=P[F][W].clone().add(J[F]);for(ze=Ae.vertexArray,Re=Ae.colorArray,Pe=Ae.faceArray,ee=Ae.vertices,me=ee*3,F=0;F<N;F++)ze[me+3*F+0]=le[F].x,ze[me+3*F+1]=le[F].y,ze[me+3*F+2]=le[F].z;for(F=0;F<N;F++)ze[me+3*F+0+3*N]=fe[N-1-F].x,ze[me+3*F+1+3*N]=fe[N-1-F].y,ze[me+3*F+2+3*N]=fe[N-1-F].z;for(F=0;F<2*N;++F)Re[me+3*F+0]=Fe.r,Re[me+3*F+1]=Fe.g,Re[me+3*F+2]=Fe.b;if(W>0&&!Y){for(F=0;F<N*2;F++)Oe=[ee+de[F][0],ee+de[F][1],ee+de[F][2],ee+de[F][3]],De=Ae.faceidx,Pe[De]=Oe[0],Pe[De+1]=Oe[1],Pe[De+2]=Oe[3],Pe[De+3]=Oe[1],Pe[De+4]=Oe[2],Pe[De+5]=Oe[3],Ae.faceidx+=6;if(Ie.clickable||Ie.hoverable){var k=[];k.push(new L.Triangle(ie[0],le[0],le[N-1])),k.push(new L.Triangle(ie[0],le[N-1],ie[N-1])),k.push(new L.Triangle(ie[N-1],le[N-1],fe[N-1])),k.push(new L.Triangle(ie[N-1],fe[N-1],ne[N-1])),k.push(new L.Triangle(fe[0],ne[0],ne[N-1])),k.push(new L.Triangle(fe[N-1],fe[0],ne[N-1])),k.push(new L.Triangle(le[0],ie[0],ne[0])),k.push(new L.Triangle(fe[0],le[0],ne[0]));for(F in k)Ie.intersectionShape.triangle.push(k[F])}}Ae.vertices+=2*N}for(ze=Ae.vertexArray,Re=Ae.colorArray,Pe=Ae.faceArray,ee=Ae.vertices,me=ee*3,De=Ae.faceidx,W=0;W<N-1;W++)Oe=[W,W+1,2*N-2-W,2*N-1-W],De=Ae.faceidx,Pe[De]=Oe[0],Pe[De+1]=Oe[1],Pe[De+2]=Oe[3],Pe[De+3]=Oe[1],Pe[De+4]=Oe[2],Pe[De+5]=Oe[3],Ae.faceidx+=6;for(W=0;W<N-1;W++)Oe=[ee-1-W,ee-2-W,ee-2*N+W+1,ee-2*N+W],De=Ae.faceidx,Pe[De]=Oe[0],Pe[De+1]=Oe[1],Pe[De+2]=Oe[3],Pe[De+3]=Oe[1],Pe[De+4]=Oe[2],Pe[De+5]=Oe[3],Ae.faceidx+=6}function s(T,P,I,B,R,z){if(!(P.length<2)){var U,W;if(U=P[0],W=P[P.length-1],U=c(U,B),W=c(W,B),!R)return e(T,U,W,I);var F=[],N,q,J,oe,le,fe=[[0,2,-6,-8],[-4,-2,6,4],[7,-1,-5,3],[-3,5,1,-7]],ie,ne,we,Ee,Se,de,ee,me,De,Ie,Fe,Ue,ze,Re,Pe,Oe,Ae;for(me=0,De=U.length;me<De;me++){if(Se=Math.round(me*(I.length-1)/De),Ee=g.CC.color(I[Se]),F.push(q=U[me]),F.push(q),F.push(J=W[me]),F.push(J),me<De-1){var Ne=U[me+1].clone().sub(U[me]),je=W[me].clone().sub(U[me]);N=je.cross(Ne).normalize().multiplyScalar(R)}for(F.push(oe=U[me].clone().add(N)),F.push(oe),F.push(le=W[me].clone().add(N)),F.push(le),q.atom!==void 0&&(de=q.atom),Re=T.updateGeoGroup(8),Pe=Re.vertexArray,Oe=Re.colorArray,Ae=Re.faceArray,ie=Re.vertices,ne=ie*3,Pe[ne]=q.x,Pe[ne+1]=q.y,Pe[ne+2]=q.z,Pe[ne+3]=q.x,Pe[ne+4]=q.y,Pe[ne+5]=q.z,Pe[ne+6]=J.x,Pe[ne+7]=J.y,Pe[ne+8]=J.z,Pe[ne+9]=J.x,Pe[ne+10]=J.y,Pe[ne+11]=J.z,Pe[ne+12]=oe.x,Pe[ne+13]=oe.y,Pe[ne+14]=oe.z,Pe[ne+15]=oe.x,Pe[ne+16]=oe.y,Pe[ne+17]=oe.z,Pe[ne+18]=le.x,Pe[ne+19]=le.y,Pe[ne+20]=le.z,Pe[ne+21]=le.x,Pe[ne+22]=le.y,Pe[ne+23]=le.z,Ie=0;Ie<8;++Ie)Oe[ne+3*Ie]=Ee.r,Oe[ne+1+3*Ie]=Ee.g,Oe[ne+2+3*Ie]=Ee.b;if(me>0){var k=ee!==void 0&&de!==void 0&&ee.serial!==de.serial;for(Ie=0;Ie<4;Ie++){var Z=[ie+fe[Ie][0],ie+fe[Ie][1],ie+fe[Ie][2],ie+fe[Ie][3]];if(we=Re.faceidx,Ae[we]=Z[0],Ae[we+1]=Z[1],Ae[we+2]=Z[3],Ae[we+3]=Z[1],Ae[we+4]=Z[2],Ae[we+5]=Z[3],Re.faceidx+=6,de.clickable||ee.clickable||de.hoverable||ee.hoverable){var Y=F[Z[3]].clone(),ve=F[Z[0]].clone(),re=F[Z[2]].clone(),Le=F[Z[1]].clone();if(Y.atom=F[Z[3]].atom||null,re.atom=F[Z[2]].atom||null,ve.atom=F[Z[0]].atom||null,Le.atom=F[Z[1]].atom||null,k){var Me=Y.clone().add(ve).multiplyScalar(.5),V=re.clone().add(Le).multiplyScalar(.5),ae=Y.clone().add(Le).multiplyScalar(.5);Ie%2===0?((ee.clickable||ee.hoverable)&&(Fe=new L.Triangle(Me,ae,Y),Ue=new L.Triangle(V,re,ae),ze=new L.Triangle(ae,re,Y),ee.intersectionShape.triangle.push(Fe),ee.intersectionShape.triangle.push(Ue),ee.intersectionShape.triangle.push(ze)),(de.clickable||de.hoverable)&&(Fe=new L.Triangle(ve,Le,ae),Ue=new L.Triangle(Le,V,ae),ze=new L.Triangle(ve,ae,Me),de.intersectionShape.triangle.push(Fe),de.intersectionShape.triangle.push(Ue),de.intersectionShape.triangle.push(ze))):((de.clickable||de.hoverable)&&(Fe=new L.Triangle(Me,ae,Y),Ue=new L.Triangle(V,re,ae),ze=new L.Triangle(ae,re,Y),de.intersectionShape.triangle.push(Fe),de.intersectionShape.triangle.push(Ue),de.intersectionShape.triangle.push(ze)),(ee.clickable||ee.hoverable)&&(Fe=new L.Triangle(ve,Le,ae),Ue=new L.Triangle(Le,V,ae),ze=new L.Triangle(ve,ae,Me),ee.intersectionShape.triangle.push(Fe),ee.intersectionShape.triangle.push(Ue),ee.intersectionShape.triangle.push(ze)))}else(de.clickable||de.hoverable)&&(Fe=new L.Triangle(ve,Le,Y),Ue=new L.Triangle(Le,re,Y),de.intersectionShape.triangle.push(Fe),de.intersectionShape.triangle.push(Ue))}}}Re.vertices+=8,ee=de}var pe=F.length-8;for(Re=T.updateGeoGroup(8),Pe=Re.vertexArray,Oe=Re.colorArray,Ae=Re.faceArray,ie=Re.vertices,ne=ie*3,we=Re.faceidx,me=0;me<4;me++){F.push(F[me*2]),F.push(F[pe+me*2]);var Te=F[me*2],se=F[pe+me*2];Pe[ne+6*me]=Te.x,Pe[ne+1+6*me]=Te.y,Pe[ne+2+6*me]=Te.z,Pe[ne+3+6*me]=se.x,Pe[ne+4+6*me]=se.y,Pe[ne+5+6*me]=se.z,Oe[ne+6*me]=Ee.r,Oe[ne+1+6*me]=Ee.g,Oe[ne+2+6*me]=Ee.b,Oe[ne+3+6*me]=Ee.r,Oe[ne+4+6*me]=Ee.g,Oe[ne+5+6*me]=Ee.b}pe+=8,Fe=[ie,ie+2,ie+6,ie+4],Ue=[ie+1,ie+5,ie+7,ie+3],Ae[we]=Fe[0],Ae[we+1]=Fe[1],Ae[we+2]=Fe[3],Ae[we+3]=Fe[1],Ae[we+4]=Fe[2],Ae[we+5]=Fe[3],Ae[we+6]=Ue[0],Ae[we+7]=Ue[1],Ae[we+8]=Ue[3],Ae[we+9]=Ue[1],Ae[we+10]=Ue[2],Ae[we+11]=Ue[3],Re.faceidx+=12,Re.vertices+=8}}function a(T,P,I,B,R,z,U){(!U||U==="default")&&(U="rectangle"),U==="edged"?s(T,P,I,B,R):(U==="rectangle"||U==="oval"||U==="parabola")&&i(T,P,I,B,R,z,U)}function h(T){return T&&T.elem==="C"&&T.atom==="CA"}function t(T,P){if(T&&P&&T.chain===P.chain){if(!T.hetflag&&!P.hetflag&&T.reschain===P.reschain&&(T.resi===P.resi||T.resi===P.resi-1))return!0;if(T.resi<P.resi){var I=T.x-P.x,B=T.y-P.y,R=T.z-P.z,z=I*I+B*B+R*R;if(T.atom=="CA"&&P.atom=="CA"&&z<16)return!0;if((T.atom=="P"||P.atom=="P")&&z<64)return!0}}return!1}function n(T,P,I,B,R){if(!(P==null||P.vertices==0)){R&&(P.initTypedArrays(),P.setUpNormals());var z=new w.MeshDoubleLambertMaterial;z.vertexColors=w.Coloring.FaceColors,typeof I=="number"&&I>=0&&I<1&&(z.transparent=!0,z.opacity=I),z.outline=B;var U=new w.Mesh(P,z);T.add(U)}}function f(T,P,I,B,R,z,U,W,F){var N,q,J,oe,le,fe;if(!(!B||!R||!U)){var ie=R.sub(B);ie.normalize();var ne=W[F];for(q=F+1;q<W.length&&(ne=W[q],ne.atom!=U.atom);q++);if(ne=ne?new M.Vector3(ne.x,ne.y,ne.z):new M.Vector3(0,0,0),ne.sub(B),U.ss==="arrow start"){var we=ne.clone().multiplyScalar(.3).cross(R);B.add(we);var Ee=ne.clone().cross(ie).normalize();ie.rotateAboutVector(Ee,.43)}for(U.style.cartoon.ribbon?N=U.style.cartoon.thickness||p:U.style.cartoon.width?N=U.style.cartoon.width:U.ss==="c"?U.atom==="P"?N=u:N=y:U.ss==="arrow start"?(N=b,le=!0):U.ss==="arrow end"||U.ss==="h"&&U.style.cartoon.tubes||U.ss==="tube start"?N=y:N=b,z!=null&&ie.dot(z)<0&&ie.negate(),ie.multiplyScalar(N),q=0;q<P;q++)J=-1+q*2/(P-1),oe=new M.Vector3(B.x+J*ie.x,B.y+J*ie.y,B.z+J*ie.z),oe.atom=U,U.ss==="s"&&(oe.smoothen=!0),T[q].push(oe);if(le)for(ie.multiplyScalar(2),q=0;q<P;q++)J=-1+q*2/(P-1),oe=new M.Vector3(B.x+J*ie.x,B.y+J*ie.y,B.z+J*ie.z),oe.atom=U,oe.smoothen=!1,oe.skip=!0,T[q].push(oe);return fe=U.style.cartoon.style||"default",T.style?T.style!=fe&&(console.log("Warning: a cartoon chain's strand-style is ambiguous"),T.style="default"):T.style=fe,(U.ss==="arrow start"||U.ss==="arrow end")&&(U.ss="s"),le}}const o={C:!0,CA:!0,O:!0,P:!0,OP2:!0,O2P:!0,"O5'":!0,"O3'":!0,"C5'":!0,"C2'":!0,"O5*":!0,"O3*":!0,"C5*":!0,"C2*":!0,N1:!0,N3:!0},v={DA:!0,DG:!0,A:!0,G:!0},m={DT:!0,DC:!0,U:!0,C:!0,T:!0},E={DA:!0,DG:!0,A:!0,G:!0,DT:!0,DC:!0,U:!0,C:!0,T:!0};function S(T,P,I,B=10){let R=B,z=B;var U,W,F,N,q,J,oe,le,fe,ie,ne,we,Ee,Se,de,ee,me,De,Ie=new w.Geometry(!0),Fe=new w.Geometry(!0),Ue=[],ze=[],Re=1,Pe=!1,Oe={};for(var Ae in O.Gradient.builtinGradients)O.Gradient.builtinGradients.hasOwnProperty(Ae)&&(Oe[Ae]=new O.Gradient.builtinGradients[Ae](I[1],I[0]));var Ne=function(j,Ce){return I&&Ce.color==="spectrum"?Ce.colorscheme in Oe?Oe[Ce.colorscheme].valueToHex(j.resi):Oe.sinebow.valueToHex(j.resi):(0,A.getColorFromStyle)(j,Ce).getHex()};for(le=0;le<R;le++)ze[le]=[];var je=!1,k=!1,Z=[];for(le in P){if(N=P[le],N.elem==="C"&&N.atom==="CA"){var Y=t(F,N);Y&&N.ss==="s"?je=!0:je&&(F&&W&&F.style.cartoon.arrows&&W.style.cartoon.arrows&&(F.ss="arrow end",W.ss="arrow start"),je=!1),Y&&(F.ss==="h"||F.ss=="tube start")&&F.style.cartoon.tubes?!k&&F.ss!="tube start"&&N.style.cartoon.tubes&&(N.ss="tube start",k=!0):k&&(F.ss==="tube start"?F.ss="tube end":W&&W.style.cartoon.tubes&&(W.ss="tube end"),k=!1),W=F,F=N}N&&N.atom in o&&Z.push(N)}k&&F.style.cartoon.tubes&&(F.ss="tube end",k=!1);var ve=function(j){ze[0].length>0&&a(Fe,ze,Ue,z,oe,Re,ze.style);var Ce=[],We=null;if(j){for(le=0;le<R;le++)Ce[le]=ze[le][ze[le].length-1];We=Ue[Ue.length-1]}for(ze=[],le=0;le<R;le++)ze[le]=[];if(Ue=[],j){for(le=0;le<R;le++)ze[le].push(Ce[le]);Ue.push(We)}n(T,Fe,Re,Pe,!0),n(T,Ie,Re,Pe,!1),Fe=new w.Geometry(!0),Ie=new w.Geometry(!0)};F=void 0;for(var re=0;re<Z.length;re++){N=Z[re];var Le=N.resn.trim(),Me=Le in E;if(Re=1,U=N.style.cartoon,F&&F.style.cartoon&&(Re=F.style.cartoon.opacity),F&&F.style.cartoon&&F.style.cartoon.outline&&(Pe=F.style.cartoon.outline),F&&F.style.cartoon&&(!N.style.cartoon||F.style.cartoon.opacity!=N.style.cartoon.opacity)&&ve(F.chain==N.chain),U.style==="trace"){if(!N.hetflag){if(N.elem==="C"&&N.atom==="CA"||Me&&N.atom==="P"||N.atom==="BB"){if(J=Ne(N,U),(0,A.isNumeric)(U.thickness)?oe=U.thickness:oe=p,t(F,N))if(J==q){var V=g.CC.color(J);_.GLDraw.drawCylinder(Ie,F,N,oe,V,2,2)}else{var ae=new M.Vector3().addVectors(F,N).multiplyScalar(.5),pe=g.CC.color(q),Te=g.CC.color(J);_.GLDraw.drawCylinder(Ie,F,ae,oe,pe,2,0),_.GLDraw.drawCylinder(Ie,ae,N,oe,Te,0,2)}if((N.clickable===!0||N.hoverable)&&N.intersectionShape!==void 0){var se=new M.Vector3(N.x,N.y,N.z);N.intersectionShape.sphere.push(new L.Sphere(se,oe))}F=N,q=J}}}else{if(h(N)||Me&&(N.atom==="P"||N.atom.indexOf("O5")==0)){if(De)if(N.ss==="tube end")De=!1,me=new M.Vector3(N.x,N.y,N.z),_.GLDraw.drawCylinder(Ie,ee,me,2,g.CC.color(q),1,1),N.ss="h";else if(F.chain!=N.chain||F.ss==="tube end")De=!1,F.ss="h",me=new M.Vector3(F.x,F.y,F.z),_.GLDraw.drawCylinder(Ie,ee,me,2,g.CC.color(q),1,1);else continue;if(F&&(!t(F,N)||F.ss==="tube start")){for(F.ss==="tube start"&&(De=!0,ee=new M.Vector3(F.x,F.y,F.z),F.ss="h"),de&&(we?Se=new M.Vector3().addVectors(F,we).multiplyScalar(.5):Se=new M.Vector3(F.x,F.y,F.z),_.GLDraw.drawCylinder(Ie,Se,de,r,g.CC.color(de.color),0,2),f(ze,R,!0,we,Ee,ne,F,Z,re),Ue.push(J),Se=null,de=null),ze[0].length>0&&a(Fe,ze,Ue,z,oe,Re,ze.style),ze=[],le=0;le<R;le++)ze[le]=[];Ue=[]}if(F===void 0||F.rescode!=N.rescode||F.resi!=N.resi){if(de&&F!=null){Se=new M.Vector3().addVectors(F,N).multiplyScalar(.5);var ye=Se.clone().sub(de).multiplyScalar(.02);Se.add(ye),_.GLDraw.drawCylinder(Ie,Se,de,r,g.CC.color(de.color),0,2),Se=null,de=null}J=Ne(N,U),Ue.push(J),(0,A.isNumeric)(U.thickness)?oe=U.thickness:oe=p,F=N,fe=new M.Vector3(F.x,F.y,F.z),fe.resi=F.resi,q=J}(N.clickable===!0||N.hoverable===!0)&&(N.intersectionShape===void 0||N.intersectionShape.triangle===void 0)&&(N.intersectionShape={sphere:null,cylinder:[],line:[],triangle:[]})}else F!=null&&(h(F)&&N.atom==="O"||Me&&F.atom==="P"&&(N.atom==="OP2"||N.atom==="O2P")||Me&&F.atom.indexOf("O5")==0&&N.atom.indexOf("C5")==0)?(ie=new M.Vector3(N.x,N.y,N.z),ie.resi=N.resi,(N.atom==="OP2"||N.atom==="O2P")&&(Ee=new M.Vector3(N.x,N.y,N.z))):Me&&N.atom.indexOf("O3")==0?we=new M.Vector3(N.x,N.y,N.z):(N.atom==="N1"&&Le in v||N.atom==="N3"&&Le in m)&&(de=new M.Vector3(N.x,N.y,N.z),de.color=(0,A.getColorFromStyle)(N,U).getHex());ie&&fe&&ie.resi===fe.resi&&(f(ze,R,!0,fe,ie,ne,F,Z,re),ne=ie,fe=null,ie=null,Ue.push(J))}}de&&(we?Se=new M.Vector3().addVectors(F,we).multiplyScalar(.5):Se=new M.Vector3(F.x,F.y,F.z),_.GLDraw.drawCylinder(Ie,Se,de,r,g.CC.color(de.color),0,2),f(ze,R,!0,we,Ee,ne,F,Z,re),Ue.push(J)),ve(!1)}},"./src/index.ts":(K,C,d)=>{d.r(C),d.d(C,{CAP:()=>r.CAP,CC:()=>L.CC,CONTEXTS_PER_VIEWPORT:()=>s.CONTEXTS_PER_VIEWPORT,Color:()=>L.Color,CustomLinear:()=>M.CustomLinear,Cylinder:()=>A.Cylinder,GLDraw:()=>r.GLDraw,GLModel:()=>i.GLModel,GLShape:()=>p.GLShape,GLViewer:()=>s.GLViewer,GLVolumetricRender:()=>u.GLVolumetricRender,Gradient:()=>M.Gradient,GradientType:()=>M.GradientType,Label:()=>w.Label,LabelCount:()=>w.LabelCount,MarchingCube:()=>y.MarchingCube,MarchingCubeInitializer:()=>y.MarchingCubeInitializer,Matrix3:()=>_.Matrix3,Matrix4:()=>_.Matrix4,Parsers:()=>g.Parsers,PausableTimer:()=>c.PausableTimer,PointGrid:()=>y.PointGrid,ProteinSurface:()=>y.ProteinSurface,Quaternion:()=>_.Quaternion,ROYGB:()=>M.ROYGB,RWB:()=>M.RWB,Ray:()=>_.Ray,Sinebow:()=>M.Sinebow,Sphere:()=>A.Sphere,SurfaceType:()=>y.SurfaceType,Triangle:()=>A.Triangle,Vector2:()=>_.Vector2,Vector3:()=>_.Vector3,VolumeData:()=>b.VolumeData,adjustVolumeStyle:()=>c.adjustVolumeStyle,applyPartialCharges:()=>O.applyPartialCharges,autoinit:()=>a.autoinit,autoload:()=>a.autoload,base64ToArray:()=>c.base64ToArray,bondLength:()=>g.bondLength,builtinColorSchemes:()=>L.builtinColorSchemes,builtinGradients:()=>M.builtinGradients,chains:()=>L.chains,clamp:()=>_.clamp,conversionMatrix3:()=>_.conversionMatrix3,createStereoViewer:()=>s.createStereoViewer,createViewer:()=>s.createViewer,createViewerGrid:()=>s.createViewerGrid,deepCopy:()=>c.deepCopy,degToRad:()=>_.degToRad,download:()=>c.download,drawCartoon:()=>e.drawCartoon,elementColors:()=>L.elementColors,extend:()=>c.extend,get:()=>c.get,getAtomProperty:()=>c.getAtomProperty,getColorFromStyle:()=>c.getColorFromStyle,getElement:()=>c.getElement,getExtent:()=>c.getExtent,getGradient:()=>M.getGradient,getPropertyRange:()=>c.getPropertyRange,getbin:()=>c.getbin,htmlColors:()=>L.htmlColors,inflateString:()=>c.inflateString,isEmptyObject:()=>c.isEmptyObject,isNumeric:()=>c.isNumeric,makeFunction:()=>c.makeFunction,mergeGeos:()=>c.mergeGeos,normalizeValue:()=>M.normalizeValue,partialCharges:()=>O.partialCharges,processing_autoinit:()=>a.processing_autoinit,residues:()=>L.residues,setBondLength:()=>g.setBondLength,setSyncSurface:()=>y.setSyncSurface,specStringToObject:()=>c.specStringToObject,splitMesh:()=>p.splitMesh,ssColors:()=>L.ssColors,subdivide_spline:()=>e.subdivide_spline,syncSurface:()=>y.syncSurface,viewers:()=>a.viewers});var M=d("./src/Gradient.ts"),L=d("./src/colors.ts"),w=d("./src/Label.ts"),O=d("./src/partialCharges.ts"),g=d("./src/parsers/index.ts"),_=d("./src/WebGL/math/index.ts"),A=d("./src/WebGL/shapes/index.ts"),c=d("./src/utilities.ts"),y=d("./src/ProteinSurface4.ts"),b=d("./src/VolumeData.ts"),u=d("./src/VolumetricRender.ts"),p=d("./src/GLShape.ts"),r=d("./src/GLDraw.ts"),e=d("./src/glcartoon.ts"),i=d("./src/GLModel.ts"),s=d("./src/GLViewer.ts"),a=d("./src/autoload.ts");d("./src/specs.ts"),window&&(window.$3Dmol=C)},"./src/parsers/BCIF.ts":(K,C,d)=>{d.r(C),d.d(C,{BCIF:()=>p});var M=d("./src/utilities.ts"),L=d("./src/parsers/utils/computeSecondaryStructure.ts"),w=d("./src/parsers/utils/processSymmetries.ts"),O=d("./src/parsers/cifutils/category.ts"),g=d("./src/parsers/utils/assignPDBBonds.ts"),_=d("./src/WebGL/index.ts"),A=d("./src/parsers/utils/isEmpty.ts"),c=d("./src/vendor/mmtf.js");class y{constructor(e){if(this.C={},e){let i=e.getField("comp_id"),s=e.getField("atom_id_1"),a=e.getField("atom_id_2"),h=e.getField("value_order");for(let t=0;t<i.length;t++){let n=i[t],f=s[t],o=a[t],v=h[t],m=1;v=="doub"?m=2:v=="trip"&&(m=3),this.C[n]==null&&(this.C[n]={}),this.C[n][f]==null&&(this.C[n][f]={}),this.C[n][o]==null&&(this.C[n][o]={}),this.C[n][f][o]=m,this.C[n][o][f]=m}}}order(e,i,s){return this.C[e]!==void 0&&this.C[e][i]!==void 0&&this.C[e][i][s]!==void 0?this.C[e][i][s]:0}}class b{constructor(e){if(this.C=[],e){let i=e.getField("conn_type_id"),s=e.getField("ptnr1_label_asym_id"),a=e.getField("ptnr1_label_seq_id"),h=e.getField("ptnr1_label_comp_id"),t=e.getField("ptnr1_label_atom_id"),n=e.getField("ptnr2_label_asym_id"),f=e.getField("ptnr2_label_seq_id"),o=e.getField("ptnr2_label_comp_id"),v=e.getField("ptnr2_label_atom_id"),m=e.getField("pdbx_value_order");for(let E=0;E<i.length;E++)if(i[E]=="disulf"||i[E]=="covale"){let S=m?m[E]==""?1:parseInt(m[E]):1;this.C.push([[s[E],a[E],h[E],t[E]],[n[E],f[E],o[E],v[E]],S])}}}}class u{constructor(){this.R={}}add(e){this.R[e.lchain]==null&&(this.R[e.lchain]={}),this.R[e.lchain][e.lresi]==null&&(this.R[e.lchain][e.lresi]={}),this.R[e.lchain][e.lresi][e.lresn]==null&&(this.R[e.lchain][e.lresi][e.lresn]=[]),this.R[e.lchain][e.lresi][e.lresn].push(e),this.R[e.lchain][e.lresi][e.lresn][e.atom]=e}geta([e,i,s,a]){if(this.R[e]!==void 0&&this.R[e][i]!==void 0&&this.R[e][i][s]!==void 0)return this.R[e][i][s][a]}setBonds(e,i){for(let s in this.R)for(let a in this.R[s])for(let h in this.R[s][a]){let t=this.R[s][a][h];for(let n=0;n<t.length;n++)for(let f=n+1;f<t.length;f++){let o=t[n],v=t[f],m=e.order(h,o.atom,v.atom);o.altLoc!=v.altLoc&&o.altLoc!=""&&v.altLoc!=""&&(m=0),m>0&&(o.bonds.push(v.index),v.bonds.push(o.index),o.bondOrder.push(m),v.bondOrder.push(m))}}for(let s of i.C){let a=s[0],h=s[1],t=s[2],n=this.geta(a),f=this.geta(h);n!=null&&f!=null&&(n.bonds.push(f.index),f.bonds.push(n.index),n.bondOrder.push(t),f.bondOrder.push(t))}}}function p(r,e){var i=!e.keepH,s=e.altLoc?e.altLoc:"A",a=!e.noComputeSecondaryStructure;const h=!e.doAssembly,t=e.assignBonds===void 0?!0:e.assignBonds;if(typeof r=="string")try{r=(0,M.base64ToArray)(r)}catch{r=new TextEncoder().encode(r)}else r=new Uint8Array(r);var n=c.decodeMsgpack(r);n==31&&(r=(0,M.inflateString)(r,!1),n=c.decodeMsgpack(r));var f=[],o=f.modelData=[],v=n.dataBlocks.length;if(v==0)return f;e.multimodel||(v=1);for(let m=0;m<v;m++){let E=f.length;const S=[];o.push({symmetries:[]}),f.push([]);const T=n.dataBlocks[m],P=Object.create(null);for(const Oe of T.categories)P[Oe.name.substr(1)]=(0,O.Category)(Oe);let I={},B=P.struct_conf;if(B){let Oe=B.getField("conf_type_id"),Ae=B.getField("beg_label_asym_id"),Ne=B.getField("beg_label_seq_id"),je=B.getField("end_label_seq_id");for(let k=0;k<Oe.length;k++)if(Oe[k].startsWith("H")){let Z=Ae[k],Y=Ne[k],ve=je[k];Z in I||(I[Z]={}),I[Z][Y]="h1";for(let re=Y+1;re<ve;re++)I[Z][re]="h";I[Z][ve]="h2"}}let R=P.struct_sheet_range;if(R){let Oe=R.getField("id"),Ae=R.getField("beg_label_asym_id"),Ne=R.getField("beg_label_seq_id"),je=R.getField("end_label_seq_id");for(let k=0;k<Oe.length;k++){let Z=Ae[k],Y=Ne[k],ve=je[k];Z in I||(I[Z]={}),I[Z][Y]="s1";for(let re=Y+1;re<ve;re++)I[Z][re]="s";I[Z][ve]="s2"}}let z=P.pdbx_struct_oper_list,U=z.getField("id");if(U&&!h){let Oe=z.getField("matrix[1][1]"),Ae=z.getField("matrix[1][2]"),Ne=z.getField("matrix[1][3]"),je=z.getField("matrix[2][1]"),k=z.getField("matrix[2][2]"),Z=z.getField("matrix[2][3]"),Y=z.getField("matrix[3][1]"),ve=z.getField("matrix[3][2]"),re=z.getField("matrix[3][3]"),Le=z.getField("vector[1]"),Me=z.getField("vector[2]"),V=z.getField("vector[3]");for(let ae=0;ae<U.length;ae++){const pe=new _.Matrix4(Oe[ae],Ae[ae],Ne[ae],Le[ae],je[ae],k[ae],Z[ae],Me[ae],Y[ae],ve[ae],re[ae],V[ae]);o[o.length-1].symmetries.push(pe)}}let W=new y(P.chem_comp_bond),F=new u,N=new b(P.struct_conn),q=P.atom_site,J=q.rowCount,oe=q.getField("group_PDB"),le=q.getField("Cartn_x"),fe=q.getField("Cartn_y"),ie=q.getField("Cartn_z"),ne=q.getField("auth_asym_id"),we=q.getField("label_asym_id"),Ee=q.getField("auth_seq_id"),Se=q.getField("label_seq_id"),de=q.getField("auth_comp_id"),ee=q.getField("label_comp_id"),me=q.getField("auth_atom_id"),De=q.getField("label_atom_id"),Ie=q.getField("type_symbol"),Fe=q.getField("B_iso_or_equiv"),Ue=q.getField("id"),ze=q.getField("label_alt_id"),Re=q.getField("pdbx_PDB_model_num"),Pe=Re?Re[0]:0;for(let Oe=0;Oe<J;Oe++){if(oe!==void 0&&oe[Oe]==="TER")continue;if(Re&&Re[Oe]!=Pe)if(Pe=Re[Oe],e.multimodel)e.onemol||(f.push([]),o.push(o[o.length-1]),Pe=Re[Oe],F.setBonds(W,N),F=new u);else break;const Ae={};Ae.x=le[Oe],Ae.y=fe[Oe],Ae.z=ie[Oe],Ae.chain=ne?ne[Oe]:we?we[Oe]:void 0,Ae.lchain=we?we[Oe]:void 0,Ae.resi=Ee?Ee[Oe]:Se?Se[Oe]:void 0,Ae.lresi=Se?Se[Oe]:void 0,Ae.resn=de?de[Oe].trim():ee?ee[Oe].trim():void 0,Ae.lresn=ee?ee[Oe].trim():void 0,Ae.atom=me?me[Oe].replace(/"/gm,""):De?De[Oe].replace(/"/gm,""):void 0,Ae.icode=ze?ze[Oe]:void 0,Ae.altLoc=Ae.icode,Ae.hetflag=!oe||oe[Oe]==="HETA"||oe[Oe]==="HETATM";let Ne="X";Ie&&(Ne=Ie[Oe].replace(/\(?\+?\d+.*/,"")),Ae.elem=Ne[0].toUpperCase()+Ne.substring(1,2).toLowerCase(),Fe&&(Ae.b=Fe[Oe]),!(i&&Ae.elem=="H")&&(Ae.altLoc!=""&&Ae.altLoc!=s&&s!="*"||(Ae.bonds=[],Ae.ss="c",Ae.serial=Ue[Oe],Ae.model=Pe,Ae.bondOrder=[],Ae.properties={},Ae.index=f[f.length-1].length,S[Ae.serial]=[f.length,Ae.index],f[f.length-1].push(Ae),F.add(Ae)))}if(F.setBonds(W,N),!(0,A.isEmpty)(I))for(let Oe=E;Oe<f.length;Oe++){let Ae=f[Oe];for(let Ne=0;Ne<Ae.length;Ne++){const je=Ae[Ne];if(je!==void 0&&je.lchain in I&&je.lresi in I[je.lchain]){const k=I[je.lchain][je.lresi];je.ss=k[0],k.length>1&&(k[1]=="1"?je.ssbegin=!0:k[1]=="2"&&(je.ssend=!0))}}}e.multimodel&&m<v-1&&(e.onemol||(f.push([]),o.push({symmetries:[]})))}for(let m=0;m<f.length;m++)t&&!(e.duplicateAssemblyAtoms&&!e.dontConnectDuplicatedAtoms)&&(0,g.assignPDBBonds)(f[m],e),a&&(0,L.computeSecondaryStructure)(f[m],e.hbondCutoff),(0,w.processSymmetries)(o[m].symmetries,f[m],e,o[m].cryst),e.duplicateAssemblyAtoms&&!e.dontConnectDuplicatedAtoms&&t&&(0,g.assignPDBBonds)(f[m],e);return f}},"./src/parsers/CDJSON.ts":(K,C,d)=>{d.r(C),d.d(C,{CDJSON:()=>M});function M(L,w){var O=[[]];typeof L=="string"&&(L=JSON.parse(L));for(var g=L.m,_=g[0].a,A=g[0].b,c=g[0].s,y=w!==void 0&&w.parseStyle!==void 0?w.parseStyle:c!==void 0,b=O[O.length-1].length,u=0;u<_.length;u++){var p=_[u],r={};r.id=p.i,r.x=p.x,r.y=p.y,r.z=p.z||0,r.bonds=[],r.bondOrder=[];var e=p.l||"C";r.elem=e[0].toUpperCase()+e.substring(1).toLowerCase(),r.serial=O[O.length-1].length,y&&(r.style=c[p.s||0]),O[O.length-1].push(r)}for(let i=0;i<A.length;i++){let s=A[i],a=s.b+b,h=s.e+b,t=s.o||1,n=O[O.length-1][a],f=O[O.length-1][h];n.bonds.push(h),n.bondOrder.push(t),f.bonds.push(a),f.bondOrder.push(t)}return O}},"./src/parsers/CIF.ts":(K,C,d)=>{d.r(C),d.d(C,{CIF:()=>_});var M=d("./src/parsers/utils/computeSecondaryStructure.ts"),L=d("./src/parsers/utils/processSymmetries.ts"),w=d("./src/WebGL/index.ts"),O=d("./src/parsers/utils/assignPDBBonds.ts");const g=function(A,c,y,b){return new w.Vector3(c,y,b).applyMatrix3(A)};function _(A,c={}){const y=[],b=!c.doAssembly,u=y.modelData=[],p=c.assignBonds===void 0?!0:c.assignBonds;function r(t,n){const f=[];let o=0,v=0;for(;v<t.length;){for(;t.substring(v,v+n.length)!==n&&v<t.length;)if(t[v]==="'"){for(v++;v<t.length&&t[v]!=="'";)v++;for(;t.substring(v,v+n.length)!==n&&v<t.length;)v++}else if(t[v]==='"'){for(v++;v<t.length&&t[v]!=='"';)v++;v++}else v++;f.push(t.substring(o,v)),o=v=v+n.length}return f}const e=A.split(/\r?\n|\r/),i=[];let s=!1;for(let t=0;t<e.length;t++){var a=e[t].split("#")[0];if(s?a[0]===";"&&(s=!1):a[0]===";"&&(s=!0),s||a!==""){if(!s&&(a=a.trim(),a[0]==="_")){const n=a.split(/\s/)[0].indexOf(".");if(n>-1){let f=a.split("");f[n]="_",a=f.join(""),a=a.substring(0,n)+"_"+a.substring(n+1)}}i.push(a)}}let h=0;for(;h<i.length;){for(;!i[h].startsWith("data_")||i[h]==="data_global";)h++;h++;const t={};for(;h<i.length&&!i[h].startsWith("data_");)if(i[h][0]===void 0)h++;else if(i[h][0]==="_"){const v=i[h].split(/\s/)[0].toLowerCase(),m=t[v]=t[v]||[],E=i[h].substring(i[h].indexOf(v)+v.length);if(E==="")if(h++,i[h][0]===";"){let S=i[h].substring(1);for(h++;i[h]!==";";)S=S+`
`+i[h],h++;m.push(S)}else m.push(i[h]);else m.push(E.trim());h++}else if(i[h].substring(0,5)==="loop_"){h++;const v=[];for(;i[h]===""||i[h][0]==="_";){if(i[h]!==""){let E=i[h].split(/\s/)[0].toLowerCase(),S=t[E]=t[E]||[];v.push(S)}h++}let m=0;for(;h<i.length&&i[h][0]!=="_"&&!i[h].startsWith("loop_")&&!i[h].startsWith("data_");){let E=r(i[h]," ");for(let S=0;S<E.length;S++)E[S]!==""&&(v[m].push(E[S]),m=(m+1)%v.length);h++}}else h++;u.push({symmetries:[]}),y.push([]);const n=t._atom_site_id!==void 0?t._atom_site_id.length:t._atom_site_label.length;let f;if(t._cell_length_a!==void 0){const v=parseFloat(t._cell_length_a),m=parseFloat(t._cell_length_b),E=parseFloat(t._cell_length_c),S=parseFloat(t._cell_angle_alpha)||90,T=parseFloat(t._cell_angle_beta)||90,P=parseFloat(t._cell_angle_gamma)||90;f=(0,w.conversionMatrix3)(v,m,E,S,T,P),u[u.length-1].cryst={a:v,b:m,c:E,alpha:S,beta:T,gamma:P}}for(let v=0;v<n;v++){if(t._atom_site_group_pdb!==void 0&&t._atom_site_group_pdb[v]==="TER")continue;const m={};if(t._atom_site_cartn_x!==void 0)m.x=parseFloat(t._atom_site_cartn_x[v]),m.y=parseFloat(t._atom_site_cartn_y[v]),m.z=parseFloat(t._atom_site_cartn_z[v]);else{const S=g(f,parseFloat(t._atom_site_fract_x[v]),parseFloat(t._atom_site_fract_y[v]),parseFloat(t._atom_site_fract_z[v]));m.x=S.x,m.y=S.y,m.z=S.z}m.chain=t._atom_site_auth_asym_id?t._atom_site_auth_asym_id[v]:t._atom_site_label_asym_id?t._atom_site_label_asym_id[v]:void 0,m.resi=t._atom_site_auth_seq_id?parseInt(t._atom_site_auth_seq_id[v]):t._atom_site_label_seq_id?t._atom_site_label_seq_id[v]:void 0,m.resn=t._atom_site_auth_comp_id?t._atom_site_auth_comp_id[v].trim():t._atom_site_label_comp_id?t._atom_site_label_comp_id[v].trim():void 0,m.atom=t._atom_site_auth_atom_id?t._atom_site_auth_atom_id[v].replace(/"/gm,""):t._atom_site_label_atom_id?t._atom_site_label_atom_id[v].replace(/"/gm,""):void 0,m.hetflag=!t._atom_site_group_pdb||t._atom_site_group_pdb[v]==="HETA"||t._atom_site_group_pdb[v]==="HETATM",t._atom_site_b_iso_or_equiv&&(m.b=parseFloat(t._atom_site_b_iso_or_equiv[v]));let E="X";t._atom_site_type_symbol?E=t._atom_site_type_symbol[v].replace(/\(?\+?\d+.*/,""):t._atom_site_label&&(E=t._atom_site_label[v].split("_")[0].replace(/\(?\d+.*/,"")),m.elem=E[0].toUpperCase()+E.substring(1,2).toLowerCase(),m.bonds=[],m.ss="c",m.serial=v,m.bondOrder=[],m.properties={},y[y.length-1].push(m)}if(t._pdbx_struct_oper_list_id!==void 0&&!b)for(let v=0;v<t._pdbx_struct_oper_list_id.length;v++){const m=parseFloat(t["_pdbx_struct_oper_list_matrix[1][1]"][v]),E=parseFloat(t["_pdbx_struct_oper_list_matrix[1][2]"][v]),S=parseFloat(t["_pdbx_struct_oper_list_matrix[1][3]"][v]),T=parseFloat(t["_pdbx_struct_oper_list_vector[1]"][v]),P=parseFloat(t["_pdbx_struct_oper_list_matrix[2][1]"][v]),I=parseFloat(t["_pdbx_struct_oper_list_matrix[2][2]"][v]),B=parseFloat(t["_pdbx_struct_oper_list_matrix[2][3]"][v]),R=parseFloat(t["_pdbx_struct_oper_list_vector[2]"][v]),z=parseFloat(t["_pdbx_struct_oper_list_matrix[3][1]"][v]),U=parseFloat(t["_pdbx_struct_oper_list_matrix[3][2]"][v]),W=parseFloat(t["_pdbx_struct_oper_list_matrix[3][3]"][v]),F=parseFloat(t["_pdbx_struct_oper_list_vector[3]"][v]),N=new w.Matrix4(m,E,S,T,P,I,B,R,z,U,W,F);u[u.length-1].symmetries.push(N)}const o=function(v){const m=v.match("-");v=v.replace(/[-xyz]/g,"");const E=v.split("/");let S,T;return E[1]===void 0?T=1:T=parseInt(E[1]),E[0]===""?S=1:S=parseInt(E[0]),S/T*(m?-1:1)};if(t._symmetry_equiv_pos_as_xyz!==void 0&&!b)for(let v=0;v<t._symmetry_equiv_pos_as_xyz.length;v++){const E=t._symmetry_equiv_pos_as_xyz[v].replace(/["' ]/g,"").split(",").map(function(I){return I.replace(/-/g,"+-")});let S=new w.Matrix4(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1);for(let I=0;I<3;I++){const B=E[I].split("+");for(let R=0;R<B.length;R++){const z=B[R];if(z==="")continue;const U=o(z);z.match("x")?S.elements[I+0]=U:z.match("y")?S.elements[I+4]=U:z.match("z")?S.elements[I+8]=U:S.elements[I+12]=U}}const T=f.getMatrix4(),P=new w.Matrix4().getInverse(T,!0);S=new w.Matrix4().multiplyMatrices(S,P),S=new w.Matrix4().multiplyMatrices(T,S),u[u.length-1].symmetries.push(S)}}for(let t=0;t<y.length;t++)p&&!(c.duplicateAssemblyAtoms&&!c.dontConnectDuplicatedAtoms)&&(0,O.assignPDBBonds)(y[t],c),(0,M.computeSecondaryStructure)(y[t],c.hbondCutoff),(0,L.processSymmetries)(u[t].symmetries,y[t],c,u[t].cryst),c.duplicateAssemblyAtoms&&!c.dontConnectDuplicatedAtoms&&p&&(0,O.assignPDBBonds)(y[t],c);return y}},"./src/parsers/CUBE.ts":(K,C,d)=>{d.r(C),d.d(C,{CUBE:()=>O});var M=d("./src/WebGL/index.ts"),L=d("./src/parsers/utils/assignBonds.ts"),w=d("./src/parsers/utils/anumToSymbol.ts");function O(g,_){_=_||{};const A=[[]];let c=g.split(/\r?\n/);const y=_.assignBonds===void 0?!0:_.assignBonds;if(c.length<6)return A;let b=c[2].replace(/^\s+/,"").replace(/\s+/g," ").split(" ");const u=Math.abs(parseFloat(b[0]));let p={origin:void 0,size:void 0,unit:void 0,matrix4:void 0,matrix:void 0};const r=p.origin=new M.Vector3(parseFloat(b[1]),parseFloat(b[2]),parseFloat(b[3]));b=c[3].replace(/^\s+/,"").replace(/\s+/g," ").split(" "),b=c[3].replace(/^\s+/,"").replace(/\s+/g," ").split(" ");const e=b[0]>0?.529177:1;r.multiplyScalar(e);const i=Math.abs(b[0]),s=new M.Vector3(parseFloat(b[1]),parseFloat(b[2]),parseFloat(b[3])).multiplyScalar(e);b=c[4].replace(/^\s+/,"").replace(/\s+/g," ").split(" ");const a=Math.abs(b[0]),h=new M.Vector3(parseFloat(b[1]),parseFloat(b[2]),parseFloat(b[3])).multiplyScalar(e);b=c[5].replace(/^\s+/,"").replace(/\s+/g," ").split(" ");const t=Math.abs(b[0]),n=new M.Vector3(parseFloat(b[1]),parseFloat(b[2]),parseFloat(b[3])).multiplyScalar(e);if(p.size={x:i,y:a,z:t},p.unit=new M.Vector3(s.x,h.y,n.z),s.y!=0||s.z!=0||h.x!=0||h.z!=0||n.x!=0||n.y!=0){p.matrix4=new M.Matrix4(s.x,h.x,n.x,0,s.y,h.y,n.y,0,s.z,h.z,n.z,0,0,0,0,1);let T=new M.Matrix4().makeTranslation(r.x,r.y,r.z);p.matrix4=p.matrix4.multiplyMatrices(T,p.matrix4),p.matrix=p.matrix4.matrix3FromTopLeft(),p.origin=new M.Vector3(0,0,0),p.unit=new M.Vector3(1,1,1)}A.modelData=[{cryst:p}],c=c.splice(6,u);for(var f=A[A.length-1].length,o=f+c.length,v=f;v<o;++v){var m={};m.serial=v;var E=c[v-f],S=E.replace(/^\s+/,"").replace(/\s+/g," ").split(" ");m.elem=w.anumToSymbol[S[0]],m.x=parseFloat(S[2])*e,m.y=parseFloat(S[3])*e,m.z=parseFloat(S[4])*e,m.hetflag=!0,m.bonds=[],m.bondOrder=[],m.properties={},A[A.length-1].push(m)}if(y)for(let T=0;T<A.length;T++)(0,L.assignBonds)(A[T],_);return A}},"./src/parsers/GRO.ts":(K,C,d)=>{d.r(C),d.d(C,{GRO:()=>w});var M=d("./src/parsers/utils/assignPDBBonds.ts"),L=d("./src/parsers/utils/atomNameToElem.ts");function w(O,g){const _=[],A=O.split(/\r?\n|\r/);for(;A.length>0;){const c=parseInt(A[1]);if(A.length<3||isNaN(c)||c<=0||A.length<c+3)break;const b=[];_.push(b);let u=2;const p=b.length,r=p+c;for(let e=p;e<r;e++){const i=A[u++],s={};s.serial=e,s.atom=i.slice(10,15).trim(),s.elem=(0,L.atomNameToElem)(s.atom,!0),s.x=10*parseFloat(i.slice(20,28)),s.y=10*parseFloat(i.slice(28,36)),s.z=10*parseFloat(i.slice(36,44)),s.resi=parseInt(i.slice(0,5)),s.resn=i.slice(5,10).trim(),s.bonds=[],s.bondOrder=[],s.properties={},i.length>44&&(s.dx=10*parseFloat(i.slice(44,52)),s.dy=10*parseFloat(i.slice(52,60)),s.dz=10*parseFloat(i.slice(60,68))),b[e]=s}if(A.length<=u+3){const i=A[u++].trim().split(/\s+/);if(i.length===3){for(let s=0;s<3;s++)i[s]=(parseFloat(i[s])*10).toString();_.box=i}}A.splice(0,++u)}for(let c=0;c<_.length;c++)(0,M.assignPDBBonds)(_[c],g);return _}},"./src/parsers/LAMMPSTRJ.ts":(K,C,d)=>{d.r(C),d.d(C,{LAMMPSTRJ:()=>w});var M=d("./src/parsers/utils/assignBonds.ts");const L={id:"serial",type:"atom",element:"elem",q:"charge",radius:"radius",x:"x",xu:"x",xs:"x",xsu:"x",y:"y",yu:"y",ys:"y",ysu:"y",z:"z",zu:"z",zs:"z",zsu:"z"};function w(O,g){const _=[],A=O.split(/\r?\n|\r/);let c=0,y=0,b=0;for(;b<A.length-9;){for(var u=b;u<A.length;u++)if(A[u].match(/ITEM: NUMBER OF ATOMS/)&&(y=parseInt(A[u+1])),A[u].match(/ITEM: ATOMS/)){c=u+1;break}const p=A[c-1].replace("ITEM: ATOMS ","").split(" ");_.push([]);for(let r=c;r<c+y;r++){const e={},i={},s=A[r].split(" ");for(let a=0;a<s.length;a++){const h=L[p[a]];h!==void 0&&(h==="serial"?e[h]=parseInt(s[a]):h==="x"||h==="y"||h==="z"?e[h]=parseFloat(s[a]):h==="charge"||h==="radius"?i[h]=parseFloat(s[a]):e[h]=s[a]),e.properties=i,e.bonds=[],e.bondOrder=[]}_[_.length-1][r-c]=e}b=c+y-1}if(g.assignBonds)for(let p=0;p<_.length;p++)(0,M.assignBonds)(_[p],g);return _}},"./src/parsers/MMTF.ts":(K,C,d)=>{d.r(C),d.d(C,{MMTFparser:()=>y});var M=d("./src/utilities.ts"),L=d("./src/WebGL/index.ts"),w=d("./src/parsers/utils/computeSecondaryStructure.ts"),O=d("./src/parsers/utils/processSymmetries.ts"),g=d("./src/vendor/mmtf.js"),_=function(b){return String.fromCharCode.apply(null,b).replace(/\0/g,"")},A=function(b){return b==0||b==2||b==4?"h":b==3?"s":"c"};let c=new Set(["D-SACCHARIDE","D-SACCHARIDE 1,4 AND 1,4 LINKING","D-SACCHARIDE 1,4 AND 1,6 LINKING","L-SACCHARIDE","L-SACCHARIDE 1,4 AND 1,4 LINKING","L-SACCHARIDE 1,4 AND 1,6 LINKING","NON-POLYMER","OTHER","PEPTIDE-LIKE","SACCHARIDE"]);function y(b,u){var p=!u.keepH,r=u.altLoc?u.altLoc:"A",e=!!u.noSecondaryStructure,i=!u.noComputeSecondaryStructure,s=!u.doAssembly,a=u.assemblyIndex?u.assemblyIndex:0;typeof b=="string"?b=(0,M.base64ToArray)(b):b=new Uint8Array(b);var h=g.decode(b),t=[[]],n=t.modelData=[],f=0,o=0,v=0,m=h.secStructList,E=h.bFactorList,S=h.altLocList,T=h.occupancyList,P=h.bondAtomList,I=h.bondOrderList,B=h.numModels;if(B==0)return t;u.multimodel||(B=1);var R,z,U,W,F,N,q=[];if(!s&&h.bioAssemblyList&&h.bioAssemblyList.length>0){var J=h.bioAssemblyList[a].transformList;for(R=0,N=J.length;R<N;R++){var oe=new L.Matrix4(J[R].matrix);oe.transpose(),q.push(oe)}}var le=null;if(h.unitCell){var fe=h.unitCell;le={a:fe[0],b:fe[1],c:fe[2],alpha:fe[3],beta:fe[4],gamma:fe[5]}}let ie=[];h.entityList.forEach(ce=>{ce.chainIndexList.forEach(H=>{ie[H]=ce.type=="polymer"})});var ne=0;for(F=0;F<B;F++){var we=h.chainsPerModel[F],Ee=t[t.length-1],Se=[];for(n.push({symmetries:q,cryst:le}),R=0;R<we;++R){var de=h.groupsPerChain[f],ee=_(h.chainIdList.subarray(f*4,f*4+4));h.chainNameList&&(ee=_(h.chainNameList.subarray(f*4,f*4+4)));var me=o,De="";for(z=0;z<de;++z){var Ie=h.groupList[h.groupTypeList[o]],Fe=Ie.atomNameList.length,Ue=0,ze=!1,Re=!1;if(m){Ue=m[o];var Pe=A(Ue);(o==0||Pe!=De)&&(ze=!0),De=Pe;var Oe=o+1;(Oe>=m.length||A(m[Oe]!=Pe))&&(Re=!0)}var Ae=h.groupIdList[o],Ne=Ie.groupName;let ce=Ie.chemCompType;var je=v;let H=c.has(ce)||!ie[f];for(U=0;U<Fe;++U){var k=Ie.elementList[U];if(p&&k=="H"){v+=1;continue}var Z="";E&&(Z=E[v]);var Y="";S&&S[v]&&(Y=String.fromCharCode(S[v]));var ve="";if(T&&(ve=T[v]),Y!=""&&Y!=r&&r!="*"){v+=1;continue}var re=h.atomIdList[v],Le=Ie.atomNameList[U],Me=0;Ie.atomChargeList&&(Me=Ie.atomChargeList[U]);var V=h.xCoordList[v],ae=h.yCoordList[v],pe=h.zCoordList[v];Se[v]=Ee.length,Ee.push({resn:Ne,x:V,y:ae,z:pe,elem:k,hetflag:H,chain:ee,resi:Ae,icode:Y,rescode:Ae+(Y!=" "?"^"+Y:""),serial:re,altLoc:Y,index:v,atom:Le,bonds:[],ss:A(Ue),ssbegin:ze,ssend:Re,bondOrder:[],properties:{charge:Me,occupancy:ve},b:Z}),v+=1}var Te=Ie.bondAtomList;for(U=0,W=Ie.bondOrderList.length;U<W;++U){var se=je+Te[U*2],ye=je+Te[U*2+1],j=Ie.bondOrderList[U],Ce=Se[se],We=Se[ye],D=Ee[Ce],ue=Ee[We];D&&ue&&(D.bonds.push(We),D.bondOrder.push(j),ue.bonds.push(Ce),ue.bondOrder.push(j))}o+=1}for(o=me,z=0;z<de;++z)o+=1;f+=1}if(P)for(let ce=ne,H=P.length;ce<H;ce+=2){let te=P[ce],_e=P[ce+1],ke=I?I[ce/2]:1;if(te>=v){ne=ce;break}let Ve=Se[te],Ge=Se[_e],$e=Ee[Ve],xt=Ee[Ge];$e&&xt&&($e.bonds.push(Ge),$e.bondOrder.push(ke),xt.bonds.push(Ve),xt.bondOrder.push(ke))}u.multimodel&&(u.onemol||t.push([]))}if(!s)for(let ce=0;ce<t.length;ce++)(0,O.processSymmetries)(n[ce].symmetries,t[ce],u,n[ce].cryst);return i&&!e&&(0,w.computeSecondaryStructure)(t,u.hbondCutoff),t}},"./src/parsers/MOL2.ts":(K,C,d)=>{d.r(C),d.d(C,{MOL2:()=>L});let M={"C.1":"C",C1:"C","C.2":"C",C2:"C","C.3":"C",C3:"C","C.ar":"C",Car:"C","C.cat":"C",Ccat:"C","H.spc":"H",Hspc:"H","H.t3p":"H",Ht3p:"H","N.1":"N",N1:"N","N.2":"N",N2:"N","N.3":"N",N3:"N","N.4":"N",N4:"N","N.am":"N",Nam:"N","N.ar":"N",Nar:"N","N.p13":"N",Np13:"N","O.2":"O",O2:"O","O.3":"O",O3:"O","O.co2":"O",Oco2:"O","O.spc":"O",Ospc:"O","O.t3p":"O",Ot3p:"O","P.3":"P",P3:"P","S.2":"S",S2:"S","S.3":"S",S3:"S","S.o":"S",So:"S","S.o2":"S",So2:"S"};function L(w,O){var g=[[]],_=!1;typeof O.keepH<"u"&&(_=!O.keepH);var A=w.search(/@<TRIPOS>MOLECULE/),c=w.search(/@<TRIPOS>ATOM/);if(A==-1||c==-1)return g;for(var y=w.substring(A).split(/\r?\n|\r/);y.length>0;){var b=[],u=y[2].replace(/^\s+/,"").replace(/\s+/g," ").split(" "),p=parseInt(u[0]),r=0;u.length>1&&(r=parseInt(u[1]));var e=4,i;for(i=3;i<y.length;i++)if(y[i]=="@<TRIPOS>ATOM"){e=i+1;break}var s=g[g.length-1].length,a=s+p,h;for(i=s;i<a;i++){h=y[e++],u=h.replace(/^\s+/,"").replace(/\s+/g," ").split(" ");var t={},n=u[5];if(M[n]!==void 0?n=M[n]:(n=n.split(".")[0],n=n[0].toUpperCase()+n.substring(1).toLowerCase()),t.atom=u[1],t.elem=n,!(t.elem=="H"&&_)){var f=g[g.length-1].length,o=parseInt(u[0]);t.serial=o,t.x=parseFloat(u[2]),t.y=parseFloat(u[3]),t.z=parseFloat(u[4]),t.atom=u[5];var v=parseFloat(u[8]);t.index=f,t.bonds=[],t.bondOrder=[],t.properties={charge:v,partialCharge:v},b[o]=f,g[g.length-1].push(t)}}for(var m=!1;e<y.length;)if(y[e++]=="@<TRIPOS>BOND"){m=!0;break}if(m&&r)for(i=0;i<r;i++){h=y[e++],u=h.replace(/^\s+/,"").replace(/\s+/g," ").split(" ");var E=parseInt(u[1]),S=g[g.length-1][b[E]],T=parseInt(u[2]),P=g[g.length-1][b[T]],I=parseInt(u[3]);isNaN(I)&&(I=1),S!==void 0&&P!==void 0&&(S.bonds.push(b[T]),S.bondOrder.push(I),P.bonds.push(b[E]),P.bondOrder.push(I))}if(O.multimodel){O.onemol||g.push([]),y.splice(0,e),w=y.join(`
`);continue}else break}return g}},"./src/parsers/PDB.ts":(K,C,d)=>{d.r(C),d.d(C,{PDB:()=>L});var M=d("./src/parsers/utils/getSinglePDB.ts");function L(w,O){O=O||{};var g=[],_={};g.modelData=[];for(var A=w.split(/\r?\n|\r/);A.length>0;){var c=(0,M.getSinglePDB)(A,O,_),y=c[0],b=c[1];if(A=c[2],y.length!=0){if(O.multimodel&&O.onemol&&g.length>0)for(var u=g[0].length,p=0;p<y.length;p++){var r=y[p];r.index=p;for(var e=0;e<r.bonds.length;e++)r.bonds[e]+=u;g[0].push(r)}else g.modelData.push(b),g.push(y);if(!O.multimodel)break}}return g}},"./src/parsers/PQR.ts":(K,C,d)=>{d.r(C),d.d(C,{PQR:()=>w});var M=d("./src/parsers/utils/assignPDBBonds.ts"),L=d("./src/parsers/utils/computeSecondaryStructure.ts");function w(O,g){var _=[[]],A=!g.noSecondaryStructure;_.modelData=[{symmetries:[]}];var c=[],y=O.split(/\r?\n|\r/),b;for(let m=0;m<y.length;m++){b=y[m].replace(/^\s*/,"");var u=b.substring(0,6);if(u.indexOf("END")==0)if(g.multimodel){g.onemol||_.push([]);continue}else break;else if(u=="ATOM  "||u=="HETATM"){var p;let E=parseInt(b.substring(6,11)),S=b.substring(12,16).replace(/ /g,""),T=b.substring(17,20).trim(),P=b.substring(21,22),I=parseInt(b.substring(22,26));var r=b.substring(30).trim().split(/\s+/),e=parseFloat(r[0]),i=parseFloat(r[1]),s=parseFloat(r[2]),a=parseFloat(r[3]),h=parseFloat(r[4]),t=S[0];S.length>1&&S[1].toUpperCase()!=S[1]&&(t=S.substring(0,2)),b[0]=="H"?p=!0:p=!1,c[E]=_[_.length-1].length,_[_.length-1].push({resn:T,x:e,y:i,z:s,elem:t,hetflag:p,chain:P,resi:I,serial:E,atom:S,bonds:[],ss:"c",bondOrder:[],properties:{charge:a,partialCharge:a,radius:h},pdbline:b})}else if(u=="CONECT"){var n=parseInt(b.substring(6,11)),f=_[_.length-1][c[n]];for(let E=0;E<4;E++){var o=parseInt(b.substring([11,16,21,26][E],[11,16,21,26][E]+5)),v=_[_.length-1][c[o]];f!==void 0&&v!==void 0&&(f.bonds.push(c[o]),f.bondOrder.push(1))}}}for(let m=0;m<_.length;m++)(0,M.assignPDBBonds)(_[m],g),A&&(0,L.computeSecondaryStructure)(_[m],g.hbondCutoff);return _}},"./src/parsers/PRMTOP.ts":(K,C,d)=>{d.r(C),d.d(C,{PRMTOP:()=>M});function M(L){var w=[],O,g=0,_=L.split(/\r?\n|\r/);if(_.length>0&&_[0].includes("VERSION")){var A=_.filter(function(e){return e.includes("POINTERS")||e.includes("ATOM_NAME")||e.includes("CHARGE")||e.includes("RADII")||e.includes("BONDS_INC_HYDROGEN")||e.includes("BONDS_WITHOUT_HYDROGEN")}),c=p("POINTERS");if(c==-1)return[];var y=r(c),b=parseInt(_[c+1].slice(0,y[1]));if(isNaN(b)||b<=0)return[];if(c=p("ATOM_NAME"),c==-1)return[];y=r(c);var u=y[0];for(let e=0;e<b/y[0];e++){e==parseInt(b/y[0])&&(u=b%y[0]);for(let i=0;i<u;i++){let s={},a={charge:"",radii:""};s.serial=g,s.x=0,s.y=0,s.z=0,s.atom=_[c+1].slice(y[1]*i,y[1]*(i+1)).trim(),s.elem=_[c+1].slice(y[1]*i,y[1]*i+1).trim(),s.properties=a,s.bonds=[],s.bondOrder=[],w.push(s),g++}c++}if(c=p("CHARGE"),c!=-1){y=r(c),g=0,u=y[0];for(let e=0;e<b/y[0];e++){e==parseInt(b/y[0])&&(u=b%y[0]);for(let i=0;i<u;i++)w[g].properties.charge=parseFloat(_[c+1].slice(y[1]*i,y[1]*(i+1))),g++;c++}}if(c=p("RADII"),c!=-1){y=r(c),g=0,u=y[0];for(let e=0;e<b/y[0];e++){e==parseInt(b/y[0])&&(u=b%y[0]);for(let i=0;i<u;i++)w[g].properties.radii=parseFloat(_[c+1].slice(y[1]*i,y[1]*(i+1))),g++;c++}}if(c=p("BONDS_WITHOUT_HYDROGEN"),c!=-1)for(y=r(c),g=0,u=y[0],c=c+1;!_[c].match(/^%FLAG/);){_[c+1].match(/^%FLAG/)&&(u=b%y[0]);for(let e=0;e<u;e++)g%3==0?O=parseInt(_[c].slice(y[1]*e,y[1]*(e+1))/3):g%3==1&&w[O].bonds.push(parseInt(_[c].slice(y[1]*e,y[1]*(e+1))/3)),g++;c++}if(c=p("BONDS_INC_HYDROGEN"),c!=-1)for(y=r(c),g=0,u=y[0],c=c+1;!_[c].match(/^%FLAG/);){_[c+1].match(/^%FLAG/)&&(u=b%y[0]);for(let e=0;e<u;e++)g%3==0?O=parseInt(_[c].slice(y[1]*e,y[1]*(e+1))/3):g%3==1&&w[O].bonds.push(parseInt(_[c].slice(y[1]*e,y[1]*(e+1))/3)),g++;c++}}else return[];function p(e){var i=_.indexOf(A.filter(function(s){return s.includes(e)})[0]);if(Number.isInteger(i)&&i>0){for(;!_[i].includes("FORMAT");)i++;return i}else return-1}function r(e){var i=_[e].match(/\((\d*)\S*/),s=_[e].match(/[a-zA-Z](\d*)\)\s*/);return s==null&&(s=_[e].match(/[a-zA-Z](\d*)\.\d*\)\s*/)),[i[1],s[1]]}return[w]}},"./src/parsers/SDF.ts":(K,C,d)=>{d.r(C),d.d(C,{SDF:()=>w});var M=function(O,g){var _=[[]],A=!1;for(typeof g.keepH<"u"&&(A=!g.keepH);O.length>0&&!(O.length<4);){var c=parseInt(O[3].substring(0,3));if(isNaN(c)||c<=0)break;var y=parseInt(O[3].substring(3,6)),b=4;if(O.length<4+c+y)break;var u=[],p=_[_.length-1].length,r=p+c,e,i;for(e=p;e<r;e++,b++){i=O[b];var s={},a=i.substring(31,34).replace(/ /g,"");s.atom=s.elem=a[0].toUpperCase()+a.substring(1).toLowerCase(),(s.elem!=="H"||!A)&&(s.serial=e,u[e]=_[_.length-1].length,s.x=parseFloat(i.substring(0,10)),s.y=parseFloat(i.substring(10,20)),s.z=parseFloat(i.substring(20,30)),s.hetflag=!0,s.bonds=[],s.bondOrder=[],s.properties={},s.index=_[_.length-1].length,_[_.length-1].push(s))}for(e=0;e<y;e++,b++){i=O[b];var h=u[parseInt(i.substring(0,3))-1+p],t=u[parseInt(i.substring(3,6))-1+p],n=parseFloat(i.substring(6));typeof h<"u"&&typeof t<"u"&&(_[_.length-1][h].bonds.push(t),_[_.length-1][h].bondOrder.push(n),_[_.length-1][t].bonds.push(h),_[_.length-1][t].bondOrder.push(n))}if(g.multimodel){for(g.onemol||_.push([]);O[b]!=="$$$$"&&b<O.length;)b++;O.splice(0,++b)}else break}return _},L=function(O,g){var _=[[]],A=!1;for(typeof g.keepH<"u"&&(A=!g.keepH);O.length>0&&!(O.length<8||!O[4].startsWith("M  V30 BEGIN CTAB")||!O[5].startsWith("M  V30 COUNTS")||O[5].length<14);){var c=O[5].substring(13).match(/\S+/g);if(c.length<2)break;var y=parseInt(c[0]);if(isNaN(y)||y<=0)break;var b=parseInt(c[1]),u=7;if(O.length<8+y+b)break;var p=[],r=_[_.length-1].length,e=r+y,i,s;for(i=r;i<e;i++,u++){s=O[u];var a=s.substring(6).match(/\S+/g);if(a.length>4){var h={},t=a[1].replace(/ /g,"");h.atom=h.elem=t[0].toUpperCase()+t.substring(1).toLowerCase(),(h.elem!=="H"||!A)&&(h.serial=i,p[i]=_[_.length-1].length,h.x=parseFloat(a[2]),h.y=parseFloat(a[3]),h.z=parseFloat(a[4]),h.hetflag=!0,h.bonds=[],h.bondOrder=[],h.properties={},h.index=_[_.length-1].length,_[_.length-1].push(h))}}if(O[u]==="M  V30 END ATOM")u++;else break;if(b!==0&&O[u]==="M  V30 BEGIN BOND")u++;else break;for(i=0;i<b;i++,u++){s=O[u];var n=s.substring(6).match(/\S+/g);if(n.length>3){var f=p[parseInt(n[2])-1+r],o=p[parseInt(n[3])-1+r],v=parseFloat(n[1]);typeof f<"u"&&typeof o<"u"&&(_[_.length-1][f].bonds.push(o),_[_.length-1][f].bondOrder.push(v),_[_.length-1][o].bonds.push(f),_[_.length-1][o].bondOrder.push(v))}}if(g.multimodel){for(g.onemol||_.push([]);O[u]!=="$$$$"&&u<O.length;)u++;O.splice(0,++u)}else break}return _};function w(O,g){var _="V2000",A=O.split(/\r?\n|\r/);return A.length>3&&A[3].length>38&&(_=A[3].substring(34,39)),_==="V2000"?M(A,g):_==="V3000"?L(A,g):[[""]]}},"./src/parsers/VASP.ts":(K,C,d)=>{d.r(C),d.d(C,{VASP:()=>w});var M=d("./src/WebGL/index.ts"),L=d("./src/parsers/utils/assignBonds.ts");function w(O,g={}){var _=[[]],A={};const c=g.assignBonds===void 0?!0:g.assignBonds;var y=O.replace(/^\s+/,"").split(/\r?\n/);if(y.length<3)return _;if(y[1].match(/\d+/))A.length=parseFloat(y[1]);else return console.log("Warning: second line of the vasp structure file must be a number"),_;if(A.length<0)return console.log("Warning: Vasp implementation for negative lattice lengths is not yet available"),_;A.xVec=new Float32Array(y[2].replace(/^\s+/,"").split(/\s+/)),A.yVec=new Float32Array(y[3].replace(/^\s+/,"").split(/\s+/)),A.zVec=new Float32Array(y[4].replace(/^\s+/,"").split(/\s+/));var b=new M.Matrix3(A.xVec[0],A.xVec[1],A.xVec[2],A.yVec[0],A.yVec[1],A.yVec[2],A.zVec[0],A.zVec[1],A.zVec[2]);b.multiplyScalar(A.length),_.modelData=[{symmetries:[],cryst:{matrix:b}}];var u=y[5].trim().split(/\s+/),p=new Int16Array(y[6].trim().split(/\s+/)),r=y[7].trim(),e=!1;if(r.match(/S/)&&(e=!0,r=y[8].trim()),r.toLowerCase()[0]=="c")r="cartesian";else if(r.toLowerCase()[0]=="d")r="direct";else return console.log("Warning: Unknown vasp mode in POSCAR file: mode must be either C(artesian) or D(irect)"),_;if(u.length!=p.length)return console.log("Warning: declaration of atomary species wrong:"),console.log(u),console.log(p),_;e?y.splice(0,9):y.splice(0,8);for(var i=0,s=0,a=u.length;s<a;s++){for(var h=u[s],t=0,n=p[s];t<n;t++){var f=new Float32Array(y[i+t].trim().split(/\s+/)),o={};o.elem=h,r=="cartesian"?(o.x=A.length*f[0],o.y=A.length*f[1],o.z=A.length*f[2]):(o.x=A.length*(f[0]*A.xVec[0]+f[1]*A.yVec[0]+f[2]*A.zVec[0]),o.y=A.length*(f[0]*A.xVec[1]+f[1]*A.yVec[1]+f[2]*A.zVec[1]),o.z=A.length*(f[0]*A.xVec[2]+f[1]*A.yVec[2]+f[2]*A.zVec[2])),o.bonds=[],o.bondOrder=[],_[0].push(o)}i+=p[s]}if(c)for(let v=0;v<_.length;v++)(0,L.assignBonds)(_[v],g);return _}},"./src/parsers/XYZ.ts":(K,C,d)=>{d.r(C),d.d(C,{XYZ:()=>w});var M=d("./src/WebGL/index.ts"),L=d("./src/parsers/utils/assignBonds.ts");function w(O,g){g=g||{};for(var _=[[]],A=g.assignBonds===void 0?!0:g.assignBonds,c=O.trimStart().split(/\r?\n|\r/);c.length>0&&!(c.length<3);){var y=parseInt(c[0]);if(isNaN(y)||y<=0||c.length<y+2)break;var b=/Lattice\s*=\s*["\{\}]([^"\{\}]+)["\{\}]\s*/gi,u=b.exec(c[1]);if(u!=null&&u.length>1){var p=new Float32Array(u[1].split(/\s+/)),r=new M.Matrix3(p[0],p[3],p[6],p[1],p[4],p[7],p[2],p[5],p[8]);_.modelData=[{cryst:{matrix:r}}]}for(var e=2,i=_[_.length-1].length,s=i+y,a=i;a<s;a++){var h=c[e++],t=h.trim().split(/\s+/),n={};n.serial=a;var f=t[0];n.atom=n.elem=f[0].toUpperCase()+f.substring(1,2).toLowerCase(),n.x=parseFloat(t[1]),n.y=parseFloat(t[2]),n.z=parseFloat(t[3]),n.hetflag=!0,n.bonds=[],n.bondOrder=[],n.properties={},_[_.length-1][a]=n,t.length>=7&&(n.dx=parseFloat(t[4]),n.dy=parseFloat(t[5]),n.dz=parseFloat(t[6]))}if(g.multimodel)_.push([]),c.splice(0,e);else break}if(A)for(let v=0;v<_.length;v++)(0,L.assignBonds)(_[v],g);if(g.onemol){var o=_;_=[],_.push(o[0]);for(let v=1;v<o.length;v++){let m=_[0].length;for(let E=0;E<o[v].length;E++){let S=o[v][E];for(let T=0;T<S.bonds.length;T++)S.bonds[T]=S.bonds[T]+m;S.index=_[0].length,S.serial=_[0].length,_[0].push(S)}}}return _}},"./src/parsers/cifutils/category.ts":(K,C,d)=>{d.r(C),d.d(C,{Category:()=>L});var M=d("./src/parsers/cifutils/decoder.ts");function L(w){const O=Object.create(null),g=Object.create(null);for(const _ of w.columns)O[_.name]=_;return{rowCount:w.rowCount,name:w.name.substring(1),fieldNames:w.columns.map(_=>_.name),getField(_){const A=O[_];if(A)return g[_]||(g[_]=(0,M.decode)(A.data)),g[_]}}}},"./src/parsers/cifutils/decoder.ts":(K,C,d)=>{d.r(C),d.d(C,{decode:()=>O});var M=d("./src/parsers/cifutils/encoding.ts");const L=new Uint16Array(new Uint8Array([18,52]).buffer)[0]===13330;function w(m,E){const S=new ArrayBuffer(m.length),T=new Uint8Array(S);for(let P=0,I=m.length;P<I;P+=E)for(let B=0;B<E;B++)T[P+E-B-1]=m[P+B];return S}function O(m){let E=m.data;for(let S=m.encoding.length-1;S>=0;S--)E=g(E,m.encoding[S]);return E}function g(m,E){switch(E.kind){case"ByteArray":switch(E.type){case M.Encoding.IntDataType.Uint8:return m;case M.Encoding.IntDataType.Int8:return c(m);case M.Encoding.IntDataType.Int16:return b(m);case M.Encoding.IntDataType.Uint16:return u(m);case M.Encoding.IntDataType.Int32:return p(m);case M.Encoding.IntDataType.Uint32:return r(m);case M.Encoding.FloatDataType.Float32:return e(m);case M.Encoding.FloatDataType.Float64:return i(m);default:throw new Error("unreachable")}case"FixedPoint":return s(m,E);case"IntervalQuantization":return a(m,E);case"RunLength":return h(m,E);case"Delta":return t(m,E);case"IntegerPacking":return o(m,E);case"StringArray":return v(m,E)}}function _(m,E){switch(m){case M.Encoding.IntDataType.Int8:return new Int8Array(E);case M.Encoding.IntDataType.Int16:return new Int16Array(E);case M.Encoding.IntDataType.Int32:return new Int32Array(E);case M.Encoding.IntDataType.Uint8:return new Uint8Array(E);case M.Encoding.IntDataType.Uint16:return new Uint16Array(E);case M.Encoding.IntDataType.Uint32:return new Uint32Array(E);default:return new Int32Array(E)}}function A(m,E){switch(m){case M.Encoding.FloatDataType.Float32:return new Float32Array(E);case M.Encoding.FloatDataType.Float64:return new Float64Array(E);default:return new Float64Array(E)}}function c(m){return new Int8Array(m.buffer,m.byteOffset)}function y(m,E,S){return(m.byteOffset!=0||m.byteLength!=m.buffer.byteLength)&&(m=new Uint8Array(m)),L?new S(m.buffer):new S(w(m,E))}function b(m){return y(m,2,Int16Array)}function u(m){return y(m,2,Uint16Array)}function p(m){return y(m,4,Int32Array)}function r(m){return y(m,4,Uint32Array)}function e(m){return y(m,4,Float32Array)}function i(m){return y(m,8,Float64Array)}function s(m,E){const S=m.length,T=A(E.srcType,S),P=1/E.factor;for(let I=0;I<S;I++)T[I]=P*m[I];return T}function a(m,E){const S=m.length,T=A(E.srcType,S),P=(E.max-E.min)/(E.numSteps-1),I=E.min;for(let B=0;B<S;B++)T[B]=I+P*m[B];return T}function h(m,E){const S=_(E.srcType,E.srcSize);let T=0;for(let P=0,I=m.length;P<I;P+=2){const B=m[P],R=m[P+1];for(let z=0;z<R;++z)S[T++]=B}return S}function t(m,E){const S=m.length,T=_(E.srcType,S);if(!S)return m;T[0]=m[0]+(E.origin|0);for(let P=1;P<S;++P)T[P]=m[P]+T[P-1];return T}function n(m,E){const S=E.byteCount===1?127:32767,T=-S-1,P=m.length,I=new Int32Array(E.srcSize);let B=0,R=0;for(;B<P;){let z=0,U=m[B];for(;U===S||U===T;)z+=U,B++,U=m[B];z+=U,I[R]=z,B++,R++}return I}function f(m,E){const S=E.byteCount===1?255:65535,T=m.length,P=new Int32Array(E.srcSize);let I=0,B=0;for(;I<T;){let R=0,z=m[I];for(;z===S;)R+=z,I++,z=m[I];R+=z,P[B]=R,I++,B++}return P}function o(m,E){return m.length===E.srcSize?m:E.isUnsigned?f(m,E):n(m,E)}function v(m,E){const S=O({encoding:E.offsetEncoding,data:E.offsets}),T=O({encoding:E.dataEncoding,data:m}),P=E.stringData,I=new Array(S.length);I[0]="";for(let z=1,U=S.length;z<U;z++)I[z]=P.substring(S[z-1],S[z]);let B=0;const R=new Array(T.length);for(let z=0,U=T.length;z<U;z++)R[B++]=I[T[z]+1];return R}},"./src/parsers/cifutils/encoding.ts":(K,C,d)=>{d.r(C),d.d(C,{Encoding:()=>L,VERSION:()=>M});const M="0.3.0";var L;(function(w){(function(_){_[_.Int8=1]="Int8",_[_.Int16=2]="Int16",_[_.Int32=3]="Int32",_[_.Uint8=4]="Uint8",_[_.Uint16=5]="Uint16",_[_.Uint32=6]="Uint32"})(w.IntDataType||(w.IntDataType={})),function(_){_[_.Float32=32]="Float32",_[_.Float64=33]="Float64"}(w.FloatDataType||(w.FloatDataType={}));function O(_){let A;return _ instanceof Int8Array?A=w.IntDataType.Int8:_ instanceof Int16Array?A=w.IntDataType.Int16:_ instanceof Int32Array?A=w.IntDataType.Int32:_ instanceof Uint8Array?A=w.IntDataType.Uint8:_ instanceof Uint16Array?A=w.IntDataType.Uint16:_ instanceof Uint32Array?A=w.IntDataType.Uint32:_ instanceof Float32Array?A=w.FloatDataType.Float32:_ instanceof Float64Array?A=w.FloatDataType.Float64:A=w.IntDataType.Int32,A}w.getDataType=O;function g(_){if(_ instanceof Int8Array||_ instanceof Int16Array||_ instanceof Int32Array)return!0;for(let A=0,c=_.length;A<c;A++)if(A<0)return!1;return!0}w.isSignedIntegerDataType=g})(L||(L={}))},"./src/parsers/index.ts":(K,C,d)=>{d.r(C),d.d(C,{Parsers:()=>s,bondLength:()=>i.bondLength,setBondLength:()=>i.setBondLength});var M=d("./src/parsers/VASP.ts"),L=d("./src/parsers/CUBE.ts"),w=d("./src/parsers/XYZ.ts"),O=d("./src/parsers/SDF.ts"),g=d("./src/parsers/CDJSON.ts"),_=d("./src/parsers/CIF.ts"),A=d("./src/parsers/MOL2.ts"),c=d("./src/parsers/PDB.ts"),y=d("./src/parsers/PQR.ts"),b=d("./src/parsers/MMTF.ts"),u=d("./src/parsers/PRMTOP.ts"),p=d("./src/parsers/GRO.ts"),r=d("./src/parsers/LAMMPSTRJ.ts"),e=d("./src/parsers/BCIF.ts"),i=d("./src/parsers/utils/bondLength.ts");const s={vasp:M.VASP,VASP:M.VASP,cube:L.CUBE,CUBE:L.CUBE,xyz:w.XYZ,XYZ:w.XYZ,sdf:O.SDF,SDF:O.SDF,json:g.CDJSON,cdjson:g.CDJSON,CDJSON:g.CDJSON,mcif:_.CIF,cif:_.CIF,CIF:_.CIF,mol2:A.MOL2,MOL2:A.MOL2,pdb:c.PDB,PDB:c.PDB,pdbqt:c.PDB,PDBQT:c.PDB,pqr:y.PQR,PQR:y.PQR,mmtf:b.MMTFparser,MMTF:b.MMTFparser,prmtop:u.PRMTOP,PRMTOP:u.PRMTOP,gro:p.GRO,GRO:p.GRO,lammpstrj:r.LAMMPSTRJ,LAMMPSTRJ:r.LAMMPSTRJ,bcif:e.BCIF,BCIF:e.BCIF}},"./src/parsers/utils/anumToSymbol.ts":(K,C,d)=>{d.r(C),d.d(C,{anumToSymbol:()=>M});const M={1:"H",2:"He",3:"Li",4:"Be",5:"B",6:"C",7:"N",8:"O",9:"F",10:"Ne",11:"Na",12:"Mg",13:"Al",14:"Si",15:"P",16:"S",17:"Cl",18:"Ar",19:"K",20:"Ca",21:"Sc",22:"Ti",23:"V",24:"Cr",25:"Mn",26:"Fe",27:"Co",28:"Ni",29:"Cu",30:"Zn",31:"Ga",32:"Ge",33:"As",34:"Se",35:"Br",36:"Kr",37:"Rb",38:"Sr",39:"Y",40:"Zr",41:"Nb",42:"Mo",43:"Tc",44:"Ru",45:"Rh",46:"Pd",47:"Ag",48:"Cd",49:"In",50:"Sn",51:"Sb",52:"Te",53:"I",54:"Xe",55:"Cs",56:"Ba",71:"Lu",72:"Hf",73:"Ta",74:"W",75:"Re",76:"Os",77:"Ir",78:"Pt",79:"Au",80:"Hg",81:"Tl",82:"Pb",83:"Bi",84:"Po",85:"At",86:"Rn",87:"Fr",88:"Ra",104:"Rf",105:"Db",106:"Sg",107:"Bh",108:"Hs",109:"Mt",110:"Ds",111:"Rg",112:"Cn",113:"Nh",114:"Fl",115:"Mc",116:"Lv",117:"Ts",118:"Og",57:"La",58:"Ce",59:"Pr",60:"Nd",61:"Pm",62:"Sm",63:"Eu",64:"Gd",65:"Tb",66:"Dy",67:"Ho",68:"Er",69:"Tm",70:"Yb",89:"Ac",90:"Th",91:"Pa",92:"U",93:"Np",94:"Pu",95:"Am",96:"Cm",97:"Bk",98:"Cf",99:"Es",100:"Fm",101:"Md",102:"No"}},"./src/parsers/utils/areConnected.ts":(K,C,d)=>{d.r(C),d.d(C,{areConnected:()=>w});var M=d("./src/parsers/utils/bondLength.ts");const L=new Set(["Na","K","Ca","Mg","Mn","Sr"]);function w(O,g,_){if(_&&_.unboundCations&&(L.has(O.elem)||L.has(g.elem)))return!1;let A=(0,M.bondLength)(O.elem)+(0,M.bondLength)(g.elem);A+=.25,A*=A;let c=O.x-g.x;if(c*=c,c>A)return!1;let y=O.y-g.y;if(y*=y,y>A)return!1;let b=O.z-g.z;if(b*=b,b>A)return!1;const u=c+y+b;return!(isNaN(u)||u<.5||u>A||O.altLoc!==g.altLoc&&O.altLoc.trim()!==""&&g.altLoc.trim()!=="")}},"./src/parsers/utils/assignBackboneHBonds.ts":(K,C,d)=>{d.r(C),d.d(C,{assignBackboneHBonds:()=>M});function M(L,w){const O=w||3.2,g=O*O,_=[];for(let A=0,c=L.length;A<c;A++){L[A].index=A;const y=L[A];!y.hetflag&&(y.atom==="N"||y.atom==="O")&&(_.push(y),y.hbondOther=null,y.hbondDistanceSq=Number.POSITIVE_INFINITY)}_.sort(function(A,c){return A.z-c.z});for(let A=0,c=_.length;A<c;A++){const y=_[A];for(let b=A+1;b<c;b++){const u=_[b],p=u.z-y.z;if(p>O)break;if(u.atom==y.atom)continue;const r=Math.abs(u.y-y.y);if(r>O)continue;const e=Math.abs(u.x-y.x);if(e>O)continue;const i=e*e+r*r+p*p;i>g||u.chain==y.chain&&Math.abs(u.resi-y.resi)<4||(i<y.hbondDistanceSq&&(y.hbondOther=u,y.hbondDistanceSq=i),i<u.hbondDistanceSq&&(u.hbondOther=y,u.hbondDistanceSq=i))}}}},"./src/parsers/utils/assignBonds.ts":(K,C,d)=>{d.r(C),d.d(C,{assignBonds:()=>O});var M=d("./src/parsers/utils/areConnected.ts");const L=[{x:0,y:0,z:1},{x:0,y:1,z:-1},{x:0,y:1,z:0},{x:0,y:1,z:1},{x:1,y:-1,z:-1},{x:1,y:-1,z:0},{x:1,y:-1,z:1},{x:1,y:0,z:-1},{x:1,y:0,z:0},{x:1,y:0,z:1},{x:1,y:1,z:-1},{x:1,y:1,z:0},{x:1,y:1,z:1}],w=4.95;function O(g,_){for(let y=0,b=g.length;y<b;y++)g[y].index||(g[y].index=y);const A={x:{y:{z:[]}}};for(let y=0;y<g.length;y++){const b=g[y],u=Math.floor(b.x/w),p=Math.floor(b.y/w),r=Math.floor(b.z/w);A[u]||(A[u]={}),A[u][p]||(A[u][p]={}),A[u][p][r]||(A[u][p][r]=[]),A[u][p][r].push(b)}function c(y,b){for(let u=0;u<y.length;u++){const p=y[u];for(let r=0;r<b.length;r++){const e=b[r];if((0,M.areConnected)(p,e,_)){const i=p.bonds.indexOf(e.index),s=e.bonds.indexOf(p.index);i===-1&&s===-1?(p.bonds.push(e.index),p.bondOrder.push(1),e.bonds.push(p.index),e.bondOrder.push(1)):i===-1?(p.bonds.push(e.index),p.bondOrder.push(e.bondOrder[s])):s===-1&&(e.bonds.push(p.index),e.bondOrder.push(p.bondOrder[i]))}}}}for(let y in A){const b=parseInt(y);for(let u in A[b]){const p=parseInt(u);for(let r in A[b][p]){const e=parseInt(r),i=A[b][p][e];for(let s=0;s<i.length;s++){const a=i[s];for(let h=s+1;h<i.length;h++){const t=i[h];(0,M.areConnected)(a,t,_)&&a.bonds.indexOf(t.index)==-1&&(a.bonds.push(t.index),a.bondOrder.push(1),t.bonds.push(a.index),t.bondOrder.push(1))}}for(let s=0;s<L.length;s++){const a=L[s];if(!A[b+a.x]||!A[b+a.x][p+a.y]||!A[b+a.x][p+a.y][e+a.z])continue;const h=A[b+a.x][p+a.y][e+a.z];c(i,h)}}}}}},"./src/parsers/utils/assignPDBBonds.ts":(K,C,d)=>{d.r(C),d.d(C,{assignPDBBonds:()=>O});var M=d("./src/parsers/utils/areConnected.ts"),L=d("./src/parsers/utils/assignBonds.ts"),w=d("./src/parsers/utils/standardResidues.ts");function O(g,_){const A=[],c=[];for(let p=0,r=g.length;p<r;p++){const e=g[p];e.index=p,e.hetflag||!w.standardResidues.has(e.resn)?c.push(e):A.push(e)}(0,L.assignBonds)(c,_),A.sort(function(p,r){return p.chain!==r.chain?p.chain<r.chain?-1:1:p.resi-r.resi});let y=-1,b=-1,u;for(let p=0,r=A.length;p<r;p++){const e=A[p];e.resi!==y&&(y=e.resi,u||b++,u=!1),e.reschain=b;for(let i=p+1;i<A.length;i++){const s=A[i];if(s.chain!==e.chain||s.resi-e.resi>1)break;(0,M.areConnected)(e,s,_)&&(e.bonds.indexOf(s.index)===-1&&(e.bonds.push(s.index),e.bondOrder.push(1),s.bonds.push(e.index),s.bondOrder.push(1)),e.resi!==s.resi&&(u=!0))}}}},"./src/parsers/utils/atomNameToElem.ts":(K,C,d)=>{d.r(C),d.d(C,{atomNameToElem:()=>L});var M=d("./src/parsers/utils/bondLength.ts");function L(w,O){let g=w.replace(/ /g,"");return g.length>0&&g[0]==="H"&&g!=="Hg"&&g!=="He"&&g!=="Hf"&&g!=="Hs"&&g!=="Ho"&&(g="H"),g.length>1&&(g=g[0].toUpperCase()+g.substring(1).toLowerCase(),M.bondTable[g]===void 0?g=g[0]:O&&(g==="Ca"||g==="Cd")&&(g="C")),g}},"./src/parsers/utils/bondLength.ts":(K,C,d)=>{d.r(C),d.d(C,{bondLength:()=>L,bondTable:()=>M,setBondLength:()=>w});let M={H:.37,He:.32,Li:1.34,Be:.9,B:.82,C:.77,N:.75,O:.73,F:.71,Ne:.69,Na:1.54,Mg:1.3,Al:1.18,Si:1.11,P:1.06,S:1.02,Cl:.99,Ar:.97,K:1.96,Ca:1.74,Sc:1.44,Ti:1.56,V:1.25,Mn:1.39,Fe:1.25,Co:1.26,Ni:1.21,Cu:1.38,Zn:1.31,Ga:1.26,Ge:1.22,Se:1.16,Br:1.14,Kr:1.1,Rb:2.11,Sr:1.92,Y:1.62,Zr:1.48,Nb:1.37,Mo:1.45,Tc:1.56,Ru:1.26,Rh:1.35,Pd:1.31,Ag:1.53,Cd:1.48,In:1.44,Sn:1.41,Sb:1.38,Te:1.35,I:1.33,Xe:1.3,Cs:2.25,Ba:1.98,Lu:1.6,Hf:1.5,Ta:1.38,W:1.46,Re:1.59,Os:1.44,Ir:1.37,Pt:1.28,Au:1.44,Hg:1.49,Tl:1.48,Pb:1.47,Bi:1.46,Rn:1.45};function L(O){return M[O]||1.6}function w(O,g){g<0&&(g=0),M[O]=g}},"./src/parsers/utils/computeSecondaryStructure.ts":(K,C,d)=>{d.r(C),d.d(C,{computeSecondaryStructure:()=>L});var M=d("./src/parsers/utils/assignBackboneHBonds.ts");function L(w,O){(0,M.assignBackboneHBonds)(w,O);const g={};let _,A,c,y,b,u;for(_=0,A=w.length;_<A;_++)if(b=w[_],g[b.chain]===void 0&&(g[b.chain]=[]),isFinite(b.hbondDistanceSq)){const p=b.hbondOther;g[p.chain]===void 0&&(g[p.chain]=[]),Math.abs(p.resi-b.resi)===4&&(g[b.chain][b.resi]="h")}for(c in g)for(y=1;y<g[c].length-1;y++){const p=g[c][y-1],r=g[c][y+1];u=g[c][y],p=="h"&&p==r&&u!=p&&(g[c][y]=p)}for(_=0,A=w.length;_<A;_++)b=w[_],isFinite(b.hbondDistanceSq)&&g[b.chain][b.resi]!="h"&&b.ss!=="h"&&(g[b.chain][b.resi]="maybesheet");for(let p=0,r=w.length;p<r;p++)if(b=w[p],isFinite(b.hbondDistanceSq)&&g[b.chain][b.resi]=="maybesheet"){let e=b.hbondOther,i=g[e.chain][e.resi];(i=="maybesheet"||i=="s")&&(g[b.chain][b.resi]="s",g[e.chain][e.resi]="s")}for(let p in g){for(let r=1;r<g[p].length-1;r++){const e=g[p][r-1],i=g[p][r+1];u=g[p][r],e=="s"&&e==i&&u!=e&&(g[p][r]=e)}for(let r=0;r<g[p].length;r++){const e=g[p][r];(e=="h"||e=="s")&&g[p][r-1]!=e&&g[p][r+1]!=e&&delete g[p][r]}}for(_=0,A=w.length;_<A;_++)b=w[_],u=g[b.chain][b.resi],delete b.hbondOther,delete b.hbondDistanceSq,!(u===void 0||u==="maybesheet")&&(b.ss=u,g[b.chain][b.resi-1]!=u&&(b.ssbegin=!0),g[b.chain][b.resi+1]!=u&&(b.ssend=!0))}},"./src/parsers/utils/getSinglePDB.ts":(K,C,d)=>{d.r(C),d.d(C,{getSinglePDB:()=>y});var M=d("./src/WebGL/index.ts"),L=d("./src/parsers/utils/atomNameToElem.ts"),w=d("./src/parsers/utils/bondLength.ts"),O=d("./src/parsers/utils/computeSecondaryStructure.ts"),g=d("./src/parsers/utils/isEmpty.ts"),_=d("./src/parsers/utils/processSymmetries.ts"),A=d("./src/parsers/utils/assignPDBBonds.ts"),c=d("./src/parsers/utils/validateBonds.ts");function y(b,u,p){const r=[],e=u.assignBonds===void 0?!0:u.assignBonds,i=!u.keepH,s=!!u.noSecondaryStructure,a=!u.noComputeSecondaryStructure,h=!u.doAssembly,t=u.altLoc?u.altLoc:"A",n={symmetries:[],cryst:void 0};let f,o=[];const v=[];let m;const E={};for(let S=0;S<b.length;S++){m=b[S].replace(/^\s*/,"");const T=m.substring(0,6);let P,I,B;if(T.indexOf("END")===0){if(o=b.slice(S+1),T==="END")for(const R in p)p.hasOwnProperty(R)&&delete p[R];break}else if(T==="ATOM  "||T==="HETATM"){let R,z,U,W,F,N,q,J,oe,le,fe,ie;if(fe=m.substring(16,17),fe!==" "&&fe!==t&&t!=="*"||(le=parseInt(m.substring(6,11)),f=m.substring(12,16).replace(/ /g,""),R=m.substring(17,20).replace(/ /g,""),z=m.substring(21,22),U=parseInt(m.substring(22,26)),W=m.substring(26,27),F=parseFloat(m.substring(30,38)),N=parseFloat(m.substring(38,46)),q=parseFloat(m.substring(46,54)),ie=parseFloat(m.substring(60,68)),oe=m.substring(76,78).replace(/ /g,""),oe===""||w.bondTable[oe]===void 0?oe=(0,L.atomNameToElem)(m.substring(12,14),m[0]=="A"):oe=oe[0].toUpperCase()+oe.substring(1).toLowerCase(),oe==="H"&&i))continue;T[0]=="H"?J=!0:J=!1,v[le]=r.length,r.push({resn:R,x:F,y:N,z:q,elem:oe,hetflag:J,altLoc:fe,chain:z,resi:U,icode:W,rescode:U+(W!==" "?"^"+W:""),serial:le,atom:f,bonds:[],ss:"c",bondOrder:[],properties:{},b:ie,pdbline:m})}else if(T==="SHEET "){P=m.substring(21,22),I=parseInt(m.substring(22,26)),B=parseInt(m.substring(33,37)),P in p||(p[P]={}),p[P][I]="s1";for(let R=I+1;R<B;R++)p[P][R]="s";p[P][B]="s2"}else if(T==="CONECT"){const R=parseInt(m.substring(6,11)),z=v[R],U=r[z],W=[11,16,21,26];for(let F=0;F<4;F++){const N=parseInt(m.substring(W[F],W[F]+5)),q=v[N];let J=z+":"+q;const oe=r[q];if(U!==void 0&&oe!==void 0)if(!E[J])E[J]=1,(U.bonds.length==0||U.bonds[U.bonds.length-1]!==q)&&(U.bonds.push(q),U.bondOrder.push(1));else{E[J]+=1;for(let le=0;le<U.bonds.length;le++)if(U.bonds[le]==q){const fe=E[J];fe>=4?U.bondOrder[le]=1:U.bondOrder[le]=fe}}}}else if(T==="HELIX "){P=m.substring(19,20),I=parseInt(m.substring(21,25)),B=parseInt(m.substring(33,37)),P in p||(p[P]={}),p[P][I]="h1";for(let R=I+1;R<B;R++)p[P][R]="h";p[P][B]="h2"}else if(!h&&T==="REMARK"&&m.substring(13,18)==="BIOMT"){let R,z=new M.Matrix4;for(R=1;R<=3;R++)if(m=b[S].replace(/^\s*/,""),parseInt(m.substring(18,19))==R)z.elements[R-1]=parseFloat(m.substring(23,33)),z.elements[R-1+4]=parseFloat(m.substring(33,43)),z.elements[R-1+8]=parseFloat(m.substring(43,53)),z.elements[R-1+12]=parseFloat(m.substring(53)),S++;else for(;m.substring(13,18)==="BIOMT";)S++,m=b[S].replace(/^\s*/,"");z.elements[3]=0,z.elements[7]=0,z.elements[11]=0,z.elements[15]=1,n.symmetries.push(z),S--}else if(T==="CRYST1"){let R,z,U,W,F,N;R=parseFloat(m.substring(7,15)),z=parseFloat(m.substring(16,24)),U=parseFloat(m.substring(25,33)),W=parseFloat(m.substring(34,40)),F=parseFloat(m.substring(41,47)),N=parseFloat(m.substring(48,54)),n.cryst={a:R,b:z,c:U,alpha:W,beta:F,gamma:N}}else if(T==="ANISOU"){const R=parseInt(m.substring(6,11)),z=v[R],U=r[z];if(U){const W=m.substring(30).trim().split(/\s+/),F={u11:parseInt(W[0]),u22:parseInt(W[1]),u33:parseInt(W[2]),u12:parseInt(W[3]),u13:parseInt(W[4]),u23:parseInt(W[5])};U.uMat=F}}}if((0,c.validateBonds)(r,v),e&&(0,A.assignPDBBonds)(r,u),h||(0,_.processSymmetries)(n.symmetries,r,u,n.cryst),a&&!s&&(0,O.computeSecondaryStructure)(r,u.hbondCutoff),!(0,g.isEmpty)(p))for(let S=0;S<r.length;S++){const T=r[S];if(T!==void 0&&T.chain in p&&T.resi in p[T.chain]){const P=p[T.chain][T.resi];T.ss=P[0],P.length>1&&(P[1]=="1"?T.ssbegin=!0:P[1]=="2"&&(T.ssend=!0))}}return[r,n,o]}},"./src/parsers/utils/isEmpty.ts":(K,C,d)=>{d.r(C),d.d(C,{isEmpty:()=>M});function M(L){for(const w in L)return!1;return!0}},"./src/parsers/utils/processSymmetries.ts":(K,C,d)=>{d.r(C),d.d(C,{processSymmetries:()=>L});var M=d("./src/WebGL/index.ts");function L(w,O,g,_){const A=!g.duplicateAssemblyAtoms,c=O.length;let y=c,b=-1,u=null,p=null;(g.normalizeAssembly||g.wrapAtoms)&&_&&(u=(0,M.conversionMatrix3)(_.a,_.b,_.c,_.alpha,_.beta,_.gamma),p=new M.Matrix3,p.getInverse3(u));let r=function(s){let a=s.clone().applyMatrix3(p);const h=[a.x,a.y,a.z],t=[0,0,0];for(let f=0;f<3;f++){for(;h[f]<-.001;)h[f]+=1,t[f]+=1;for(;h[f]>1.001;)h[f]-=1,t[f]-=1}const n=new M.Vector3(t[0],t[1],t[2]);return n.applyMatrix3(u),n};if(g.normalizeAssembly&&_)for(let s=0;s<w.length;s++){const a=new M.Vector3(0,0,0);for(let t=0;t<c;t++){const n=new M.Vector3(O[t].x,O[t].y,O[t].z);n.applyMatrix4(w[s]),a.add(n)}a.divideScalar(c);const h=r(a);w[s].isNearlyIdentity()&&h.lengthSq()>.001&&(b=s),w[s].translate(h)}if(A){if(w.length>1)for(let s=0;s<O.length;s++){var e=[];for(let a=0;a<w.length;a++)if(!w[a].isNearlyIdentity()){var i=new M.Vector3;i.set(O[s].x,O[s].y,O[s].z),i.applyMatrix4(w[a]),e.push(i)}O[s].symmetries=e}}else{for(let s=0;s<c;s++)O[s].sym=-1;for(let s=0;s<w.length;s++)if(!w[s].isNearlyIdentity()&&b!=s){let a=new M.Vector3;for(let h=0;h<c;h++){const t=[];for(let f=0;f<O[h].bonds.length;f++)t.push(O[h].bonds[f]+y);if(a.set(O[h].x,O[h].y,O[h].z),a.applyMatrix4(w[s]),g.wrapAtoms&&_){let f=r(a);a.add(f)}const n={};for(const f in O[h])n[f]=O[h][f];n.x=a.x,n.y=a.y,n.z=a.z,n.bonds=t,n.sym=s,n.index=O.length,O.push(n)}y=O.length}else for(let a=0;a<c;a++)O[a].sym=s;if(g.wrapAtoms&&_){let s=new M.Vector3;for(let a=0;a<c;a++){s.set(O[a].x,O[a].y,O[a].z);let h=r(s);s.add(h),O[a].x=s.x,O[a].y=s.y,O[a].z=s.z}}if(b>=0){const s=new M.Vector3;for(let a=0;a<c;a++)s.set(O[a].x,O[a].y,O[a].z),s.applyMatrix4(w[b]),O[a].x=s.x,O[a].y=s.y,O[a].z=s.z}w.length=0}}},"./src/parsers/utils/standardResidues.ts":(K,C,d)=>{d.r(C),d.d(C,{standardResidues:()=>M});const M=new Set(["ABU","ACD","ALA","ALB","ALI","ARG","AR0","ASN","ASP","ASX","BAS","CYS","CYH","CYX","CSS","CSH","GLN","GLU","GLX","GLY","HIS","HIE","HID","HIP","HYP","ILE","ILU","LEU","LYS","MET","PCA","PGA","PHE","PR0","PRO","PRZ","SER","THR","TRP","TYR","VAL","A","1MA","C","5MC","OMC","G","1MG","2MG","M2G","7MG","OMG","YG","I","T","U","+U","H2U","5MU","PSU","ACE","F0R","H2O","HOH","WAT"])},"./src/parsers/utils/validateBonds.ts":(K,C,d)=>{d.r(C),d.d(C,{validateBonds:()=>M});function M(L,w){for(let O=0,g=L.length;O<g;O++){const _=L[O];for(let A=0;A<_.bonds.length;A++){const c=_.bonds[A],y=L[c],b=w[_.serial];y&&b&&y.bonds.indexOf(b)<0&&(y.bonds.push(b),y.bondOrder.push(_.bondOrder[A]))}}}},"./src/partialCharges.ts":(K,C,d)=>{d.r(C),d.d(C,{applyPartialCharges:()=>L,partialCharges:()=>M});const M={"ALA:N":-.15,"ALA:CA":.1,"ALA:CB":0,"ALA:C":.6,"ALA:O":-.55,"ARG:N":-.15,"ARG:CA":.1,"ARG:CB":0,"ARG:CG":0,"ARG:CD":.1,"ARG:NE":-.1,"ARG:CZ":.5,"ARG:NH1":.25,"ARG:NH2":.25,"ARG:C":.6,"ARG:O":-.55,"ASN:N":-.15,"ASN:CA":.1,"ASN:CB":0,"ASN:CG":.55,"ASN:OD1":-.55,"ASN:ND2":0,"ASN:C":.6,"ASN:O":-.55,"ASP:N":-.15,"ASP:CA":.1,"ASP:CB":0,"ASP:CG":.14,"ASP:OD1":-.57,"ASP:OD2":-.57,"ASP:C":.6,"ASP:O":-.55,"CYS:N":-.15,"CYS:CA":.1,"CYS:CB":.19,"CYS:SG":-.19,"CYS:C":.6,"CYS:O":-.55,"GLN:N":-.15,"GLN:CA":.1,"GLN:CB":0,"GLN:CG":0,"GLN:CD":.55,"GLN:OE1":-.55,"GLN:NE2":0,"GLN:C":.6,"GLN:O":-.55,"GLU:N":-.15,"GLU:CA":.1,"GLU:CB":0,"GLU:CG":0,"GLU:CD":.14,"GLU:OE1":-.57,"GLU:OE2":-.57,"GLU:C":.6,"GLU:O":-.55,"GLY:N":-.15,"GLY:CA":.1,"GLY:C":.6,"GLY:O":-.55,"HIS:N":-.15,"HIS:CA":.1,"HIS:CB":0,"HIS:CG":.1,"HIS:ND1":-.1,"HIS:CD2":.1,"HIS:NE2":-.4,"HIS:CE1":.3,"HIS:C":.6,"HIS:O":-.55,"ILE:N":-.15,"ILE:CA":.1,"ILE:CB":0,"ILE:CG2":0,"ILE:CG1":0,"ILE:CD":0,"ILE:C":.6,"ILE:O":-.55,"LEU:N":-.15,"LEU:CA":.1,"LEU:CB":0,"LEU:CG":0,"LEU:CD1":0,"LEU:CD2":0,"LEU:C":.6,"LEU:O":-.55,"LYS:N":-.15,"LYS:CA":.1,"LYS:CB":0,"LYS:CG":0,"LYS:CD":0,"LYS:CE":.25,"LYS:NZ":.75,"LYS:C":.6,"LYS:O":-.55,"MET:N":-.15,"MET:CA":.1,"MET:CB":0,"MET:CG":.06,"MET:SD":-.12,"MET:CE":.06,"MET:C":.6,"MET:O":-.55,"PHE:N":-.15,"PHE:CA":.1,"PHE:CB":0,"PHE:CG":0,"PHE:CD1":0,"PHE:CD2":0,"PHE:CE1":0,"PHE:CE2":0,"PHE:CZ":0,"PHE:C":.6,"PHE:O":-.55,"PRO:N":-.25,"PRO:CD":.1,"PRO:CA":.1,"PRO:CB":0,"PRO:CG":0,"PRO:C":.6,"PRO:O":-.55,"SER:N":-.15,"SER:CA":.1,"SER:CB":.25,"SER:OG":-.25,"SER:C":.6,"SER:O":-.55,"THR:N":-.15,"THR:CA":.1,"THR:CB":.25,"THR:OG1":-.25,"THR:CG2":0,"THR:C":.6,"THR:O":-.55,"TRP:N":-.15,"TRP:CA":.1,"TRP:CB":0,"TRP:CG":-.03,"TRP:CD2":.1,"TRP:CE2":-.04,"TRP:CE3":-.03,"TRP:CD1":.06,"TRP:NE1":-.06,"TRP:CZ2":0,"TRP:CZ3":0,"TRP:CH2":0,"TRP:C":.6,"TRP:O":-.55,"TYR:N":-.15,"TYR:CA":.1,"TYR:CB":0,"TYR:CG":0,"TYR:CD1":0,"TYR:CE1":0,"TYR:CD2":0,"TYR:CE2":0,"TYR:CZ":.25,"TYR:OH":-.25,"TYR:C":.6,"TYR:O":-.55,"VAL:N":-.15,"VAL:CA":.1,"VAL:CB":0,"VAL:CG1":0,"VAL:CG2":0,"VAL:C":.6,"VAL:O":-.55};function L(w,O){if((!O||typeof w.partialCharge>"u")&&w.resn&&w.atom){var g=w.resn+":"+w.atom;w.properties.partialCharge=M[g]}}},"./src/specs.ts":(K,C,d)=>{d.r(C)},"./src/utilities.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{PausableTimer:()=>PausableTimer,adjustVolumeStyle:()=>adjustVolumeStyle,base64ToArray:()=>base64ToArray,deepCopy:()=>deepCopy,download:()=>download,extend:()=>extend,get:()=>get,getAtomProperty:()=>getAtomProperty,getColorFromStyle:()=>getColorFromStyle,getElement:()=>getElement,getExtent:()=>getExtent,getPropertyRange:()=>getPropertyRange,getbin:()=>getbin,inflateString:()=>inflateString,isEmptyObject:()=>isEmptyObject,isNumeric:()=>isNumeric,makeFunction:()=>makeFunction,mergeGeos:()=>mergeGeos,specStringToObject:()=>specStringToObject});var _Gradient__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./src/Gradient.ts"),_VolumeData__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./src/VolumeData.ts"),_colors__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./src/colors.ts"),pako__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/pako/dist/pako.esm.mjs");function extend(K,C){for(var d in C)C.hasOwnProperty(d)&&C[d]!==void 0&&(K[d]=C[d]);return K}function deepCopy(K){let C,d,M;if(K==null)return{};if(typeof K!="object"||K===null)return K;C=Array.isArray(K)?[]:{};for(M in K)d=K[M],C[M]=deepCopy(d);return C}function isNumeric(K){var C=typeof K;return(C==="number"||C==="string")&&!isNaN(K-parseFloat(K))}function isEmptyObject(K){var C;for(C in K)return!1;return!0}function makeFunction(callback){return callback&&typeof callback=="string"&&(callback=eval("("+callback+")")),callback&&typeof callback!="function"?(console.warn("Invalid callback provided."),()=>{}):callback}function adjustVolumeStyle(K){K&&(K.volformat&&!(K.voldata instanceof _VolumeData__WEBPACK_IMPORTED_MODULE_1__.VolumeData)&&(K.voldata=new _VolumeData__WEBPACK_IMPORTED_MODULE_1__.VolumeData(K.voldata,K.volformat)),K.volscheme&&(K.volscheme=_Gradient__WEBPACK_IMPORTED_MODULE_0__.Gradient.getGradient(K.volscheme)))}function getExtent(K,C){var d,M,L,w,O,g,_,A,c,y,b=!C;if(d=M=L=9999,w=O=g=-9999,_=A=c=y=0,K.length===0)return[[0,0,0],[0,0,0],[0,0,0]];for(var u=0;u<K.length;u++){var p=K[u];if(!(typeof p>"u"||!isFinite(p.x)||!isFinite(p.y)||!isFinite(p.z))&&(y++,_+=p.x,A+=p.y,c+=p.z,d=d<p.x?d:p.x,M=M<p.y?M:p.y,L=L<p.z?L:p.z,w=w>p.x?w:p.x,O=O>p.y?O:p.y,g=g>p.z?g:p.z,p.symmetries&&b))for(var r=0;r<p.symmetries.length;r++)y++,_+=p.symmetries[r].x,A+=p.symmetries[r].y,c+=p.symmetries[r].z,d=d<p.symmetries[r].x?d:p.symmetries[r].x,M=M<p.symmetries[r].y?M:p.symmetries[r].y,L=L<p.symmetries[r].z?L:p.symmetries[r].z,w=w>p.symmetries[r].x?w:p.symmetries[r].x,O=O>p.symmetries[r].y?O:p.symmetries[r].y,g=g>p.symmetries[r].z?g:p.symmetries[r].z}return[[d,M,L],[w,O,g],[_/y,A/y,c/y]]}function getPropertyRange(K,C){for(var d=Number.POSITIVE_INFINITY,M=Number.NEGATIVE_INFINITY,L=0,w=K.length;L<w;L++){var O=K[L],g=getAtomProperty(O,C);g!=null&&(g<d&&(d=g),g>M&&(M=g))}return!isFinite(d)&&!isFinite(M)?d=M=0:isFinite(d)?isFinite(M)||(M=d):d=M,[d,M]}class PausableTimer{constructor(C,d,M){this.total_time_run=0,this.fn=C,this.arg=M,this.countdown=d,this.start_time=new Date().getTime(),this.ident=setTimeout(C,d,M)}cancel(){clearTimeout(this.ident)}pause(){clearTimeout(this.ident),this.total_time_run=new Date().getTime()-this.start_time}resume(){this.ident=setTimeout(this.fn,Math.max(0,this.countdown-this.total_time_run),this.arg)}}function base64ToArray(K){for(var C=window.atob(K),d=C.length,M=new Uint8Array(d),L=0;L<d;L++)M[L]=C.charCodeAt(L);return M}function getAtomProperty(K,C){var d=null;return K.properties&&typeof K.properties[C]<"u"?d=K.properties[C]:typeof K[C]<"u"&&(d=K[C]),d}function mergeGeos(K,C){var d=C.geometry;d!==void 0&&K.geometryGroups.push(d.geometryGroups[0])}function specStringToObject(K){if(typeof K=="object")return K;if(typeof K>"u"||K==null)return K;try{return JSON.parse(K)}catch{}K=K.replace(/%7E/g,"~");var C=function(b){return isNumeric(b)?Math.floor(parseFloat(b))==parseInt(b)||b.indexOf(".")>=0?parseFloat(b):parseInt(b):b==="true"?!0:b==="false"?!1:b},d={};if(K==="all")return d;for(var M=K.split(";"),L=0;L<M.length;L++){var w=M[L].split(":"),O=w[0],g={},_=w[1];if(_)if(_=_.replace(/~/g,"="),_.indexOf("=")!==-1)for(var A=_.split(","),c=0;c<A.length;c++){var y=A[c].split("=",2);g[y[0]]=C(y[1])}else _.indexOf(",")!==-1?g=_.split(","):g=C(_);d[O]=g}return d}function checkStatus(K){if(!K.ok)throw new Error(`HTTP ${K.status} - ${K.statusText}`);return K}function get(K,C){var d=fetch(K).then(checkStatus).then(M=>M.text());return C?d.then(C):d}function getbin(K,C,d,M){var L;return d=="POST"?L=fetch(K,{method:"POST",body:M}).then(w=>checkStatus(w)).then(w=>w.arrayBuffer()):L=fetch(K).then(w=>checkStatus(w)).then(w=>w.arrayBuffer()),C?L.then(C):L}function download(K,C,d,M){var L="",w="",O="",g=null,_=C.addModel();if(K.indexOf(":")<0&&(K.length==4?K="pdb:"+K:isNaN(K)?K="url:"+K:K="cid:"+K),K.substring(0,5)=="mmtf:"&&(console.warn("WARNING: MMTF now deprecated.  Reverting to bcif."),K="bcif:"+K.slice(5)),K.substring(0,5)==="bcif:")K=K.substring(5).toUpperCase(),O="https://models.rcsb.org/"+K+".bcif.gz",d&&typeof d.noComputeSecondaryStructure>"u"&&(d.noComputeSecondaryStructure=!0),g=new Promise(function(c){getbin(O).then(function(y){_.addMolData(y,"bcif.gz",d),C.zoomTo(),C.render(),c(_)},function(){console.error("fetch of "+O+" failed.")})});else{if(K.substring(0,4)==="pdb:"){if(L="bcif",d&&d.format&&(L=d.format),d&&typeof d.noComputeSecondaryStructure>"u"&&(d.noComputeSecondaryStructure=!0),K=K.substring(4).toUpperCase(),!K.match(/^[1-9][A-Za-z0-9]{3}$/)){alert("Wrong PDB ID");return}L=="bcif"?O="https://models.rcsb.org/"+K.toUpperCase()+".bcif.gz":(w=d&&d.pdbUri?d.pdbUri:"https://files.rcsb.org/view/",O=w+K+"."+L)}else if(K.substring(0,4)=="cid:"){if(L="sdf",K=K.substring(4),!K.match(/^[0-9]+$/)){alert("Wrong Compound ID");return}O="https://pubchem.ncbi.nlm.nih.gov/rest/pug/compound/cid/"+K+"/SDF?record_type=3d"}else K.substring(0,4)=="url:"&&(O=K.substring(4),L=O);var A=function(c){_.addMolData(c,L,d),C.zoomTo(),C.render()};g=new Promise(function(c){L=="bcif"?getbin(O).then(function(y){A(y),c(_)}).catch(function(){w=d&&d.pdbUri?d.pdbUri:"https://files.rcsb.org/view/",O=w+K+".pdb",L="pdb",console.warn("falling back to pdb format"),get(O).then(function(y){A(y),c(_)}).catch(function(y){A(""),c(_),console.error("fetch of "+O+" failed: "+y.statusText)})}):get(O).then(function(y){A(y),c(_)}).catch(function(y){A(""),c(_),console.error("fetch of "+O+" failed: "+y.statusText)})})}return M?(g.then(function(c){M(c)}),_):g}function getColorFromStyle(K,C){let d=C.colorscheme;if(typeof _colors__WEBPACK_IMPORTED_MODULE_2__.builtinColorSchemes[d]<"u")d=_colors__WEBPACK_IMPORTED_MODULE_2__.builtinColorSchemes[d];else if(typeof d=="string"&&d.endsWith("Carbon")){let O=d.substring(0,d.lastIndexOf("Carbon")).toLowerCase();if(typeof _colors__WEBPACK_IMPORTED_MODULE_2__.htmlColors[O]<"u"){let g=Object.assign({},_colors__WEBPACK_IMPORTED_MODULE_2__.elementColors.defaultColors);g.C=_colors__WEBPACK_IMPORTED_MODULE_2__.htmlColors[O],_colors__WEBPACK_IMPORTED_MODULE_2__.builtinColorSchemes[d]={prop:"elem",map:g},d=_colors__WEBPACK_IMPORTED_MODULE_2__.builtinColorSchemes[d]}}let M=K.color;if(typeof C.color<"u"&&C.color!="spectrum"&&(M=C.color),typeof d<"u"){let O,g;if(typeof _colors__WEBPACK_IMPORTED_MODULE_2__.elementColors[d]<"u")d=_colors__WEBPACK_IMPORTED_MODULE_2__.elementColors[d],typeof d[K[d.prop]]<"u"&&(M=d.map[K[d.prop]]);else if(typeof d[K[d.prop]]<"u")M=d.map[K[d.prop]];else if(typeof d.prop<"u"&&typeof d.gradient<"u"){O=d.prop;var L=d.gradient;L instanceof _Gradient__WEBPACK_IMPORTED_MODULE_0__.GradientType||(L=(0,_Gradient__WEBPACK_IMPORTED_MODULE_0__.getGradient)(d));let _=L.range()||[-1,1];g=getAtomProperty(K,O),g!=null&&(M=L.valueToHex(g,_))}else typeof d.prop<"u"&&typeof d.map<"u"?(O=d.prop,g=getAtomProperty(K,O),typeof d.map[g]<"u"&&(M=d.map[g])):typeof C.colorscheme[K.elem]<"u"?M=C.colorscheme[K.elem]:console.warn("Could not interpret colorscheme "+d)}else typeof C.colorfunc<"u"&&(M=C.colorfunc(K));return _colors__WEBPACK_IMPORTED_MODULE_2__.CC.color(M)}function getElement(K){let C=K;return typeof K=="string"?C=document.querySelector("#"+K):typeof K=="object"&&K.get&&(C=K.get(0)),C}function inflateString(K,C=!0){let d;return typeof K=="string"?d=new TextEncoder().encode(K):d=new Uint8Array(K),(0,pako__WEBPACK_IMPORTED_MODULE_3__.inflate)(d,{to:C?"string":null})}},"./node_modules/upng-js/UPNG.js":(K,C,d)=>{(function(){var M={},L;K.exports=M,L=d("./node_modules/upng-js/node_modules/pako/index.js"),function(w,O){w.toRGBA8=function(g){var _=g.width,A=g.height;if(g.tabs.acTL==null)return[w.toRGBA8.decodeImage(g.data,_,A,g).buffer];var c=[];g.frames[0].data==null&&(g.frames[0].data=g.data);for(var y,b=new Uint8Array(_*A*4),u=0;u<g.frames.length;u++){var p=g.frames[u],r=p.rect.x,e=p.rect.y,i=p.rect.width,s=p.rect.height,a=w.toRGBA8.decodeImage(p.data,i,s,g);if(u==0?y=a:p.blend==0?w._copyTile(a,i,s,y,_,A,r,e,0):p.blend==1&&w._copyTile(a,i,s,y,_,A,r,e,1),c.push(y.buffer),y=y.slice(0),p.dispose!=0){if(p.dispose==1)w._copyTile(b,i,s,y,_,A,r,e,0);else if(p.dispose==2){for(var h=u-1;g.frames[h].dispose==2;)h--;y=new Uint8Array(c[h]).slice(0)}}}return c},w.toRGBA8.decodeImage=function(g,_,A,c){var y=_*A,b=w.decode._getBPP(c),u=Math.ceil(_*b/8),p=new Uint8Array(y*4),r=new Uint32Array(p.buffer),e=c.ctype,i=c.depth,s=w._bin.readUshort;if(e==6){var a=y<<2;if(i==8)for(var h=0;h<a;h++)p[h]=g[h];if(i==16)for(var h=0;h<a;h++)p[h]=g[h<<1]}else if(e==2){var t=c.tabs.tRNS,n=-1,f=-1,o=-1;if(t&&(n=t[0],f=t[1],o=t[2]),i==8)for(var h=0;h<y;h++){var v=h<<2,m=h*3;p[v]=g[m],p[v+1]=g[m+1],p[v+2]=g[m+2],p[v+3]=255,n!=-1&&g[m]==n&&g[m+1]==f&&g[m+2]==o&&(p[v+3]=0)}if(i==16)for(var h=0;h<y;h++){var v=h<<2,m=h*6;p[v]=g[m],p[v+1]=g[m+2],p[v+2]=g[m+4],p[v+3]=255,n!=-1&&s(g,m)==n&&s(g,m+2)==f&&s(g,m+4)==o&&(p[v+3]=0)}}else if(e==3){var E=c.tabs.PLTE,S=c.tabs.tRNS,T=S?S.length:0;if(i==1)for(var P=0;P<A;P++)for(var I=P*u,B=P*_,h=0;h<_;h++){var v=B+h<<2,R=g[I+(h>>3)]>>7-((h&7)<<0)&1,z=3*R;p[v]=E[z],p[v+1]=E[z+1],p[v+2]=E[z+2],p[v+3]=R<T?S[R]:255}if(i==2)for(var P=0;P<A;P++)for(var I=P*u,B=P*_,h=0;h<_;h++){var v=B+h<<2,R=g[I+(h>>2)]>>6-((h&3)<<1)&3,z=3*R;p[v]=E[z],p[v+1]=E[z+1],p[v+2]=E[z+2],p[v+3]=R<T?S[R]:255}if(i==4)for(var P=0;P<A;P++)for(var I=P*u,B=P*_,h=0;h<_;h++){var v=B+h<<2,R=g[I+(h>>1)]>>4-((h&1)<<2)&15,z=3*R;p[v]=E[z],p[v+1]=E[z+1],p[v+2]=E[z+2],p[v+3]=R<T?S[R]:255}if(i==8)for(var h=0;h<y;h++){var v=h<<2,R=g[h],z=3*R;p[v]=E[z],p[v+1]=E[z+1],p[v+2]=E[z+2],p[v+3]=R<T?S[R]:255}}else if(e==4){if(i==8)for(var h=0;h<y;h++){var v=h<<2,U=h<<1,W=g[U];p[v]=W,p[v+1]=W,p[v+2]=W,p[v+3]=g[U+1]}if(i==16)for(var h=0;h<y;h++){var v=h<<2,U=h<<2,W=g[U];p[v]=W,p[v+1]=W,p[v+2]=W,p[v+3]=g[U+2]}}else if(e==0){var n=c.tabs.tRNS?c.tabs.tRNS:-1;if(i==1)for(var h=0;h<y;h++){var W=255*(g[h>>3]>>7-(h&7)&1),F=W==n*255?0:255;r[h]=F<<24|W<<16|W<<8|W}if(i==2)for(var h=0;h<y;h++){var W=85*(g[h>>2]>>6-((h&3)<<1)&3),F=W==n*85?0:255;r[h]=F<<24|W<<16|W<<8|W}if(i==4)for(var h=0;h<y;h++){var W=17*(g[h>>1]>>4-((h&1)<<2)&15),F=W==n*17?0:255;r[h]=F<<24|W<<16|W<<8|W}if(i==8)for(var h=0;h<y;h++){var W=g[h],F=W==n?0:255;r[h]=F<<24|W<<16|W<<8|W}if(i==16)for(var h=0;h<y;h++){var W=g[h<<1],F=s(g,h<<1)==n?0:255;r[h]=F<<24|W<<16|W<<8|W}}return p},w.decode=function(g){for(var _=new Uint8Array(g),A=8,c=w._bin,y=c.readUshort,b=c.readUint,u={tabs:{},frames:[]},p=new Uint8Array(_.length),r=0,e,i=0,s=[137,80,78,71,13,10,26,10],a=0;a<8;a++)if(_[a]!=s[a])throw"The input is not a PNG file!";for(;A<_.length;){var h=c.readUint(_,A);A+=4;var t=c.readASCII(_,A,4);if(A+=4,t=="IHDR")w.decode._IHDR(_,A,u);else if(t=="IDAT"){for(var a=0;a<h;a++)p[r+a]=_[A+a];r+=h}else if(t=="acTL")u.tabs[t]={num_frames:b(_,A),num_plays:b(_,A+4)},e=new Uint8Array(_.length);else if(t=="fcTL"){if(i!=0){var n=u.frames[u.frames.length-1];n.data=w.decode._decompress(u,e.slice(0,i),n.rect.width,n.rect.height),i=0}var f={x:b(_,A+12),y:b(_,A+16),width:b(_,A+4),height:b(_,A+8)},o=y(_,A+22);o=y(_,A+20)/(o==0?100:o);var v={rect:f,delay:Math.round(o*1e3),dispose:_[A+24],blend:_[A+25]};u.frames.push(v)}else if(t=="fdAT"){for(var a=0;a<h-4;a++)e[i+a]=_[A+a+4];i+=h-4}else if(t=="pHYs")u.tabs[t]=[c.readUint(_,A),c.readUint(_,A+4),_[A+8]];else if(t=="cHRM"){u.tabs[t]=[];for(var a=0;a<8;a++)u.tabs[t].push(c.readUint(_,A+a*4))}else if(t=="tEXt"){u.tabs[t]==null&&(u.tabs[t]={});var m=c.nextZero(_,A),E=c.readASCII(_,A,m-A),S=c.readASCII(_,m+1,A+h-m-1);u.tabs[t][E]=S}else if(t=="iTXt"){u.tabs[t]==null&&(u.tabs[t]={});var m=0,T=A;m=c.nextZero(_,T);var E=c.readASCII(_,T,m-T);T=m+1,_[T],_[T+1],T+=2,m=c.nextZero(_,T),c.readASCII(_,T,m-T),T=m+1,m=c.nextZero(_,T),c.readUTF8(_,T,m-T),T=m+1;var S=c.readUTF8(_,T,h-(T-A));u.tabs[t][E]=S}else if(t=="PLTE")u.tabs[t]=c.readBytes(_,A,h);else if(t=="hIST"){var P=u.tabs.PLTE.length/3;u.tabs[t]=[];for(var a=0;a<P;a++)u.tabs[t].push(y(_,A+a*2))}else if(t=="tRNS")u.ctype==3?u.tabs[t]=c.readBytes(_,A,h):u.ctype==0?u.tabs[t]=y(_,A):u.ctype==2&&(u.tabs[t]=[y(_,A),y(_,A+2),y(_,A+4)]);else if(t=="gAMA")u.tabs[t]=c.readUint(_,A)/1e5;else if(t=="sRGB")u.tabs[t]=_[A];else if(t=="bKGD")u.ctype==0||u.ctype==4?u.tabs[t]=[y(_,A)]:u.ctype==2||u.ctype==6?u.tabs[t]=[y(_,A),y(_,A+2),y(_,A+4)]:u.ctype==3&&(u.tabs[t]=_[A]);else if(t=="IEND"){if(i!=0){var n=u.frames[u.frames.length-1];n.data=w.decode._decompress(u,e.slice(0,i),n.rect.width,n.rect.height),i=0}u.data=w.decode._decompress(u,p,u.width,u.height);break}A+=h,c.readUint(_,A),A+=4}return delete u.compress,delete u.interlace,delete u.filter,u},w.decode._decompress=function(g,_,A,c){return g.compress==0&&(_=w.decode._inflate(_)),g.interlace==0?_=w.decode._filterZero(_,g,0,A,c):g.interlace==1&&(_=w.decode._readInterlace(_,g)),_},w.decode._inflate=function(g){return O.inflate(g)},w.decode._readInterlace=function(g,_){for(var A=_.width,c=_.height,y=w.decode._getBPP(_),b=y>>3,u=Math.ceil(A*y/8),p=new Uint8Array(c*u),r=0,e=[0,0,4,0,2,0,1],i=[0,4,0,2,0,1,0],s=[8,8,8,4,4,2,2],a=[8,8,4,4,2,2,1],h=0;h<7;){for(var t=s[h],n=a[h],f=0,o=0,v=e[h];v<c;)v+=t,o++;for(var m=i[h];m<A;)m+=n,f++;var E=Math.ceil(f*y/8);w.decode._filterZero(g,_,r,f,o);for(var S=0,T=e[h];T<c;){for(var P=i[h],I=r+S*E<<3;P<A;){if(y==1){var B=g[I>>3];B=B>>7-(I&7)&1,p[T*u+(P>>3)]|=B<<7-((P&3)<<0)}if(y==2){var B=g[I>>3];B=B>>6-(I&7)&3,p[T*u+(P>>2)]|=B<<6-((P&3)<<1)}if(y==4){var B=g[I>>3];B=B>>4-(I&7)&15,p[T*u+(P>>1)]|=B<<4-((P&1)<<2)}if(y>=8)for(var R=T*u+P*b,z=0;z<b;z++)p[R+z]=g[(I>>3)+z];I+=y,P+=n}S++,T+=t}f*o!=0&&(r+=o*(1+E)),h=h+1}return p},w.decode._getBPP=function(g){var _=[1,null,3,1,2,null,4][g.ctype];return _*g.depth},w.decode._filterZero=function(g,_,A,c,y){var b=w.decode._getBPP(_),u=Math.ceil(c*b/8),p=w.decode._paeth;b=Math.ceil(b/8);for(var r=0;r<y;r++){var e=A+r*u,i=e+r+1,s=g[i-1];if(s==0)for(var a=0;a<u;a++)g[e+a]=g[i+a];else if(s==1){for(var a=0;a<b;a++)g[e+a]=g[i+a];for(var a=b;a<u;a++)g[e+a]=g[i+a]+g[e+a-b]&255}else if(r==0){for(var a=0;a<b;a++)g[e+a]=g[i+a];if(s==2)for(var a=b;a<u;a++)g[e+a]=g[i+a]&255;if(s==3)for(var a=b;a<u;a++)g[e+a]=g[i+a]+(g[e+a-b]>>1)&255;if(s==4)for(var a=b;a<u;a++)g[e+a]=g[i+a]+p(g[e+a-b],0,0)&255}else{if(s==2)for(var a=0;a<u;a++)g[e+a]=g[i+a]+g[e+a-u]&255;if(s==3){for(var a=0;a<b;a++)g[e+a]=g[i+a]+(g[e+a-u]>>1)&255;for(var a=b;a<u;a++)g[e+a]=g[i+a]+(g[e+a-u]+g[e+a-b]>>1)&255}if(s==4){for(var a=0;a<b;a++)g[e+a]=g[i+a]+p(0,g[e+a-u],0)&255;for(var a=b;a<u;a++)g[e+a]=g[i+a]+p(g[e+a-b],g[e+a-u],g[e+a-b-u])&255}}}return g},w.decode._paeth=function(g,_,A){var c=g+_-A,y=Math.abs(c-g),b=Math.abs(c-_),u=Math.abs(c-A);return y<=b&&y<=u?g:b<=u?_:A},w.decode._IHDR=function(g,_,A){var c=w._bin;A.width=c.readUint(g,_),_+=4,A.height=c.readUint(g,_),_+=4,A.depth=g[_],_++,A.ctype=g[_],_++,A.compress=g[_],_++,A.filter=g[_],_++,A.interlace=g[_],_++},w._bin={nextZero:function(g,_){for(;g[_]!=0;)_++;return _},readUshort:function(g,_){return g[_]<<8|g[_+1]},writeUshort:function(g,_,A){g[_]=A>>8&255,g[_+1]=A&255},readUint:function(g,_){return g[_]*16777216+(g[_+1]<<16|g[_+2]<<8|g[_+3])},writeUint:function(g,_,A){g[_]=A>>24&255,g[_+1]=A>>16&255,g[_+2]=A>>8&255,g[_+3]=A&255},readASCII:function(g,_,A){for(var c="",y=0;y<A;y++)c+=String.fromCharCode(g[_+y]);return c},writeASCII:function(g,_,A){for(var c=0;c<A.length;c++)g[_+c]=A.charCodeAt(c)},readBytes:function(g,_,A){for(var c=[],y=0;y<A;y++)c.push(g[_+y]);return c},pad:function(g){return g.length<2?"0"+g:g},readUTF8:function(g,_,A){for(var c="",y,b=0;b<A;b++)c+="%"+w._bin.pad(g[_+b].toString(16));try{y=decodeURIComponent(c)}catch{return w._bin.readASCII(g,_,A)}return y}},w._copyTile=function(g,_,A,c,y,b,u,p,r){for(var e=Math.min(_,y),i=Math.min(A,b),s=0,a=0,h=0;h<i;h++)for(var t=0;t<e;t++)if(u>=0&&p>=0?(s=h*_+t<<2,a=(p+h)*y+u+t<<2):(s=(-p+h)*_-u+t<<2,a=h*y+t<<2),r==0)c[a]=g[s],c[a+1]=g[s+1],c[a+2]=g[s+2],c[a+3]=g[s+3];else if(r==1){var n=g[s+3]*.00392156862745098,f=g[s]*n,o=g[s+1]*n,v=g[s+2]*n,m=c[a+3]*(1/255),E=c[a]*m,S=c[a+1]*m,T=c[a+2]*m,P=1-n,I=n+m*P,B=I==0?0:1/I;c[a+3]=255*I,c[a+0]=(f+E*P)*B,c[a+1]=(o+S*P)*B,c[a+2]=(v+T*P)*B}else if(r==2){var n=g[s+3],f=g[s],o=g[s+1],v=g[s+2],m=c[a+3],E=c[a],S=c[a+1],T=c[a+2];n==m&&f==E&&o==S&&v==T?(c[a]=0,c[a+1]=0,c[a+2]=0,c[a+3]=0):(c[a]=f,c[a+1]=o,c[a+2]=v,c[a+3]=n)}else if(r==3){var n=g[s+3],f=g[s],o=g[s+1],v=g[s+2],m=c[a+3],E=c[a],S=c[a+1],T=c[a+2];if(n==m&&f==E&&o==S&&v==T)continue;if(n<220&&m>20)return!1}return!0},w.encode=function(g,_,A,c,y,b){c==null&&(c=0),b==null&&(b=!1);for(var u=new Uint8Array(g[0].byteLength*g.length+100),p=[137,80,78,71,13,10,26,10],r=0;r<8;r++)u[r]=p[r];var e=8,i=w._bin,s=w.crc.crc,a=i.writeUint,h=i.writeUshort,t=i.writeASCII,n=w.encode.compressPNG(g,_,A,c,b);a(u,e,13),e+=4,t(u,e,"IHDR"),e+=4,a(u,e,_),e+=4,a(u,e,A),e+=4,u[e]=n.depth,e++,u[e]=n.ctype,e++,u[e]=0,e++,u[e]=0,e++,u[e]=0,e++,a(u,e,s(u,e-17,17)),e+=4,a(u,e,1),e+=4,t(u,e,"sRGB"),e+=4,u[e]=1,e++,a(u,e,s(u,e-5,5)),e+=4;var f=g.length>1;if(f&&(a(u,e,8),e+=4,t(u,e,"acTL"),e+=4,a(u,e,g.length),e+=4,a(u,e,0),e+=4,a(u,e,s(u,e-12,12)),e+=4),n.ctype==3){var o=n.plte.length;a(u,e,o*3),e+=4,t(u,e,"PLTE"),e+=4;for(var r=0;r<o;r++){var v=r*3,m=n.plte[r],E=m&255,S=m>>8&255,T=m>>16&255;u[e+v+0]=E,u[e+v+1]=S,u[e+v+2]=T}if(e+=o*3,a(u,e,s(u,e-o*3-4,o*3+4)),e+=4,n.gotAlpha){a(u,e,o),e+=4,t(u,e,"tRNS"),e+=4;for(var r=0;r<o;r++)u[e+r]=n.plte[r]>>24&255;e+=o,a(u,e,s(u,e-o-4,o+4)),e+=4}}for(var P=0,I=0;I<n.frames.length;I++){var B=n.frames[I];f&&(a(u,e,26),e+=4,t(u,e,"fcTL"),e+=4,a(u,e,P++),e+=4,a(u,e,B.rect.width),e+=4,a(u,e,B.rect.height),e+=4,a(u,e,B.rect.x),e+=4,a(u,e,B.rect.y),e+=4,h(u,e,y[I]),e+=2,h(u,e,1e3),e+=2,u[e]=B.dispose,e++,u[e]=B.blend,e++,a(u,e,s(u,e-30,30)),e+=4);var R=B.cimg,o=R.length;a(u,e,o+(I==0?0:4)),e+=4;var z=e;t(u,e,I==0?"IDAT":"fdAT"),e+=4,I!=0&&(a(u,e,P++),e+=4);for(var r=0;r<o;r++)u[e+r]=R[r];e+=o,a(u,e,s(u,z,e-z)),e+=4}return a(u,e,0),e+=4,t(u,e,"IEND"),e+=4,a(u,e,s(u,e-4,4)),e+=4,u.buffer.slice(0,e)},w.encode.compressPNG=function(g,_,A,c,y){for(var b=w.encode.compress(g,_,A,c,!1,y),u=0;u<g.length;u++){var p=b.frames[u];p.rect.width;var r=p.rect.height,e=p.bpl,i=p.bpp,s=new Uint8Array(r*e+r);p.cimg=w.encode._filterZero(p.img,r,i,e,s)}return b},w.encode.compress=function(g,_,A,c,y,b){b==null&&(b=!1);for(var u=6,p=8,r=4,e=255,i=0;i<g.length;i++)for(var s=new Uint8Array(g[i]),a=s.length,h=0;h<a;h+=4)e&=s[h+3];var t=e!=255,n={},f=[];if(g.length!=0&&(n[0]=0,f.push(0),c!=0&&c--),c!=0){var o=w.quantize(g,c,y);g=o.bufs;for(var h=0;h<o.plte.length;h++){var v=o.plte[h].est.rgba;n[v]==null&&(n[v]=f.length,f.push(v))}}else for(var i=0;i<g.length;i++)for(var m=new Uint32Array(g[i]),a=m.length,h=0;h<a;h++){var v=m[h];if((h<_||v!=m[h-1]&&v!=m[h-_])&&n[v]==null&&(n[v]=f.length,f.push(v),f.length>=300))break}var E=t?y:!1,S=f.length;S<=256&&b==!1&&(S<=2?p=1:S<=4?p=2:S<=16?p=4:p=8,y&&(p=8),t=!0);for(var T=[],i=0;i<g.length;i++){var P=new Uint8Array(g[i]),I=new Uint32Array(P.buffer),B=0,R=0,z=_,U=A,W=0;if(i!=0&&!E){for(var F=y||i==1||T[T.length-2].dispose==2?1:2,N=0,q=1e9,J=0;J<F;J++){for(var de=new Uint8Array(g[i-1-J]),oe=new Uint32Array(g[i-1-J]),le=_,fe=A,ie=-1,ne=-1,we=0;we<A;we++)for(var Ee=0;Ee<_;Ee++){var h=we*_+Ee;I[h]!=oe[h]&&(Ee<le&&(le=Ee),Ee>ie&&(ie=Ee),we<fe&&(fe=we),we>ne&&(ne=we))}var Se=ie==-1?1:(ie-le+1)*(ne-fe+1);Se<q&&(q=Se,N=J,ie==-1?(B=R=0,z=U=1):(B=le,R=fe,z=ie-le+1,U=ne-fe+1))}var de=new Uint8Array(g[i-1-N]);N==1&&(T[T.length-1].dispose=2);var ee=new Uint8Array(z*U*4);new Uint32Array(ee.buffer),w._copyTile(de,_,A,ee,z,U,-B,-R,0),w._copyTile(P,_,A,ee,z,U,-B,-R,3)?(w._copyTile(P,_,A,ee,z,U,-B,-R,2),W=1):(w._copyTile(P,_,A,ee,z,U,-B,-R,0),W=0),P=ee,I=new Uint32Array(P.buffer)}var me=4*z;if(S<=256&&b==!1){me=Math.ceil(p*z/8);for(var ee=new Uint8Array(me*U),we=0;we<U;we++){var h=we*me,De=we*z;if(p==8)for(var Ee=0;Ee<z;Ee++)ee[h+Ee]=n[I[De+Ee]];else if(p==4)for(var Ee=0;Ee<z;Ee++)ee[h+(Ee>>1)]|=n[I[De+Ee]]<<4-(Ee&1)*4;else if(p==2)for(var Ee=0;Ee<z;Ee++)ee[h+(Ee>>2)]|=n[I[De+Ee]]<<6-(Ee&3)*2;else if(p==1)for(var Ee=0;Ee<z;Ee++)ee[h+(Ee>>3)]|=n[I[De+Ee]]<<7-(Ee&7)*1}P=ee,u=3,r=1}else if(t==!1&&g.length==1){for(var ee=new Uint8Array(z*U*3),Ie=z*U,h=0;h<Ie;h++){var Fe=h*3,Ue=h*4;ee[Fe]=P[Ue],ee[Fe+1]=P[Ue+1],ee[Fe+2]=P[Ue+2]}P=ee,u=2,r=3,me=3*z}T.push({rect:{x:B,y:R,width:z,height:U},img:P,bpl:me,bpp:r,blend:W,dispose:E?1:0})}return{ctype:u,depth:p,plte:f,gotAlpha:t,frames:T}},w.encode._filterZero=function(g,_,A,c,y){for(var b=[],u=0;u<5;u++)if(!(_*c>5e5&&(u==2||u==3||u==4))){for(var p=0;p<_;p++)w.encode._filterLine(y,g,p,c,A,u);if(b.push(O.deflate(y)),A==1)break}for(var r,e=1e9,i=0;i<b.length;i++)b[i].length<e&&(r=i,e=b[i].length);return b[r]},w.encode._filterLine=function(g,_,A,c,y,b){var u=A*c,p=u+A,r=w.decode._paeth;if(g[p]=b,p++,b==0)for(var e=0;e<c;e++)g[p+e]=_[u+e];else if(b==1){for(var e=0;e<y;e++)g[p+e]=_[u+e];for(var e=y;e<c;e++)g[p+e]=_[u+e]-_[u+e-y]+256&255}else if(A==0){for(var e=0;e<y;e++)g[p+e]=_[u+e];if(b==2)for(var e=y;e<c;e++)g[p+e]=_[u+e];if(b==3)for(var e=y;e<c;e++)g[p+e]=_[u+e]-(_[u+e-y]>>1)+256&255;if(b==4)for(var e=y;e<c;e++)g[p+e]=_[u+e]-r(_[u+e-y],0,0)+256&255}else{if(b==2)for(var e=0;e<c;e++)g[p+e]=_[u+e]+256-_[u+e-c]&255;if(b==3){for(var e=0;e<y;e++)g[p+e]=_[u+e]+256-(_[u+e-c]>>1)&255;for(var e=y;e<c;e++)g[p+e]=_[u+e]+256-(_[u+e-c]+_[u+e-y]>>1)&255}if(b==4){for(var e=0;e<y;e++)g[p+e]=_[u+e]+256-r(0,_[u+e-c],0)&255;for(var e=y;e<c;e++)g[p+e]=_[u+e]+256-r(_[u+e-y],_[u+e-c],_[u+e-y-c])&255}}},w.crc={table:function(){for(var g=new Uint32Array(256),_=0;_<256;_++){for(var A=_,c=0;c<8;c++)A&1?A=3988292384^A>>>1:A=A>>>1;g[_]=A}return g}(),update:function(g,_,A,c){for(var y=0;y<c;y++)g=w.crc.table[(g^_[A+y])&255]^g>>>8;return g},crc:function(g,_,A){return w.crc.update(4294967295,g,_,A)^4294967295}},w.quantize=function(g,_,A){for(var c=[],y=0,b=0;b<g.length;b++)c.push(w.encode.alphaMul(new Uint8Array(g[b]),A)),y+=g[b].byteLength;for(var u=new Uint8Array(y),p=new Uint32Array(u.buffer),r=0,b=0;b<c.length;b++){for(var e=c[b],i=e.length,s=0;s<i;s++)u[r+s]=e[s];r+=i}var a={i0:0,i1:u.length,bst:null,est:null,tdst:0,left:null,right:null};a.bst=w.quantize.stats(u,a.i0,a.i1),a.est=w.quantize.estats(a.bst);for(var h=[a];h.length<_;){for(var t=0,n=0,b=0;b<h.length;b++)h[b].est.L>t&&(t=h[b].est.L,n=b);if(t<.001)break;var f=h[n],o=w.quantize.splitPixels(u,p,f.i0,f.i1,f.est.e,f.est.eMq255),v={i0:f.i0,i1:o,bst:null,est:null,tdst:0,left:null,right:null};v.bst=w.quantize.stats(u,v.i0,v.i1),v.est=w.quantize.estats(v.bst);var m={i0:o,i1:f.i1,bst:null,est:null,tdst:0,left:null,right:null};m.bst={R:[],m:[],N:f.bst.N-v.bst.N};for(var b=0;b<16;b++)m.bst.R[b]=f.bst.R[b]-v.bst.R[b];for(var b=0;b<4;b++)m.bst.m[b]=f.bst.m[b]-v.bst.m[b];m.est=w.quantize.estats(m.bst),f.left=v,f.right=m,h[n]=v,h.push(m)}h.sort(function(F,N){return N.bst.N-F.bst.N});for(var E=0;E<c.length;E++){for(var S=w.quantize.planeDst,T=new Uint8Array(c[E].buffer),P=new Uint32Array(c[E].buffer),I=T.length,b=0;b<I;b+=4){for(var B=T[b]*.00392156862745098,R=T[b+1]*(1/255),z=T[b+2]*(1/255),U=T[b+3]*(1/255),W=a;W.left;)W=S(W.est,B,R,z,U)<=0?W.left:W.right;P[b>>2]=W.est.rgba}c[E]=P.buffer}return{bufs:c,plte:h}},w.quantize.getNearest=function(g,_,A,c,y){if(g.left==null)return g.tdst=w.quantize.dist(g.est.q,_,A,c,y),g;var b=w.quantize.planeDst(g.est,_,A,c,y),u=g.left,p=g.right;b>0&&(u=g.right,p=g.left);var r=w.quantize.getNearest(u,_,A,c,y);if(r.tdst<=b*b)return r;var e=w.quantize.getNearest(p,_,A,c,y);return e.tdst<r.tdst?e:r},w.quantize.planeDst=function(g,_,A,c,y){var b=g.e;return b[0]*_+b[1]*A+b[2]*c+b[3]*y-g.eMq},w.quantize.dist=function(g,_,A,c,y){var b=_-g[0],u=A-g[1],p=c-g[2],r=y-g[3];return b*b+u*u+p*p+r*r},w.quantize.splitPixels=function(g,_,A,c,y,b){var u=w.quantize.vecDot;for(c-=4;A<c;){for(;u(g,A,y)<=b;)A+=4;for(;u(g,c,y)>b;)c-=4;if(A>=c)break;var p=_[A>>2];_[A>>2]=_[c>>2],_[c>>2]=p,A+=4,c-=4}for(;u(g,A,y)>b;)A-=4;return A+4},w.quantize.vecDot=function(g,_,A){return g[_]*A[0]+g[_+1]*A[1]+g[_+2]*A[2]+g[_+3]*A[3]},w.quantize.stats=function(g,_,A){for(var c=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],y=[0,0,0,0],b=A-_>>2,u=_;u<A;u+=4){var p=g[u]*.00392156862745098,r=g[u+1]*(1/255),e=g[u+2]*(1/255),i=g[u+3]*(1/255);y[0]+=p,y[1]+=r,y[2]+=e,y[3]+=i,c[0]+=p*p,c[1]+=p*r,c[2]+=p*e,c[3]+=p*i,c[5]+=r*r,c[6]+=r*e,c[7]+=r*i,c[10]+=e*e,c[11]+=e*i,c[15]+=i*i}return c[4]=c[1],c[8]=c[2],c[12]=c[3],c[9]=c[6],c[13]=c[7],c[14]=c[11],{R:c,m:y,N:b}},w.quantize.estats=function(g){var _=g.R,A=g.m,c=g.N,y=A[0],b=A[1],u=A[2],p=A[3],r=c==0?0:1/c,e=[_[0]-y*y*r,_[1]-y*b*r,_[2]-y*u*r,_[3]-y*p*r,_[4]-b*y*r,_[5]-b*b*r,_[6]-b*u*r,_[7]-b*p*r,_[8]-u*y*r,_[9]-u*b*r,_[10]-u*u*r,_[11]-u*p*r,_[12]-p*y*r,_[13]-p*b*r,_[14]-p*u*r,_[15]-p*p*r],i=e,s=w.M4,a=[.5,.5,.5,.5],h=0,t=0;if(c!=0)for(var n=0;n<10&&(a=s.multVec(i,a),t=Math.sqrt(s.dot(a,a)),a=s.sml(1/t,a),!(Math.abs(t-h)<1e-9));n++)h=t;var f=[y*r,b*r,u*r,p*r],o=s.dot(s.sml(255,f),a),v=f[3]<.001?0:1/f[3];return{Cov:e,q:f,e:a,L:h,eMq255:o,eMq:s.dot(a,f),rgba:(Math.round(255*f[3])<<24|Math.round(255*f[2]*v)<<16|Math.round(255*f[1]*v)<<8|Math.round(255*f[0]*v)<<0)>>>0}},w.M4={multVec:function(g,_){return[g[0]*_[0]+g[1]*_[1]+g[2]*_[2]+g[3]*_[3],g[4]*_[0]+g[5]*_[1]+g[6]*_[2]+g[7]*_[3],g[8]*_[0]+g[9]*_[1]+g[10]*_[2]+g[11]*_[3],g[12]*_[0]+g[13]*_[1]+g[14]*_[2]+g[15]*_[3]]},dot:function(g,_){return g[0]*_[0]+g[1]*_[1]+g[2]*_[2]+g[3]*_[3]},sml:function(g,_){return[g*_[0],g*_[1],g*_[2],g*_[3]]}},w.encode.alphaMul=function(g,_){for(var A=new Uint8Array(g.length),c=g.length>>2,y=0;y<c;y++){var b=y<<2,u=g[b+3];_&&(u=u<128?0:255);var p=u*(1/255);A[b+0]=g[b+0]*p,A[b+1]=g[b+1]*p,A[b+2]=g[b+2]*p,A[b+3]=u}return A}}(M,L)})()},"./node_modules/upng-js/node_modules/pako/index.js":(K,C,d)=>{var M=d("./node_modules/upng-js/node_modules/pako/lib/utils/common.js").assign,L=d("./node_modules/upng-js/node_modules/pako/lib/deflate.js"),w=d("./node_modules/upng-js/node_modules/pako/lib/inflate.js"),O=d("./node_modules/upng-js/node_modules/pako/lib/zlib/constants.js"),g={};M(g,L,w,O),K.exports=g},"./node_modules/upng-js/node_modules/pako/lib/deflate.js":(K,C,d)=>{var M=d("./node_modules/upng-js/node_modules/pako/lib/zlib/deflate.js"),L=d("./node_modules/upng-js/node_modules/pako/lib/utils/common.js"),w=d("./node_modules/upng-js/node_modules/pako/lib/utils/strings.js"),O=d("./node_modules/upng-js/node_modules/pako/lib/zlib/messages.js"),g=d("./node_modules/upng-js/node_modules/pako/lib/zlib/zstream.js"),_=Object.prototype.toString,A=0,c=4,y=0,b=1,u=2,p=-1,r=0,e=8;function i(t){if(!(this instanceof i))return new i(t);this.options=L.assign({level:p,method:e,chunkSize:16384,windowBits:15,memLevel:8,strategy:r,to:""},t||{});var n=this.options;n.raw&&n.windowBits>0?n.windowBits=-n.windowBits:n.gzip&&n.windowBits>0&&n.windowBits<16&&(n.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new g,this.strm.avail_out=0;var f=M.deflateInit2(this.strm,n.level,n.method,n.windowBits,n.memLevel,n.strategy);if(f!==y)throw new Error(O[f]);if(n.header&&M.deflateSetHeader(this.strm,n.header),n.dictionary){var o;if(typeof n.dictionary=="string"?o=w.string2buf(n.dictionary):_.call(n.dictionary)==="[object ArrayBuffer]"?o=new Uint8Array(n.dictionary):o=n.dictionary,f=M.deflateSetDictionary(this.strm,o),f!==y)throw new Error(O[f]);this._dict_set=!0}}i.prototype.push=function(t,n){var f=this.strm,o=this.options.chunkSize,v,m;if(this.ended)return!1;m=n===~~n?n:n===!0?c:A,typeof t=="string"?f.input=w.string2buf(t):_.call(t)==="[object ArrayBuffer]"?f.input=new Uint8Array(t):f.input=t,f.next_in=0,f.avail_in=f.input.length;do{if(f.avail_out===0&&(f.output=new L.Buf8(o),f.next_out=0,f.avail_out=o),v=M.deflate(f,m),v!==b&&v!==y)return this.onEnd(v),this.ended=!0,!1;(f.avail_out===0||f.avail_in===0&&(m===c||m===u))&&(this.options.to==="string"?this.onData(w.buf2binstring(L.shrinkBuf(f.output,f.next_out))):this.onData(L.shrinkBuf(f.output,f.next_out)))}while((f.avail_in>0||f.avail_out===0)&&v!==b);return m===c?(v=M.deflateEnd(this.strm),this.onEnd(v),this.ended=!0,v===y):(m===u&&(this.onEnd(y),f.avail_out=0),!0)},i.prototype.onData=function(t){this.chunks.push(t)},i.prototype.onEnd=function(t){t===y&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=L.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};function s(t,n){var f=new i(n);if(f.push(t,!0),f.err)throw f.msg||O[f.err];return f.result}function a(t,n){return n=n||{},n.raw=!0,s(t,n)}function h(t,n){return n=n||{},n.gzip=!0,s(t,n)}C.Deflate=i,C.deflate=s,C.deflateRaw=a,C.gzip=h},"./node_modules/upng-js/node_modules/pako/lib/inflate.js":(K,C,d)=>{var M=d("./node_modules/upng-js/node_modules/pako/lib/zlib/inflate.js"),L=d("./node_modules/upng-js/node_modules/pako/lib/utils/common.js"),w=d("./node_modules/upng-js/node_modules/pako/lib/utils/strings.js"),O=d("./node_modules/upng-js/node_modules/pako/lib/zlib/constants.js"),g=d("./node_modules/upng-js/node_modules/pako/lib/zlib/messages.js"),_=d("./node_modules/upng-js/node_modules/pako/lib/zlib/zstream.js"),A=d("./node_modules/upng-js/node_modules/pako/lib/zlib/gzheader.js"),c=Object.prototype.toString;function y(p){if(!(this instanceof y))return new y(p);this.options=L.assign({chunkSize:16384,windowBits:0,to:""},p||{});var r=this.options;r.raw&&r.windowBits>=0&&r.windowBits<16&&(r.windowBits=-r.windowBits,r.windowBits===0&&(r.windowBits=-15)),r.windowBits>=0&&r.windowBits<16&&!(p&&p.windowBits)&&(r.windowBits+=32),r.windowBits>15&&r.windowBits<48&&(r.windowBits&15)===0&&(r.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new _,this.strm.avail_out=0;var e=M.inflateInit2(this.strm,r.windowBits);if(e!==O.Z_OK)throw new Error(g[e]);if(this.header=new A,M.inflateGetHeader(this.strm,this.header),r.dictionary&&(typeof r.dictionary=="string"?r.dictionary=w.string2buf(r.dictionary):c.call(r.dictionary)==="[object ArrayBuffer]"&&(r.dictionary=new Uint8Array(r.dictionary)),r.raw&&(e=M.inflateSetDictionary(this.strm,r.dictionary),e!==O.Z_OK)))throw new Error(g[e])}y.prototype.push=function(p,r){var e=this.strm,i=this.options.chunkSize,s=this.options.dictionary,a,h,t,n,f,o=!1;if(this.ended)return!1;h=r===~~r?r:r===!0?O.Z_FINISH:O.Z_NO_FLUSH,typeof p=="string"?e.input=w.binstring2buf(p):c.call(p)==="[object ArrayBuffer]"?e.input=new Uint8Array(p):e.input=p,e.next_in=0,e.avail_in=e.input.length;do{if(e.avail_out===0&&(e.output=new L.Buf8(i),e.next_out=0,e.avail_out=i),a=M.inflate(e,O.Z_NO_FLUSH),a===O.Z_NEED_DICT&&s&&(a=M.inflateSetDictionary(this.strm,s)),a===O.Z_BUF_ERROR&&o===!0&&(a=O.Z_OK,o=!1),a!==O.Z_STREAM_END&&a!==O.Z_OK)return this.onEnd(a),this.ended=!0,!1;e.next_out&&(e.avail_out===0||a===O.Z_STREAM_END||e.avail_in===0&&(h===O.Z_FINISH||h===O.Z_SYNC_FLUSH))&&(this.options.to==="string"?(t=w.utf8border(e.output,e.next_out),n=e.next_out-t,f=w.buf2string(e.output,t),e.next_out=n,e.avail_out=i-n,n&&L.arraySet(e.output,e.output,t,n,0),this.onData(f)):this.onData(L.shrinkBuf(e.output,e.next_out))),e.avail_in===0&&e.avail_out===0&&(o=!0)}while((e.avail_in>0||e.avail_out===0)&&a!==O.Z_STREAM_END);return a===O.Z_STREAM_END&&(h=O.Z_FINISH),h===O.Z_FINISH?(a=M.inflateEnd(this.strm),this.onEnd(a),this.ended=!0,a===O.Z_OK):(h===O.Z_SYNC_FLUSH&&(this.onEnd(O.Z_OK),e.avail_out=0),!0)},y.prototype.onData=function(p){this.chunks.push(p)},y.prototype.onEnd=function(p){p===O.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=L.flattenChunks(this.chunks)),this.chunks=[],this.err=p,this.msg=this.strm.msg};function b(p,r){var e=new y(r);if(e.push(p,!0),e.err)throw e.msg||g[e.err];return e.result}function u(p,r){return r=r||{},r.raw=!0,b(p,r)}C.Inflate=y,C.inflate=b,C.inflateRaw=u,C.ungzip=b},"./node_modules/upng-js/node_modules/pako/lib/utils/common.js":(K,C)=>{var d=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";function M(O,g){return Object.prototype.hasOwnProperty.call(O,g)}C.assign=function(O){for(var g=Array.prototype.slice.call(arguments,1);g.length;){var _=g.shift();if(_){if(typeof _!="object")throw new TypeError(_+"must be non-object");for(var A in _)M(_,A)&&(O[A]=_[A])}}return O},C.shrinkBuf=function(O,g){return O.length===g?O:O.subarray?O.subarray(0,g):(O.length=g,O)};var L={arraySet:function(O,g,_,A,c){if(g.subarray&&O.subarray){O.set(g.subarray(_,_+A),c);return}for(var y=0;y<A;y++)O[c+y]=g[_+y]},flattenChunks:function(O){var g,_,A,c,y,b;for(A=0,g=0,_=O.length;g<_;g++)A+=O[g].length;for(b=new Uint8Array(A),c=0,g=0,_=O.length;g<_;g++)y=O[g],b.set(y,c),c+=y.length;return b}},w={arraySet:function(O,g,_,A,c){for(var y=0;y<A;y++)O[c+y]=g[_+y]},flattenChunks:function(O){return[].concat.apply([],O)}};C.setTyped=function(O){O?(C.Buf8=Uint8Array,C.Buf16=Uint16Array,C.Buf32=Int32Array,C.assign(C,L)):(C.Buf8=Array,C.Buf16=Array,C.Buf32=Array,C.assign(C,w))},C.setTyped(d)},"./node_modules/upng-js/node_modules/pako/lib/utils/strings.js":(K,C,d)=>{var M=d("./node_modules/upng-js/node_modules/pako/lib/utils/common.js"),L=!0,w=!0;try{String.fromCharCode.apply(null,[0])}catch{L=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{w=!1}for(var O=new M.Buf8(256),g=0;g<256;g++)O[g]=g>=252?6:g>=248?5:g>=240?4:g>=224?3:g>=192?2:1;O[254]=O[254]=1,C.string2buf=function(A){var c,y,b,u,p,r=A.length,e=0;for(u=0;u<r;u++)y=A.charCodeAt(u),(y&64512)===55296&&u+1<r&&(b=A.charCodeAt(u+1),(b&64512)===56320&&(y=65536+(y-55296<<10)+(b-56320),u++)),e+=y<128?1:y<2048?2:y<65536?3:4;for(c=new M.Buf8(e),p=0,u=0;p<e;u++)y=A.charCodeAt(u),(y&64512)===55296&&u+1<r&&(b=A.charCodeAt(u+1),(b&64512)===56320&&(y=65536+(y-55296<<10)+(b-56320),u++)),y<128?c[p++]=y:y<2048?(c[p++]=192|y>>>6,c[p++]=128|y&63):y<65536?(c[p++]=224|y>>>12,c[p++]=128|y>>>6&63,c[p++]=128|y&63):(c[p++]=240|y>>>18,c[p++]=128|y>>>12&63,c[p++]=128|y>>>6&63,c[p++]=128|y&63);return c};function _(A,c){if(c<65534&&(A.subarray&&w||!A.subarray&&L))return String.fromCharCode.apply(null,M.shrinkBuf(A,c));for(var y="",b=0;b<c;b++)y+=String.fromCharCode(A[b]);return y}C.buf2binstring=function(A){return _(A,A.length)},C.binstring2buf=function(A){for(var c=new M.Buf8(A.length),y=0,b=c.length;y<b;y++)c[y]=A.charCodeAt(y);return c},C.buf2string=function(A,c){var y,b,u,p,r=c||A.length,e=new Array(r*2);for(b=0,y=0;y<r;){if(u=A[y++],u<128){e[b++]=u;continue}if(p=O[u],p>4){e[b++]=65533,y+=p-1;continue}for(u&=p===2?31:p===3?15:7;p>1&&y<r;)u=u<<6|A[y++]&63,p--;if(p>1){e[b++]=65533;continue}u<65536?e[b++]=u:(u-=65536,e[b++]=55296|u>>10&1023,e[b++]=56320|u&1023)}return _(e,b)},C.utf8border=function(A,c){var y;for(c=c||A.length,c>A.length&&(c=A.length),y=c-1;y>=0&&(A[y]&192)===128;)y--;return y<0||y===0?c:y+O[A[y]]>c?y:c}},"./node_modules/upng-js/node_modules/pako/lib/zlib/adler32.js":K=>{function C(d,M,L,w){for(var O=d&65535|0,g=d>>>16&65535|0,_=0;L!==0;){_=L>2e3?2e3:L,L-=_;do O=O+M[w++]|0,g=g+O|0;while(--_);O%=65521,g%=65521}return O|g<<16|0}K.exports=C},"./node_modules/upng-js/node_modules/pako/lib/zlib/constants.js":K=>{K.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},"./node_modules/upng-js/node_modules/pako/lib/zlib/crc32.js":K=>{function C(){for(var L,w=[],O=0;O<256;O++){L=O;for(var g=0;g<8;g++)L=L&1?3988292384^L>>>1:L>>>1;w[O]=L}return w}var d=C();function M(L,w,O,g){var _=d,A=g+O;L^=-1;for(var c=g;c<A;c++)L=L>>>8^_[(L^w[c])&255];return L^-1}K.exports=M},"./node_modules/upng-js/node_modules/pako/lib/zlib/deflate.js":(K,C,d)=>{var M=d("./node_modules/upng-js/node_modules/pako/lib/utils/common.js"),L=d("./node_modules/upng-js/node_modules/pako/lib/zlib/trees.js"),w=d("./node_modules/upng-js/node_modules/pako/lib/zlib/adler32.js"),O=d("./node_modules/upng-js/node_modules/pako/lib/zlib/crc32.js"),g=d("./node_modules/upng-js/node_modules/pako/lib/zlib/messages.js"),_=0,A=1,c=3,y=4,b=5,u=0,p=1,r=-2,e=-3,i=-5,s=-1,a=1,h=2,t=3,n=4,f=0,o=2,v=8,m=9,E=15,S=8,T=29,P=256,I=P+1+T,B=30,R=19,z=2*I+1,U=15,W=3,F=258,N=F+W+1,q=32,J=42,oe=69,le=73,fe=91,ie=103,ne=113,we=666,Ee=1,Se=2,de=3,ee=4,me=3;function De(D,ue){return D.msg=g[ue],ue}function Ie(D){return(D<<1)-(D>4?9:0)}function Fe(D){for(var ue=D.length;--ue>=0;)D[ue]=0}function Ue(D){var ue=D.state,ce=ue.pending;ce>D.avail_out&&(ce=D.avail_out),ce!==0&&(M.arraySet(D.output,ue.pending_buf,ue.pending_out,ce,D.next_out),D.next_out+=ce,ue.pending_out+=ce,D.total_out+=ce,D.avail_out-=ce,ue.pending-=ce,ue.pending===0&&(ue.pending_out=0))}function ze(D,ue){L._tr_flush_block(D,D.block_start>=0?D.block_start:-1,D.strstart-D.block_start,ue),D.block_start=D.strstart,Ue(D.strm)}function Re(D,ue){D.pending_buf[D.pending++]=ue}function Pe(D,ue){D.pending_buf[D.pending++]=ue>>>8&255,D.pending_buf[D.pending++]=ue&255}function Oe(D,ue,ce,H){var te=D.avail_in;return te>H&&(te=H),te===0?0:(D.avail_in-=te,M.arraySet(ue,D.input,D.next_in,te,ce),D.state.wrap===1?D.adler=w(D.adler,ue,te,ce):D.state.wrap===2&&(D.adler=O(D.adler,ue,te,ce)),D.next_in+=te,D.total_in+=te,te)}function Ae(D,ue){var ce=D.max_chain_length,H=D.strstart,te,_e,ke=D.prev_length,Ve=D.nice_match,Ge=D.strstart>D.w_size-N?D.strstart-(D.w_size-N):0,$e=D.window,xt=D.w_mask,tt=D.prev,et=D.strstart+F,Je=$e[H+ke-1],_t=$e[H+ke];D.prev_length>=D.good_match&&(ce>>=2),Ve>D.lookahead&&(Ve=D.lookahead);do if(te=ue,!($e[te+ke]!==_t||$e[te+ke-1]!==Je||$e[te]!==$e[H]||$e[++te]!==$e[H+1])){H+=2,te++;do;while($e[++H]===$e[++te]&&$e[++H]===$e[++te]&&$e[++H]===$e[++te]&&$e[++H]===$e[++te]&&$e[++H]===$e[++te]&&$e[++H]===$e[++te]&&$e[++H]===$e[++te]&&$e[++H]===$e[++te]&&H<et);if(_e=F-(et-H),H=et-F,_e>ke){if(D.match_start=ue,ke=_e,_e>=Ve)break;Je=$e[H+ke-1],_t=$e[H+ke]}}while((ue=tt[ue&xt])>Ge&&--ce!==0);return ke<=D.lookahead?ke:D.lookahead}function Ne(D){var ue=D.w_size,ce,H,te,_e,ke;do{if(_e=D.window_size-D.lookahead-D.strstart,D.strstart>=ue+(ue-N)){M.arraySet(D.window,D.window,ue,ue,0),D.match_start-=ue,D.strstart-=ue,D.block_start-=ue,H=D.hash_size,ce=H;do te=D.head[--ce],D.head[ce]=te>=ue?te-ue:0;while(--H);H=ue,ce=H;do te=D.prev[--ce],D.prev[ce]=te>=ue?te-ue:0;while(--H);_e+=ue}if(D.strm.avail_in===0)break;if(H=Oe(D.strm,D.window,D.strstart+D.lookahead,_e),D.lookahead+=H,D.lookahead+D.insert>=W)for(ke=D.strstart-D.insert,D.ins_h=D.window[ke],D.ins_h=(D.ins_h<<D.hash_shift^D.window[ke+1])&D.hash_mask;D.insert&&(D.ins_h=(D.ins_h<<D.hash_shift^D.window[ke+W-1])&D.hash_mask,D.prev[ke&D.w_mask]=D.head[D.ins_h],D.head[D.ins_h]=ke,ke++,D.insert--,!(D.lookahead+D.insert<W)););}while(D.lookahead<N&&D.strm.avail_in!==0)}function je(D,ue){var ce=65535;for(ce>D.pending_buf_size-5&&(ce=D.pending_buf_size-5);;){if(D.lookahead<=1){if(Ne(D),D.lookahead===0&&ue===_)return Ee;if(D.lookahead===0)break}D.strstart+=D.lookahead,D.lookahead=0;var H=D.block_start+ce;if((D.strstart===0||D.strstart>=H)&&(D.lookahead=D.strstart-H,D.strstart=H,ze(D,!1),D.strm.avail_out===0)||D.strstart-D.block_start>=D.w_size-N&&(ze(D,!1),D.strm.avail_out===0))return Ee}return D.insert=0,ue===y?(ze(D,!0),D.strm.avail_out===0?de:ee):(D.strstart>D.block_start&&(ze(D,!1),D.strm.avail_out===0),Ee)}function k(D,ue){for(var ce,H;;){if(D.lookahead<N){if(Ne(D),D.lookahead<N&&ue===_)return Ee;if(D.lookahead===0)break}if(ce=0,D.lookahead>=W&&(D.ins_h=(D.ins_h<<D.hash_shift^D.window[D.strstart+W-1])&D.hash_mask,ce=D.prev[D.strstart&D.w_mask]=D.head[D.ins_h],D.head[D.ins_h]=D.strstart),ce!==0&&D.strstart-ce<=D.w_size-N&&(D.match_length=Ae(D,ce)),D.match_length>=W)if(H=L._tr_tally(D,D.strstart-D.match_start,D.match_length-W),D.lookahead-=D.match_length,D.match_length<=D.max_lazy_match&&D.lookahead>=W){D.match_length--;do D.strstart++,D.ins_h=(D.ins_h<<D.hash_shift^D.window[D.strstart+W-1])&D.hash_mask,ce=D.prev[D.strstart&D.w_mask]=D.head[D.ins_h],D.head[D.ins_h]=D.strstart;while(--D.match_length!==0);D.strstart++}else D.strstart+=D.match_length,D.match_length=0,D.ins_h=D.window[D.strstart],D.ins_h=(D.ins_h<<D.hash_shift^D.window[D.strstart+1])&D.hash_mask;else H=L._tr_tally(D,0,D.window[D.strstart]),D.lookahead--,D.strstart++;if(H&&(ze(D,!1),D.strm.avail_out===0))return Ee}return D.insert=D.strstart<W-1?D.strstart:W-1,ue===y?(ze(D,!0),D.strm.avail_out===0?de:ee):D.last_lit&&(ze(D,!1),D.strm.avail_out===0)?Ee:Se}function Z(D,ue){for(var ce,H,te;;){if(D.lookahead<N){if(Ne(D),D.lookahead<N&&ue===_)return Ee;if(D.lookahead===0)break}if(ce=0,D.lookahead>=W&&(D.ins_h=(D.ins_h<<D.hash_shift^D.window[D.strstart+W-1])&D.hash_mask,ce=D.prev[D.strstart&D.w_mask]=D.head[D.ins_h],D.head[D.ins_h]=D.strstart),D.prev_length=D.match_length,D.prev_match=D.match_start,D.match_length=W-1,ce!==0&&D.prev_length<D.max_lazy_match&&D.strstart-ce<=D.w_size-N&&(D.match_length=Ae(D,ce),D.match_length<=5&&(D.strategy===a||D.match_length===W&&D.strstart-D.match_start>4096)&&(D.match_length=W-1)),D.prev_length>=W&&D.match_length<=D.prev_length){te=D.strstart+D.lookahead-W,H=L._tr_tally(D,D.strstart-1-D.prev_match,D.prev_length-W),D.lookahead-=D.prev_length-1,D.prev_length-=2;do++D.strstart<=te&&(D.ins_h=(D.ins_h<<D.hash_shift^D.window[D.strstart+W-1])&D.hash_mask,ce=D.prev[D.strstart&D.w_mask]=D.head[D.ins_h],D.head[D.ins_h]=D.strstart);while(--D.prev_length!==0);if(D.match_available=0,D.match_length=W-1,D.strstart++,H&&(ze(D,!1),D.strm.avail_out===0))return Ee}else if(D.match_available){if(H=L._tr_tally(D,0,D.window[D.strstart-1]),H&&ze(D,!1),D.strstart++,D.lookahead--,D.strm.avail_out===0)return Ee}else D.match_available=1,D.strstart++,D.lookahead--}return D.match_available&&(H=L._tr_tally(D,0,D.window[D.strstart-1]),D.match_available=0),D.insert=D.strstart<W-1?D.strstart:W-1,ue===y?(ze(D,!0),D.strm.avail_out===0?de:ee):D.last_lit&&(ze(D,!1),D.strm.avail_out===0)?Ee:Se}function Y(D,ue){for(var ce,H,te,_e,ke=D.window;;){if(D.lookahead<=F){if(Ne(D),D.lookahead<=F&&ue===_)return Ee;if(D.lookahead===0)break}if(D.match_length=0,D.lookahead>=W&&D.strstart>0&&(te=D.strstart-1,H=ke[te],H===ke[++te]&&H===ke[++te]&&H===ke[++te])){_e=D.strstart+F;do;while(H===ke[++te]&&H===ke[++te]&&H===ke[++te]&&H===ke[++te]&&H===ke[++te]&&H===ke[++te]&&H===ke[++te]&&H===ke[++te]&&te<_e);D.match_length=F-(_e-te),D.match_length>D.lookahead&&(D.match_length=D.lookahead)}if(D.match_length>=W?(ce=L._tr_tally(D,1,D.match_length-W),D.lookahead-=D.match_length,D.strstart+=D.match_length,D.match_length=0):(ce=L._tr_tally(D,0,D.window[D.strstart]),D.lookahead--,D.strstart++),ce&&(ze(D,!1),D.strm.avail_out===0))return Ee}return D.insert=0,ue===y?(ze(D,!0),D.strm.avail_out===0?de:ee):D.last_lit&&(ze(D,!1),D.strm.avail_out===0)?Ee:Se}function ve(D,ue){for(var ce;;){if(D.lookahead===0&&(Ne(D),D.lookahead===0)){if(ue===_)return Ee;break}if(D.match_length=0,ce=L._tr_tally(D,0,D.window[D.strstart]),D.lookahead--,D.strstart++,ce&&(ze(D,!1),D.strm.avail_out===0))return Ee}return D.insert=0,ue===y?(ze(D,!0),D.strm.avail_out===0?de:ee):D.last_lit&&(ze(D,!1),D.strm.avail_out===0)?Ee:Se}function re(D,ue,ce,H,te){this.good_length=D,this.max_lazy=ue,this.nice_length=ce,this.max_chain=H,this.func=te}var Le;Le=[new re(0,0,0,0,je),new re(4,4,8,4,k),new re(4,5,16,8,k),new re(4,6,32,32,k),new re(4,4,16,16,Z),new re(8,16,32,32,Z),new re(8,16,128,128,Z),new re(8,32,128,256,Z),new re(32,128,258,1024,Z),new re(32,258,258,4096,Z)];function Me(D){D.window_size=2*D.w_size,Fe(D.head),D.max_lazy_match=Le[D.level].max_lazy,D.good_match=Le[D.level].good_length,D.nice_match=Le[D.level].nice_length,D.max_chain_length=Le[D.level].max_chain,D.strstart=0,D.block_start=0,D.lookahead=0,D.insert=0,D.match_length=D.prev_length=W-1,D.match_available=0,D.ins_h=0}function V(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=v,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new M.Buf16(z*2),this.dyn_dtree=new M.Buf16((2*B+1)*2),this.bl_tree=new M.Buf16((2*R+1)*2),Fe(this.dyn_ltree),Fe(this.dyn_dtree),Fe(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new M.Buf16(U+1),this.heap=new M.Buf16(2*I+1),Fe(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new M.Buf16(2*I+1),Fe(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function ae(D){var ue;return!D||!D.state?De(D,r):(D.total_in=D.total_out=0,D.data_type=o,ue=D.state,ue.pending=0,ue.pending_out=0,ue.wrap<0&&(ue.wrap=-ue.wrap),ue.status=ue.wrap?J:ne,D.adler=ue.wrap===2?0:1,ue.last_flush=_,L._tr_init(ue),u)}function pe(D){var ue=ae(D);return ue===u&&Me(D.state),ue}function Te(D,ue){return!D||!D.state||D.state.wrap!==2?r:(D.state.gzhead=ue,u)}function se(D,ue,ce,H,te,_e){if(!D)return r;var ke=1;if(ue===s&&(ue=6),H<0?(ke=0,H=-H):H>15&&(ke=2,H-=16),te<1||te>m||ce!==v||H<8||H>15||ue<0||ue>9||_e<0||_e>n)return De(D,r);H===8&&(H=9);var Ve=new V;return D.state=Ve,Ve.strm=D,Ve.wrap=ke,Ve.gzhead=null,Ve.w_bits=H,Ve.w_size=1<<Ve.w_bits,Ve.w_mask=Ve.w_size-1,Ve.hash_bits=te+7,Ve.hash_size=1<<Ve.hash_bits,Ve.hash_mask=Ve.hash_size-1,Ve.hash_shift=~~((Ve.hash_bits+W-1)/W),Ve.window=new M.Buf8(Ve.w_size*2),Ve.head=new M.Buf16(Ve.hash_size),Ve.prev=new M.Buf16(Ve.w_size),Ve.lit_bufsize=1<<te+6,Ve.pending_buf_size=Ve.lit_bufsize*4,Ve.pending_buf=new M.Buf8(Ve.pending_buf_size),Ve.d_buf=1*Ve.lit_bufsize,Ve.l_buf=3*Ve.lit_bufsize,Ve.level=ue,Ve.strategy=_e,Ve.method=ce,pe(D)}function ye(D,ue){return se(D,ue,v,E,S,f)}function j(D,ue){var ce,H,te,_e;if(!D||!D.state||ue>b||ue<0)return D?De(D,r):r;if(H=D.state,!D.output||!D.input&&D.avail_in!==0||H.status===we&&ue!==y)return De(D,D.avail_out===0?i:r);if(H.strm=D,ce=H.last_flush,H.last_flush=ue,H.status===J)if(H.wrap===2)D.adler=0,Re(H,31),Re(H,139),Re(H,8),H.gzhead?(Re(H,(H.gzhead.text?1:0)+(H.gzhead.hcrc?2:0)+(H.gzhead.extra?4:0)+(H.gzhead.name?8:0)+(H.gzhead.comment?16:0)),Re(H,H.gzhead.time&255),Re(H,H.gzhead.time>>8&255),Re(H,H.gzhead.time>>16&255),Re(H,H.gzhead.time>>24&255),Re(H,H.level===9?2:H.strategy>=h||H.level<2?4:0),Re(H,H.gzhead.os&255),H.gzhead.extra&&H.gzhead.extra.length&&(Re(H,H.gzhead.extra.length&255),Re(H,H.gzhead.extra.length>>8&255)),H.gzhead.hcrc&&(D.adler=O(D.adler,H.pending_buf,H.pending,0)),H.gzindex=0,H.status=oe):(Re(H,0),Re(H,0),Re(H,0),Re(H,0),Re(H,0),Re(H,H.level===9?2:H.strategy>=h||H.level<2?4:0),Re(H,me),H.status=ne);else{var ke=v+(H.w_bits-8<<4)<<8,Ve=-1;H.strategy>=h||H.level<2?Ve=0:H.level<6?Ve=1:H.level===6?Ve=2:Ve=3,ke|=Ve<<6,H.strstart!==0&&(ke|=q),ke+=31-ke%31,H.status=ne,Pe(H,ke),H.strstart!==0&&(Pe(H,D.adler>>>16),Pe(H,D.adler&65535)),D.adler=1}if(H.status===oe)if(H.gzhead.extra){for(te=H.pending;H.gzindex<(H.gzhead.extra.length&65535)&&!(H.pending===H.pending_buf_size&&(H.gzhead.hcrc&&H.pending>te&&(D.adler=O(D.adler,H.pending_buf,H.pending-te,te)),Ue(D),te=H.pending,H.pending===H.pending_buf_size));)Re(H,H.gzhead.extra[H.gzindex]&255),H.gzindex++;H.gzhead.hcrc&&H.pending>te&&(D.adler=O(D.adler,H.pending_buf,H.pending-te,te)),H.gzindex===H.gzhead.extra.length&&(H.gzindex=0,H.status=le)}else H.status=le;if(H.status===le)if(H.gzhead.name){te=H.pending;do{if(H.pending===H.pending_buf_size&&(H.gzhead.hcrc&&H.pending>te&&(D.adler=O(D.adler,H.pending_buf,H.pending-te,te)),Ue(D),te=H.pending,H.pending===H.pending_buf_size)){_e=1;break}H.gzindex<H.gzhead.name.length?_e=H.gzhead.name.charCodeAt(H.gzindex++)&255:_e=0,Re(H,_e)}while(_e!==0);H.gzhead.hcrc&&H.pending>te&&(D.adler=O(D.adler,H.pending_buf,H.pending-te,te)),_e===0&&(H.gzindex=0,H.status=fe)}else H.status=fe;if(H.status===fe)if(H.gzhead.comment){te=H.pending;do{if(H.pending===H.pending_buf_size&&(H.gzhead.hcrc&&H.pending>te&&(D.adler=O(D.adler,H.pending_buf,H.pending-te,te)),Ue(D),te=H.pending,H.pending===H.pending_buf_size)){_e=1;break}H.gzindex<H.gzhead.comment.length?_e=H.gzhead.comment.charCodeAt(H.gzindex++)&255:_e=0,Re(H,_e)}while(_e!==0);H.gzhead.hcrc&&H.pending>te&&(D.adler=O(D.adler,H.pending_buf,H.pending-te,te)),_e===0&&(H.status=ie)}else H.status=ie;if(H.status===ie&&(H.gzhead.hcrc?(H.pending+2>H.pending_buf_size&&Ue(D),H.pending+2<=H.pending_buf_size&&(Re(H,D.adler&255),Re(H,D.adler>>8&255),D.adler=0,H.status=ne)):H.status=ne),H.pending!==0){if(Ue(D),D.avail_out===0)return H.last_flush=-1,u}else if(D.avail_in===0&&Ie(ue)<=Ie(ce)&&ue!==y)return De(D,i);if(H.status===we&&D.avail_in!==0)return De(D,i);if(D.avail_in!==0||H.lookahead!==0||ue!==_&&H.status!==we){var Ge=H.strategy===h?ve(H,ue):H.strategy===t?Y(H,ue):Le[H.level].func(H,ue);if((Ge===de||Ge===ee)&&(H.status=we),Ge===Ee||Ge===de)return D.avail_out===0&&(H.last_flush=-1),u;if(Ge===Se&&(ue===A?L._tr_align(H):ue!==b&&(L._tr_stored_block(H,0,0,!1),ue===c&&(Fe(H.head),H.lookahead===0&&(H.strstart=0,H.block_start=0,H.insert=0))),Ue(D),D.avail_out===0))return H.last_flush=-1,u}return ue!==y?u:H.wrap<=0?p:(H.wrap===2?(Re(H,D.adler&255),Re(H,D.adler>>8&255),Re(H,D.adler>>16&255),Re(H,D.adler>>24&255),Re(H,D.total_in&255),Re(H,D.total_in>>8&255),Re(H,D.total_in>>16&255),Re(H,D.total_in>>24&255)):(Pe(H,D.adler>>>16),Pe(H,D.adler&65535)),Ue(D),H.wrap>0&&(H.wrap=-H.wrap),H.pending!==0?u:p)}function Ce(D){var ue;return!D||!D.state?r:(ue=D.state.status,ue!==J&&ue!==oe&&ue!==le&&ue!==fe&&ue!==ie&&ue!==ne&&ue!==we?De(D,r):(D.state=null,ue===ne?De(D,e):u))}function We(D,ue){var ce=ue.length,H,te,_e,ke,Ve,Ge,$e,xt;if(!D||!D.state||(H=D.state,ke=H.wrap,ke===2||ke===1&&H.status!==J||H.lookahead))return r;for(ke===1&&(D.adler=w(D.adler,ue,ce,0)),H.wrap=0,ce>=H.w_size&&(ke===0&&(Fe(H.head),H.strstart=0,H.block_start=0,H.insert=0),xt=new M.Buf8(H.w_size),M.arraySet(xt,ue,ce-H.w_size,H.w_size,0),ue=xt,ce=H.w_size),Ve=D.avail_in,Ge=D.next_in,$e=D.input,D.avail_in=ce,D.next_in=0,D.input=ue,Ne(H);H.lookahead>=W;){te=H.strstart,_e=H.lookahead-(W-1);do H.ins_h=(H.ins_h<<H.hash_shift^H.window[te+W-1])&H.hash_mask,H.prev[te&H.w_mask]=H.head[H.ins_h],H.head[H.ins_h]=te,te++;while(--_e);H.strstart=te,H.lookahead=W-1,Ne(H)}return H.strstart+=H.lookahead,H.block_start=H.strstart,H.insert=H.lookahead,H.lookahead=0,H.match_length=H.prev_length=W-1,H.match_available=0,D.next_in=Ge,D.input=$e,D.avail_in=Ve,H.wrap=ke,u}C.deflateInit=ye,C.deflateInit2=se,C.deflateReset=pe,C.deflateResetKeep=ae,C.deflateSetHeader=Te,C.deflate=j,C.deflateEnd=Ce,C.deflateSetDictionary=We,C.deflateInfo="pako deflate (from Nodeca project)"},"./node_modules/upng-js/node_modules/pako/lib/zlib/gzheader.js":K=>{function C(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}K.exports=C},"./node_modules/upng-js/node_modules/pako/lib/zlib/inffast.js":K=>{var C=30,d=12;K.exports=function(L,w){var O,g,_,A,c,y,b,u,p,r,e,i,s,a,h,t,n,f,o,v,m,E,S,T,P;O=L.state,g=L.next_in,T=L.input,_=g+(L.avail_in-5),A=L.next_out,P=L.output,c=A-(w-L.avail_out),y=A+(L.avail_out-257),b=O.dmax,u=O.wsize,p=O.whave,r=O.wnext,e=O.window,i=O.hold,s=O.bits,a=O.lencode,h=O.distcode,t=(1<<O.lenbits)-1,n=(1<<O.distbits)-1;e:do{s<15&&(i+=T[g++]<<s,s+=8,i+=T[g++]<<s,s+=8),f=a[i&t];t:for(;;){if(o=f>>>24,i>>>=o,s-=o,o=f>>>16&255,o===0)P[A++]=f&65535;else if(o&16){v=f&65535,o&=15,o&&(s<o&&(i+=T[g++]<<s,s+=8),v+=i&(1<<o)-1,i>>>=o,s-=o),s<15&&(i+=T[g++]<<s,s+=8,i+=T[g++]<<s,s+=8),f=h[i&n];i:for(;;){if(o=f>>>24,i>>>=o,s-=o,o=f>>>16&255,o&16){if(m=f&65535,o&=15,s<o&&(i+=T[g++]<<s,s+=8,s<o&&(i+=T[g++]<<s,s+=8)),m+=i&(1<<o)-1,m>b){L.msg="invalid distance too far back",O.mode=C;break e}if(i>>>=o,s-=o,o=A-c,m>o){if(o=m-o,o>p&&O.sane){L.msg="invalid distance too far back",O.mode=C;break e}if(E=0,S=e,r===0){if(E+=u-o,o<v){v-=o;do P[A++]=e[E++];while(--o);E=A-m,S=P}}else if(r<o){if(E+=u+r-o,o-=r,o<v){v-=o;do P[A++]=e[E++];while(--o);if(E=0,r<v){o=r,v-=o;do P[A++]=e[E++];while(--o);E=A-m,S=P}}}else if(E+=r-o,o<v){v-=o;do P[A++]=e[E++];while(--o);E=A-m,S=P}for(;v>2;)P[A++]=S[E++],P[A++]=S[E++],P[A++]=S[E++],v-=3;v&&(P[A++]=S[E++],v>1&&(P[A++]=S[E++]))}else{E=A-m;do P[A++]=P[E++],P[A++]=P[E++],P[A++]=P[E++],v-=3;while(v>2);v&&(P[A++]=P[E++],v>1&&(P[A++]=P[E++]))}}else if((o&64)===0){f=h[(f&65535)+(i&(1<<o)-1)];continue i}else{L.msg="invalid distance code",O.mode=C;break e}break}}else if((o&64)===0){f=a[(f&65535)+(i&(1<<o)-1)];continue t}else if(o&32){O.mode=d;break e}else{L.msg="invalid literal/length code",O.mode=C;break e}break}}while(g<_&&A<y);v=s>>3,g-=v,s-=v<<3,i&=(1<<s)-1,L.next_in=g,L.next_out=A,L.avail_in=g<_?5+(_-g):5-(g-_),L.avail_out=A<y?257+(y-A):257-(A-y),O.hold=i,O.bits=s}},"./node_modules/upng-js/node_modules/pako/lib/zlib/inflate.js":(K,C,d)=>{var M=d("./node_modules/upng-js/node_modules/pako/lib/utils/common.js"),L=d("./node_modules/upng-js/node_modules/pako/lib/zlib/adler32.js"),w=d("./node_modules/upng-js/node_modules/pako/lib/zlib/crc32.js"),O=d("./node_modules/upng-js/node_modules/pako/lib/zlib/inffast.js"),g=d("./node_modules/upng-js/node_modules/pako/lib/zlib/inftrees.js"),_=0,A=1,c=2,y=4,b=5,u=6,p=0,r=1,e=2,i=-2,s=-3,a=-4,h=-5,t=8,n=1,f=2,o=3,v=4,m=5,E=6,S=7,T=8,P=9,I=10,B=11,R=12,z=13,U=14,W=15,F=16,N=17,q=18,J=19,oe=20,le=21,fe=22,ie=23,ne=24,we=25,Ee=26,Se=27,de=28,ee=29,me=30,De=31,Ie=32,Fe=852,Ue=592,ze=15,Re=ze;function Pe(se){return(se>>>24&255)+(se>>>8&65280)+((se&65280)<<8)+((se&255)<<24)}function Oe(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new M.Buf16(320),this.work=new M.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function Ae(se){var ye;return!se||!se.state?i:(ye=se.state,se.total_in=se.total_out=ye.total=0,se.msg="",ye.wrap&&(se.adler=ye.wrap&1),ye.mode=n,ye.last=0,ye.havedict=0,ye.dmax=32768,ye.head=null,ye.hold=0,ye.bits=0,ye.lencode=ye.lendyn=new M.Buf32(Fe),ye.distcode=ye.distdyn=new M.Buf32(Ue),ye.sane=1,ye.back=-1,p)}function Ne(se){var ye;return!se||!se.state?i:(ye=se.state,ye.wsize=0,ye.whave=0,ye.wnext=0,Ae(se))}function je(se,ye){var j,Ce;return!se||!se.state||(Ce=se.state,ye<0?(j=0,ye=-ye):(j=(ye>>4)+1,ye<48&&(ye&=15)),ye&&(ye<8||ye>15))?i:(Ce.window!==null&&Ce.wbits!==ye&&(Ce.window=null),Ce.wrap=j,Ce.wbits=ye,Ne(se))}function k(se,ye){var j,Ce;return se?(Ce=new Oe,se.state=Ce,Ce.window=null,j=je(se,ye),j!==p&&(se.state=null),j):i}function Z(se){return k(se,Re)}var Y=!0,ve,re;function Le(se){if(Y){var ye;for(ve=new M.Buf32(512),re=new M.Buf32(32),ye=0;ye<144;)se.lens[ye++]=8;for(;ye<256;)se.lens[ye++]=9;for(;ye<280;)se.lens[ye++]=7;for(;ye<288;)se.lens[ye++]=8;for(g(A,se.lens,0,288,ve,0,se.work,{bits:9}),ye=0;ye<32;)se.lens[ye++]=5;g(c,se.lens,0,32,re,0,se.work,{bits:5}),Y=!1}se.lencode=ve,se.lenbits=9,se.distcode=re,se.distbits=5}function Me(se,ye,j,Ce){var We,D=se.state;return D.window===null&&(D.wsize=1<<D.wbits,D.wnext=0,D.whave=0,D.window=new M.Buf8(D.wsize)),Ce>=D.wsize?(M.arraySet(D.window,ye,j-D.wsize,D.wsize,0),D.wnext=0,D.whave=D.wsize):(We=D.wsize-D.wnext,We>Ce&&(We=Ce),M.arraySet(D.window,ye,j-Ce,We,D.wnext),Ce-=We,Ce?(M.arraySet(D.window,ye,j-Ce,Ce,0),D.wnext=Ce,D.whave=D.wsize):(D.wnext+=We,D.wnext===D.wsize&&(D.wnext=0),D.whave<D.wsize&&(D.whave+=We))),0}function V(se,ye){var j,Ce,We,D,ue,ce,H,te,_e,ke,Ve,Ge,$e,xt,tt=0,et,Je,_t,dt,Ot,Dt,gt,vt,ct=new M.Buf8(4),At,yt,Bt=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!se||!se.state||!se.output||!se.input&&se.avail_in!==0)return i;j=se.state,j.mode===R&&(j.mode=z),ue=se.next_out,We=se.output,H=se.avail_out,D=se.next_in,Ce=se.input,ce=se.avail_in,te=j.hold,_e=j.bits,ke=ce,Ve=H,vt=p;e:for(;;)switch(j.mode){case n:if(j.wrap===0){j.mode=z;break}for(;_e<16;){if(ce===0)break e;ce--,te+=Ce[D++]<<_e,_e+=8}if(j.wrap&2&&te===35615){j.check=0,ct[0]=te&255,ct[1]=te>>>8&255,j.check=w(j.check,ct,2,0),te=0,_e=0,j.mode=f;break}if(j.flags=0,j.head&&(j.head.done=!1),!(j.wrap&1)||(((te&255)<<8)+(te>>8))%31){se.msg="incorrect header check",j.mode=me;break}if((te&15)!==t){se.msg="unknown compression method",j.mode=me;break}if(te>>>=4,_e-=4,gt=(te&15)+8,j.wbits===0)j.wbits=gt;else if(gt>j.wbits){se.msg="invalid window size",j.mode=me;break}j.dmax=1<<gt,se.adler=j.check=1,j.mode=te&512?I:R,te=0,_e=0;break;case f:for(;_e<16;){if(ce===0)break e;ce--,te+=Ce[D++]<<_e,_e+=8}if(j.flags=te,(j.flags&255)!==t){se.msg="unknown compression method",j.mode=me;break}if(j.flags&57344){se.msg="unknown header flags set",j.mode=me;break}j.head&&(j.head.text=te>>8&1),j.flags&512&&(ct[0]=te&255,ct[1]=te>>>8&255,j.check=w(j.check,ct,2,0)),te=0,_e=0,j.mode=o;case o:for(;_e<32;){if(ce===0)break e;ce--,te+=Ce[D++]<<_e,_e+=8}j.head&&(j.head.time=te),j.flags&512&&(ct[0]=te&255,ct[1]=te>>>8&255,ct[2]=te>>>16&255,ct[3]=te>>>24&255,j.check=w(j.check,ct,4,0)),te=0,_e=0,j.mode=v;case v:for(;_e<16;){if(ce===0)break e;ce--,te+=Ce[D++]<<_e,_e+=8}j.head&&(j.head.xflags=te&255,j.head.os=te>>8),j.flags&512&&(ct[0]=te&255,ct[1]=te>>>8&255,j.check=w(j.check,ct,2,0)),te=0,_e=0,j.mode=m;case m:if(j.flags&1024){for(;_e<16;){if(ce===0)break e;ce--,te+=Ce[D++]<<_e,_e+=8}j.length=te,j.head&&(j.head.extra_len=te),j.flags&512&&(ct[0]=te&255,ct[1]=te>>>8&255,j.check=w(j.check,ct,2,0)),te=0,_e=0}else j.head&&(j.head.extra=null);j.mode=E;case E:if(j.flags&1024&&(Ge=j.length,Ge>ce&&(Ge=ce),Ge&&(j.head&&(gt=j.head.extra_len-j.length,j.head.extra||(j.head.extra=new Array(j.head.extra_len)),M.arraySet(j.head.extra,Ce,D,Ge,gt)),j.flags&512&&(j.check=w(j.check,Ce,Ge,D)),ce-=Ge,D+=Ge,j.length-=Ge),j.length))break e;j.length=0,j.mode=S;case S:if(j.flags&2048){if(ce===0)break e;Ge=0;do gt=Ce[D+Ge++],j.head&&gt&&j.length<65536&&(j.head.name+=String.fromCharCode(gt));while(gt&&Ge<ce);if(j.flags&512&&(j.check=w(j.check,Ce,Ge,D)),ce-=Ge,D+=Ge,gt)break e}else j.head&&(j.head.name=null);j.length=0,j.mode=T;case T:if(j.flags&4096){if(ce===0)break e;Ge=0;do gt=Ce[D+Ge++],j.head&&gt&&j.length<65536&&(j.head.comment+=String.fromCharCode(gt));while(gt&&Ge<ce);if(j.flags&512&&(j.check=w(j.check,Ce,Ge,D)),ce-=Ge,D+=Ge,gt)break e}else j.head&&(j.head.comment=null);j.mode=P;case P:if(j.flags&512){for(;_e<16;){if(ce===0)break e;ce--,te+=Ce[D++]<<_e,_e+=8}if(te!==(j.check&65535)){se.msg="header crc mismatch",j.mode=me;break}te=0,_e=0}j.head&&(j.head.hcrc=j.flags>>9&1,j.head.done=!0),se.adler=j.check=0,j.mode=R;break;case I:for(;_e<32;){if(ce===0)break e;ce--,te+=Ce[D++]<<_e,_e+=8}se.adler=j.check=Pe(te),te=0,_e=0,j.mode=B;case B:if(j.havedict===0)return se.next_out=ue,se.avail_out=H,se.next_in=D,se.avail_in=ce,j.hold=te,j.bits=_e,e;se.adler=j.check=1,j.mode=R;case R:if(ye===b||ye===u)break e;case z:if(j.last){te>>>=_e&7,_e-=_e&7,j.mode=Se;break}for(;_e<3;){if(ce===0)break e;ce--,te+=Ce[D++]<<_e,_e+=8}switch(j.last=te&1,te>>>=1,_e-=1,te&3){case 0:j.mode=U;break;case 1:if(Le(j),j.mode=oe,ye===u){te>>>=2,_e-=2;break e}break;case 2:j.mode=N;break;case 3:se.msg="invalid block type",j.mode=me}te>>>=2,_e-=2;break;case U:for(te>>>=_e&7,_e-=_e&7;_e<32;){if(ce===0)break e;ce--,te+=Ce[D++]<<_e,_e+=8}if((te&65535)!==(te>>>16^65535)){se.msg="invalid stored block lengths",j.mode=me;break}if(j.length=te&65535,te=0,_e=0,j.mode=W,ye===u)break e;case W:j.mode=F;case F:if(Ge=j.length,Ge){if(Ge>ce&&(Ge=ce),Ge>H&&(Ge=H),Ge===0)break e;M.arraySet(We,Ce,D,Ge,ue),ce-=Ge,D+=Ge,H-=Ge,ue+=Ge,j.length-=Ge;break}j.mode=R;break;case N:for(;_e<14;){if(ce===0)break e;ce--,te+=Ce[D++]<<_e,_e+=8}if(j.nlen=(te&31)+257,te>>>=5,_e-=5,j.ndist=(te&31)+1,te>>>=5,_e-=5,j.ncode=(te&15)+4,te>>>=4,_e-=4,j.nlen>286||j.ndist>30){se.msg="too many length or distance symbols",j.mode=me;break}j.have=0,j.mode=q;case q:for(;j.have<j.ncode;){for(;_e<3;){if(ce===0)break e;ce--,te+=Ce[D++]<<_e,_e+=8}j.lens[Bt[j.have++]]=te&7,te>>>=3,_e-=3}for(;j.have<19;)j.lens[Bt[j.have++]]=0;if(j.lencode=j.lendyn,j.lenbits=7,At={bits:j.lenbits},vt=g(_,j.lens,0,19,j.lencode,0,j.work,At),j.lenbits=At.bits,vt){se.msg="invalid code lengths set",j.mode=me;break}j.have=0,j.mode=J;case J:for(;j.have<j.nlen+j.ndist;){for(;tt=j.lencode[te&(1<<j.lenbits)-1],et=tt>>>24,Je=tt>>>16&255,_t=tt&65535,!(et<=_e);){if(ce===0)break e;ce--,te+=Ce[D++]<<_e,_e+=8}if(_t<16)te>>>=et,_e-=et,j.lens[j.have++]=_t;else{if(_t===16){for(yt=et+2;_e<yt;){if(ce===0)break e;ce--,te+=Ce[D++]<<_e,_e+=8}if(te>>>=et,_e-=et,j.have===0){se.msg="invalid bit length repeat",j.mode=me;break}gt=j.lens[j.have-1],Ge=3+(te&3),te>>>=2,_e-=2}else if(_t===17){for(yt=et+3;_e<yt;){if(ce===0)break e;ce--,te+=Ce[D++]<<_e,_e+=8}te>>>=et,_e-=et,gt=0,Ge=3+(te&7),te>>>=3,_e-=3}else{for(yt=et+7;_e<yt;){if(ce===0)break e;ce--,te+=Ce[D++]<<_e,_e+=8}te>>>=et,_e-=et,gt=0,Ge=11+(te&127),te>>>=7,_e-=7}if(j.have+Ge>j.nlen+j.ndist){se.msg="invalid bit length repeat",j.mode=me;break}for(;Ge--;)j.lens[j.have++]=gt}}if(j.mode===me)break;if(j.lens[256]===0){se.msg="invalid code -- missing end-of-block",j.mode=me;break}if(j.lenbits=9,At={bits:j.lenbits},vt=g(A,j.lens,0,j.nlen,j.lencode,0,j.work,At),j.lenbits=At.bits,vt){se.msg="invalid literal/lengths set",j.mode=me;break}if(j.distbits=6,j.distcode=j.distdyn,At={bits:j.distbits},vt=g(c,j.lens,j.nlen,j.ndist,j.distcode,0,j.work,At),j.distbits=At.bits,vt){se.msg="invalid distances set",j.mode=me;break}if(j.mode=oe,ye===u)break e;case oe:j.mode=le;case le:if(ce>=6&&H>=258){se.next_out=ue,se.avail_out=H,se.next_in=D,se.avail_in=ce,j.hold=te,j.bits=_e,O(se,Ve),ue=se.next_out,We=se.output,H=se.avail_out,D=se.next_in,Ce=se.input,ce=se.avail_in,te=j.hold,_e=j.bits,j.mode===R&&(j.back=-1);break}for(j.back=0;tt=j.lencode[te&(1<<j.lenbits)-1],et=tt>>>24,Je=tt>>>16&255,_t=tt&65535,!(et<=_e);){if(ce===0)break e;ce--,te+=Ce[D++]<<_e,_e+=8}if(Je&&(Je&240)===0){for(dt=et,Ot=Je,Dt=_t;tt=j.lencode[Dt+((te&(1<<dt+Ot)-1)>>dt)],et=tt>>>24,Je=tt>>>16&255,_t=tt&65535,!(dt+et<=_e);){if(ce===0)break e;ce--,te+=Ce[D++]<<_e,_e+=8}te>>>=dt,_e-=dt,j.back+=dt}if(te>>>=et,_e-=et,j.back+=et,j.length=_t,Je===0){j.mode=Ee;break}if(Je&32){j.back=-1,j.mode=R;break}if(Je&64){se.msg="invalid literal/length code",j.mode=me;break}j.extra=Je&15,j.mode=fe;case fe:if(j.extra){for(yt=j.extra;_e<yt;){if(ce===0)break e;ce--,te+=Ce[D++]<<_e,_e+=8}j.length+=te&(1<<j.extra)-1,te>>>=j.extra,_e-=j.extra,j.back+=j.extra}j.was=j.length,j.mode=ie;case ie:for(;tt=j.distcode[te&(1<<j.distbits)-1],et=tt>>>24,Je=tt>>>16&255,_t=tt&65535,!(et<=_e);){if(ce===0)break e;ce--,te+=Ce[D++]<<_e,_e+=8}if((Je&240)===0){for(dt=et,Ot=Je,Dt=_t;tt=j.distcode[Dt+((te&(1<<dt+Ot)-1)>>dt)],et=tt>>>24,Je=tt>>>16&255,_t=tt&65535,!(dt+et<=_e);){if(ce===0)break e;ce--,te+=Ce[D++]<<_e,_e+=8}te>>>=dt,_e-=dt,j.back+=dt}if(te>>>=et,_e-=et,j.back+=et,Je&64){se.msg="invalid distance code",j.mode=me;break}j.offset=_t,j.extra=Je&15,j.mode=ne;case ne:if(j.extra){for(yt=j.extra;_e<yt;){if(ce===0)break e;ce--,te+=Ce[D++]<<_e,_e+=8}j.offset+=te&(1<<j.extra)-1,te>>>=j.extra,_e-=j.extra,j.back+=j.extra}if(j.offset>j.dmax){se.msg="invalid distance too far back",j.mode=me;break}j.mode=we;case we:if(H===0)break e;if(Ge=Ve-H,j.offset>Ge){if(Ge=j.offset-Ge,Ge>j.whave&&j.sane){se.msg="invalid distance too far back",j.mode=me;break}Ge>j.wnext?(Ge-=j.wnext,$e=j.wsize-Ge):$e=j.wnext-Ge,Ge>j.length&&(Ge=j.length),xt=j.window}else xt=We,$e=ue-j.offset,Ge=j.length;Ge>H&&(Ge=H),H-=Ge,j.length-=Ge;do We[ue++]=xt[$e++];while(--Ge);j.length===0&&(j.mode=le);break;case Ee:if(H===0)break e;We[ue++]=j.length,H--,j.mode=le;break;case Se:if(j.wrap){for(;_e<32;){if(ce===0)break e;ce--,te|=Ce[D++]<<_e,_e+=8}if(Ve-=H,se.total_out+=Ve,j.total+=Ve,Ve&&(se.adler=j.check=j.flags?w(j.check,We,Ve,ue-Ve):L(j.check,We,Ve,ue-Ve)),Ve=H,(j.flags?te:Pe(te))!==j.check){se.msg="incorrect data check",j.mode=me;break}te=0,_e=0}j.mode=de;case de:if(j.wrap&&j.flags){for(;_e<32;){if(ce===0)break e;ce--,te+=Ce[D++]<<_e,_e+=8}if(te!==(j.total&4294967295)){se.msg="incorrect length check",j.mode=me;break}te=0,_e=0}j.mode=ee;case ee:vt=r;break e;case me:vt=s;break e;case De:return a;case Ie:default:return i}return se.next_out=ue,se.avail_out=H,se.next_in=D,se.avail_in=ce,j.hold=te,j.bits=_e,(j.wsize||Ve!==se.avail_out&&j.mode<me&&(j.mode<Se||ye!==y))&&Me(se,se.output,se.next_out,Ve-se.avail_out),ke-=se.avail_in,Ve-=se.avail_out,se.total_in+=ke,se.total_out+=Ve,j.total+=Ve,j.wrap&&Ve&&(se.adler=j.check=j.flags?w(j.check,We,Ve,se.next_out-Ve):L(j.check,We,Ve,se.next_out-Ve)),se.data_type=j.bits+(j.last?64:0)+(j.mode===R?128:0)+(j.mode===oe||j.mode===W?256:0),(ke===0&&Ve===0||ye===y)&&vt===p&&(vt=h),vt}function ae(se){if(!se||!se.state)return i;var ye=se.state;return ye.window&&(ye.window=null),se.state=null,p}function pe(se,ye){var j;return!se||!se.state||(j=se.state,(j.wrap&2)===0)?i:(j.head=ye,ye.done=!1,p)}function Te(se,ye){var j=ye.length,Ce,We,D;return!se||!se.state||(Ce=se.state,Ce.wrap!==0&&Ce.mode!==B)?i:Ce.mode===B&&(We=1,We=L(We,ye,j,0),We!==Ce.check)?s:(D=Me(se,ye,j,j),D?(Ce.mode=De,a):(Ce.havedict=1,p))}C.inflateReset=Ne,C.inflateReset2=je,C.inflateResetKeep=Ae,C.inflateInit=Z,C.inflateInit2=k,C.inflate=V,C.inflateEnd=ae,C.inflateGetHeader=pe,C.inflateSetDictionary=Te,C.inflateInfo="pako inflate (from Nodeca project)"},"./node_modules/upng-js/node_modules/pako/lib/zlib/inftrees.js":(K,C,d)=>{var M=d("./node_modules/upng-js/node_modules/pako/lib/utils/common.js"),L=15,w=852,O=592,g=0,_=1,A=2,c=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],y=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],b=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],u=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];K.exports=function(r,e,i,s,a,h,t,n){var f=n.bits,o=0,v=0,m=0,E=0,S=0,T=0,P=0,I=0,B=0,R=0,z,U,W,F,N,q=null,J=0,oe,le=new M.Buf16(L+1),fe=new M.Buf16(L+1),ie=null,ne=0,we,Ee,Se;for(o=0;o<=L;o++)le[o]=0;for(v=0;v<s;v++)le[e[i+v]]++;for(S=f,E=L;E>=1&&le[E]===0;E--);if(S>E&&(S=E),E===0)return a[h++]=20971520,a[h++]=20971520,n.bits=1,0;for(m=1;m<E&&le[m]===0;m++);for(S<m&&(S=m),I=1,o=1;o<=L;o++)if(I<<=1,I-=le[o],I<0)return-1;if(I>0&&(r===g||E!==1))return-1;for(fe[1]=0,o=1;o<L;o++)fe[o+1]=fe[o]+le[o];for(v=0;v<s;v++)e[i+v]!==0&&(t[fe[e[i+v]]++]=v);if(r===g?(q=ie=t,oe=19):r===_?(q=c,J-=257,ie=y,ne-=257,oe=256):(q=b,ie=u,oe=-1),R=0,v=0,o=m,N=h,T=S,P=0,W=-1,B=1<<S,F=B-1,r===_&&B>w||r===A&&B>O)return 1;for(;;){we=o-P,t[v]<oe?(Ee=0,Se=t[v]):t[v]>oe?(Ee=ie[ne+t[v]],Se=q[J+t[v]]):(Ee=96,Se=0),z=1<<o-P,U=1<<T,m=U;do U-=z,a[N+(R>>P)+U]=we<<24|Ee<<16|Se|0;while(U!==0);for(z=1<<o-1;R&z;)z>>=1;if(z!==0?(R&=z-1,R+=z):R=0,v++,--le[o]===0){if(o===E)break;o=e[i+t[v]]}if(o>S&&(R&F)!==W){for(P===0&&(P=S),N+=m,T=o-P,I=1<<T;T+P<E&&(I-=le[T+P],!(I<=0));)T++,I<<=1;if(B+=1<<T,r===_&&B>w||r===A&&B>O)return 1;W=R&F,a[W]=S<<24|T<<16|N-h|0}}return R!==0&&(a[N+R]=o-P<<24|4194304|0),n.bits=S,0}},"./node_modules/upng-js/node_modules/pako/lib/zlib/messages.js":K=>{K.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},"./node_modules/upng-js/node_modules/pako/lib/zlib/trees.js":(K,C,d)=>{var M=d("./node_modules/upng-js/node_modules/pako/lib/utils/common.js"),L=4,w=0,O=1,g=2;function _(V){for(var ae=V.length;--ae>=0;)V[ae]=0}var A=0,c=1,y=2,b=3,u=258,p=29,r=256,e=r+1+p,i=30,s=19,a=2*e+1,h=15,t=16,n=7,f=256,o=16,v=17,m=18,E=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],S=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],T=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],P=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],I=512,B=new Array((e+2)*2);_(B);var R=new Array(i*2);_(R);var z=new Array(I);_(z);var U=new Array(u-b+1);_(U);var W=new Array(p);_(W);var F=new Array(i);_(F);function N(V,ae,pe,Te,se){this.static_tree=V,this.extra_bits=ae,this.extra_base=pe,this.elems=Te,this.max_length=se,this.has_stree=V&&V.length}var q,J,oe;function le(V,ae){this.dyn_tree=V,this.max_code=0,this.stat_desc=ae}function fe(V){return V<256?z[V]:z[256+(V>>>7)]}function ie(V,ae){V.pending_buf[V.pending++]=ae&255,V.pending_buf[V.pending++]=ae>>>8&255}function ne(V,ae,pe){V.bi_valid>t-pe?(V.bi_buf|=ae<<V.bi_valid&65535,ie(V,V.bi_buf),V.bi_buf=ae>>t-V.bi_valid,V.bi_valid+=pe-t):(V.bi_buf|=ae<<V.bi_valid&65535,V.bi_valid+=pe)}function we(V,ae,pe){ne(V,pe[ae*2],pe[ae*2+1])}function Ee(V,ae){var pe=0;do pe|=V&1,V>>>=1,pe<<=1;while(--ae>0);return pe>>>1}function Se(V){V.bi_valid===16?(ie(V,V.bi_buf),V.bi_buf=0,V.bi_valid=0):V.bi_valid>=8&&(V.pending_buf[V.pending++]=V.bi_buf&255,V.bi_buf>>=8,V.bi_valid-=8)}function de(V,ae){var pe=ae.dyn_tree,Te=ae.max_code,se=ae.stat_desc.static_tree,ye=ae.stat_desc.has_stree,j=ae.stat_desc.extra_bits,Ce=ae.stat_desc.extra_base,We=ae.stat_desc.max_length,D,ue,ce,H,te,_e,ke=0;for(H=0;H<=h;H++)V.bl_count[H]=0;for(pe[V.heap[V.heap_max]*2+1]=0,D=V.heap_max+1;D<a;D++)ue=V.heap[D],H=pe[pe[ue*2+1]*2+1]+1,H>We&&(H=We,ke++),pe[ue*2+1]=H,!(ue>Te)&&(V.bl_count[H]++,te=0,ue>=Ce&&(te=j[ue-Ce]),_e=pe[ue*2],V.opt_len+=_e*(H+te),ye&&(V.static_len+=_e*(se[ue*2+1]+te)));if(ke!==0){do{for(H=We-1;V.bl_count[H]===0;)H--;V.bl_count[H]--,V.bl_count[H+1]+=2,V.bl_count[We]--,ke-=2}while(ke>0);for(H=We;H!==0;H--)for(ue=V.bl_count[H];ue!==0;)ce=V.heap[--D],!(ce>Te)&&(pe[ce*2+1]!==H&&(V.opt_len+=(H-pe[ce*2+1])*pe[ce*2],pe[ce*2+1]=H),ue--)}}function ee(V,ae,pe){var Te=new Array(h+1),se=0,ye,j;for(ye=1;ye<=h;ye++)Te[ye]=se=se+pe[ye-1]<<1;for(j=0;j<=ae;j++){var Ce=V[j*2+1];Ce!==0&&(V[j*2]=Ee(Te[Ce]++,Ce))}}function me(){var V,ae,pe,Te,se,ye=new Array(h+1);for(pe=0,Te=0;Te<p-1;Te++)for(W[Te]=pe,V=0;V<1<<E[Te];V++)U[pe++]=Te;for(U[pe-1]=Te,se=0,Te=0;Te<16;Te++)for(F[Te]=se,V=0;V<1<<S[Te];V++)z[se++]=Te;for(se>>=7;Te<i;Te++)for(F[Te]=se<<7,V=0;V<1<<S[Te]-7;V++)z[256+se++]=Te;for(ae=0;ae<=h;ae++)ye[ae]=0;for(V=0;V<=143;)B[V*2+1]=8,V++,ye[8]++;for(;V<=255;)B[V*2+1]=9,V++,ye[9]++;for(;V<=279;)B[V*2+1]=7,V++,ye[7]++;for(;V<=287;)B[V*2+1]=8,V++,ye[8]++;for(ee(B,e+1,ye),V=0;V<i;V++)R[V*2+1]=5,R[V*2]=Ee(V,5);q=new N(B,E,r+1,e,h),J=new N(R,S,0,i,h),oe=new N(new Array(0),T,0,s,n)}function De(V){var ae;for(ae=0;ae<e;ae++)V.dyn_ltree[ae*2]=0;for(ae=0;ae<i;ae++)V.dyn_dtree[ae*2]=0;for(ae=0;ae<s;ae++)V.bl_tree[ae*2]=0;V.dyn_ltree[f*2]=1,V.opt_len=V.static_len=0,V.last_lit=V.matches=0}function Ie(V){V.bi_valid>8?ie(V,V.bi_buf):V.bi_valid>0&&(V.pending_buf[V.pending++]=V.bi_buf),V.bi_buf=0,V.bi_valid=0}function Fe(V,ae,pe,Te){Ie(V),ie(V,pe),ie(V,~pe),M.arraySet(V.pending_buf,V.window,ae,pe,V.pending),V.pending+=pe}function Ue(V,ae,pe,Te){var se=ae*2,ye=pe*2;return V[se]<V[ye]||V[se]===V[ye]&&Te[ae]<=Te[pe]}function ze(V,ae,pe){for(var Te=V.heap[pe],se=pe<<1;se<=V.heap_len&&(se<V.heap_len&&Ue(ae,V.heap[se+1],V.heap[se],V.depth)&&se++,!Ue(ae,Te,V.heap[se],V.depth));)V.heap[pe]=V.heap[se],pe=se,se<<=1;V.heap[pe]=Te}function Re(V,ae,pe){var Te,se,ye=0,j,Ce;if(V.last_lit!==0)do Te=V.pending_buf[V.d_buf+ye*2]<<8|V.pending_buf[V.d_buf+ye*2+1],se=V.pending_buf[V.l_buf+ye],ye++,Te===0?we(V,se,ae):(j=U[se],we(V,j+r+1,ae),Ce=E[j],Ce!==0&&(se-=W[j],ne(V,se,Ce)),Te--,j=fe(Te),we(V,j,pe),Ce=S[j],Ce!==0&&(Te-=F[j],ne(V,Te,Ce)));while(ye<V.last_lit);we(V,f,ae)}function Pe(V,ae){var pe=ae.dyn_tree,Te=ae.stat_desc.static_tree,se=ae.stat_desc.has_stree,ye=ae.stat_desc.elems,j,Ce,We=-1,D;for(V.heap_len=0,V.heap_max=a,j=0;j<ye;j++)pe[j*2]!==0?(V.heap[++V.heap_len]=We=j,V.depth[j]=0):pe[j*2+1]=0;for(;V.heap_len<2;)D=V.heap[++V.heap_len]=We<2?++We:0,pe[D*2]=1,V.depth[D]=0,V.opt_len--,se&&(V.static_len-=Te[D*2+1]);for(ae.max_code=We,j=V.heap_len>>1;j>=1;j--)ze(V,pe,j);D=ye;do j=V.heap[1],V.heap[1]=V.heap[V.heap_len--],ze(V,pe,1),Ce=V.heap[1],V.heap[--V.heap_max]=j,V.heap[--V.heap_max]=Ce,pe[D*2]=pe[j*2]+pe[Ce*2],V.depth[D]=(V.depth[j]>=V.depth[Ce]?V.depth[j]:V.depth[Ce])+1,pe[j*2+1]=pe[Ce*2+1]=D,V.heap[1]=D++,ze(V,pe,1);while(V.heap_len>=2);V.heap[--V.heap_max]=V.heap[1],de(V,ae),ee(pe,We,V.bl_count)}function Oe(V,ae,pe){var Te,se=-1,ye,j=ae[0*2+1],Ce=0,We=7,D=4;for(j===0&&(We=138,D=3),ae[(pe+1)*2+1]=65535,Te=0;Te<=pe;Te++)ye=j,j=ae[(Te+1)*2+1],!(++Ce<We&&ye===j)&&(Ce<D?V.bl_tree[ye*2]+=Ce:ye!==0?(ye!==se&&V.bl_tree[ye*2]++,V.bl_tree[o*2]++):Ce<=10?V.bl_tree[v*2]++:V.bl_tree[m*2]++,Ce=0,se=ye,j===0?(We=138,D=3):ye===j?(We=6,D=3):(We=7,D=4))}function Ae(V,ae,pe){var Te,se=-1,ye,j=ae[0*2+1],Ce=0,We=7,D=4;for(j===0&&(We=138,D=3),Te=0;Te<=pe;Te++)if(ye=j,j=ae[(Te+1)*2+1],!(++Ce<We&&ye===j)){if(Ce<D)do we(V,ye,V.bl_tree);while(--Ce!==0);else ye!==0?(ye!==se&&(we(V,ye,V.bl_tree),Ce--),we(V,o,V.bl_tree),ne(V,Ce-3,2)):Ce<=10?(we(V,v,V.bl_tree),ne(V,Ce-3,3)):(we(V,m,V.bl_tree),ne(V,Ce-11,7));Ce=0,se=ye,j===0?(We=138,D=3):ye===j?(We=6,D=3):(We=7,D=4)}}function Ne(V){var ae;for(Oe(V,V.dyn_ltree,V.l_desc.max_code),Oe(V,V.dyn_dtree,V.d_desc.max_code),Pe(V,V.bl_desc),ae=s-1;ae>=3&&V.bl_tree[P[ae]*2+1]===0;ae--);return V.opt_len+=3*(ae+1)+5+5+4,ae}function je(V,ae,pe,Te){var se;for(ne(V,ae-257,5),ne(V,pe-1,5),ne(V,Te-4,4),se=0;se<Te;se++)ne(V,V.bl_tree[P[se]*2+1],3);Ae(V,V.dyn_ltree,ae-1),Ae(V,V.dyn_dtree,pe-1)}function k(V){var ae=4093624447,pe;for(pe=0;pe<=31;pe++,ae>>>=1)if(ae&1&&V.dyn_ltree[pe*2]!==0)return w;if(V.dyn_ltree[18]!==0||V.dyn_ltree[20]!==0||V.dyn_ltree[26]!==0)return O;for(pe=32;pe<r;pe++)if(V.dyn_ltree[pe*2]!==0)return O;return w}var Z=!1;function Y(V){Z||(me(),Z=!0),V.l_desc=new le(V.dyn_ltree,q),V.d_desc=new le(V.dyn_dtree,J),V.bl_desc=new le(V.bl_tree,oe),V.bi_buf=0,V.bi_valid=0,De(V)}function ve(V,ae,pe,Te){ne(V,(A<<1)+(Te?1:0),3),Fe(V,ae,pe)}function re(V){ne(V,c<<1,3),we(V,f,B),Se(V)}function Le(V,ae,pe,Te){var se,ye,j=0;V.level>0?(V.strm.data_type===g&&(V.strm.data_type=k(V)),Pe(V,V.l_desc),Pe(V,V.d_desc),j=Ne(V),se=V.opt_len+3+7>>>3,ye=V.static_len+3+7>>>3,ye<=se&&(se=ye)):se=ye=pe+5,pe+4<=se&&ae!==-1?ve(V,ae,pe,Te):V.strategy===L||ye===se?(ne(V,(c<<1)+(Te?1:0),3),Re(V,B,R)):(ne(V,(y<<1)+(Te?1:0),3),je(V,V.l_desc.max_code+1,V.d_desc.max_code+1,j+1),Re(V,V.dyn_ltree,V.dyn_dtree)),De(V),Te&&Ie(V)}function Me(V,ae,pe){return V.pending_buf[V.d_buf+V.last_lit*2]=ae>>>8&255,V.pending_buf[V.d_buf+V.last_lit*2+1]=ae&255,V.pending_buf[V.l_buf+V.last_lit]=pe&255,V.last_lit++,ae===0?V.dyn_ltree[pe*2]++:(V.matches++,ae--,V.dyn_ltree[(U[pe]+r+1)*2]++,V.dyn_dtree[fe(ae)*2]++),V.last_lit===V.lit_bufsize-1}C._tr_init=Y,C._tr_stored_block=ve,C._tr_flush_block=Le,C._tr_tally=Me,C._tr_align=re},"./node_modules/upng-js/node_modules/pako/lib/zlib/zstream.js":K=>{function C(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}K.exports=C},"./src/SurfaceWorker.js":()=>{$3Dmol.workerString=(function(){self.onmessage=function(K){var C=K.data,d=C.type;if(d<0)self.atomData=C.atoms,self.volume=C.volume,self.ps=new ProteinSurface;else{var M=self.ps;M.initparm(C.expandedExtent,d!=1,self.volume),M.fillvoxels(self.atomData,C.extendedAtoms),M.buildboundary(),(d===4||d===2)&&(M.fastdistancemap(),M.boundingatom(!1),M.fillvoxelswaals(self.atomData,C.extendedAtoms)),M.marchingcube(d);var L=M.getFacesAndVertices(C.atomsToShow);self.postMessage(L)}}}).toString().replace(/(^.*?\{|\}$)/g,""),$3Dmol.workerString+=`;
function _classCallCheck() {};`,$3Dmol.workerString+=`;
`+$3Dmol.Vector3.toString(),$3Dmol.workerString+=`;
`+$3Dmol.MarchingCubeInitializer.toString()+`;

`,$3Dmol.workerString+=`;
`+$3Dmol.PointGrid.toString()+`;
`,$3Dmol.workerString+=`;
var ProteinSurface = `+$3Dmol.ProteinSurface.toString()+`;
`,$3Dmol.SurfaceWorker=window.URL?window.URL.createObjectURL(new Blob([$3Dmol.workerString],{type:"text/javascript"})):void 0},"./src/exporter.js":K=>{typeof K.exports=="object"&&(K.exports=window.$3Dmol)},"./src/vendor/mmtf.js":function(K,C){(function(d,M){M(C)})(this,function(d){function M(k,Z,Y){for(var ve=(k.byteLength,0),re=Y.length;re>ve;ve++){var Le=Y.charCodeAt(ve);if(128>Le)k.setUint8(Z++,Le>>>0&127|0);else if(2048>Le)k.setUint8(Z++,Le>>>6&31|192),k.setUint8(Z++,Le>>>0&63|128);else if(65536>Le)k.setUint8(Z++,Le>>>12&15|224),k.setUint8(Z++,Le>>>6&63|128),k.setUint8(Z++,Le>>>0&63|128);else{if(!(1114112>Le))throw new Error("bad codepoint "+Le);k.setUint8(Z++,Le>>>18&7|240),k.setUint8(Z++,Le>>>12&63|128),k.setUint8(Z++,Le>>>6&63|128),k.setUint8(Z++,Le>>>0&63|128)}}}function L(k){for(var Z=0,Y=0,ve=k.length;ve>Y;Y++){var re=k.charCodeAt(Y);if(128>re)Z+=1;else if(2048>re)Z+=2;else if(65536>re)Z+=3;else{if(!(1114112>re))throw new Error("bad codepoint "+re);Z+=4}}return Z}function w(k,Z,Y){var ve=typeof k;if(ve==="string"){var re=L(k);if(32>re)return Z.setUint8(Y,160|re),M(Z,Y+1,k),1+re;if(256>re)return Z.setUint8(Y,217),Z.setUint8(Y+1,re),M(Z,Y+2,k),2+re;if(65536>re)return Z.setUint8(Y,218),Z.setUint16(Y+1,re),M(Z,Y+3,k),3+re;if(4294967296>re)return Z.setUint8(Y,219),Z.setUint32(Y+1,re),M(Z,Y+5,k),5+re}if(k instanceof Uint8Array){var re=k.byteLength,Le=new Uint8Array(Z.buffer);if(256>re)return Z.setUint8(Y,196),Z.setUint8(Y+1,re),Le.set(k,Y+2),2+re;if(65536>re)return Z.setUint8(Y,197),Z.setUint16(Y+1,re),Le.set(k,Y+3),3+re;if(4294967296>re)return Z.setUint8(Y,198),Z.setUint32(Y+1,re),Le.set(k,Y+5),5+re}if(ve==="number"){if(!isFinite(k))throw new Error("Number not finite: "+k);if(Math.floor(k)!==k)return Z.setUint8(Y,203),Z.setFloat64(Y+1,k),9;if(k>=0){if(128>k)return Z.setUint8(Y,k),1;if(256>k)return Z.setUint8(Y,204),Z.setUint8(Y+1,k),2;if(65536>k)return Z.setUint8(Y,205),Z.setUint16(Y+1,k),3;if(4294967296>k)return Z.setUint8(Y,206),Z.setUint32(Y+1,k),5;throw new Error("Number too big 0x"+k.toString(16))}if(k>=-32)return Z.setInt8(Y,k),1;if(k>=-128)return Z.setUint8(Y,208),Z.setInt8(Y+1,k),2;if(k>=-32768)return Z.setUint8(Y,209),Z.setInt16(Y+1,k),3;if(k>=-2147483648)return Z.setUint8(Y,210),Z.setInt32(Y+1,k),5;throw new Error("Number too small -0x"+(-k).toString(16).substr(1))}if(k===null)return Z.setUint8(Y,192),1;if(ve==="boolean")return Z.setUint8(Y,k?195:194),1;if(ve==="object"){var re,ae=0,Me=Array.isArray(k);if(Me)re=k.length;else{var V=Object.keys(k);re=V.length}var ae;if(16>re?(Z.setUint8(Y,re|(Me?144:128)),ae=1):65536>re?(Z.setUint8(Y,Me?220:222),Z.setUint16(Y+1,re),ae=3):4294967296>re&&(Z.setUint8(Y,Me?221:223),Z.setUint32(Y+1,re),ae=5),Me)for(var pe=0;re>pe;pe++)ae+=w(k[pe],Z,Y+ae);else for(var pe=0;re>pe;pe++){var Te=V[pe];ae+=w(Te,Z,Y+ae),ae+=w(k[Te],Z,Y+ae)}return ae}throw new Error("Unknown type "+ve)}function O(k){var Z=typeof k;if(Z==="string"){var Y=L(k);if(32>Y)return 1+Y;if(256>Y)return 2+Y;if(65536>Y)return 3+Y;if(4294967296>Y)return 5+Y}if(k instanceof Uint8Array){var Y=k.byteLength;if(256>Y)return 2+Y;if(65536>Y)return 3+Y;if(4294967296>Y)return 5+Y}if(Z==="number"){if(Math.floor(k)!==k)return 9;if(k>=0){if(128>k)return 1;if(256>k)return 2;if(65536>k)return 3;if(4294967296>k)return 5;throw new Error("Number too big 0x"+k.toString(16))}if(k>=-32)return 1;if(k>=-128)return 2;if(k>=-32768)return 3;if(k>=-2147483648)return 5;throw new Error("Number too small -0x"+k.toString(16).substr(1))}if(Z==="boolean"||k===null)return 1;if(Z==="object"){var Y,ve=0;if(Array.isArray(k)){Y=k.length;for(var re=0;Y>re;re++)ve+=O(k[re])}else{var Le=Object.keys(k);Y=Le.length;for(var re=0;Y>re;re++){var Me=Le[re];ve+=O(Me)+O(k[Me])}}if(16>Y)return 1+ve;if(65536>Y)return 3+ve;if(4294967296>Y)return 5+ve;throw new Error("Array or object too long 0x"+Y.toString(16))}throw new Error("Unknown type "+Z)}function g(k){var Z=new ArrayBuffer(O(k)),Y=new DataView(Z);return w(k,Y,0),new Uint8Array(Z)}function _(k,Z,Y){return Z?new k(Z.buffer,Z.byteOffset,Z.byteLength/(Y||1)):void 0}function A(k){return _(DataView,k)}function c(k){return _(Uint8Array,k)}function y(k){return _(Int8Array,k)}function b(k){return _(Int32Array,k,4)}function u(k){return _(Float32Array,k,4)}function p(k,Z){var Y=k.length/2;Z||(Z=new Int16Array(Y));for(var ve=0,re=0;Y>ve;++ve,re+=2)Z[ve]=k[re]<<8^k[re+1]<<0;return Z}function r(k,Z){var Y=k.length;Z||(Z=new Uint8Array(2*Y));for(var ve=A(Z),re=0;Y>re;++re)ve.setInt16(2*re,k[re]);return c(Z)}function e(k,Z){var Y=k.length/4;Z||(Z=new Int32Array(Y));for(var ve=0,re=0;Y>ve;++ve,re+=4)Z[ve]=k[re]<<24^k[re+1]<<16^k[re+2]<<8^k[re+3]<<0;return Z}function i(k,Z){var Y=k.length;Z||(Z=new Uint8Array(4*Y));for(var ve=A(Z),re=0;Y>re;++re)ve.setInt32(4*re,k[re]);return c(Z)}function s(k,Z){var Y=k.length;Z||(Z=new Float32Array(Y/4));for(var ve=A(Z),re=A(k),Le=0,Me=0,V=Y/4;V>Le;++Le,Me+=4)ve.setFloat32(Me,re.getFloat32(Me),!0);return Z}function a(k,Z,Y){var ve=k.length,re=1/Z;Y||(Y=new Float32Array(ve));for(var Le=0;ve>Le;++Le)Y[Le]=k[Le]*re;return Y}function h(k,Z,Y){var ve=k.length;Y||(Y=new Int32Array(ve));for(var re=0;ve>re;++re)Y[re]=Math.round(k[re]*Z);return Y}function t(k,Z){var Y,ve;if(!Z){var re=0;for(Y=0,ve=k.length;ve>Y;Y+=2)re+=k[Y+1];Z=new k.constructor(re)}var Le=0;for(Y=0,ve=k.length;ve>Y;Y+=2)for(var Me=k[Y],V=k[Y+1],ae=0;V>ae;++ae)Z[Le]=Me,++Le;return Z}function n(k){if(k.length===0)return new Int32Array;var Z,Y,ve=2;for(Z=1,Y=k.length;Y>Z;++Z)k[Z-1]!==k[Z]&&(ve+=2);var re=new Int32Array(ve),Le=0,Me=1;for(Z=1,Y=k.length;Y>Z;++Z)k[Z-1]!==k[Z]?(re[Le]=k[Z-1],re[Le+1]=Me,Me=1,Le+=2):++Me;return re[Le]=k[k.length-1],re[Le+1]=Me,re}function f(k,Z){var Y=k.length;Z||(Z=new k.constructor(Y)),Y&&(Z[0]=k[0]);for(var ve=1;Y>ve;++ve)Z[ve]=k[ve]+Z[ve-1];return Z}function o(k,Z){var Y=k.length;Z||(Z=new k.constructor(Y)),Z[0]=k[0];for(var ve=1;Y>ve;++ve)Z[ve]=k[ve]-k[ve-1];return Z}function v(k,Z){var Y,ve,re=k instanceof Int8Array?127:32767,Le=-re-1,Me=k.length;if(!Z){var V=0;for(Y=0;Me>Y;++Y)k[Y]<re&&k[Y]>Le&&++V;Z=new Int32Array(V)}for(Y=0,ve=0;Me>Y;){for(var ae=0;k[Y]===re||k[Y]===Le;)ae+=k[Y],++Y;ae+=k[Y],++Y,Z[ve]=ae,++ve}return Z}function m(k,Z){var Y,ve=32767,re=-32768,Le=k.length,Me=0;for(Y=0;Le>Y;++Y){var V=k[Y];V===0?++Me:V>0?(Me+=Math.ceil(V/ve),V%ve===0&&(Me+=1)):(Me+=Math.ceil(V/re),V%re===0&&(Me+=1))}var ae=Z?new Int8Array(Me):new Int16Array(Me),pe=0;for(Y=0;Le>Y;++Y){var V=k[Y];if(V>=0)for(;V>=ve;)ae[pe]=ve,++pe,V-=ve;else for(;re>=V;)ae[pe]=re,++pe,V-=re;ae[pe]=V,++pe}return ae}function E(k,Z){return f(t(k),Z)}function S(k){return n(o(k))}function T(k,Z,Y){return a(t(k,b(Y)),Z,Y)}function P(k,Z){return n(h(k,Z))}function I(k,Z,Y){return a(f(k,b(Y)),Z,Y)}function B(k,Z,Y){return o(h(k,Z),Y)}function R(k,Z,Y){return a(v(k,b(Y)),Z,Y)}function z(k,Z,Y){var ve=v(k,b(Y));return I(ve,Z,u(ve))}function U(k,Z,Y){return m(B(k,Z),Y)}function W(Le){var Z=A(Le),Y=Z.getInt32(0),ve=Z.getInt32(4),re=Le.subarray(8,12),Le=Le.subarray(12);return[Y,Le,ve,re]}function F(k,Z,Y,ve){var re=new ArrayBuffer(12+ve.byteLength),Le=new Uint8Array(re),Me=new DataView(re);return Me.setInt32(0,k),Me.setInt32(4,Z),Y&&Le.set(Y,8),Le.set(ve,12),Le}function N(k){var Z=k.length,Y=c(k);return F(2,Z,void 0,Y)}function q(k){var Z=k.length,Y=i(k);return F(4,Z,void 0,Y)}function J(k,Z){var Y=k.length/Z,ve=i([Z]),re=c(k);return F(5,Y,ve,re)}function oe(k){var Z=k.length,Y=i(n(k));return F(6,Z,void 0,Y)}function le(k){var Z=k.length,Y=i(S(k));return F(8,Z,void 0,Y)}function fe(k,Z){var Y=k.length,ve=i([Z]),re=i(P(k,Z));return F(9,Y,ve,re)}function ie(k,Z){var Y=k.length,ve=i([Z]),re=r(U(k,Z));return F(10,Y,ve,re)}function ne(k){var Z={};return ze.forEach(function(Y){k[Y]!==void 0&&(Z[Y]=k[Y])}),k.bondAtomList&&(Z.bondAtomList=q(k.bondAtomList)),k.bondOrderList&&(Z.bondOrderList=N(k.bondOrderList)),Z.xCoordList=ie(k.xCoordList,1e3),Z.yCoordList=ie(k.yCoordList,1e3),Z.zCoordList=ie(k.zCoordList,1e3),k.bFactorList&&(Z.bFactorList=ie(k.bFactorList,100)),k.atomIdList&&(Z.atomIdList=le(k.atomIdList)),k.altLocList&&(Z.altLocList=oe(k.altLocList)),k.occupancyList&&(Z.occupancyList=fe(k.occupancyList,100)),Z.groupIdList=le(k.groupIdList),Z.groupTypeList=q(k.groupTypeList),k.secStructList&&(Z.secStructList=N(k.secStructList)),k.insCodeList&&(Z.insCodeList=oe(k.insCodeList)),k.sequenceIndexList&&(Z.sequenceIndexList=le(k.sequenceIndexList)),Z.chainIdList=J(k.chainIdList,4),k.chainNameList&&(Z.chainNameList=J(k.chainNameList,4)),Z}function we(k){function Z(ae){for(var pe={},Te=0;ae>Te;Te++){var se=Le();pe[se]=Le()}return pe}function Y(ae){var pe=k.subarray(Me,Me+ae);return Me+=ae,pe}function ve(ae){var pe=k.subarray(Me,Me+ae);Me+=ae;var Te=65535;if(ae>Te){for(var se=[],ye=0;ye<pe.length;ye+=Te)se.push(String.fromCharCode.apply(null,pe.subarray(ye,ye+Te)));return se.join("")}return String.fromCharCode.apply(null,pe)}function re(ae){for(var pe=new Array(ae),Te=0;ae>Te;Te++)pe[Te]=Le();return pe}function Le(){var ae,pe,Te=k[Me];if((128&Te)===0)return Me++,Te;if((240&Te)===128)return pe=15&Te,Me++,Z(pe);if((240&Te)===144)return pe=15&Te,Me++,re(pe);if((224&Te)===160)return pe=31&Te,Me++,ve(pe);if((224&Te)===224)return ae=V.getInt8(Me),Me++,ae;switch(Te){case 192:return Me++,null;case 194:return Me++,!1;case 195:return Me++,!0;case 196:return pe=V.getUint8(Me+1),Me+=2,Y(pe);case 197:return pe=V.getUint16(Me+1),Me+=3,Y(pe);case 198:return pe=V.getUint32(Me+1),Me+=5,Y(pe);case 202:return ae=V.getFloat32(Me+1),Me+=5,ae;case 203:return ae=V.getFloat64(Me+1),Me+=9,ae;case 204:return ae=k[Me+1],Me+=2,ae;case 205:return ae=V.getUint16(Me+1),Me+=3,ae;case 206:return ae=V.getUint32(Me+1),Me+=5,ae;case 208:return ae=V.getInt8(Me+1),Me+=2,ae;case 209:return ae=V.getInt16(Me+1),Me+=3,ae;case 210:return ae=V.getInt32(Me+1),Me+=5,ae;case 217:return pe=V.getUint8(Me+1),Me+=2,ve(pe);case 218:return pe=V.getUint16(Me+1),Me+=3,ve(pe);case 219:return pe=V.getUint32(Me+1),Me+=5,ve(pe);case 220:return pe=V.getUint16(Me+1),Me+=3,re(pe);case 221:return pe=V.getUint32(Me+1),Me+=5,re(pe);case 222:return pe=V.getUint16(Me+1),Me+=3,Z(pe);case 223:return pe=V.getUint32(Me+1),Me+=5,Z(pe)}throw new Error("Unknown type 0x"+Te.toString(16))}var Me=0,V=new DataView(k.buffer);return Le()}function Ee(k,Z,Y,ve){switch(k){case 1:return s(Z);case 2:return y(Z);case 3:return p(Z);case 4:return e(Z);case 5:return c(Z);case 6:return t(e(Z),new Uint8Array(Y));case 7:return t(e(Z));case 8:return E(e(Z));case 9:return T(e(Z),e(ve)[0]);case 10:return z(p(Z),e(ve)[0]);case 11:return a(p(Z),e(ve)[0]);case 12:return R(p(Z),e(ve)[0]);case 13:return R(y(Z),e(ve)[0]);case 14:return v(p(Z));case 15:return v(y(Z))}}function Se(k,Z){Z=Z||{};var Y=Z.ignoreFields,ve={};return Pe.forEach(function(re){var Le=Y?Y.indexOf(re)!==-1:!1,Me=k[re];Le||Me===void 0||(Me instanceof Uint8Array?ve[re]=Ee.apply(null,W(Me)):ve[re]=Me)}),ve}function de(k){return String.fromCharCode.apply(null,k).replace(/\0/g,"")}function ee(k,Z,Y){Y=Y||{};var ve,re,Le,Me,V,ae,pe=Y.firstModelOnly,Te=Z.onModel,se=Z.onChain,ye=Z.onGroup,j=Z.onAtom,Ce=Z.onBond,We=0,D=0,ue=0,ce=0,H=0,te=-1,_e=k.chainNameList,ke=k.secStructList,Ve=k.insCodeList,Ge=k.sequenceIndexList,$e=k.atomIdList,xt=k.bFactorList,tt=k.altLocList,et=k.occupancyList,Je=k.bondAtomList,_t=k.bondOrderList;for(ve=0,re=k.chainsPerModel.length;re>ve&&!(pe&&We>0);++ve){var dt=k.chainsPerModel[We];for(Te&&Te({chainCount:dt,modelIndex:We}),Le=0;dt>Le;++Le){var Ot=k.groupsPerChain[D];if(se){var Dt=de(k.chainIdList.subarray(4*D,4*D+4)),gt=null;_e&&(gt=de(_e.subarray(4*D,4*D+4))),se({groupCount:Ot,chainIndex:D,modelIndex:We,chainId:Dt,chainName:gt})}for(Me=0;Ot>Me;++Me){var vt=k.groupList[k.groupTypeList[ue]],ct=vt.atomNameList.length;if(ye){var At=null;ke&&(At=ke[ue]);var yt=null;k.insCodeList&&(yt=String.fromCharCode(Ve[ue]));var Bt=null;Ge&&(Bt=Ge[ue]),ye({atomCount:ct,groupIndex:ue,chainIndex:D,modelIndex:We,groupId:k.groupIdList[ue],groupType:k.groupTypeList[ue],groupName:vt.groupName,singleLetterCode:vt.singleLetterCode,chemCompType:vt.chemCompType,secStruct:At,insCode:yt,sequenceIndex:Bt})}for(V=0;ct>V;++V){if(j){var oi=null;$e&&(oi=$e[ce]);var Ft=null;xt&&(Ft=xt[ce]);var li=null;tt&&(li=String.fromCharCode(tt[ce]));var hi=null;et&&(hi=et[ce]),j({atomIndex:ce,groupIndex:ue,chainIndex:D,modelIndex:We,atomId:oi,element:vt.elementList[V],atomName:vt.atomNameList[V],formalCharge:vt.formalChargeList[V],xCoord:k.xCoordList[ce],yCoord:k.yCoordList[ce],zCoord:k.zCoordList[ce],bFactor:Ft,altLoc:li,occupancy:hi})}ce+=1}if(Ce){var fi=vt.bondAtomList;for(V=0,ae=vt.bondOrderList.length;ae>V;++V)Ce({atomIndex1:ce-ct+fi[2*V],atomIndex2:ce-ct+fi[2*V+1],bondOrder:vt.bondOrderList[V]})}ue+=1}D+=1}if(H=te+1,te=ce-1,Ce&&Je)for(V=0,ae=Je.length;ae>V;V+=2){var di=Je[V],ci=Je[V+1];(di>=H&&te>=di||ci>=H&&te>=ci)&&Ce({atomIndex1:di,atomIndex2:ci,bondOrder:_t?_t[V/2]:null})}We+=1}}function me(k){return g(ne(k))}function De(k,Z){k instanceof ArrayBuffer&&(k=new Uint8Array(k));var Y;return Y=k instanceof Uint8Array?we(k):k,Se(Y,Z)}function Ie(k,Z,Y,ve){function re(){try{var Me=De(Le.response);Y(Me)}catch(V){ve(V)}}var Le=new XMLHttpRequest;Le.addEventListener("load",re,!0),Le.addEventListener("error",ve,!0),Le.responseType="arraybuffer",Le.open("GET",Z+k.toUpperCase()),Le.send()}function Fe(k,Z,Y){Ie(k,Ne,Z,Y)}function Ue(k,Z,Y){Ie(k,je,Z,Y)}var ze=["mmtfVersion","mmtfProducer","unitCell","spaceGroup","structureId","title","depositionDate","releaseDate","experimentalMethods","resolution","rFree","rWork","bioAssemblyList","ncsOperatorList","entityList","groupList","numBonds","numAtoms","numGroups","numChains","numModels","groupsPerChain","chainsPerModel"],Re=["xCoordList","yCoordList","zCoordList","groupIdList","groupTypeList","chainIdList","bFactorList","atomIdList","altLocList","occupancyList","secStructList","insCodeList","sequenceIndexList","chainNameList","bondAtomList","bondOrderList"],Pe=ze.concat(Re),Oe="v1.0.1",Ae="//mmtf.rcsb.org/v1.0/",Ne=Ae+"full/",je=Ae+"reduced/";d.encode=me,d.decode=De,d.traverse=ee,d.fetch=Fe,d.fetchReduced=Ue,d.version=Oe,d.fetchUrl=Ne,d.fetchReducedUrl=je,d.encodeMsgpack=g,d.encodeMmtf=ne,d.decodeMsgpack=we,d.decodeMmtf=Se})},"./node_modules/pako/dist/pako.esm.mjs":(K,C,d)=>{d.r(C),d.d(C,{Deflate:()=>Ur,Inflate:()=>Vr,constants:()=>Kr,default:()=>Gs,deflate:()=>Wr,deflateRaw:()=>Gr,gzip:()=>Nr,inflate:()=>jr,inflateRaw:()=>kr,ungzip:()=>Hr});/*! pako 2.1.0 https://github.com/nodeca/pako @license (MIT AND Zlib) */const M=4,L=0,w=1,O=2;function g(l){let G=l.length;for(;--G>=0;)l[G]=0}const _=0,A=1,c=2,y=3,b=258,u=29,p=256,r=p+1+u,e=30,i=19,s=2*r+1,a=15,h=16,t=7,n=256,f=16,o=17,v=18,m=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),E=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),S=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),T=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),P=512,I=new Array((r+2)*2);g(I);const B=new Array(e*2);g(B);const R=new Array(P);g(R);const z=new Array(b-y+1);g(z);const U=new Array(u);g(U);const W=new Array(e);g(W);function F(l,G,x,X,Q){this.static_tree=l,this.extra_bits=G,this.extra_base=x,this.elems=X,this.max_length=Q,this.has_stree=l&&l.length}let N,q,J;function oe(l,G){this.dyn_tree=l,this.max_code=0,this.stat_desc=G}const le=l=>l<256?R[l]:R[256+(l>>>7)],fe=(l,G)=>{l.pending_buf[l.pending++]=G&255,l.pending_buf[l.pending++]=G>>>8&255},ie=(l,G,x)=>{l.bi_valid>h-x?(l.bi_buf|=G<<l.bi_valid&65535,fe(l,l.bi_buf),l.bi_buf=G>>h-l.bi_valid,l.bi_valid+=x-h):(l.bi_buf|=G<<l.bi_valid&65535,l.bi_valid+=x)},ne=(l,G,x)=>{ie(l,x[G*2],x[G*2+1])},we=(l,G)=>{let x=0;do x|=l&1,l>>>=1,x<<=1;while(--G>0);return x>>>1},Ee=l=>{l.bi_valid===16?(fe(l,l.bi_buf),l.bi_buf=0,l.bi_valid=0):l.bi_valid>=8&&(l.pending_buf[l.pending++]=l.bi_buf&255,l.bi_buf>>=8,l.bi_valid-=8)},Se=(l,G)=>{const x=G.dyn_tree,X=G.max_code,Q=G.stat_desc.static_tree,$=G.stat_desc.has_stree,xe=G.stat_desc.extra_bits,ge=G.stat_desc.extra_base,Ze=G.stat_desc.max_length;let he,be,ot,Ke,Be,Xe,pt=0;for(Ke=0;Ke<=a;Ke++)l.bl_count[Ke]=0;for(x[l.heap[l.heap_max]*2+1]=0,he=l.heap_max+1;he<s;he++)be=l.heap[he],Ke=x[x[be*2+1]*2+1]+1,Ke>Ze&&(Ke=Ze,pt++),x[be*2+1]=Ke,!(be>X)&&(l.bl_count[Ke]++,Be=0,be>=ge&&(Be=xe[be-ge]),Xe=x[be*2],l.opt_len+=Xe*(Ke+Be),$&&(l.static_len+=Xe*(Q[be*2+1]+Be)));if(pt!==0){do{for(Ke=Ze-1;l.bl_count[Ke]===0;)Ke--;l.bl_count[Ke]--,l.bl_count[Ke+1]+=2,l.bl_count[Ze]--,pt-=2}while(pt>0);for(Ke=Ze;Ke!==0;Ke--)for(be=l.bl_count[Ke];be!==0;)ot=l.heap[--he],!(ot>X)&&(x[ot*2+1]!==Ke&&(l.opt_len+=(Ke-x[ot*2+1])*x[ot*2],x[ot*2+1]=Ke),be--)}},de=(l,G,x)=>{const X=new Array(a+1);let Q=0,$,xe;for($=1;$<=a;$++)Q=Q+x[$-1]<<1,X[$]=Q;for(xe=0;xe<=G;xe++){let ge=l[xe*2+1];ge!==0&&(l[xe*2]=we(X[ge]++,ge))}},ee=()=>{let l,G,x,X,Q;const $=new Array(a+1);for(x=0,X=0;X<u-1;X++)for(U[X]=x,l=0;l<1<<m[X];l++)z[x++]=X;for(z[x-1]=X,Q=0,X=0;X<16;X++)for(W[X]=Q,l=0;l<1<<E[X];l++)R[Q++]=X;for(Q>>=7;X<e;X++)for(W[X]=Q<<7,l=0;l<1<<E[X]-7;l++)R[256+Q++]=X;for(G=0;G<=a;G++)$[G]=0;for(l=0;l<=143;)I[l*2+1]=8,l++,$[8]++;for(;l<=255;)I[l*2+1]=9,l++,$[9]++;for(;l<=279;)I[l*2+1]=7,l++,$[7]++;for(;l<=287;)I[l*2+1]=8,l++,$[8]++;for(de(I,r+1,$),l=0;l<e;l++)B[l*2+1]=5,B[l*2]=we(l,5);N=new F(I,m,p+1,r,a),q=new F(B,E,0,e,a),J=new F(new Array(0),S,0,i,t)},me=l=>{let G;for(G=0;G<r;G++)l.dyn_ltree[G*2]=0;for(G=0;G<e;G++)l.dyn_dtree[G*2]=0;for(G=0;G<i;G++)l.bl_tree[G*2]=0;l.dyn_ltree[n*2]=1,l.opt_len=l.static_len=0,l.sym_next=l.matches=0},De=l=>{l.bi_valid>8?fe(l,l.bi_buf):l.bi_valid>0&&(l.pending_buf[l.pending++]=l.bi_buf),l.bi_buf=0,l.bi_valid=0},Ie=(l,G,x,X)=>{const Q=G*2,$=x*2;return l[Q]<l[$]||l[Q]===l[$]&&X[G]<=X[x]},Fe=(l,G,x)=>{const X=l.heap[x];let Q=x<<1;for(;Q<=l.heap_len&&(Q<l.heap_len&&Ie(G,l.heap[Q+1],l.heap[Q],l.depth)&&Q++,!Ie(G,X,l.heap[Q],l.depth));)l.heap[x]=l.heap[Q],x=Q,Q<<=1;l.heap[x]=X},Ue=(l,G,x)=>{let X,Q,$=0,xe,ge;if(l.sym_next!==0)do X=l.pending_buf[l.sym_buf+$++]&255,X+=(l.pending_buf[l.sym_buf+$++]&255)<<8,Q=l.pending_buf[l.sym_buf+$++],X===0?ne(l,Q,G):(xe=z[Q],ne(l,xe+p+1,G),ge=m[xe],ge!==0&&(Q-=U[xe],ie(l,Q,ge)),X--,xe=le(X),ne(l,xe,x),ge=E[xe],ge!==0&&(X-=W[xe],ie(l,X,ge)));while($<l.sym_next);ne(l,n,G)},ze=(l,G)=>{const x=G.dyn_tree,X=G.stat_desc.static_tree,Q=G.stat_desc.has_stree,$=G.stat_desc.elems;let xe,ge,Ze=-1,he;for(l.heap_len=0,l.heap_max=s,xe=0;xe<$;xe++)x[xe*2]!==0?(l.heap[++l.heap_len]=Ze=xe,l.depth[xe]=0):x[xe*2+1]=0;for(;l.heap_len<2;)he=l.heap[++l.heap_len]=Ze<2?++Ze:0,x[he*2]=1,l.depth[he]=0,l.opt_len--,Q&&(l.static_len-=X[he*2+1]);for(G.max_code=Ze,xe=l.heap_len>>1;xe>=1;xe--)Fe(l,x,xe);he=$;do xe=l.heap[1],l.heap[1]=l.heap[l.heap_len--],Fe(l,x,1),ge=l.heap[1],l.heap[--l.heap_max]=xe,l.heap[--l.heap_max]=ge,x[he*2]=x[xe*2]+x[ge*2],l.depth[he]=(l.depth[xe]>=l.depth[ge]?l.depth[xe]:l.depth[ge])+1,x[xe*2+1]=x[ge*2+1]=he,l.heap[1]=he++,Fe(l,x,1);while(l.heap_len>=2);l.heap[--l.heap_max]=l.heap[1],Se(l,G),de(x,Ze,l.bl_count)},Re=(l,G,x)=>{let X,Q=-1,$,xe=G[0*2+1],ge=0,Ze=7,he=4;for(xe===0&&(Ze=138,he=3),G[(x+1)*2+1]=65535,X=0;X<=x;X++)$=xe,xe=G[(X+1)*2+1],!(++ge<Ze&&$===xe)&&(ge<he?l.bl_tree[$*2]+=ge:$!==0?($!==Q&&l.bl_tree[$*2]++,l.bl_tree[f*2]++):ge<=10?l.bl_tree[o*2]++:l.bl_tree[v*2]++,ge=0,Q=$,xe===0?(Ze=138,he=3):$===xe?(Ze=6,he=3):(Ze=7,he=4))},Pe=(l,G,x)=>{let X,Q=-1,$,xe=G[0*2+1],ge=0,Ze=7,he=4;for(xe===0&&(Ze=138,he=3),X=0;X<=x;X++)if($=xe,xe=G[(X+1)*2+1],!(++ge<Ze&&$===xe)){if(ge<he)do ne(l,$,l.bl_tree);while(--ge!==0);else $!==0?($!==Q&&(ne(l,$,l.bl_tree),ge--),ne(l,f,l.bl_tree),ie(l,ge-3,2)):ge<=10?(ne(l,o,l.bl_tree),ie(l,ge-3,3)):(ne(l,v,l.bl_tree),ie(l,ge-11,7));ge=0,Q=$,xe===0?(Ze=138,he=3):$===xe?(Ze=6,he=3):(Ze=7,he=4)}},Oe=l=>{let G;for(Re(l,l.dyn_ltree,l.l_desc.max_code),Re(l,l.dyn_dtree,l.d_desc.max_code),ze(l,l.bl_desc),G=i-1;G>=3&&l.bl_tree[T[G]*2+1]===0;G--);return l.opt_len+=3*(G+1)+5+5+4,G},Ae=(l,G,x,X)=>{let Q;for(ie(l,G-257,5),ie(l,x-1,5),ie(l,X-4,4),Q=0;Q<X;Q++)ie(l,l.bl_tree[T[Q]*2+1],3);Pe(l,l.dyn_ltree,G-1),Pe(l,l.dyn_dtree,x-1)},Ne=l=>{let G=4093624447,x;for(x=0;x<=31;x++,G>>>=1)if(G&1&&l.dyn_ltree[x*2]!==0)return L;if(l.dyn_ltree[9*2]!==0||l.dyn_ltree[10*2]!==0||l.dyn_ltree[13*2]!==0)return w;for(x=32;x<p;x++)if(l.dyn_ltree[x*2]!==0)return w;return L};let je=!1;const k=l=>{je||(ee(),je=!0),l.l_desc=new oe(l.dyn_ltree,N),l.d_desc=new oe(l.dyn_dtree,q),l.bl_desc=new oe(l.bl_tree,J),l.bi_buf=0,l.bi_valid=0,me(l)},Z=(l,G,x,X)=>{ie(l,(_<<1)+(X?1:0),3),De(l),fe(l,x),fe(l,~x),x&&l.pending_buf.set(l.window.subarray(G,G+x),l.pending),l.pending+=x},Y=l=>{ie(l,A<<1,3),ne(l,n,I),Ee(l)},ve=(l,G,x,X)=>{let Q,$,xe=0;l.level>0?(l.strm.data_type===O&&(l.strm.data_type=Ne(l)),ze(l,l.l_desc),ze(l,l.d_desc),xe=Oe(l),Q=l.opt_len+3+7>>>3,$=l.static_len+3+7>>>3,$<=Q&&(Q=$)):Q=$=x+5,x+4<=Q&&G!==-1?Z(l,G,x,X):l.strategy===M||$===Q?(ie(l,(A<<1)+(X?1:0),3),Ue(l,I,B)):(ie(l,(c<<1)+(X?1:0),3),Ae(l,l.l_desc.max_code+1,l.d_desc.max_code+1,xe+1),Ue(l,l.dyn_ltree,l.dyn_dtree)),me(l),X&&De(l)},re=(l,G,x)=>(l.pending_buf[l.sym_buf+l.sym_next++]=G,l.pending_buf[l.sym_buf+l.sym_next++]=G>>8,l.pending_buf[l.sym_buf+l.sym_next++]=x,G===0?l.dyn_ltree[x*2]++:(l.matches++,G--,l.dyn_ltree[(z[x]+p+1)*2]++,l.dyn_dtree[le(G)*2]++),l.sym_next===l.sym_end);var Le=k,Me=Z,V=ve,ae=re,pe=Y,Te={_tr_init:Le,_tr_stored_block:Me,_tr_flush_block:V,_tr_tally:ae,_tr_align:pe},ye=(l,G,x,X)=>{let Q=l&65535|0,$=l>>>16&65535|0,xe=0;for(;x!==0;){xe=x>2e3?2e3:x,x-=xe;do Q=Q+G[X++]|0,$=$+Q|0;while(--xe);Q%=65521,$%=65521}return Q|$<<16|0};const j=()=>{let l,G=[];for(var x=0;x<256;x++){l=x;for(var X=0;X<8;X++)l=l&1?3988292384^l>>>1:l>>>1;G[x]=l}return G},Ce=new Uint32Array(j());var D=(l,G,x,X)=>{const Q=Ce,$=X+x;l^=-1;for(let xe=X;xe<$;xe++)l=l>>>8^Q[(l^G[xe])&255];return l^-1},ue={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},ce={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:H,_tr_stored_block:te,_tr_flush_block:_e,_tr_tally:ke,_tr_align:Ve}=Te,{Z_NO_FLUSH:Ge,Z_PARTIAL_FLUSH:$e,Z_FULL_FLUSH:xt,Z_FINISH:tt,Z_BLOCK:et,Z_OK:Je,Z_STREAM_END:_t,Z_STREAM_ERROR:dt,Z_DATA_ERROR:Ot,Z_BUF_ERROR:Dt,Z_DEFAULT_COMPRESSION:gt,Z_FILTERED:vt,Z_HUFFMAN_ONLY:ct,Z_RLE:At,Z_FIXED:yt,Z_DEFAULT_STRATEGY:Bt,Z_UNKNOWN:oi,Z_DEFLATED:Ft}=ce,li=9,hi=15,fi=8,Ai=256+1+29,Xr=30,Yr=19,$r=2*Ai+1,Qr=15,rt=3,It=258,Tt=It+rt+1,Jr=32,kt=42,Mi=57,wi=69,Ci=73,Di=91,Ti=103,Ut=113,$t=666,Et=1,Ht=2,Wt=3,Kt=4,qr=3,Gt=(l,G)=>(l.msg=ue[G],G),Ni=l=>l*2-(l>4?9:0),Rt=l=>{let G=l.length;for(;--G>=0;)l[G]=0},en=l=>{let G,x,X,Q=l.w_size;G=l.hash_size,X=G;do x=l.head[--X],l.head[X]=x>=Q?x-Q:0;while(--G);G=Q,X=G;do x=l.prev[--X],l.prev[X]=x>=Q?x-Q:0;while(--G)};let zt=(l,G,x)=>(G<<l.hash_shift^x)&l.hash_mask;const Mt=l=>{const G=l.state;let x=G.pending;x>l.avail_out&&(x=l.avail_out),x!==0&&(l.output.set(G.pending_buf.subarray(G.pending_out,G.pending_out+x),l.next_out),l.next_out+=x,G.pending_out+=x,l.total_out+=x,l.avail_out-=x,G.pending-=x,G.pending===0&&(G.pending_out=0))},wt=(l,G)=>{_e(l,l.block_start>=0?l.block_start:-1,l.strstart-l.block_start,G),l.block_start=l.strstart,Mt(l.strm)},lt=(l,G)=>{l.pending_buf[l.pending++]=G},Qt=(l,G)=>{l.pending_buf[l.pending++]=G>>>8&255,l.pending_buf[l.pending++]=G&255},Li=(l,G,x,X)=>{let Q=l.avail_in;return Q>X&&(Q=X),Q===0?0:(l.avail_in-=Q,G.set(l.input.subarray(l.next_in,l.next_in+Q),x),l.state.wrap===1?l.adler=ye(l.adler,G,Q,x):l.state.wrap===2&&(l.adler=D(l.adler,G,Q,x)),l.next_in+=Q,l.total_in+=Q,Q)},Vi=(l,G)=>{let x=l.max_chain_length,X=l.strstart,Q,$,xe=l.prev_length,ge=l.nice_match;const Ze=l.strstart>l.w_size-Tt?l.strstart-(l.w_size-Tt):0,he=l.window,be=l.w_mask,ot=l.prev,Ke=l.strstart+It;let Be=he[X+xe-1],Xe=he[X+xe];l.prev_length>=l.good_match&&(x>>=2),ge>l.lookahead&&(ge=l.lookahead);do if(Q=G,!(he[Q+xe]!==Xe||he[Q+xe-1]!==Be||he[Q]!==he[X]||he[++Q]!==he[X+1])){X+=2,Q++;do;while(he[++X]===he[++Q]&&he[++X]===he[++Q]&&he[++X]===he[++Q]&&he[++X]===he[++Q]&&he[++X]===he[++Q]&&he[++X]===he[++Q]&&he[++X]===he[++Q]&&he[++X]===he[++Q]&&X<Ke);if($=It-(Ke-X),X=Ke-It,$>xe){if(l.match_start=G,xe=$,$>=ge)break;Be=he[X+xe-1],Xe=he[X+xe]}}while((G=ot[G&be])>Ze&&--x!==0);return xe<=l.lookahead?xe:l.lookahead},Zt=l=>{const G=l.w_size;let x,X,Q;do{if(X=l.window_size-l.lookahead-l.strstart,l.strstart>=G+(G-Tt)&&(l.window.set(l.window.subarray(G,G+G-X),0),l.match_start-=G,l.strstart-=G,l.block_start-=G,l.insert>l.strstart&&(l.insert=l.strstart),en(l),X+=G),l.strm.avail_in===0)break;if(x=Li(l.strm,l.window,l.strstart+l.lookahead,X),l.lookahead+=x,l.lookahead+l.insert>=rt)for(Q=l.strstart-l.insert,l.ins_h=l.window[Q],l.ins_h=zt(l,l.ins_h,l.window[Q+1]);l.insert&&(l.ins_h=zt(l,l.ins_h,l.window[Q+rt-1]),l.prev[Q&l.w_mask]=l.head[l.ins_h],l.head[l.ins_h]=Q,Q++,l.insert--,!(l.lookahead+l.insert<rt)););}while(l.lookahead<Tt&&l.strm.avail_in!==0)},ji=(l,G)=>{let x=l.pending_buf_size-5>l.w_size?l.w_size:l.pending_buf_size-5,X,Q,$,xe=0,ge=l.strm.avail_in;do{if(X=65535,$=l.bi_valid+42>>3,l.strm.avail_out<$||($=l.strm.avail_out-$,Q=l.strstart-l.block_start,X>Q+l.strm.avail_in&&(X=Q+l.strm.avail_in),X>$&&(X=$),X<x&&(X===0&&G!==tt||G===Ge||X!==Q+l.strm.avail_in)))break;xe=G===tt&&X===Q+l.strm.avail_in?1:0,te(l,0,0,xe),l.pending_buf[l.pending-4]=X,l.pending_buf[l.pending-3]=X>>8,l.pending_buf[l.pending-2]=~X,l.pending_buf[l.pending-1]=~X>>8,Mt(l.strm),Q&&(Q>X&&(Q=X),l.strm.output.set(l.window.subarray(l.block_start,l.block_start+Q),l.strm.next_out),l.strm.next_out+=Q,l.strm.avail_out-=Q,l.strm.total_out+=Q,l.block_start+=Q,X-=Q),X&&(Li(l.strm,l.strm.output,l.strm.next_out,X),l.strm.next_out+=X,l.strm.avail_out-=X,l.strm.total_out+=X)}while(xe===0);return ge-=l.strm.avail_in,ge&&(ge>=l.w_size?(l.matches=2,l.window.set(l.strm.input.subarray(l.strm.next_in-l.w_size,l.strm.next_in),0),l.strstart=l.w_size,l.insert=l.strstart):(l.window_size-l.strstart<=ge&&(l.strstart-=l.w_size,l.window.set(l.window.subarray(l.w_size,l.w_size+l.strstart),0),l.matches<2&&l.matches++,l.insert>l.strstart&&(l.insert=l.strstart)),l.window.set(l.strm.input.subarray(l.strm.next_in-ge,l.strm.next_in),l.strstart),l.strstart+=ge,l.insert+=ge>l.w_size-l.insert?l.w_size-l.insert:ge),l.block_start=l.strstart),l.high_water<l.strstart&&(l.high_water=l.strstart),xe?Kt:G!==Ge&&G!==tt&&l.strm.avail_in===0&&l.strstart===l.block_start?Ht:($=l.window_size-l.strstart,l.strm.avail_in>$&&l.block_start>=l.w_size&&(l.block_start-=l.w_size,l.strstart-=l.w_size,l.window.set(l.window.subarray(l.w_size,l.w_size+l.strstart),0),l.matches<2&&l.matches++,$+=l.w_size,l.insert>l.strstart&&(l.insert=l.strstart)),$>l.strm.avail_in&&($=l.strm.avail_in),$&&(Li(l.strm,l.window,l.strstart,$),l.strstart+=$,l.insert+=$>l.w_size-l.insert?l.w_size-l.insert:$),l.high_water<l.strstart&&(l.high_water=l.strstart),$=l.bi_valid+42>>3,$=l.pending_buf_size-$>65535?65535:l.pending_buf_size-$,x=$>l.w_size?l.w_size:$,Q=l.strstart-l.block_start,(Q>=x||(Q||G===tt)&&G!==Ge&&l.strm.avail_in===0&&Q<=$)&&(X=Q>$?$:Q,xe=G===tt&&l.strm.avail_in===0&&X===Q?1:0,te(l,l.block_start,X,xe),l.block_start+=X,Mt(l.strm)),xe?Wt:Et)},Oi=(l,G)=>{let x,X;for(;;){if(l.lookahead<Tt){if(Zt(l),l.lookahead<Tt&&G===Ge)return Et;if(l.lookahead===0)break}if(x=0,l.lookahead>=rt&&(l.ins_h=zt(l,l.ins_h,l.window[l.strstart+rt-1]),x=l.prev[l.strstart&l.w_mask]=l.head[l.ins_h],l.head[l.ins_h]=l.strstart),x!==0&&l.strstart-x<=l.w_size-Tt&&(l.match_length=Vi(l,x)),l.match_length>=rt)if(X=ke(l,l.strstart-l.match_start,l.match_length-rt),l.lookahead-=l.match_length,l.match_length<=l.max_lazy_match&&l.lookahead>=rt){l.match_length--;do l.strstart++,l.ins_h=zt(l,l.ins_h,l.window[l.strstart+rt-1]),x=l.prev[l.strstart&l.w_mask]=l.head[l.ins_h],l.head[l.ins_h]=l.strstart;while(--l.match_length!==0);l.strstart++}else l.strstart+=l.match_length,l.match_length=0,l.ins_h=l.window[l.strstart],l.ins_h=zt(l,l.ins_h,l.window[l.strstart+1]);else X=ke(l,0,l.window[l.strstart]),l.lookahead--,l.strstart++;if(X&&(wt(l,!1),l.strm.avail_out===0))return Et}return l.insert=l.strstart<rt-1?l.strstart:rt-1,G===tt?(wt(l,!0),l.strm.avail_out===0?Wt:Kt):l.sym_next&&(wt(l,!1),l.strm.avail_out===0)?Et:Ht},Xt=(l,G)=>{let x,X,Q;for(;;){if(l.lookahead<Tt){if(Zt(l),l.lookahead<Tt&&G===Ge)return Et;if(l.lookahead===0)break}if(x=0,l.lookahead>=rt&&(l.ins_h=zt(l,l.ins_h,l.window[l.strstart+rt-1]),x=l.prev[l.strstart&l.w_mask]=l.head[l.ins_h],l.head[l.ins_h]=l.strstart),l.prev_length=l.match_length,l.prev_match=l.match_start,l.match_length=rt-1,x!==0&&l.prev_length<l.max_lazy_match&&l.strstart-x<=l.w_size-Tt&&(l.match_length=Vi(l,x),l.match_length<=5&&(l.strategy===vt||l.match_length===rt&&l.strstart-l.match_start>4096)&&(l.match_length=rt-1)),l.prev_length>=rt&&l.match_length<=l.prev_length){Q=l.strstart+l.lookahead-rt,X=ke(l,l.strstart-1-l.prev_match,l.prev_length-rt),l.lookahead-=l.prev_length-1,l.prev_length-=2;do++l.strstart<=Q&&(l.ins_h=zt(l,l.ins_h,l.window[l.strstart+rt-1]),x=l.prev[l.strstart&l.w_mask]=l.head[l.ins_h],l.head[l.ins_h]=l.strstart);while(--l.prev_length!==0);if(l.match_available=0,l.match_length=rt-1,l.strstart++,X&&(wt(l,!1),l.strm.avail_out===0))return Et}else if(l.match_available){if(X=ke(l,0,l.window[l.strstart-1]),X&&wt(l,!1),l.strstart++,l.lookahead--,l.strm.avail_out===0)return Et}else l.match_available=1,l.strstart++,l.lookahead--}return l.match_available&&(X=ke(l,0,l.window[l.strstart-1]),l.match_available=0),l.insert=l.strstart<rt-1?l.strstart:rt-1,G===tt?(wt(l,!0),l.strm.avail_out===0?Wt:Kt):l.sym_next&&(wt(l,!1),l.strm.avail_out===0)?Et:Ht},tn=(l,G)=>{let x,X,Q,$;const xe=l.window;for(;;){if(l.lookahead<=It){if(Zt(l),l.lookahead<=It&&G===Ge)return Et;if(l.lookahead===0)break}if(l.match_length=0,l.lookahead>=rt&&l.strstart>0&&(Q=l.strstart-1,X=xe[Q],X===xe[++Q]&&X===xe[++Q]&&X===xe[++Q])){$=l.strstart+It;do;while(X===xe[++Q]&&X===xe[++Q]&&X===xe[++Q]&&X===xe[++Q]&&X===xe[++Q]&&X===xe[++Q]&&X===xe[++Q]&&X===xe[++Q]&&Q<$);l.match_length=It-($-Q),l.match_length>l.lookahead&&(l.match_length=l.lookahead)}if(l.match_length>=rt?(x=ke(l,1,l.match_length-rt),l.lookahead-=l.match_length,l.strstart+=l.match_length,l.match_length=0):(x=ke(l,0,l.window[l.strstart]),l.lookahead--,l.strstart++),x&&(wt(l,!1),l.strm.avail_out===0))return Et}return l.insert=0,G===tt?(wt(l,!0),l.strm.avail_out===0?Wt:Kt):l.sym_next&&(wt(l,!1),l.strm.avail_out===0)?Et:Ht},rn=(l,G)=>{let x;for(;;){if(l.lookahead===0&&(Zt(l),l.lookahead===0)){if(G===Ge)return Et;break}if(l.match_length=0,x=ke(l,0,l.window[l.strstart]),l.lookahead--,l.strstart++,x&&(wt(l,!1),l.strm.avail_out===0))return Et}return l.insert=0,G===tt?(wt(l,!0),l.strm.avail_out===0?Wt:Kt):l.sym_next&&(wt(l,!1),l.strm.avail_out===0)?Et:Ht};function Lt(l,G,x,X,Q){this.good_length=l,this.max_lazy=G,this.nice_length=x,this.max_chain=X,this.func=Q}const Jt=[new Lt(0,0,0,0,ji),new Lt(4,4,8,4,Oi),new Lt(4,5,16,8,Oi),new Lt(4,6,32,32,Oi),new Lt(4,4,16,16,Xt),new Lt(8,16,32,32,Xt),new Lt(8,16,128,128,Xt),new Lt(8,32,128,256,Xt),new Lt(32,128,258,1024,Xt),new Lt(32,258,258,4096,Xt)],nn=l=>{l.window_size=2*l.w_size,Rt(l.head),l.max_lazy_match=Jt[l.level].max_lazy,l.good_match=Jt[l.level].good_length,l.nice_match=Jt[l.level].nice_length,l.max_chain_length=Jt[l.level].max_chain,l.strstart=0,l.block_start=0,l.lookahead=0,l.insert=0,l.match_length=l.prev_length=rt-1,l.match_available=0,l.ins_h=0};function sn(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=Ft,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array($r*2),this.dyn_dtree=new Uint16Array((2*Xr+1)*2),this.bl_tree=new Uint16Array((2*Yr+1)*2),Rt(this.dyn_ltree),Rt(this.dyn_dtree),Rt(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(Qr+1),this.heap=new Uint16Array(2*Ai+1),Rt(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*Ai+1),Rt(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const qt=l=>{if(!l)return 1;const G=l.state;return!G||G.strm!==l||G.status!==kt&&G.status!==Mi&&G.status!==wi&&G.status!==Ci&&G.status!==Di&&G.status!==Ti&&G.status!==Ut&&G.status!==$t?1:0},ki=l=>{if(qt(l))return Gt(l,dt);l.total_in=l.total_out=0,l.data_type=oi;const G=l.state;return G.pending=0,G.pending_out=0,G.wrap<0&&(G.wrap=-G.wrap),G.status=G.wrap===2?Mi:G.wrap?kt:Ut,l.adler=G.wrap===2?0:1,G.last_flush=-2,H(G),Je},Hi=l=>{const G=ki(l);return G===Je&&nn(l.state),G},an=(l,G)=>qt(l)||l.state.wrap!==2?dt:(l.state.gzhead=G,Je),Ki=(l,G,x,X,Q,$)=>{if(!l)return dt;let xe=1;if(G===gt&&(G=6),X<0?(xe=0,X=-X):X>15&&(xe=2,X-=16),Q<1||Q>li||x!==Ft||X<8||X>15||G<0||G>9||$<0||$>yt||X===8&&xe!==1)return Gt(l,dt);X===8&&(X=9);const ge=new sn;return l.state=ge,ge.strm=l,ge.status=kt,ge.wrap=xe,ge.gzhead=null,ge.w_bits=X,ge.w_size=1<<ge.w_bits,ge.w_mask=ge.w_size-1,ge.hash_bits=Q+7,ge.hash_size=1<<ge.hash_bits,ge.hash_mask=ge.hash_size-1,ge.hash_shift=~~((ge.hash_bits+rt-1)/rt),ge.window=new Uint8Array(ge.w_size*2),ge.head=new Uint16Array(ge.hash_size),ge.prev=new Uint16Array(ge.w_size),ge.lit_bufsize=1<<Q+6,ge.pending_buf_size=ge.lit_bufsize*4,ge.pending_buf=new Uint8Array(ge.pending_buf_size),ge.sym_buf=ge.lit_bufsize,ge.sym_end=(ge.lit_bufsize-1)*3,ge.level=G,ge.strategy=$,ge.method=x,Hi(l)},on=(l,G)=>Ki(l,G,Ft,hi,fi,Bt),ln=(l,G)=>{if(qt(l)||G>et||G<0)return l?Gt(l,dt):dt;const x=l.state;if(!l.output||l.avail_in!==0&&!l.input||x.status===$t&&G!==tt)return Gt(l,l.avail_out===0?Dt:dt);const X=x.last_flush;if(x.last_flush=G,x.pending!==0){if(Mt(l),l.avail_out===0)return x.last_flush=-1,Je}else if(l.avail_in===0&&Ni(G)<=Ni(X)&&G!==tt)return Gt(l,Dt);if(x.status===$t&&l.avail_in!==0)return Gt(l,Dt);if(x.status===kt&&x.wrap===0&&(x.status=Ut),x.status===kt){let Q=Ft+(x.w_bits-8<<4)<<8,$=-1;if(x.strategy>=ct||x.level<2?$=0:x.level<6?$=1:x.level===6?$=2:$=3,Q|=$<<6,x.strstart!==0&&(Q|=Jr),Q+=31-Q%31,Qt(x,Q),x.strstart!==0&&(Qt(x,l.adler>>>16),Qt(x,l.adler&65535)),l.adler=1,x.status=Ut,Mt(l),x.pending!==0)return x.last_flush=-1,Je}if(x.status===Mi){if(l.adler=0,lt(x,31),lt(x,139),lt(x,8),x.gzhead)lt(x,(x.gzhead.text?1:0)+(x.gzhead.hcrc?2:0)+(x.gzhead.extra?4:0)+(x.gzhead.name?8:0)+(x.gzhead.comment?16:0)),lt(x,x.gzhead.time&255),lt(x,x.gzhead.time>>8&255),lt(x,x.gzhead.time>>16&255),lt(x,x.gzhead.time>>24&255),lt(x,x.level===9?2:x.strategy>=ct||x.level<2?4:0),lt(x,x.gzhead.os&255),x.gzhead.extra&&x.gzhead.extra.length&&(lt(x,x.gzhead.extra.length&255),lt(x,x.gzhead.extra.length>>8&255)),x.gzhead.hcrc&&(l.adler=D(l.adler,x.pending_buf,x.pending,0)),x.gzindex=0,x.status=wi;else if(lt(x,0),lt(x,0),lt(x,0),lt(x,0),lt(x,0),lt(x,x.level===9?2:x.strategy>=ct||x.level<2?4:0),lt(x,qr),x.status=Ut,Mt(l),x.pending!==0)return x.last_flush=-1,Je}if(x.status===wi){if(x.gzhead.extra){let Q=x.pending,$=(x.gzhead.extra.length&65535)-x.gzindex;for(;x.pending+$>x.pending_buf_size;){let ge=x.pending_buf_size-x.pending;if(x.pending_buf.set(x.gzhead.extra.subarray(x.gzindex,x.gzindex+ge),x.pending),x.pending=x.pending_buf_size,x.gzhead.hcrc&&x.pending>Q&&(l.adler=D(l.adler,x.pending_buf,x.pending-Q,Q)),x.gzindex+=ge,Mt(l),x.pending!==0)return x.last_flush=-1,Je;Q=0,$-=ge}let xe=new Uint8Array(x.gzhead.extra);x.pending_buf.set(xe.subarray(x.gzindex,x.gzindex+$),x.pending),x.pending+=$,x.gzhead.hcrc&&x.pending>Q&&(l.adler=D(l.adler,x.pending_buf,x.pending-Q,Q)),x.gzindex=0}x.status=Ci}if(x.status===Ci){if(x.gzhead.name){let Q=x.pending,$;do{if(x.pending===x.pending_buf_size){if(x.gzhead.hcrc&&x.pending>Q&&(l.adler=D(l.adler,x.pending_buf,x.pending-Q,Q)),Mt(l),x.pending!==0)return x.last_flush=-1,Je;Q=0}x.gzindex<x.gzhead.name.length?$=x.gzhead.name.charCodeAt(x.gzindex++)&255:$=0,lt(x,$)}while($!==0);x.gzhead.hcrc&&x.pending>Q&&(l.adler=D(l.adler,x.pending_buf,x.pending-Q,Q)),x.gzindex=0}x.status=Di}if(x.status===Di){if(x.gzhead.comment){let Q=x.pending,$;do{if(x.pending===x.pending_buf_size){if(x.gzhead.hcrc&&x.pending>Q&&(l.adler=D(l.adler,x.pending_buf,x.pending-Q,Q)),Mt(l),x.pending!==0)return x.last_flush=-1,Je;Q=0}x.gzindex<x.gzhead.comment.length?$=x.gzhead.comment.charCodeAt(x.gzindex++)&255:$=0,lt(x,$)}while($!==0);x.gzhead.hcrc&&x.pending>Q&&(l.adler=D(l.adler,x.pending_buf,x.pending-Q,Q))}x.status=Ti}if(x.status===Ti){if(x.gzhead.hcrc){if(x.pending+2>x.pending_buf_size&&(Mt(l),x.pending!==0))return x.last_flush=-1,Je;lt(x,l.adler&255),lt(x,l.adler>>8&255),l.adler=0}if(x.status=Ut,Mt(l),x.pending!==0)return x.last_flush=-1,Je}if(l.avail_in!==0||x.lookahead!==0||G!==Ge&&x.status!==$t){let Q=x.level===0?ji(x,G):x.strategy===ct?rn(x,G):x.strategy===At?tn(x,G):Jt[x.level].func(x,G);if((Q===Wt||Q===Kt)&&(x.status=$t),Q===Et||Q===Wt)return l.avail_out===0&&(x.last_flush=-1),Je;if(Q===Ht&&(G===$e?Ve(x):G!==et&&(te(x,0,0,!1),G===xt&&(Rt(x.head),x.lookahead===0&&(x.strstart=0,x.block_start=0,x.insert=0))),Mt(l),l.avail_out===0))return x.last_flush=-1,Je}return G!==tt?Je:x.wrap<=0?_t:(x.wrap===2?(lt(x,l.adler&255),lt(x,l.adler>>8&255),lt(x,l.adler>>16&255),lt(x,l.adler>>24&255),lt(x,l.total_in&255),lt(x,l.total_in>>8&255),lt(x,l.total_in>>16&255),lt(x,l.total_in>>24&255)):(Qt(x,l.adler>>>16),Qt(x,l.adler&65535)),Mt(l),x.wrap>0&&(x.wrap=-x.wrap),x.pending!==0?Je:_t)},hn=l=>{if(qt(l))return dt;const G=l.state.status;return l.state=null,G===Ut?Gt(l,Ot):Je},fn=(l,G)=>{let x=G.length;if(qt(l))return dt;const X=l.state,Q=X.wrap;if(Q===2||Q===1&&X.status!==kt||X.lookahead)return dt;if(Q===1&&(l.adler=ye(l.adler,G,x,0)),X.wrap=0,x>=X.w_size){Q===0&&(Rt(X.head),X.strstart=0,X.block_start=0,X.insert=0);let Ze=new Uint8Array(X.w_size);Ze.set(G.subarray(x-X.w_size,x),0),G=Ze,x=X.w_size}const $=l.avail_in,xe=l.next_in,ge=l.input;for(l.avail_in=x,l.next_in=0,l.input=G,Zt(X);X.lookahead>=rt;){let Ze=X.strstart,he=X.lookahead-(rt-1);do X.ins_h=zt(X,X.ins_h,X.window[Ze+rt-1]),X.prev[Ze&X.w_mask]=X.head[X.ins_h],X.head[X.ins_h]=Ze,Ze++;while(--he);X.strstart=Ze,X.lookahead=rt-1,Zt(X)}return X.strstart+=X.lookahead,X.block_start=X.strstart,X.insert=X.lookahead,X.lookahead=0,X.match_length=X.prev_length=rt-1,X.match_available=0,l.next_in=xe,l.input=ge,l.avail_in=$,X.wrap=Q,Je};var dn=on,cn=Ki,un=Hi,gn=ki,vn=an,mn=ln,pn=hn,_n=fn,xn="pako deflate (from Nodeca project)",ei={deflateInit:dn,deflateInit2:cn,deflateReset:un,deflateResetKeep:gn,deflateSetHeader:vn,deflate:mn,deflateEnd:pn,deflateSetDictionary:_n,deflateInfo:xn};const bn=(l,G)=>Object.prototype.hasOwnProperty.call(l,G);var yn=function(l){const G=Array.prototype.slice.call(arguments,1);for(;G.length;){const x=G.shift();if(x){if(typeof x!="object")throw new TypeError(x+"must be non-object");for(const X in x)bn(x,X)&&(l[X]=x[X])}}return l},En=l=>{let G=0;for(let X=0,Q=l.length;X<Q;X++)G+=l[X].length;const x=new Uint8Array(G);for(let X=0,Q=0,$=l.length;X<$;X++){let xe=l[X];x.set(xe,Q),Q+=xe.length}return x},ui={assign:yn,flattenChunks:En};let Zi=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{Zi=!1}const ti=new Uint8Array(256);for(let l=0;l<256;l++)ti[l]=l>=252?6:l>=248?5:l>=240?4:l>=224?3:l>=192?2:1;ti[254]=ti[254]=1;var An=l=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(l);let G,x,X,Q,$,xe=l.length,ge=0;for(Q=0;Q<xe;Q++)x=l.charCodeAt(Q),(x&64512)===55296&&Q+1<xe&&(X=l.charCodeAt(Q+1),(X&64512)===56320&&(x=65536+(x-55296<<10)+(X-56320),Q++)),ge+=x<128?1:x<2048?2:x<65536?3:4;for(G=new Uint8Array(ge),$=0,Q=0;$<ge;Q++)x=l.charCodeAt(Q),(x&64512)===55296&&Q+1<xe&&(X=l.charCodeAt(Q+1),(X&64512)===56320&&(x=65536+(x-55296<<10)+(X-56320),Q++)),x<128?G[$++]=x:x<2048?(G[$++]=192|x>>>6,G[$++]=128|x&63):x<65536?(G[$++]=224|x>>>12,G[$++]=128|x>>>6&63,G[$++]=128|x&63):(G[$++]=240|x>>>18,G[$++]=128|x>>>12&63,G[$++]=128|x>>>6&63,G[$++]=128|x&63);return G};const Mn=(l,G)=>{if(G<65534&&l.subarray&&Zi)return String.fromCharCode.apply(null,l.length===G?l:l.subarray(0,G));let x="";for(let X=0;X<G;X++)x+=String.fromCharCode(l[X]);return x};var wn=(l,G)=>{const x=G||l.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(l.subarray(0,G));let X,Q;const $=new Array(x*2);for(Q=0,X=0;X<x;){let xe=l[X++];if(xe<128){$[Q++]=xe;continue}let ge=ti[xe];if(ge>4){$[Q++]=65533,X+=ge-1;continue}for(xe&=ge===2?31:ge===3?15:7;ge>1&&X<x;)xe=xe<<6|l[X++]&63,ge--;if(ge>1){$[Q++]=65533;continue}xe<65536?$[Q++]=xe:(xe-=65536,$[Q++]=55296|xe>>10&1023,$[Q++]=56320|xe&1023)}return Mn($,Q)},Cn=(l,G)=>{G=G||l.length,G>l.length&&(G=l.length);let x=G-1;for(;x>=0&&(l[x]&192)===128;)x--;return x<0||x===0?G:x+ti[l[x]]>G?x:G},ii={string2buf:An,buf2string:wn,utf8border:Cn};function Dn(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}var Xi=Dn;const Yi=Object.prototype.toString,{Z_NO_FLUSH:Tn,Z_SYNC_FLUSH:Ln,Z_FULL_FLUSH:On,Z_FINISH:Sn,Z_OK:gi,Z_STREAM_END:Pn,Z_DEFAULT_COMPRESSION:In,Z_DEFAULT_STRATEGY:Rn,Z_DEFLATED:zn}=ce;function ri(l){this.options=ui.assign({level:In,method:zn,chunkSize:16384,windowBits:15,memLevel:8,strategy:Rn},l||{});let G=this.options;G.raw&&G.windowBits>0?G.windowBits=-G.windowBits:G.gzip&&G.windowBits>0&&G.windowBits<16&&(G.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Xi,this.strm.avail_out=0;let x=ei.deflateInit2(this.strm,G.level,G.method,G.windowBits,G.memLevel,G.strategy);if(x!==gi)throw new Error(ue[x]);if(G.header&&ei.deflateSetHeader(this.strm,G.header),G.dictionary){let X;if(typeof G.dictionary=="string"?X=ii.string2buf(G.dictionary):Yi.call(G.dictionary)==="[object ArrayBuffer]"?X=new Uint8Array(G.dictionary):X=G.dictionary,x=ei.deflateSetDictionary(this.strm,X),x!==gi)throw new Error(ue[x]);this._dict_set=!0}}ri.prototype.push=function(l,G){const x=this.strm,X=this.options.chunkSize;let Q,$;if(this.ended)return!1;for(G===~~G?$=G:$=G===!0?Sn:Tn,typeof l=="string"?x.input=ii.string2buf(l):Yi.call(l)==="[object ArrayBuffer]"?x.input=new Uint8Array(l):x.input=l,x.next_in=0,x.avail_in=x.input.length;;){if(x.avail_out===0&&(x.output=new Uint8Array(X),x.next_out=0,x.avail_out=X),($===Ln||$===On)&&x.avail_out<=6){this.onData(x.output.subarray(0,x.next_out)),x.avail_out=0;continue}if(Q=ei.deflate(x,$),Q===Pn)return x.next_out>0&&this.onData(x.output.subarray(0,x.next_out)),Q=ei.deflateEnd(this.strm),this.onEnd(Q),this.ended=!0,Q===gi;if(x.avail_out===0){this.onData(x.output);continue}if($>0&&x.next_out>0){this.onData(x.output.subarray(0,x.next_out)),x.avail_out=0;continue}if(x.avail_in===0)break}return!0},ri.prototype.onData=function(l){this.chunks.push(l)},ri.prototype.onEnd=function(l){l===gi&&(this.result=ui.flattenChunks(this.chunks)),this.chunks=[],this.err=l,this.msg=this.strm.msg};function Si(l,G){const x=new ri(G);if(x.push(l,!0),x.err)throw x.msg||ue[x.err];return x.result}function Bn(l,G){return G=G||{},G.raw=!0,Si(l,G)}function Fn(l,G){return G=G||{},G.gzip=!0,Si(l,G)}var Un=ri,Wn=Si,Gn=Bn,Nn=Fn,Vn={Deflate:Un,deflate:Wn,deflateRaw:Gn,gzip:Nn};const vi=16209,jn=16191;var kn=function(G,x){let X,Q,$,xe,ge,Ze,he,be,ot,Ke,Be,Xe,pt,st,qe,ft,it,He,ht,bt,Ye,ut,at,Qe;const nt=G.state;X=G.next_in,at=G.input,Q=X+(G.avail_in-5),$=G.next_out,Qe=G.output,xe=$-(x-G.avail_out),ge=$+(G.avail_out-257),Ze=nt.dmax,he=nt.wsize,be=nt.whave,ot=nt.wnext,Ke=nt.window,Be=nt.hold,Xe=nt.bits,pt=nt.lencode,st=nt.distcode,qe=(1<<nt.lenbits)-1,ft=(1<<nt.distbits)-1;e:do{Xe<15&&(Be+=at[X++]<<Xe,Xe+=8,Be+=at[X++]<<Xe,Xe+=8),it=pt[Be&qe];t:for(;;){if(He=it>>>24,Be>>>=He,Xe-=He,He=it>>>16&255,He===0)Qe[$++]=it&65535;else if(He&16){ht=it&65535,He&=15,He&&(Xe<He&&(Be+=at[X++]<<Xe,Xe+=8),ht+=Be&(1<<He)-1,Be>>>=He,Xe-=He),Xe<15&&(Be+=at[X++]<<Xe,Xe+=8,Be+=at[X++]<<Xe,Xe+=8),it=st[Be&ft];i:for(;;){if(He=it>>>24,Be>>>=He,Xe-=He,He=it>>>16&255,He&16){if(bt=it&65535,He&=15,Xe<He&&(Be+=at[X++]<<Xe,Xe+=8,Xe<He&&(Be+=at[X++]<<Xe,Xe+=8)),bt+=Be&(1<<He)-1,bt>Ze){G.msg="invalid distance too far back",nt.mode=vi;break e}if(Be>>>=He,Xe-=He,He=$-xe,bt>He){if(He=bt-He,He>be&&nt.sane){G.msg="invalid distance too far back",nt.mode=vi;break e}if(Ye=0,ut=Ke,ot===0){if(Ye+=he-He,He<ht){ht-=He;do Qe[$++]=Ke[Ye++];while(--He);Ye=$-bt,ut=Qe}}else if(ot<He){if(Ye+=he+ot-He,He-=ot,He<ht){ht-=He;do Qe[$++]=Ke[Ye++];while(--He);if(Ye=0,ot<ht){He=ot,ht-=He;do Qe[$++]=Ke[Ye++];while(--He);Ye=$-bt,ut=Qe}}}else if(Ye+=ot-He,He<ht){ht-=He;do Qe[$++]=Ke[Ye++];while(--He);Ye=$-bt,ut=Qe}for(;ht>2;)Qe[$++]=ut[Ye++],Qe[$++]=ut[Ye++],Qe[$++]=ut[Ye++],ht-=3;ht&&(Qe[$++]=ut[Ye++],ht>1&&(Qe[$++]=ut[Ye++]))}else{Ye=$-bt;do Qe[$++]=Qe[Ye++],Qe[$++]=Qe[Ye++],Qe[$++]=Qe[Ye++],ht-=3;while(ht>2);ht&&(Qe[$++]=Qe[Ye++],ht>1&&(Qe[$++]=Qe[Ye++]))}}else if((He&64)===0){it=st[(it&65535)+(Be&(1<<He)-1)];continue i}else{G.msg="invalid distance code",nt.mode=vi;break e}break}}else if((He&64)===0){it=pt[(it&65535)+(Be&(1<<He)-1)];continue t}else if(He&32){nt.mode=jn;break e}else{G.msg="invalid literal/length code",nt.mode=vi;break e}break}}while(X<Q&&$<ge);ht=Xe>>3,X-=ht,Xe-=ht<<3,Be&=(1<<Xe)-1,G.next_in=X,G.next_out=$,G.avail_in=X<Q?5+(Q-X):5-(X-Q),G.avail_out=$<ge?257+(ge-$):257-($-ge),nt.hold=Be,nt.bits=Xe};const Yt=15,$i=852,Qi=592,Ji=0,Pi=1,qi=2,Hn=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),Kn=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),Zn=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),Xn=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var ni=(l,G,x,X,Q,$,xe,ge)=>{const Ze=ge.bits;let he=0,be=0,ot=0,Ke=0,Be=0,Xe=0,pt=0,st=0,qe=0,ft=0,it,He,ht,bt,Ye,ut=null,at;const Qe=new Uint16Array(Yt+1),nt=new Uint16Array(Yt+1);let jt=null,Zr,yi,Ei;for(he=0;he<=Yt;he++)Qe[he]=0;for(be=0;be<X;be++)Qe[G[x+be]]++;for(Be=Ze,Ke=Yt;Ke>=1&&Qe[Ke]===0;Ke--);if(Be>Ke&&(Be=Ke),Ke===0)return Q[$++]=1<<24|64<<16|0,Q[$++]=1<<24|64<<16|0,ge.bits=1,0;for(ot=1;ot<Ke&&Qe[ot]===0;ot++);for(Be<ot&&(Be=ot),st=1,he=1;he<=Yt;he++)if(st<<=1,st-=Qe[he],st<0)return-1;if(st>0&&(l===Ji||Ke!==1))return-1;for(nt[1]=0,he=1;he<Yt;he++)nt[he+1]=nt[he]+Qe[he];for(be=0;be<X;be++)G[x+be]!==0&&(xe[nt[G[x+be]]++]=be);if(l===Ji?(ut=jt=xe,at=20):l===Pi?(ut=Hn,jt=Kn,at=257):(ut=Zn,jt=Xn,at=0),ft=0,be=0,he=ot,Ye=$,Xe=Be,pt=0,ht=-1,qe=1<<Be,bt=qe-1,l===Pi&&qe>$i||l===qi&&qe>Qi)return 1;for(;;){Zr=he-pt,xe[be]+1<at?(yi=0,Ei=xe[be]):xe[be]>=at?(yi=jt[xe[be]-at],Ei=ut[xe[be]-at]):(yi=96,Ei=0),it=1<<he-pt,He=1<<Xe,ot=He;do He-=it,Q[Ye+(ft>>pt)+He]=Zr<<24|yi<<16|Ei|0;while(He!==0);for(it=1<<he-1;ft&it;)it>>=1;if(it!==0?(ft&=it-1,ft+=it):ft=0,be++,--Qe[he]===0){if(he===Ke)break;he=G[x+xe[be]]}if(he>Be&&(ft&bt)!==ht){for(pt===0&&(pt=Be),Ye+=ot,Xe=he-pt,st=1<<Xe;Xe+pt<Ke&&(st-=Qe[Xe+pt],!(st<=0));)Xe++,st<<=1;if(qe+=1<<Xe,l===Pi&&qe>$i||l===qi&&qe>Qi)return 1;ht=ft&bt,Q[ht]=Be<<24|Xe<<16|Ye-$|0}}return ft!==0&&(Q[Ye+ft]=he-pt<<24|64<<16|0),ge.bits=Be,0};const Yn=0,er=1,tr=2,{Z_FINISH:ir,Z_BLOCK:$n,Z_TREES:mi,Z_OK:Nt,Z_STREAM_END:Qn,Z_NEED_DICT:Jn,Z_STREAM_ERROR:Ct,Z_DATA_ERROR:rr,Z_MEM_ERROR:nr,Z_BUF_ERROR:qn,Z_DEFLATED:sr}=ce,pi=16180,ar=16181,or=16182,lr=16183,hr=16184,fr=16185,dr=16186,cr=16187,ur=16188,gr=16189,_i=16190,St=16191,Ii=16192,vr=16193,Ri=16194,mr=16195,pr=16196,_r=16197,xr=16198,xi=16199,bi=16200,br=16201,yr=16202,Er=16203,Ar=16204,Mr=16205,zi=16206,wr=16207,Cr=16208,mt=16209,Dr=16210,Tr=16211,es=852,ts=592,is=15,Lr=l=>(l>>>24&255)+(l>>>8&65280)+((l&65280)<<8)+((l&255)<<24);function rs(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const Vt=l=>{if(!l)return 1;const G=l.state;return!G||G.strm!==l||G.mode<pi||G.mode>Tr?1:0},Or=l=>{if(Vt(l))return Ct;const G=l.state;return l.total_in=l.total_out=G.total=0,l.msg="",G.wrap&&(l.adler=G.wrap&1),G.mode=pi,G.last=0,G.havedict=0,G.flags=-1,G.dmax=32768,G.head=null,G.hold=0,G.bits=0,G.lencode=G.lendyn=new Int32Array(es),G.distcode=G.distdyn=new Int32Array(ts),G.sane=1,G.back=-1,Nt},Sr=l=>{if(Vt(l))return Ct;const G=l.state;return G.wsize=0,G.whave=0,G.wnext=0,Or(l)},Pr=(l,G)=>{let x;if(Vt(l))return Ct;const X=l.state;return G<0?(x=0,G=-G):(x=(G>>4)+5,G<48&&(G&=15)),G&&(G<8||G>15)?Ct:(X.window!==null&&X.wbits!==G&&(X.window=null),X.wrap=x,X.wbits=G,Sr(l))},Ir=(l,G)=>{if(!l)return Ct;const x=new rs;l.state=x,x.strm=l,x.window=null,x.mode=pi;const X=Pr(l,G);return X!==Nt&&(l.state=null),X},ns=l=>Ir(l,is);let Rr=!0,Bi,Fi;const ss=l=>{if(Rr){Bi=new Int32Array(512),Fi=new Int32Array(32);let G=0;for(;G<144;)l.lens[G++]=8;for(;G<256;)l.lens[G++]=9;for(;G<280;)l.lens[G++]=7;for(;G<288;)l.lens[G++]=8;for(ni(er,l.lens,0,288,Bi,0,l.work,{bits:9}),G=0;G<32;)l.lens[G++]=5;ni(tr,l.lens,0,32,Fi,0,l.work,{bits:5}),Rr=!1}l.lencode=Bi,l.lenbits=9,l.distcode=Fi,l.distbits=5},zr=(l,G,x,X)=>{let Q;const $=l.state;return $.window===null&&($.wsize=1<<$.wbits,$.wnext=0,$.whave=0,$.window=new Uint8Array($.wsize)),X>=$.wsize?($.window.set(G.subarray(x-$.wsize,x),0),$.wnext=0,$.whave=$.wsize):(Q=$.wsize-$.wnext,Q>X&&(Q=X),$.window.set(G.subarray(x-X,x-X+Q),$.wnext),X-=Q,X?($.window.set(G.subarray(x-X,x),0),$.wnext=X,$.whave=$.wsize):($.wnext+=Q,$.wnext===$.wsize&&($.wnext=0),$.whave<$.wsize&&($.whave+=Q))),0},as=(l,G)=>{let x,X,Q,$,xe,ge,Ze,he,be,ot,Ke,Be,Xe,pt,st=0,qe,ft,it,He,ht,bt,Ye,ut;const at=new Uint8Array(4);let Qe,nt;const jt=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(Vt(l)||!l.output||!l.input&&l.avail_in!==0)return Ct;x=l.state,x.mode===St&&(x.mode=Ii),xe=l.next_out,Q=l.output,Ze=l.avail_out,$=l.next_in,X=l.input,ge=l.avail_in,he=x.hold,be=x.bits,ot=ge,Ke=Ze,ut=Nt;e:for(;;)switch(x.mode){case pi:if(x.wrap===0){x.mode=Ii;break}for(;be<16;){if(ge===0)break e;ge--,he+=X[$++]<<be,be+=8}if(x.wrap&2&&he===35615){x.wbits===0&&(x.wbits=15),x.check=0,at[0]=he&255,at[1]=he>>>8&255,x.check=D(x.check,at,2,0),he=0,be=0,x.mode=ar;break}if(x.head&&(x.head.done=!1),!(x.wrap&1)||(((he&255)<<8)+(he>>8))%31){l.msg="incorrect header check",x.mode=mt;break}if((he&15)!==sr){l.msg="unknown compression method",x.mode=mt;break}if(he>>>=4,be-=4,Ye=(he&15)+8,x.wbits===0&&(x.wbits=Ye),Ye>15||Ye>x.wbits){l.msg="invalid window size",x.mode=mt;break}x.dmax=1<<x.wbits,x.flags=0,l.adler=x.check=1,x.mode=he&512?gr:St,he=0,be=0;break;case ar:for(;be<16;){if(ge===0)break e;ge--,he+=X[$++]<<be,be+=8}if(x.flags=he,(x.flags&255)!==sr){l.msg="unknown compression method",x.mode=mt;break}if(x.flags&57344){l.msg="unknown header flags set",x.mode=mt;break}x.head&&(x.head.text=he>>8&1),x.flags&512&&x.wrap&4&&(at[0]=he&255,at[1]=he>>>8&255,x.check=D(x.check,at,2,0)),he=0,be=0,x.mode=or;case or:for(;be<32;){if(ge===0)break e;ge--,he+=X[$++]<<be,be+=8}x.head&&(x.head.time=he),x.flags&512&&x.wrap&4&&(at[0]=he&255,at[1]=he>>>8&255,at[2]=he>>>16&255,at[3]=he>>>24&255,x.check=D(x.check,at,4,0)),he=0,be=0,x.mode=lr;case lr:for(;be<16;){if(ge===0)break e;ge--,he+=X[$++]<<be,be+=8}x.head&&(x.head.xflags=he&255,x.head.os=he>>8),x.flags&512&&x.wrap&4&&(at[0]=he&255,at[1]=he>>>8&255,x.check=D(x.check,at,2,0)),he=0,be=0,x.mode=hr;case hr:if(x.flags&1024){for(;be<16;){if(ge===0)break e;ge--,he+=X[$++]<<be,be+=8}x.length=he,x.head&&(x.head.extra_len=he),x.flags&512&&x.wrap&4&&(at[0]=he&255,at[1]=he>>>8&255,x.check=D(x.check,at,2,0)),he=0,be=0}else x.head&&(x.head.extra=null);x.mode=fr;case fr:if(x.flags&1024&&(Be=x.length,Be>ge&&(Be=ge),Be&&(x.head&&(Ye=x.head.extra_len-x.length,x.head.extra||(x.head.extra=new Uint8Array(x.head.extra_len)),x.head.extra.set(X.subarray($,$+Be),Ye)),x.flags&512&&x.wrap&4&&(x.check=D(x.check,X,Be,$)),ge-=Be,$+=Be,x.length-=Be),x.length))break e;x.length=0,x.mode=dr;case dr:if(x.flags&2048){if(ge===0)break e;Be=0;do Ye=X[$+Be++],x.head&&Ye&&x.length<65536&&(x.head.name+=String.fromCharCode(Ye));while(Ye&&Be<ge);if(x.flags&512&&x.wrap&4&&(x.check=D(x.check,X,Be,$)),ge-=Be,$+=Be,Ye)break e}else x.head&&(x.head.name=null);x.length=0,x.mode=cr;case cr:if(x.flags&4096){if(ge===0)break e;Be=0;do Ye=X[$+Be++],x.head&&Ye&&x.length<65536&&(x.head.comment+=String.fromCharCode(Ye));while(Ye&&Be<ge);if(x.flags&512&&x.wrap&4&&(x.check=D(x.check,X,Be,$)),ge-=Be,$+=Be,Ye)break e}else x.head&&(x.head.comment=null);x.mode=ur;case ur:if(x.flags&512){for(;be<16;){if(ge===0)break e;ge--,he+=X[$++]<<be,be+=8}if(x.wrap&4&&he!==(x.check&65535)){l.msg="header crc mismatch",x.mode=mt;break}he=0,be=0}x.head&&(x.head.hcrc=x.flags>>9&1,x.head.done=!0),l.adler=x.check=0,x.mode=St;break;case gr:for(;be<32;){if(ge===0)break e;ge--,he+=X[$++]<<be,be+=8}l.adler=x.check=Lr(he),he=0,be=0,x.mode=_i;case _i:if(x.havedict===0)return l.next_out=xe,l.avail_out=Ze,l.next_in=$,l.avail_in=ge,x.hold=he,x.bits=be,Jn;l.adler=x.check=1,x.mode=St;case St:if(G===$n||G===mi)break e;case Ii:if(x.last){he>>>=be&7,be-=be&7,x.mode=zi;break}for(;be<3;){if(ge===0)break e;ge--,he+=X[$++]<<be,be+=8}switch(x.last=he&1,he>>>=1,be-=1,he&3){case 0:x.mode=vr;break;case 1:if(ss(x),x.mode=xi,G===mi){he>>>=2,be-=2;break e}break;case 2:x.mode=pr;break;case 3:l.msg="invalid block type",x.mode=mt}he>>>=2,be-=2;break;case vr:for(he>>>=be&7,be-=be&7;be<32;){if(ge===0)break e;ge--,he+=X[$++]<<be,be+=8}if((he&65535)!==(he>>>16^65535)){l.msg="invalid stored block lengths",x.mode=mt;break}if(x.length=he&65535,he=0,be=0,x.mode=Ri,G===mi)break e;case Ri:x.mode=mr;case mr:if(Be=x.length,Be){if(Be>ge&&(Be=ge),Be>Ze&&(Be=Ze),Be===0)break e;Q.set(X.subarray($,$+Be),xe),ge-=Be,$+=Be,Ze-=Be,xe+=Be,x.length-=Be;break}x.mode=St;break;case pr:for(;be<14;){if(ge===0)break e;ge--,he+=X[$++]<<be,be+=8}if(x.nlen=(he&31)+257,he>>>=5,be-=5,x.ndist=(he&31)+1,he>>>=5,be-=5,x.ncode=(he&15)+4,he>>>=4,be-=4,x.nlen>286||x.ndist>30){l.msg="too many length or distance symbols",x.mode=mt;break}x.have=0,x.mode=_r;case _r:for(;x.have<x.ncode;){for(;be<3;){if(ge===0)break e;ge--,he+=X[$++]<<be,be+=8}x.lens[jt[x.have++]]=he&7,he>>>=3,be-=3}for(;x.have<19;)x.lens[jt[x.have++]]=0;if(x.lencode=x.lendyn,x.lenbits=7,Qe={bits:x.lenbits},ut=ni(Yn,x.lens,0,19,x.lencode,0,x.work,Qe),x.lenbits=Qe.bits,ut){l.msg="invalid code lengths set",x.mode=mt;break}x.have=0,x.mode=xr;case xr:for(;x.have<x.nlen+x.ndist;){for(;st=x.lencode[he&(1<<x.lenbits)-1],qe=st>>>24,ft=st>>>16&255,it=st&65535,!(qe<=be);){if(ge===0)break e;ge--,he+=X[$++]<<be,be+=8}if(it<16)he>>>=qe,be-=qe,x.lens[x.have++]=it;else{if(it===16){for(nt=qe+2;be<nt;){if(ge===0)break e;ge--,he+=X[$++]<<be,be+=8}if(he>>>=qe,be-=qe,x.have===0){l.msg="invalid bit length repeat",x.mode=mt;break}Ye=x.lens[x.have-1],Be=3+(he&3),he>>>=2,be-=2}else if(it===17){for(nt=qe+3;be<nt;){if(ge===0)break e;ge--,he+=X[$++]<<be,be+=8}he>>>=qe,be-=qe,Ye=0,Be=3+(he&7),he>>>=3,be-=3}else{for(nt=qe+7;be<nt;){if(ge===0)break e;ge--,he+=X[$++]<<be,be+=8}he>>>=qe,be-=qe,Ye=0,Be=11+(he&127),he>>>=7,be-=7}if(x.have+Be>x.nlen+x.ndist){l.msg="invalid bit length repeat",x.mode=mt;break}for(;Be--;)x.lens[x.have++]=Ye}}if(x.mode===mt)break;if(x.lens[256]===0){l.msg="invalid code -- missing end-of-block",x.mode=mt;break}if(x.lenbits=9,Qe={bits:x.lenbits},ut=ni(er,x.lens,0,x.nlen,x.lencode,0,x.work,Qe),x.lenbits=Qe.bits,ut){l.msg="invalid literal/lengths set",x.mode=mt;break}if(x.distbits=6,x.distcode=x.distdyn,Qe={bits:x.distbits},ut=ni(tr,x.lens,x.nlen,x.ndist,x.distcode,0,x.work,Qe),x.distbits=Qe.bits,ut){l.msg="invalid distances set",x.mode=mt;break}if(x.mode=xi,G===mi)break e;case xi:x.mode=bi;case bi:if(ge>=6&&Ze>=258){l.next_out=xe,l.avail_out=Ze,l.next_in=$,l.avail_in=ge,x.hold=he,x.bits=be,kn(l,Ke),xe=l.next_out,Q=l.output,Ze=l.avail_out,$=l.next_in,X=l.input,ge=l.avail_in,he=x.hold,be=x.bits,x.mode===St&&(x.back=-1);break}for(x.back=0;st=x.lencode[he&(1<<x.lenbits)-1],qe=st>>>24,ft=st>>>16&255,it=st&65535,!(qe<=be);){if(ge===0)break e;ge--,he+=X[$++]<<be,be+=8}if(ft&&(ft&240)===0){for(He=qe,ht=ft,bt=it;st=x.lencode[bt+((he&(1<<He+ht)-1)>>He)],qe=st>>>24,ft=st>>>16&255,it=st&65535,!(He+qe<=be);){if(ge===0)break e;ge--,he+=X[$++]<<be,be+=8}he>>>=He,be-=He,x.back+=He}if(he>>>=qe,be-=qe,x.back+=qe,x.length=it,ft===0){x.mode=Mr;break}if(ft&32){x.back=-1,x.mode=St;break}if(ft&64){l.msg="invalid literal/length code",x.mode=mt;break}x.extra=ft&15,x.mode=br;case br:if(x.extra){for(nt=x.extra;be<nt;){if(ge===0)break e;ge--,he+=X[$++]<<be,be+=8}x.length+=he&(1<<x.extra)-1,he>>>=x.extra,be-=x.extra,x.back+=x.extra}x.was=x.length,x.mode=yr;case yr:for(;st=x.distcode[he&(1<<x.distbits)-1],qe=st>>>24,ft=st>>>16&255,it=st&65535,!(qe<=be);){if(ge===0)break e;ge--,he+=X[$++]<<be,be+=8}if((ft&240)===0){for(He=qe,ht=ft,bt=it;st=x.distcode[bt+((he&(1<<He+ht)-1)>>He)],qe=st>>>24,ft=st>>>16&255,it=st&65535,!(He+qe<=be);){if(ge===0)break e;ge--,he+=X[$++]<<be,be+=8}he>>>=He,be-=He,x.back+=He}if(he>>>=qe,be-=qe,x.back+=qe,ft&64){l.msg="invalid distance code",x.mode=mt;break}x.offset=it,x.extra=ft&15,x.mode=Er;case Er:if(x.extra){for(nt=x.extra;be<nt;){if(ge===0)break e;ge--,he+=X[$++]<<be,be+=8}x.offset+=he&(1<<x.extra)-1,he>>>=x.extra,be-=x.extra,x.back+=x.extra}if(x.offset>x.dmax){l.msg="invalid distance too far back",x.mode=mt;break}x.mode=Ar;case Ar:if(Ze===0)break e;if(Be=Ke-Ze,x.offset>Be){if(Be=x.offset-Be,Be>x.whave&&x.sane){l.msg="invalid distance too far back",x.mode=mt;break}Be>x.wnext?(Be-=x.wnext,Xe=x.wsize-Be):Xe=x.wnext-Be,Be>x.length&&(Be=x.length),pt=x.window}else pt=Q,Xe=xe-x.offset,Be=x.length;Be>Ze&&(Be=Ze),Ze-=Be,x.length-=Be;do Q[xe++]=pt[Xe++];while(--Be);x.length===0&&(x.mode=bi);break;case Mr:if(Ze===0)break e;Q[xe++]=x.length,Ze--,x.mode=bi;break;case zi:if(x.wrap){for(;be<32;){if(ge===0)break e;ge--,he|=X[$++]<<be,be+=8}if(Ke-=Ze,l.total_out+=Ke,x.total+=Ke,x.wrap&4&&Ke&&(l.adler=x.check=x.flags?D(x.check,Q,Ke,xe-Ke):ye(x.check,Q,Ke,xe-Ke)),Ke=Ze,x.wrap&4&&(x.flags?he:Lr(he))!==x.check){l.msg="incorrect data check",x.mode=mt;break}he=0,be=0}x.mode=wr;case wr:if(x.wrap&&x.flags){for(;be<32;){if(ge===0)break e;ge--,he+=X[$++]<<be,be+=8}if(x.wrap&4&&he!==(x.total&4294967295)){l.msg="incorrect length check",x.mode=mt;break}he=0,be=0}x.mode=Cr;case Cr:ut=Qn;break e;case mt:ut=rr;break e;case Dr:return nr;case Tr:default:return Ct}return l.next_out=xe,l.avail_out=Ze,l.next_in=$,l.avail_in=ge,x.hold=he,x.bits=be,(x.wsize||Ke!==l.avail_out&&x.mode<mt&&(x.mode<zi||G!==ir))&&zr(l,l.output,l.next_out,Ke-l.avail_out),ot-=l.avail_in,Ke-=l.avail_out,l.total_in+=ot,l.total_out+=Ke,x.total+=Ke,x.wrap&4&&Ke&&(l.adler=x.check=x.flags?D(x.check,Q,Ke,l.next_out-Ke):ye(x.check,Q,Ke,l.next_out-Ke)),l.data_type=x.bits+(x.last?64:0)+(x.mode===St?128:0)+(x.mode===xi||x.mode===Ri?256:0),(ot===0&&Ke===0||G===ir)&&ut===Nt&&(ut=qn),ut},os=l=>{if(Vt(l))return Ct;let G=l.state;return G.window&&(G.window=null),l.state=null,Nt},ls=(l,G)=>{if(Vt(l))return Ct;const x=l.state;return(x.wrap&2)===0?Ct:(x.head=G,G.done=!1,Nt)},hs=(l,G)=>{const x=G.length;let X,Q,$;return Vt(l)||(X=l.state,X.wrap!==0&&X.mode!==_i)?Ct:X.mode===_i&&(Q=1,Q=ye(Q,G,x,0),Q!==X.check)?rr:($=zr(l,G,x,x),$?(X.mode=Dr,nr):(X.havedict=1,Nt))};var fs=Sr,ds=Pr,cs=Or,us=ns,gs=Ir,vs=as,ms=os,ps=ls,_s=hs,xs="pako inflate (from Nodeca project)",Pt={inflateReset:fs,inflateReset2:ds,inflateResetKeep:cs,inflateInit:us,inflateInit2:gs,inflate:vs,inflateEnd:ms,inflateGetHeader:ps,inflateSetDictionary:_s,inflateInfo:xs};function bs(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}var ys=bs;const Br=Object.prototype.toString,{Z_NO_FLUSH:Es,Z_FINISH:As,Z_OK:si,Z_STREAM_END:Ui,Z_NEED_DICT:Wi,Z_STREAM_ERROR:Ms,Z_DATA_ERROR:Fr,Z_MEM_ERROR:ws}=ce;function ai(l){this.options=ui.assign({chunkSize:65536,windowBits:15,to:""},l||{});const G=this.options;G.raw&&G.windowBits>=0&&G.windowBits<16&&(G.windowBits=-G.windowBits,G.windowBits===0&&(G.windowBits=-15)),G.windowBits>=0&&G.windowBits<16&&!(l&&l.windowBits)&&(G.windowBits+=32),G.windowBits>15&&G.windowBits<48&&(G.windowBits&15)===0&&(G.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Xi,this.strm.avail_out=0;let x=Pt.inflateInit2(this.strm,G.windowBits);if(x!==si)throw new Error(ue[x]);if(this.header=new ys,Pt.inflateGetHeader(this.strm,this.header),G.dictionary&&(typeof G.dictionary=="string"?G.dictionary=ii.string2buf(G.dictionary):Br.call(G.dictionary)==="[object ArrayBuffer]"&&(G.dictionary=new Uint8Array(G.dictionary)),G.raw&&(x=Pt.inflateSetDictionary(this.strm,G.dictionary),x!==si)))throw new Error(ue[x])}ai.prototype.push=function(l,G){const x=this.strm,X=this.options.chunkSize,Q=this.options.dictionary;let $,xe,ge;if(this.ended)return!1;for(G===~~G?xe=G:xe=G===!0?As:Es,Br.call(l)==="[object ArrayBuffer]"?x.input=new Uint8Array(l):x.input=l,x.next_in=0,x.avail_in=x.input.length;;){for(x.avail_out===0&&(x.output=new Uint8Array(X),x.next_out=0,x.avail_out=X),$=Pt.inflate(x,xe),$===Wi&&Q&&($=Pt.inflateSetDictionary(x,Q),$===si?$=Pt.inflate(x,xe):$===Fr&&($=Wi));x.avail_in>0&&$===Ui&&x.state.wrap>0&&l[x.next_in]!==0;)Pt.inflateReset(x),$=Pt.inflate(x,xe);switch($){case Ms:case Fr:case Wi:case ws:return this.onEnd($),this.ended=!0,!1}if(ge=x.avail_out,x.next_out&&(x.avail_out===0||$===Ui))if(this.options.to==="string"){let Ze=ii.utf8border(x.output,x.next_out),he=x.next_out-Ze,be=ii.buf2string(x.output,Ze);x.next_out=he,x.avail_out=X-he,he&&x.output.set(x.output.subarray(Ze,Ze+he),0),this.onData(be)}else this.onData(x.output.length===x.next_out?x.output:x.output.subarray(0,x.next_out));if(!($===si&&ge===0)){if($===Ui)return $=Pt.inflateEnd(this.strm),this.onEnd($),this.ended=!0,!0;if(x.avail_in===0)break}}return!0},ai.prototype.onData=function(l){this.chunks.push(l)},ai.prototype.onEnd=function(l){l===si&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=ui.flattenChunks(this.chunks)),this.chunks=[],this.err=l,this.msg=this.strm.msg};function Gi(l,G){const x=new ai(G);if(x.push(l),x.err)throw x.msg||ue[x.err];return x.result}function Cs(l,G){return G=G||{},G.raw=!0,Gi(l,G)}var Ds=ai,Ts=Gi,Ls=Cs,Os=Gi,Ss={Inflate:Ds,inflate:Ts,inflateRaw:Ls,ungzip:Os};const{Deflate:Ps,deflate:Is,deflateRaw:Rs,gzip:zs}=Vn,{Inflate:Bs,inflate:Fs,inflateRaw:Us,ungzip:Ws}=Ss;var Ur=Ps,Wr=Is,Gr=Rs,Nr=zs,Vr=Bs,jr=Fs,kr=Us,Hr=Ws,Kr=ce,Gs={Deflate:Ur,deflate:Wr,deflateRaw:Gr,gzip:Nr,Inflate:Vr,inflate:jr,inflateRaw:kr,ungzip:Hr,constants:Kr}}},__webpack_module_cache__={};function __webpack_require__(K){var C=__webpack_module_cache__[K];if(C!==void 0)return C.exports;var d=__webpack_module_cache__[K]={exports:{}};return __webpack_modules__[K].call(d.exports,d,d.exports,__webpack_require__),d.exports}__webpack_require__.n=K=>{var C=K&&K.__esModule?()=>K.default:()=>K;return __webpack_require__.d(C,{a:C}),C},__webpack_require__.d=(K,C)=>{for(var d in C)__webpack_require__.o(C,d)&&!__webpack_require__.o(K,d)&&Object.defineProperty(K,d,{enumerable:!0,get:C[d]})},__webpack_require__.o=(K,C)=>Object.prototype.hasOwnProperty.call(K,C),__webpack_require__.r=K=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(K,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(K,"__esModule",{value:!0})},__webpack_require__("./src/index.ts"),__webpack_require__("./src/SurfaceWorker.js");var __webpack_exports__=__webpack_require__("./src/exporter.js");return __webpack_exports__})())}(_3Dmol$2)),_3Dmol$2.exports}var _3DmolExports=require_3Dmol();const _3Dmol=_mergeNamespaces({__proto__:null},[_3DmolExports]);export{_3Dmol as _};
